head	1.63;
access;
symbols
	tg-mergetmp-mirosx-1:1.63.2.2
	tg-mergefixes-1-branch:1.63.0.4
	tg-mergefixes-1-base:1.63
	MIROS_X:1.63.0.2
	MIROS_X_BASE:1.63
	tg-mergetmp-3:1.63
	cvs-200412031430:1.1.1.7
	MIRBSD_XP_MIRPPC:1.48.0.4
	MIRBSD_XP_SPARC_BASE:1.48
	MIRBSD_XP_SPARC:1.48.0.2
	MIRBSD_7quater:1.19.2.6.2.1
	cvs-200405160640:1.1.1.6
	cvs-200401271800:1.1.1.5
	cvs-200401261630:1.1.1.5
	cvs-200401021645:1.1.1.4
	MIRBSD_7_ALPHA:1.19.2.6.0.4
	MIRBSD_7:1.19.2.6.0.2
	cvs-200312222040:1.1.1.4
	MIRBSD_7ter:1.19.2.6
	MIRBSD_7_DEV:1.19.0.2
	cvs-200310020700:1.1.1.3
	cvs-200309271030:1.1.1.3
	cvs-200309251530:1.1.1.3
	cvs-200308302005:1.1.1.3
	cvs-200308171200:1.1.1.3
	ctm-3496:1.1.1.3
	ctm-3449:1.1.1.3
	ctm-3437:1.1.1.3
	cvs-200307191805:1.1.1.3
	ctm-3425:1.1.1.3
	cvs-200307091500:1.1.1.3
	ctm-3389:1.1.1.3
	cvs-200306291430:1.1.1.3
	ctm-3341:1.1.1.3
	MIRBSD_5:1.7
	cvs-200306082100:1.1.1.3
	ctm-3316:1.1.1.3
	ctm-3272:1.1.1.3
	ctm-3264:1.1.1.2
	cvs-200305071630:1.1.1.2
	MIRBSD_4:1.2
	ctm-3203:1.1.1.1
	cvs-20030410-1130:1.1.1.1
	ctm-3155:1.1.1.1
	ctm-3132:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.63
date	2004.12.15.09.10.31;	author tg;	state Exp;
branches
	1.63.2.1
	1.63.4.1;
next	1.62;

1.62
date	2004.12.14.19.22.06;	author tg;	state Exp;
branches;
next	1.61;

1.61
date	2004.12.14.19.21.09;	author tg;	state Exp;
branches;
next	1.60;

1.60
date	2004.12.14.19.07.47;	author tg;	state Exp;
branches;
next	1.59;

1.59
date	2004.12.14.18.54.49;	author tg;	state Exp;
branches;
next	1.58;

1.58
date	2004.12.09.19.19.18;	author tg;	state Exp;
branches;
next	1.57;

1.57
date	2004.12.09.18.59.01;	author tg;	state Exp;
branches;
next	1.56;

1.56
date	2004.12.05.19.37.04;	author tg;	state Exp;
branches;
next	1.55;

1.55
date	2004.12.03.23.03.44;	author tg;	state Exp;
branches;
next	1.54;

1.54
date	2004.11.30.16.46.50;	author tg;	state Exp;
branches;
next	1.53;

1.53
date	2004.11.28.02.02.00;	author tg;	state Exp;
branches;
next	1.52;

1.52
date	2004.11.13.20.22.54;	author tg;	state Exp;
branches;
next	1.51;

1.51
date	2004.10.24.15.11.12;	author tg;	state Exp;
branches;
next	1.50;

1.50
date	2004.10.21.14.22.24;	author tg;	state Exp;
branches;
next	1.49;

1.49
date	2004.10.10.23.37.55;	author tg;	state Exp;
branches;
next	1.48;

1.48
date	2004.10.08.04.21.13;	author tg;	state Exp;
branches;
next	1.47;

1.47
date	2004.08.14.04.30.07;	author tg;	state Stab;
branches;
next	1.46;

1.46
date	2004.08.13.21.13.43;	author tg;	state Exp;
branches;
next	1.45;

1.45
date	2004.08.13.15.51.46;	author tg;	state Exp;
branches;
next	1.44;

1.44
date	2004.08.13.15.46.26;	author tg;	state Exp;
branches;
next	1.43;

1.43
date	2004.08.13.15.33.55;	author tg;	state Exp;
branches;
next	1.42;

1.42
date	2004.07.18.13.26.21;	author tg;	state Exp;
branches;
next	1.41;

1.41
date	2004.07.18.12.28.11;	author tg;	state Exp;
branches;
next	1.40;

1.40
date	2004.07.14.11.21.20;	author tg;	state Exp;
branches;
next	1.39;

1.39
date	2004.06.17.19.52.40;	author tg;	state Exp;
branches;
next	1.38;

1.38
date	2004.06.16.15.44.20;	author tg;	state Exp;
branches;
next	1.37;

1.37
date	2004.06.14.00.25.39;	author tg;	state Exp;
branches;
next	1.36;

1.36
date	2004.05.22.00.19.23;	author tg;	state Exp;
branches;
next	1.35;

1.35
date	2004.05.21.19.28.58;	author tg;	state Exp;
branches;
next	1.34;

1.34
date	2004.05.02.16.37.07;	author tg;	state Exp;
branches;
next	1.33;

1.33
date	2004.03.14.17.57.22;	author tg;	state Exp;
branches;
next	1.32;

1.32
date	2004.03.11.18.35.21;	author tg;	state Exp;
branches;
next	1.31;

1.31
date	2004.03.10.17.37.09;	author tg;	state Exp;
branches;
next	1.30;

1.30
date	2004.01.27.17.41.28;	author tg;	state Exp;
branches;
next	1.29;

1.29
date	2004.01.21.15.07.01;	author tg;	state Exp;
branches;
next	1.28;

1.28
date	2004.01.21.11.59.23;	author tg;	state Exp;
branches;
next	1.27;

1.27
date	2004.01.20.19.31.19;	author tg;	state Exp;
branches;
next	1.26;

1.26
date	2004.01.20.19.22.14;	author tg;	state Exp;
branches;
next	1.25;

1.25
date	2004.01.03.04.56.36;	author tg;	state Exp;
branches;
next	1.24;

1.24
date	2003.12.28.00.17.33;	author tg;	state Exp;
branches;
next	1.23;

1.23
date	2003.12.23.13.41.45;	author tg;	state Exp;
branches;
next	1.22;

1.22
date	2003.12.17.17.47.04;	author tg;	state Exp;
branches;
next	1.21;

1.21
date	2003.12.10.21.45.00;	author tg;	state Exp;
branches;
next	1.20;

1.20
date	2003.11.16.10.45.19;	author tg;	state Exp;
branches;
next	1.19;

1.19
date	2003.10.03.11.32.15;	author tg;	state Exp;
branches
	1.19.2.1;
next	1.18;

1.18
date	2003.09.03.22.52.43;	author tg;	state Exp;
branches;
next	1.17;

1.17
date	2003.09.03.18.50.09;	author tg;	state Exp;
branches;
next	1.16;

1.16
date	2003.09.02.08.54.40;	author tg;	state Exp;
branches;
next	1.15;

1.15
date	2003.09.02.08.43.30;	author tg;	state Exp;
branches;
next	1.14;

1.14
date	2003.09.02.08.34.57;	author tg;	state Exp;
branches;
next	1.13;

1.13
date	2003.09.02.08.34.15;	author tg;	state Exp;
branches;
next	1.12;

1.12
date	2003.09.02.01.32.06;	author tg;	state Exp;
branches;
next	1.11;

1.11
date	2003.07.20.20.58.27;	author tg;	state Exp;
branches;
next	1.10;

1.10
date	2003.07.19.20.21.18;	author tg;	state Exp;
branches;
next	1.9;

1.9
date	2003.06.30.15.47.27;	author tg;	state Exp;
branches;
next	1.8;

1.8
date	2003.06.30.15.46.57;	author tg;	state Exp;
branches;
next	1.7;

1.7
date	2003.06.02.16.30.20;	author tg;	state Exp;
branches;
next	1.6;

1.6
date	2003.05.22.14.04.46;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2003.05.18.22.40.12;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2003.05.18.12.14.13;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2003.05.07.20.52.09;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2003.03.23.21.43.33;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.22.17.34.59;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.03.22.17.34.59;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.05.07.17.15.09;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2003.05.21.18.35.44;	author tg;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2003.12.22.20.22.28;	author tg;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2004.01.26.16.54.38;	author tg;	state Exp;
branches;
next	1.1.1.6;

1.1.1.6
date	2004.05.16.07.16.32;	author tg;	state Exp;
branches;
next	1.1.1.7;

1.1.1.7
date	2004.12.03.14.35.04;	author tg;	state Exp;
branches;
next	;

1.19.2.1
date	2003.10.23.20.37.04;	author tg;	state Exp;
branches;
next	1.19.2.2;

1.19.2.2
date	2003.11.09.19.33.27;	author tg;	state Exp;
branches;
next	1.19.2.3;

1.19.2.3
date	2003.11.15.21.19.50;	author tg;	state Exp;
branches;
next	1.19.2.4;

1.19.2.4
date	2003.11.19.16.26.20;	author tg;	state Exp;
branches;
next	1.19.2.5;

1.19.2.5
date	2003.11.19.19.13.11;	author tg;	state Exp;
branches;
next	1.19.2.6;

1.19.2.6
date	2003.11.20.12.09.30;	author tg;	state Exp;
branches
	1.19.2.6.2.1;
next	;

1.19.2.6.2.1
date	2004.06.02.18.53.38;	author tg;	state Exp;
branches;
next	;

1.63.2.1
date	2004.12.27.23.43.40;	author tg;	state Exp;
branches;
next	1.63.2.2;

1.63.2.2
date	2004.12.28.11.33.48;	author tg;	state Exp;
branches;
next	;

1.63.4.1
date	2004.12.28.18.42.14;	author tg;	state Exp;
branches;
next	;


desc
@@


1.63
log
@correctly create the systrace policy for a make release
XXX only when make b-r or contrelease issued, breaks
XXX	doign a simple cd etc; make release destdir= releasedir=
XXX need to test this with make build again
@
text
@# $MirBSD: src/Makefile,v 1.62 2004/12/14 19:22:06 tg Exp $
# $OpenBSD: Makefile,v 1.103 2004/05/03 15:18:18 drahn Exp $
#
# For more information on building in tricky environments, please see
# the list of possible environment variables described in
# /usr/share/mk/bsd.README.
#
# Building recommendations:
#
# 1) If at all possible, put this source tree in /usr/src.  If /usr/src
# must be a symbolic link, setenv BSDSRCDIR to point to the real location.
#
# 2) It is also recommended that you compile with objects outside the
# source tree. To do this, ensure /usr/obj exists or points to some
# area of disk of sufficient size.  Then do "cd /usr/src; make obj".
# This will make a symbolic link called "obj" in each directory, as
# well as populate the /usr/obj properly with directories for the
# objects.
# The "b-r" target does this automatically.
#
# 3) It is strongly recommended that you build and install a new kernel
# before rebuilding your system. Some of the new programs may use new
# functionality or depend on API changes that your old kernel doesn't have.
#
# 4) If you are reasonably sure that things will compile OK, use the
# "make build" target supplied here. Good luck.

.include <bsd.own.mk>
.include "Makefile.inc"
MYDESTDIR?=	${BSDOBJDIR}/D
MYRELDIR?=	${BSDOBJDIR}/R

.if !exists(X-Window)
SKIPDIR+=	X-Window
.endif

.if make(obj)
#SUBDIR+= X-Window
.endif

SUBDIR+= lib
SUBDIR+= include
SUBDIR+= bin
SUBDIR+= libexec
SUBDIR+= sbin
SUBDIR+= usr.bin
SUBDIR+= usr.sbin
SUBDIR+= share
SUBDIR+= gnu
SUBDIR+= sys

.if make(clean) || make(cleandir) || make(obj)
SUBDIR+= distrib
.endif

includes:
	cd ${.CURDIR}/include && ${MAKE} prereq && exec ${SUDO} ${MAKE} includes

beforeinstall:
	cd ${.CURDIR}/etc && exec ${MAKE} DESTDIR=${DESTDIR} distrib-dirs
	cd ${.CURDIR}/include && exec ${MAKE} includes

afterinstall:
.if !defined(NOMAN) || ${NOMAN:L} == "no"
	cd ${.CURDIR}/share/man && exec ${MAKE} makedb
.endif
	-rm -f ${_STFILE_DEST}

mksystrace: mksystrace-obj mksystrace-dest

mksystrace-obj:
	cd ${BSDOBJDIR} && env WRITEDIR="${BSDOBJDIR}/*" \
	    ${SHELL} ${BSDSRCDIR}/scripts/systrace.mk make

mksystrace-dest:
	d="${DESTDIR}"; cd $${d:-/} && env WRITEDIR="$${d:-/}:$$d/*" \
	    ${SUDO} ${SHELL} ${BSDSRCDIR}/scripts/systrace.mk make

build: mksystrace
	cd ${.CURDIR}/share/mk \
	    && exec ${SUDO} ${_STCMD_DEST} ${MAKE} install
	cd ${.CURDIR}/include \
	    && ${_STCMD_OBJ} ${MAKE} prereq \
	    && exec ${SUDO} ${_STCMD_DEST} ${MAKE} includes
	${SUDO} ${_STCMD_OBJ} ${MAKE} cleandir
	cd ${.CURDIR}/lib \
	    && ${_STCMD_OBJ} ${MAKE} depend \
	    && ${_STCMD_OBJ} ${MAKE} \
	    && exec ${SUDO} ${_STCMD_DEST} ${MAKE} install NOMAN=yes
	${_STCMD_OBJ} ${MAKE} depend
	# The build is now restartable from here.
	exec ${MAKE} contbuild

contbuild:
	${_STCMD_OBJ} ${MAKE} \
	    && ${SUDO} ${_STCMD_DEST} ${MAKE} install
	-rm -f ${_STFILE_OBJ}

distrib-dirs:
	cd ${.CURDIR}/etc && ${SUDO} ${MAKE} distrib-dirs DESTDIR=${DESTDIR}

b-r: .PHONY
	@@if mount 2>&1 | fgrep " on /mnt" >/dev/null 2>&1; then \
		print '========================================='; \
		print ' Cannot "make b-r" when something is'; \
		print ' mounted at /mnt. Please umount first!'; \
		print '========================================='; \
		exit 1; fi
	# Test if the targets are mounted suitable for root (BTSTF)
.for _dir in ${BSDOBJDIR} ${MYDESTDIR} ${MYRELDIR}
	mkdir -p ${_dir} || ${SUDO} mkdir -p ${_dir}
	${SUDO} touch ${_dir}/permissions.test
	${SUDO} chown root:wheel ${_dir}/permissions.test
	${SUDO} rm ${_dir}/permissions.test
.endfor
	touch ${BSDOBJDIR}/permissions.test && rm ${BSDOBJDIR}/permissions.test
	@@echo "============================================================"
	@@date
	@@echo "============================================================"
	${MAKE} obj
	${MAKE} build
	${MAKE} contrelease MYDESTDIR=${MYDESTDIR} MYRELDIR=${MYRELDIR}

contrelease:
	mkdir -p ${MYDESTDIR}/base ${MYRELDIR} \
	    || ${SUDO} mkdir -p ${MYDESTDIR}/base ${MYRELDIR}
	cd ${.CURDIR} && ${MAKE} mksystrace-dest DESTDIR=${MYDESTDIR}/base
	cd ${.CURDIR}/etc && exec ${MAKE} \
	    release DESTDIR=${MYDESTDIR}/base RELEASEDIR=${MYRELDIR}
	@@echo "============================================================"
	@@echo "Build and Release complete."
	@@date; uname -a
	@@echo "============================================================"
	mkdir -p ${MYDESTDIR}/htman || ${SUDO} mkdir -p ${MYDESTDIR}/htman
	cd ${.CURDIR}/etc && exec ${MAKE} htman RELEASEDIR=${MYRELDIR} \
	    DESTDIR=${MYDESTDIR}/htman BASEDESTDIR=${MYDESTDIR}/base
	@@${MAKE} contrelease-x MYDESTDIR=${MYDESTDIR} MYRELDIR=${MYRELDIR}

contrelease-x:
.if defined(SKIPDIR) && ${SKIPDIR:MX-Window}
	@@echo 'NOT building X-Window!'
.else
	cd ${BSDOBJDIR}/X-Window && ${MAKE} build
	mkdir -p ${MYDESTDIR}/x11 || ${SUDO} mkdir -p ${MYDESTDIR}/x11
	cd ${BSDOBJDIR}/X-Window && ${SUDO} ${MAKE} release \
	    DESTDIR=${MYDESTDIR}/x11 RELEASEDIR=${MYRELDIR}
	cd ${MYRELDIR}; md5 x* | ${SUDO} tee -a MD5
	@@echo "Build of X11 complete on $$(date)"
.endif
	@@echo "============================================================"

CVSROOT?=/cvs
cvsup:
	-rm -f ${.CURDIR}/build.log
	cd ${.CURDIR} && cvs -Rqz3 -d ${CVSROOT} up -PAd [!CXcmtw]!(*cc) .*

.PHONY:	includes beforeinstall afterinstall build release b-r \
	contbuild contrelease contrelease-x distrib-dirs cvsup \
	mksystrace mksystrace-obj mksystrace-dest

.include <bsd.subdir.mk>
@


1.63.4.1
log
@merge the first bunch of MirOS X (branch MIROS_X tag tg-mergetmp-mirosx-1) into mergefixes branch
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.63.2.2 2004/12/28 11:33:48 tg Exp $
a47 1
.if ${CROSS_MODE:L} != "yes"
a50 1
.endif
@


1.63.2.1
log
@first MirOS X stage

I've been able to build a few static libraries, but
didn't try gnat, the crt*.o don't install themselfes,
and the multilib:soft-float removat must be tested.

Though, the following appeared:
tg@@odem:/usr/src/bin/cat/obj.macppc $ file cat
cat: ELF 32-bit MSB executable, PowerPC, version 1, for MirOS BSD, statically linked, not stripped
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.63 2004/12/15 09:10:31 tg Exp $
a47 1
.ifndef CROSS_MODE
a50 1
.endif
@


1.63.2.2
log
@unbreak make obj
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.63.2.1 2004/12/27 23:43:40 tg Exp $
d48 1
a48 1
.if ${CROSS_MODE:L} != "yes"
@


1.62
log
@.PHONY though shalt be
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.61 2004/12/14 19:21:09 tg Exp $
d76 1
a76 1
	d="${DESTDIR}"; cd $${d:-/} && env WRITEDIR="$$d/*" \
d127 1
@


1.61
log
@more fixage for directory globbing etc.
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.60 2004/12/14 19:07:47 tg Exp $
d157 2
a158 1
	contbuild contrelease contrelease-x distrib-dirs cvsup mksystrace
@


1.60
log
@release, too (except kernel builds)
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.59 2004/12/14 18:54:49 tg Exp $
d72 1
a72 1
	cd ${BSDOBJDIR} && env WRITEDIR="${BSDOBJDIR}" \
d76 1
a76 1
	cd ${DESTDIR} && env WRITEDIR="${DESTDIR}" \
@


1.59
log
@(experimental) enable systrace'd build
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.57 2004/12/09 18:59:01 tg Exp $
d29 1
d69 1
a69 5
_STCMD=		/bin/systrace -e -i -a
_STFILE_OBJ=	${BSDOBJDIR}/systrace.policy
_STFILE_DEST=	${DESTDIR}/systrace.policy
_STCMD_OBJ=	${_STCMD} -f ${_STFILE_OBJ}
_STCMD_DEST=	${_STCMD} -f ${_STFILE_DEST}
d71 1
a71 1
mksystrace:
d74 2
@


1.58
log
@move GNU libiberty to binutils, where its source is,
and remove the special handling of it
@
text
@d37 1
a37 1
SUBDIR+= X-Window
d66 1
d68 15
a82 2
build:
	cd ${.CURDIR}/share/mk && exec ${SUDO} ${MAKE} install
d84 8
a91 5
	    && ${MAKE} prereq && exec ${SUDO} ${MAKE} includes
	${SUDO} ${MAKE} cleandir
	cd ${.CURDIR}/lib && ${MAKE} depend && ${MAKE} && \
	    NOMAN=yes exec ${SUDO} ${MAKE} install
	${MAKE} depend
d96 3
a98 1
	${MAKE} && exec ${SUDO} ${MAKE} install
d158 1
a158 1
	contbuild contrelease contrelease-x distrib-dirs cvsup
@


1.57
log
@* games went off to ports/games/bsdgames
* don't install isakmpd or ctm samples
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.56 2004/12/05 19:37:04 tg Exp $
a72 2
	    NOMAN=yes exec ${SUDO} ${MAKE} install
	cd ${.CURDIR}/gnu/lib && ${MAKE} depend && ${MAKE} && \
@


1.56
log
@wow... in May 2004, our last OpenBSD sync was done
bit since May 2003, OpenBSD doesn't build libperl twice
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.55 2004/12/03 23:03:44 tg Exp $
a47 1
SUBDIR+= games
@


1.55
log
@additional touch
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.54 2004/11/30 16:46:50 tg Exp $
a76 4
	cd ${.CURDIR}/gnu/usr.bin/perl && \
	    ${MAKE} -f Makefile.bsd-wrapper depend && \
	    ${MAKE} -f Makefile.bsd-wrapper perl.lib && \
	    exec ${SUDO} ${MAKE} -f Makefile.bsd-wrapper install.lib
@


1.54
log
@remove NOPROFILE traces (we can't build profiled libs anyway)
switch NOMAN, NOLINT, NOPROG to yes/no logic (defaulting to yes if defined)
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.53 2004/11/28 02:02:00 tg Exp $
d105 1
@


1.53
log
@* fix a few cases where DESTDIR wasn't honoured
* fix a few cases where CFLAGS (specifically the
  new global -Werror) wasn't honoured
* fix a bunch of warnings and errors
  (for takers: there are quite a few left, I fixed
  the most important ones. Don't care about gcc3.2
  though, it'll die RSN. Perl or Lynx are probably
  good targets.)
* fix parameter passing to HTML manpage generation
  (noticed outside the chroot and with a known bad
  config only... jarejare... we should build stuff
  with a ports-like systrace (I have worn the idea
  for weeks).
* sync lists

I'm not too sure about this code being release-quality
yet, but OTOH it works without too much failures.
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.52 2004/11/13 20:22:54 tg Exp $
d64 1
a64 1
.ifndef NOMAN
d74 1
a74 1
	    NOMAN=1 exec ${SUDO} ${MAKE} install
d76 1
a76 1
	    NOMAN=1 exec ${SUDO} ${MAKE} install
@


1.52
log
@if !exists(X-Window) add it to SKIPDIRS
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.51 2004/10/24 15:11:12 tg Exp $
d122 2
a123 2
	cd ${.CURDIR}/etc && exec ${MAKE} \
	    htman DESTDIR=${MYDESTDIR}/htman RELEASEDIR=${MYRELDIR}
@


1.51
log
@sync, after make b-r w/o X
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.50 2004/10/21 14:22:24 tg Exp $
d32 4
d52 1
a52 1
.if   make(clean) || make(cleandir) || make(obj)
@


1.50
log
@* move distrib/lists/<set> to distrib/lists/base/<set>
  so the new structure is distrib/lists/<list>/<set>/mi
  where <list> is the same as in /usr/obj/D/<list>
  and distrib/lists/<list>/ignfiles exist
* add new set htman8.ngz containing the online manpages
* copy old contrib/samples/man2htm.sh, slightly adapted
  for the release process, here
* generate that set during make b-r
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.49 2004/10/10 23:37:55 tg Exp $
d96 2
a97 2
	( mkdir -p ${_dir} || ${SUDO} mkdir -p ${_dir} ) \
	    && ${SUDO} touch ${_dir}/permissions.test
d109 2
a110 1
	${SUDO} mkdir -p ${MYDESTDIR}/base ${MYRELDIR}
@


1.49
log
@update dot-files, too, on 'make cvsup'
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.48 2004/10/08 04:21:13 tg Exp $
d96 2
a97 1
	${SUDO} mkdir -p ${_dir} && ${SUDO} touch ${_dir}/permissions.test
d116 3
d126 1
a126 1
	${SUDO} mkdir -p ${MYDESTDIR}/x11
@


1.48
log
@nice 'cvs up' target for only the base
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.47 2004/08/14 04:30:07 tg Stab $
d133 1
a133 1
	cd ${.CURDIR} && cvs -Rqz3 -d ${CVSROOT} up -PAd [!CXcmtw]!(*cc)
@


1.47
log
@don't build X as root
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.46 2004/08/13 21:13:43 tg Exp $
d130 5
d136 1
a136 1
	contbuild contrelease contrelease-x distrib-dirs
@


1.46
log
@a way to redo from X
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.45 2004/08/13 15:51:46 tg Exp $
d121 1
a121 1
	cd ${BSDOBJDIR}/X-Window && ${SUDO} ${MAKE} build
@


1.45
log
@@@ before echo/print
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.44 2004/08/13 15:46:26 tg Exp $
d115 3
d130 2
a131 2
.PHONY:	includes beforeinstall afterinstall build \
	release b-r contbuild contrelease distrib-dirs
@


1.44
log
@call checkflist before makeflist, optionally wait
remove a few superfluous targets (leftovers from MirOS #0 or #1 or so)
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.43 2004/08/13 15:33:55 tg Exp $
d123 1
a123 1
	echo "Build of X11 complete on $$(date)"
@


1.43
log
@want full output of X in b-r mode here
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.42 2004/07/18 13:26:21 tg Exp $
a110 5
	@@echo "============================================================"
	@@echo "Checking files:"
	@@echo ""
	-@@cd ${BSDSRCDIR}/distrib/lists && DESTDIR=${MYDESTDIR}/base \
	    ${SUDO} ${SHELL} ${BSDSRCDIR}/scripts/checkflist
@


1.42
log
@nuke egcs (pgcc, gcc2) and simplify the system a bit
also fix placement of GNUSYSTEM_AUX_DIR equation in <bsd.own.mk> while here
remove some sparc and xc-old/xc-mit remnants
for now, all distribution lists are mi, since we only have 1 arch

XXX comp is second-largest now (after xfont), need ideas, come to IRC

agreed: <benz|lernen> joa, warum nicht
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.41 2004/07/18 12:28:11 tg Exp $
d123 1
d125 2
a126 5
	cd ${BSDOBJDIR}/X-Window; \
	    ${SUDO} rm -rf dest rel; \
	    ${SUDO} ln -s ${MYDESTDIR}/x11 dest; \
	    ${SUDO} ln -s ${MYRELDIR} rel; \
	    ${SUDO} ${MAKE} b-r
@


1.41
log
@nuke regression tests

noone actually uses them (I've run them about half a dozen times only),
some of the tests (eg. everything PF) are broken, some of the code is
broken... and the adventurous are invited to use CVS and fix them,
maybe on a tagged branch.
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.40 2004/07/14 11:21:20 tg Exp $
a114 1
	    HAS_GCC2="${HAS_GCC2:L}" HAS_GCC3="${HAS_GCC3:L}" \
@


1.40
log
@put in some effort to
* fix the boot loader output
* fix ramdisk root device selection
* make release with as few sudo as possible
* fix COPTS selection for the anoncvsbin
* fix COPTS (no -g) for the kernel
  (a kernel with DEBUG=-g needs a higher ulimit -d)
* clean up in general
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.39 2004/06/17 19:52:40 tg Exp $
d49 1
a49 7
SUBDIR+= distrib regress
.endif

.if exists(regress)
regression-tests:
	@@echo Running regression tests...
	@@cd ${.CURDIR}/regress && ${MAKE} depend && exec ${MAKE} regress
d135 1
a135 1
.PHONY:	regression-tests includes beforeinstall afterinstall build \
@


1.39
log
@preliminary build fixes, whitespace fixes, dependency fixes,
manpage installation and naming fixes, programme hard-link
fixes & addition to <bsd.cfwrap.mk>, removal-of-NOPROFILE-option
fixes etc.

you should be able to build kernel & userland with this set
of source and the following line in /etc/mk.conf added:
| CSYS+=		-D"ETHER_ALIGN=2"
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.38 2004/06/16 15:44:20 tg Exp $
d115 1
a115 1
	cd ${.CURDIR}/etc && exec ${SUDO} ${MAKE} \
@


1.38
log
@                             Tadaa!

                 MirSolutions proudly presents:
      The GNU Autoconf'd directory configure script wrapper

First, a simple attempt to convert the "easy" cases (CVS, RCS, Lynx)
and the one which _needs_ it (less) to <bsd.cfwrap.mk> - I said it
was impossible, but it's actually possible, tho hard.

More to follow.
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.37 2004/06/14 00:25:39 tg Exp $
d111 1
a111 1
	${SUDO} ${MAKE} contrelease MYDESTDIR=${MYDESTDIR} MYRELDIR=${MYRELDIR}
d114 2
a115 2
	mkdir -p ${MYDESTDIR}/base ${MYRELDIR}
	cd ${.CURDIR}/etc && exec ${MAKE} \
@


1.37
log
@First (probably not working[1]) attempt at modernizing the framework:
* MANZ, MANPS, NOPROFILE die (always set to false, false, true)
* Fortran generating code for <bsd.prog.mk> dies (pascal to follow)
* GLOBAL_AUTOCONF_CACHE dies (birth of <bsd.gnuwrap.mk> to follow...)
* sanitize my head and rewrite certain pieces of certain Makefiles
* move most mk.conf functionality out of there, so a system
  without mk.conf works really well(TM)
* attempt at synching docs with reality

[1] First update *.mk, then remove old mk.conf and mk.conf.local,
    then install new mk.conf and adapt it to suit your needs.

Why don't the OpenBSD people modernize parts of this? The indenting
is really really bad in places, and MANSUBDIR was... well. I have
done it with 1/3 of the code now, and it works. Even better.

There will definitively follow more ;-)
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.36 2004/05/22 00:19:23 tg Exp $
d127 1
a127 1
.  if defined(SKIPDIR) && ${SKIPDIR:MX-Window}
d129 1
a129 1
.  else
d138 1
a138 1
.  endif
a139 1
.endif
@


1.36
log
@the crunchtools move to usr.bin, crunched themselfes,
and with some extra paranoia
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.35 2004/05/21 19:28:58 tg Exp $
d28 3
a30 1
.include <bsd.own.mk>	# for NOMAN, if it's there.
a70 3
.ifdef GLOBAL_AUTOCONF_CACHE
	cp /dev/null ${GLOBAL_AUTOCONF_CACHE}
.endif
d72 2
a73 1
	cd ${.CURDIR}/include && ${MAKE} prereq && exec ${SUDO} ${MAKE} includes
a74 3
.ifdef GLOBAL_AUTOCONF_CACHE
	cp /dev/null ${GLOBAL_AUTOCONF_CACHE}
.endif
d85 1
a85 1
	${MAKE} contbuild
d90 4
a93 2
.if defined(DESTDIR)
release:	.PHONY
d95 4
a98 4
		echo "=========================================="; \
		echo " Can't ``make release´´ when something is "; \
		echo " mounted at \"/mnt\", please umount first!"; \
		echo "=========================================="; \
a99 32
.  if defined(RELEASEDIR)
	cd ${.CURDIR}/etc && \
	    DESTDIR=${DESTDIR} RELEASEDIR=${RELEASEDIR} ${SUDO} ${MAKE} release
.  else
	@@echo "use 'make b-r' or set DESTDIR and RELEASEDIR before!"
.  endif

distrib-dirs:
	cd ${.CURDIR}/etc && \
	    DESTDIR=${DESTDIR} RELEASEDIR=${RELEASEDIR} \
	    ${SUDO} ${MAKE} distrib-dirs

b-r:
	@@echo 'Unset DESTDIR before calling make b-r!'
	@@false
.else
distrib-dirs:
	cd ${.CURDIR}/etc && ${SUDO} ${MAKE} distrib-dirs

release:	.PHONY
	@@echo "use 'make b-r' or set DESTDIR and RELEASEDIR before trying me!"

.  if defined(NFSDESTDIR) && defined(NFSRELEASEDIR)
_DEST=	${NFSDESTDIR}
_REL=	${NFSRELEASEDIR}
.  else
_DEST=	${BSDOBJDIR}/D
_REL=	${BSDOBJDIR}/R
.  endif

b-r:	.PHONY
.  if defined(NFSDESTDIR) && defined(NFSRELEASEDIR)
d101 5
a105 4
	touch $(NFSDESTDIR)/perms.test $(NFSRELEASEDIR)/perms.test
	chown root:wheel $(NFSDESTDIR)/perms.test $(NFSRELEASEDIR)/perms.test
	rm $(NFSDESTDIR)/perms.test $(NFSRELEASEDIR)/perms.test
.  endif
d109 3
a111 3
	cd ${.CURDIR} && exec ${MAKE} obj
	cd ${.CURDIR} && exec ${MAKE} build
	cd ${.CURDIR} && exec ${MAKE} contrelease
d114 3
a116 3
	mkdir -p ${_DEST}/base ${_REL}
	cd ${.CURDIR} && exec ${MAKE} \
	    release DESTDIR=${_DEST}/base RELEASEDIR=${_REL}
d120 1
a120 1
	-@@cd ${BSDSRCDIR}/distrib/lists && DESTDIR=${_DEST}/base \
d122 1
a122 1
	    ${SUDO} sh ${BSDSRCDIR}/scripts/checkflist
d130 1
a130 1
	${SUDO} mkdir -p ${_DEST}/x11 ${_REL}
d133 2
a134 2
	    ${SUDO} ln -s ${_DEST}/x11 dest; \
	    ${SUDO} ln -s ${_REL} rel; \
d136 1
a136 1
	cd ${_REL}; md5 x* | ${SUDO} tee -a MD5
@


1.35
log
@first of many many of the >1000 conflicts
XXX should fix pfctl tests instead
@
text
@d1 1
a1 1
# $MirBSD: src/Makefile,v 1.34 2004/05/02 16:37:07 tg Exp $
d34 9
a42 1
SUBDIR+= lib include bin libexec sbin usr.bin usr.sbin share games
d44 1
a44 2

SUBDIR+= sys distrib/crunch
@


1.34
log
@* make use of capabilities (HAS_GCC2, HAS_GCC3) in
  - descending into gnu/gcc or gnu/egcs/gcc directory
  - distribution set lists
* fix gcc2 -femit-memmove
* document changes in manpages
* install cccp and gcc-local manpages from gnu/doc/
* install gcc3 /usr/libexec/cpp if HAS_GCC2=no
* fold gpcrts into gcc3 again, since utils are now external,
  and don't warn on installation any more
* fix calls to scripts
@
text
@d1 2
a2 2
# $MirBSD: src/Makefile,v 1.33 2004/03/14 17:57:22 tg Exp $
# $OpenBSD: Makefile,v 1.97 2004/01/14 23:26:24 brad Exp $
@


1.33
log
@remove cross-build framework, which was orphaned
we'll do a new one when we feel like it. but differently.

(it would have required too many patches to function anyways)
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.32 2004/03/11 18:35:21 tg Exp $
d146 2
a147 1
	    NO_GCC3="${NO_GCC3}" ${SUDO} sh ${BSDSRCDIR}/scripts/checkflist
@


1.32
log
@use tee for creating the MD5 file, because sudo doesn't do output redirection
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.31 2004/03/10 17:37:09 tg Exp $
a26 7
#
# 5) If you want to setup a cross-build environment, there is a "cross-tools"
# target available which upon completion of "make TARGET=<target> cross-tools"
# (where <target> is one of the names in the /sys/arch directory) will produce
# a set of compilation tools along with the includes in the /usr/cross/<target>
# directory. The "cross-distrib" target will build cross-tools as well as
# binaries for a given <target>.
a85 263
.if !defined(TARGET)
cross-tools cross-distrib:
	echo "TARGET must be set"; exit 1
.else
cross-tools:	cross-includes cross-binutils cross-gcc cross-lib
cross-distrib:	cross-tools cross-bin cross-etc-root-var

CROSSCPPFLAGS?=	-nostdinc -I${CROSSDIR}/usr/include
CROSSLDFLAGS?=	-nostdlib -L${CROSSDIR}/usr/lib -static
CROSSCFLAGS?=	${CROSSCPPFLAGS}
CROSSCXXFLAGS?=	${CROSSCPPFLAGS}
LDSTATIC?=	-static

CROSSDIR=	${DESTDIR}/usr/cross/${TARGET}
CROSSENV=	AR=${CROSSDIR}/usr/bin/ar AS=${CROSSDIR}/usr/bin/as \
		CC=${CROSSDIR}/usr/bin/cc CPP=${CROSSDIR}/usr/bin/cpp \
		CXX=${CROSSDIR}/usr/bin/c++ \
		LD=${CROSSDIR}/usr/bin/ld NM=${CROSSDIR}/usr/bin/nm \
		LORDER=/usr/bin/lorder RANLIB=${CROSSDIR}/usr/bin/ranlib \
		SIZE=${CROSSDIR}/usr/bin/size STRIP=${CROSSDIR}/usr/bin/strip \
		HOSTCC=\"${CC}\" HOSTCXX=\"${CXX}\" NOMAN= DESTDIR=${CROSSDIR} \
		HOSTCFLAGS=\"${CFLAGS}\" HOSTCXXFLAGS=\"${CXXFLAGS}\" \
		HOSTLDFLAGS=\"${LDFLAGS} \" \
		CFLAGS=\"${CROSSCFLAGS}\" CPPFLAGS=\"${CROSSCPPFLAGS}\" \
		CXXFLAGS=\"${CROSSCXXFLAGS}\" \
		LDFLAGS=\"${CROSSLDFLAGS}\"
CROSSPATH=	${PATH}:${CROSSDIR}/usr/bin
CROSSLANGS?=	c

CROSSDIRS=	${CROSSDIR}/.dirs_done
CROSSOBJ=	${CROSSDIR}/usr/obj/.obj_done
CROSSINCLUDES=	${CROSSDIR}/usr/include/.includes_done
CROSSBINUTILS=	${CROSSDIR}/usr/bin/.binutils_done
CROSSGCC=	${CROSSDIR}/usr/bin/.gcc_done
NO_CROSS=	isakmpd tn3270 less sudo openssl libkeynote libssl \
		photurisd keynote sectok ssh

cross-dirs:	${CROSSDIRS}
cross-obj:	${CROSSOBJ}
cross-includes:	${CROSSINCLUDES}
cross-binutils:	${CROSSBINUTILS}
cross-gcc:	${CROSSGCC}

cross-env:
	@@echo ${CROSSENV} MACHINE=${TARGET} \
	    MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH)

${CROSSDIRS}:
	@@-mkdir -p ${CROSSDIR}
	@@case ${TARGET} in \
		sparc|i386|m68k|alpha|hppa|powerpc|sparc64|m88k|vax) \
			echo ${TARGET} ;;\
		amiga|sun3|mac68k|hp300|mvme68k) \
			echo m68k ;;\
		mvme88k) \
			echo m88k ;;\
		mvmeppc|macppc|pegasos) \
			echo powerpc ;;\
		sgi) \
			echo mips ;;\
		*) \
			(echo Unknown arch ${TARGET} >&2) ; exit 1;; \
	esac > ${CROSSDIR}/TARGET_ARCH
	@@echo TARGET_ARCH is $$(<${CROSSDIR}/TARGET_ARCH)
	@@eval $$(grep '^osr=' sys/conf/newvers.sh); \
	   sed "s/\$$/-unknown-openbsd$$osr/" ${CROSSDIR}/TARGET_ARCH > \
	   ${CROSSDIR}/TARGET_CANON
	@@-mkdir -p ${CROSSDIR}
	@@-mkdir -p ${CROSSDIR}/usr/$$(<${CROSSDIR}/TARGET_CANON)
	@@ln -sf ${CROSSDIR}/usr/include \
	    ${CROSSDIR}/usr/$$(<${CROSSDIR}/TARGET_CANON)/include
	@@ln -sf ${CROSSDIR}/usr/lib \
	    ${CROSSDIR}/usr/$$(<${CROSSDIR}/TARGET_CANON)/lib
	@@-mkdir -p ${CROSSDIR}/usr/$$(<${CROSSDIR}/TARGET_CANON)/bin
	@@(cd ${.CURDIR}/etc && DESTDIR=${CROSSDIR} ${MAKE} distrib-dirs)
	@@touch ${CROSSDIRS}

${CROSSOBJ}:	${CROSSDIRS}
	@@-mkdir -p ${CROSSDIR}/usr/obj
	@@(cd ${.CURDIR} && \
	    BSDOBJDIR=${CROSSDIR}/usr/obj \
	    MACHINE=${TARGET} \
	    MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    BSDSRCDIR=${.CURDIR} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    ${MAKE} obj)
	@@touch ${CROSSOBJ}

${CROSSINCLUDES}:	${CROSSOBJ}
	@@-mkdir -p ${CROSSDIR}/usr/include
	@@(cd ${.CURDIR}/include && \
	    MACHINE=${TARGET} MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    ${MAKE} prereq && \
	    MACHINE=${TARGET} MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    ${MAKE} DESTDIR=${CROSSDIR} includes)
	@@touch ${CROSSINCLUDES}

.if ${TARGET} == "alpha" || ${TARGET} == "hppa" || ${TARGET} == "i386" || \
    ${TARGET} == "macppc" || ${TARGET} == "mvmeppc" || ${TARGET} == "sgi" || \
    ${TARGET} == "sparc" || ${TARGET} == "sparc64"
BINUTILS=	ar as gasp ld nm objcopy objdump ranlib readelf size \
		strings strip
NEW_BINUTILS?=	Yes
.else
BINUTILS=	ar as ld nm ranlib objcopy objdump strings strip
NEW_BINUTILS?=	No
.endif

${CROSSBINUTILS}:	${CROSSINCLUDES}
.if ${NEW_BINUTILS:L} == "yes"
	export BSDSRCDIR=${.CURDIR}; \
	    (cd ${CROSSDIR}/usr/obj/gnu/usr.bin/binutils; \
	    /bin/sh ${BSDSRCDIR}/gnu/usr.bin/binutils/configure \
	    --prefix ${CROSSDIR}/usr \
	    --disable-nls --disable-gdbtk --disable-commonbfdlib \
	    --target $$(<${CROSSDIR}/TARGET_CANON) && \
	    ${MAKE} CFLAGS="${CFLAGS}" && ${MAKE} install )
.else
	(cd ${.CURDIR}/gnu/usr.bin/gas; \
	    TARGET_MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    MAKEOBJDIR=obj.${MACHINE}.${TARGET} ${MAKE} depend all; \
	    TARGET_MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    DESTDIR=${CROSSDIR} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    ${MAKE} NOMAN= install)
	ln -sf ${CROSSDIR}/usr/bin/as \
	    ${CROSSDIR}/usr/$$(<${CROSSDIR}/TARGET_CANON)/bin/as
	(cd ${.CURDIR}/gnu/usr.bin/ld; \
	    TARGET_MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    ${MAKE} NOPIC= NOMAN= depend all; \
	    TARGET_MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    DESTDIR=${CROSSDIR} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    ${MAKE} NOPIC= NOMAN= install)
	ln -sf ${CROSSDIR}/usr/bin/ld \
	    ${CROSSDIR}/usr/$$(<${CROSSDIR}/TARGET_CANON)/bin/ld
	(cd ${.CURDIR}/usr.bin/ar; \
	    MAKEOBJDIR=obj.${MACHINE}.${TARGET} ${MAKE} NOMAN= depend all; \
	    DESTDIR=${CROSSDIR} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    ${MAKE} NOMAN= install)
	ln -sf ${CROSSDIR}/usr/bin/ar \
	    ${CROSSDIR}/usr/$$(<${CROSSDIR}/TARGET_CANON)/bin/ar
	(cd ${.CURDIR}/usr.bin/ranlib; \
	    MAKEOBJDIR=obj.${MACHINE}.${TARGET} ${MAKE} NOMAN= depend all; \
	    DESTDIR=${CROSSDIR} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    ${MAKE} NOMAN= install)
	ln -sf ${CROSSDIR}/usr/bin/ranlib \
	    ${CROSSDIR}/usr/$$(<${CROSSDIR}/TARGET_CANON)/bin/ranlib
	(cd ${.CURDIR}/usr.bin/strip; \
	    MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    ${MAKE} TARGET_MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    NOMAN= depend all; \
	    DESTDIR=${CROSSDIR} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    ${MAKE} TARGET_MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    NOMAN= install)
	ln -sf ${CROSSDIR}/usr/bin/strip \
	    ${CROSSDIR}/usr/$$(<${CROSSDIR}/TARGET_CANON)/bin/strip
	(cd ${.CURDIR}/usr.bin/nm; \
	    MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    ${MAKE} TARGET_MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH) \
	    NOMAN= depend all; \
	    DESTDIR=${CROSSDIR} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    ${MAKE} NOMAN= install)
	ln -sf ${CROSSDIR}/usr/bin/nm \
	    ${CROSSDIR}/usr/$$(<${CROSSDIR}/TARGET_CANON)/bin/nm
	ln -sf ${CROSSDIR}/usr/bin/size \
	    ${CROSSDIR}/usr/$$(<${CROSSDIR}/TARGET_CANON)/bin/nm
.endif
	@@for cmd in ${BINUTILS}; do \
	 if [ ! -e ${CROSSDIR}/usr/bin/$$cmd -a \
	 -e ${CROSSDIR}/usr/bin/$$(<${CROSSDIR}/TARGET_CANON)-$$cmd ]; then \
	    ln -sf ${CROSSDIR}/usr/bin/$$(<${CROSSDIR}/TARGET_CANON)-$$cmd \
	        ${CROSSDIR}/usr/bin/$$cmd ;\
	 elif [ -e ${CROSSDIR}/usr/bin/$$cmd -a \
	 ! -e ${CROSSDIR}/usr/bin/$$(<${CROSSDIR}/TARGET_CANON)-$$cmd ]; then \
	    ln -sf ${CROSSDIR}/usr/bin/$$cmd \
	        ${CROSSDIR}/usr/bin/$$(<${CROSSDIR}/TARGET_CANON)-$$cmd; \
	 fi ;\
	done
	@@touch ${CROSSBINUTILS}

${CROSSGCC}:		${CROSSBINUTILS}
	(cd ${CROSSDIR}/usr/obj/gnu/egcs/gcc; \
	    /bin/sh ${.CURDIR}/gnu/egcs/gcc/configure \
	    --prefix ${CROSSDIR}/usr \
	    --target $$(<${CROSSDIR}/TARGET_CANON) \
	    --with-gxx-include-dir=${CROSSDIR}/usr/include/g++ && \
	    PATH=${CROSSPATH} ${MAKE} BISON=yacc LANGUAGES="${CROSSLANGS}" \
	    LDFLAGS="${LDSTATIC}" build_infodir=. \
	    GCC_FOR_TARGET="./xgcc -B./ -I${CROSSDIR}/usr/include" && \
	    ${MAKE} BISON=yacc LANGUAGES="${CROSSLANGS}" LDFLAGS="${LDSTATIC}" \
	    GCC_FOR_TARGET="./xgcc -B./ -I${CROSSDIR}/usr/include" \
	    build_infodir=. INSTALL_MAN= INSTALL_HEADERS_DIR= install)
	ln -sf ${CROSSDIR}/usr/bin/$$(<${CROSSDIR}/TARGET_CANON)-gcc \
	    ${CROSSDIR}/usr/bin/cc
	ln -sf ${CROSSDIR}/usr/bin/$$(<${CROSSDIR}/TARGET_CANON)-g++ \
	    ${CROSSDIR}/usr/bin/c++
	${INSTALL} -c -o ${BINOWN} -g ${BINGRP} -m ${BINMODE} \
	    ${CROSSDIR}/usr/obj/gnu/egcs/gcc/cpp \
	    ${CROSSDIR}/usr/libexec/cpp
	sed -e 's#/usr/libexec/cpp#${CROSSDIR}/usr/libexec/cpp#' \
	    -e 's#/usr/include#${CROSSDIR}/usr/include#' \
	    ${.CURDIR}/usr.bin/cpp/cpp.sh > ${CROSSDIR}/usr/bin/cpp
	chmod ${BINMODE} ${CROSSDIR}/usr/bin/cpp
	chown ${BINOWN}:${BINGRP} ${CROSSDIR}/usr/bin/cpp
	@@touch ${CROSSGCC}

# XXX MAKEOBJDIR maybe should be obj.${TARGET} here, revisit later
cross-lib:	${CROSSGCC}
	MACHINE=${TARGET} MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH); \
	export MACHINE MACHINE_ARCH; \
	(cd ${.CURDIR}/lib; \
	    for lib in csu libc; do \
	    (cd $$lib; \
	        eval ${CROSSENV} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
		    ${MAKE} depend all install); \
	    done; \
	    eval ${CROSSENV} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	        SKIPDIR=\"${NO_CROSS} libocurses/PSD.doc\" \
	        ${MAKE} depend all install)

cross-bin:	${CROSSOBJ}
	MACHINE=${TARGET} MACHINE_ARCH=$$(<${CROSSDIR}/TARGET_ARCH); \
	export MACHINE MACHINE_ARCH; \
	for i in libexec bin sbin usr.bin usr.sbin; do \
	(cd ${.CURDIR}/$$i; \
	    eval ${CROSSENV} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	        SKIPDIR=\"${BINUTILS} ${NO_CROSS}\" \
	        ${MAKE} depend all install); \
	done

cross-etc-root-var:	${CROSSOBJ}
	(cd ${.CURDIR}/etc && \
	    DESTDIR=${CROSSDIR} ${MAKE} distribution-etc-root-var)

cross-depend:
	@@(cd ${.CURDIR} && \
	    BSDOBJDIR=${CROSSDIR}/usr/obj \
	    BSDSRCDIR=${.CURDIR} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    SKIPDIR="${NO_CROSS}" \
	    ${MAKE} depend)

cross-clean:
	@@(cd ${.CURDIR} && \
	    BSDOBJDIR=${CROSSDIR}/usr/obj \
	    BSDSRCDIR=${.CURDIR} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    SKIPDIR="${NO_CROSS}" \
	    ${MAKE} clean)

cross-cleandir:
	@@(cd ${.CURDIR} && \
	    BSDOBJDIR=${CROSSDIR}/usr/obj \
	    BSDSRCDIR=${.CURDIR} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    SKIPDIR="${NO_CROSS}" \
	    ${MAKE} cleandir)

.endif # defined(TARGET)

a166 3
	cross-tools cross-includes cross-binutils cross-gcc cross-lib \
	cross-distrib cross-bin cross-etc-root-var cross-dirs cross-obj \
	cross-env cross-depend cross-clean cross-cleandir \
@


1.31
log
@* fix the build system
* fix and enable the GNU Pascal RTS and Utils
  -> gpc is now fully supported; Hello World works.
* merge OpenBSD-OpenSSH 3.8, bump patchlevel
* add fchroot(2) diff, From: Pedro Martelletto <pbastos@@rdc.puc-rio.br>
* add fchroot(2) man page from NetBSD and myself
* fix orders of manpage sections
* fix displaying of .Nx mdoc macro
* convert scripts requiring bash to ksh
* nuke a shutload of GNU make idiotisms
* add pregenerated manpages - help2man is just bloat
* increase shlib versions after fchroot addition
* adjust and unbreak mk.conf after recent changes
* fix boot system version number after CD boot changes
* understand why Makefile.bsd-wrapper is needed as filename. Finally.
* regenerate files after syscalls.master change
* fix RCS Id detection and generation while here
* remove unused archs while there
* use __RCSID() macro in ssh ifdef __MirBSD__
* build ssh with -Werror, too

Note: this is a pre-snapshot, pre-build commit. Nothing
of this has actually been tested.

Like I said, please wait for the snapshot. Though, the
snapshot doesn't have any more circumstances preventing
me from working towards a release and upload now.
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.30 2004/01/27 17:41:28 tg Exp $
d138 1
a138 1
	    MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH)
d156 1
a156 1
	@@echo TARGET_ARCH is $$(cat ${CROSSDIR}/TARGET_ARCH)
d161 1
a161 1
	@@-mkdir -p ${CROSSDIR}/usr/$$(cat ${CROSSDIR}/TARGET_CANON)
d163 1
a163 1
	    ${CROSSDIR}/usr/$$(cat ${CROSSDIR}/TARGET_CANON)/include
d165 2
a166 2
	    ${CROSSDIR}/usr/$$(cat ${CROSSDIR}/TARGET_CANON)/lib
	@@-mkdir -p ${CROSSDIR}/usr/$$(cat ${CROSSDIR}/TARGET_CANON)/bin
d175 1
a175 1
	    MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
d183 1
a183 1
	    MACHINE=${TARGET} MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
d185 1
a185 1
	    MACHINE=${TARGET} MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
d207 1
a207 1
	    --target $$(cat ${CROSSDIR}/TARGET_CANON) && \
d211 2
a212 2
	    TARGET_MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
	    MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
d214 2
a215 2
	    TARGET_MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
	    MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
d219 1
a219 1
	    ${CROSSDIR}/usr/$$(cat ${CROSSDIR}/TARGET_CANON)/bin/as
d221 2
a222 2
	    TARGET_MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
	    MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
d225 2
a226 2
	    TARGET_MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
	    MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
d230 1
a230 1
	    ${CROSSDIR}/usr/$$(cat ${CROSSDIR}/TARGET_CANON)/bin/ld
d236 1
a236 1
	    ${CROSSDIR}/usr/$$(cat ${CROSSDIR}/TARGET_CANON)/bin/ar
d242 1
a242 1
	    ${CROSSDIR}/usr/$$(cat ${CROSSDIR}/TARGET_CANON)/bin/ranlib
d245 2
a246 2
	    ${MAKE} TARGET_MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
	    MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
d249 2
a250 2
	    ${MAKE} TARGET_MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
	    MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
d253 1
a253 1
	    ${CROSSDIR}/usr/$$(cat ${CROSSDIR}/TARGET_CANON)/bin/strip
d256 2
a257 2
	    ${MAKE} TARGET_MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
	    MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
d262 1
a262 1
	    ${CROSSDIR}/usr/$$(cat ${CROSSDIR}/TARGET_CANON)/bin/nm
d264 1
a264 1
	    ${CROSSDIR}/usr/$$(cat ${CROSSDIR}/TARGET_CANON)/bin/nm
d268 2
a269 2
	 -e ${CROSSDIR}/usr/bin/$$(cat ${CROSSDIR}/TARGET_CANON)-$$cmd ]; then \
	    ln -sf ${CROSSDIR}/usr/bin/$$(cat ${CROSSDIR}/TARGET_CANON)-$$cmd \
d272 1
a272 1
	 ! -e ${CROSSDIR}/usr/bin/$$(cat ${CROSSDIR}/TARGET_CANON)-$$cmd ]; then \
d274 1
a274 1
	        ${CROSSDIR}/usr/bin/$$(cat ${CROSSDIR}/TARGET_CANON)-$$cmd; \
d283 1
a283 1
	    --target $$(cat ${CROSSDIR}/TARGET_CANON) \
d291 1
a291 1
	ln -sf ${CROSSDIR}/usr/bin/$$(cat ${CROSSDIR}/TARGET_CANON)-gcc \
d293 1
a293 1
	ln -sf ${CROSSDIR}/usr/bin/$$(cat ${CROSSDIR}/TARGET_CANON)-g++ \
d307 1
a307 1
	MACHINE=${TARGET} MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH); \
d320 1
a320 1
	MACHINE=${TARGET} MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH); \
d430 1
a430 1
	cd ${_REL}; md5 x* >>MD5
@


1.30
log
@first part of mergeing OpenBSD and fixing whitespace and RCS IDs
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.29 2004/01/21 15:07:01 tg Exp $
d120 1
a120 1
CROSSLANGS?=	c c++
@


1.29
log
@I must appear pretty stupid. This is a better way to check
if X should be built or not.
@
text
@d1 2
a2 2
#	$MirBSD: Makefile,v 1.28 2004/01/21 11:59:23 tg Exp $
#	$OpenBSD: Makefile,v 1.95 2003/12/14 10:02:57 matthieu Exp $
d149 1
a149 1
		mvmeppc|macppc) \
d196 1
a196 1
BINUTILS=	ar as ld nm ranlib objcopy objdump size strings strip
a253 9
	(cd ${.CURDIR}/usr.bin/size; \
	    MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    ${MAKE} TARGET_MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
	    MACHINE_ARCH=$$(cat ${CROSSDIR}/TARGET_ARCH) \
	    NOMAN= depend all; \
	    DESTDIR=${CROSSDIR} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    ${MAKE} NOMAN= install)
	ln -sf ${CROSSDIR}/usr/bin/size \
	    ${CROSSDIR}/usr/$$(cat ${CROSSDIR}/TARGET_CANON)/bin/size
d262 2
@


1.28
log
@fix building (scripts) a release
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.27 2004/01/20 19:31:19 tg Exp $
d428 12
a439 13
	@@case "${SKIPDIR}" { \
		*X-Window*)	echo 'NOT building X-Window!'; \
				;; \
		*)		${SUDO} mkdir -p ${_DEST}/x11 ${_REL}; \
				cd ${BSDOBJDIR}/X-Window; \
				${SUDO} rm -rf dest rel; \
				${SUDO} ln -s ${_DEST}/x11 dest; \
				${SUDO} ln -s ${_REL} rel; \
				${SUDO} ${MAKE} b-r; \
				cd ${_REL}; md5 x* >>MD5; \
				echo "Build of X11 complete on $$(date)"; \
				;; \
	}
@


1.27
log
@move release-generation scripts into new "src/scripts" directory,
which will be the home for maintainer scripte (such as pre-import
ones) as well.
adjust the Makefiles which refer to the scripts.
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.26 2004/01/20 19:22:14 tg Exp $
d423 1
a423 1
	    ${SUDO} sh ${BSDSRCDIR}/scripts/checkflist
@


1.26
log
@* nuke duplicate code
* automatically md5 the X sets
* move distrib/sets/lists/* and X-Window/distrib/sets/lists/*
  into a common distrib/lists/* (subdir'd, though)
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.25 2004/01/03 04:56:36 tg Exp $
d380 2
a381 1
	    DESTDIR=${DESTDIR} RELEASEDIR=${RELEASEDIR} ${SUDO} ${MAKE} distrib-dirs
d422 2
a423 2
	-@@cd ${.CURDIR}/distrib/lists && \
	    DESTDIR=${_DEST}/base ${SUDO} sh checkflist
@


1.25
log
@don't let checkflist prevent a nightly build from continuing at X
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.24 2003/12/28 00:17:33 tg Exp $
d392 8
d415 1
a415 1
.  if defined(NFSDESTDIR) && defined(NFSRELEASEDIR)
d417 1
a417 6
	    release DESTDIR=$(NFSDESTDIR) RELEASEDIR=$(NFSRELEASEDIR)
.  else
	mkdir -p $(BSDOBJDIR)/D $(BSDOBJDIR)/R
	cd ${.CURDIR} && exec ${MAKE} \
	    release DESTDIR=$(BSDOBJDIR)/D RELEASEDIR=$(BSDOBJDIR)/R
.  endif
d421 2
a422 7
.  if defined(NFSDESTDIR) && defined(NFSRELEASEDIR)
	-@@cd ${.CURDIR}/distrib/sets && \
	    DESTDIR=$(NFSDESTDIR) ${SUDO} sh checkflist
.  else
	-@@cd ${.CURDIR}/distrib/sets && \
	    DESTDIR=$(BSDOBJDIR)/D ${SUDO} sh checkflist
.  endif
a426 1
.  if defined(NFSDESTDIR) && defined(NFSRELEASEDIR)
d430 2
a431 1
		*)		cd ${BSDOBJDIR}/X-Window; \
d433 2
a434 14
				${SUDO} mkdir -p $(NFSDESTDIR)/X11R6 \
				    $(NFSRELEASEDIR)/X11R6; \
				${SUDO} ln -s $(NFSDESTDIR)/X11R6 dest; \
				${SUDO} ln -s $(NFSRELEASEDIR)/X11R6 rel; \
				${SUDO} ${MAKE} b-r; \
				echo "Build of X11 complete on $$(date)"; \
				;; \
	}
.  else
	@@case "${SKIPDIR}" { \
		*X-Window*)	echo 'NOT building X-Window!'; \
				;; \
		*)		cd ${BSDOBJDIR}/X-Window; \
				${SUDO} mkdir -p dest rel; \
d436 1
a440 1
.  endif
@


1.24
log
@Build and Release complete.\nSun Dec 28 00:00:02 UTC 2003
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.23 2003/12/23 13:41:45 tg Exp $
d419 1
a419 1
	@@cd ${.CURDIR}/distrib/sets && \
d422 1
a422 1
	@@cd ${.CURDIR}/distrib/sets && \
@


1.23
log
@* merge in OpenBSD
* rename cd34.iso to cdrom8.iso

XXX gzip/compress on ramdisk in MirOS should still
XXX	be able to compress and not only decompress
XXX	files. must be revisited
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.22 2003/12/17 17:47:04 tg Exp $
d427 1
a427 1
	@@date; uname -Ma
@


1.22
log
@attempt to merge MirBSD #7ter into HEAD
@
text
@d1 2
a2 2
#	$MirBSD: Makefile,v 1.21 2003/12/10 21:45:00 tg Exp $
#	$OpenBSD: Makefile,v 1.92 2003/05/17 20:58:52 millert Exp $
d319 1
a319 1
	        ${CROSSENV} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
d322 2
a323 2
	    ${CROSSENV} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	        SKIPDIR="${NO_CROSS} libocurses/PSD.doc" \
d331 2
a332 2
	    ${CROSSENV} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	        SKIPDIR="${BINUTILS} ${NO_CROSS}" \
@


1.21
log
@sync after partial make build, full make install, before make release or X11
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.20 2003/11/16 10:45:19 tg Exp $
a2 1

d19 1
a33 1
#
d364 8
a371 1
release:
d374 3
d389 10
a398 1
b-r:
d407 4
d414 1
d418 4
d424 1
d429 16
a444 1
	@@case "${SKIPDIR}" in \
d452 1
a452 1
	esac
d454 1
@


1.20
log
@.PHONY whack
use contbuild for build, note restartability (EXCEPT FOR FORMAL RELEASES!)
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.19 2003/10/03 11:32:15 tg Exp $
d369 4
d377 3
d417 1
a417 1
	release b-r contbuild contrelease
@


1.19
log
@o enter MirBSD #7bis RELEASE
o enable automatic execution of X-Window 'make b-r' after/within
  top-level 'make b-r' except if X-Window is contained in $(SKIPDIR)
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.18 2003/09/03 22:52:43 tg Exp $
d69 1
a69 1
build:	.PHONY
d87 3
a89 1
	${MAKE} depend && ${MAKE} && exec ${SUDO} ${MAKE} install
d91 1
a91 1
contbuild:	.PHONY
d137 1
a137 1
cross-env:	.PHONY
d341 1
a341 1
cross-depend:	.PHONY
d348 1
a348 1
cross-clean:	.PHONY
d355 1
a355 1
cross-cleandir:	.PHONY
d365 1
a365 1
release:	.PHONY
d369 1
a369 1
b-r:	.PHONY
d373 1
a373 1
b-r:	.PHONY
d405 6
@


1.19.2.1
log
@no X-Window in MIRBSD_7_DEV
we'll patch current code accordingly for MirOS BSD #7ter RELEASE
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.19 2003/10/03 11:32:15 tg Exp $
d39 1
a39 1
#SUBDIR+= X-Window
@


1.19.2.2
log
@enable 'make b-r' with DESTDIR _and_ RELEASEDIR on NFS
* not only one. both.
* enabled if uncommented (defined).
  if you want to disable, you must undefine the variables.
  just setting them empty WILL NOT HELP. I REPEAT: <repeat />

while here: check that nothing is mounted on /mnt
before starting make release
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.19.2.1 2003/10/23 20:37:04 tg Exp $
a363 7
	@@if mount 2>&1 | fgrep " on /mnt" >/dev/null 2>&1; then \
		echo "=========================================="; \
		echo " Can't ``make release´´ when something is "; \
		echo " mounted at \"/mnt\", please umount first!"; \
		echo "=========================================="; \
		exit 1; fi
.if defined(RELEASEDIR)
a365 3
.else
	@@echo "use 'make b-r' or set DESTDIR and RELEASEDIR before!"
.endif
a370 3
release:	.PHONY
	@@echo "use 'make b-r' or set DESTDIR and RELEASEDIR before trying me!"

a379 4
.if defined(NFSDESTDIR) && defined(NFSRELEASEDIR)
	cd ${.CURDIR} && exec ${MAKE} \
	    release DESTDIR=$(NFSDESTDIR) RELEASEDIR=$(NFSRELEASEDIR)
.else
a382 1
.endif
a385 4
.if defined(NFSDESTDIR) && defined(NFSRELEASEDIR)
	@@cd ${.CURDIR}/distrib/sets && \
	    DESTDIR=$(NFSDESTDIR) ${SUDO} sh checkflist
.else
a387 1
.endif
a395 5
.if defined(NFSDESTDIR) && defined(NFSRELEASEDIR)
				${SUDO} rm -rf dest rel; \
				${SUDO} ln -s $(NFSDESTDIR) dest; \
				${SUDO} ln -s $(NFSRELEASEDIR) rel; \
.else
a396 1
.endif
@


1.19.2.3
log
@X-Window is back on track, and in Tag: MIRBSD_7ter
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.19.2.2 2003/11/09 19:33:27 tg Exp $
d3 1
a19 1
# The "b-r" target does this automatically.
d34 1
d39 1
a39 1
SUBDIR+= X-Window
@


1.19.2.4
log
@use the subdirectory X11 in NFS{DEST,RELEASE}DIR for making
the X-Window system releases
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.19.2.3 2003/11/15 21:19:50 tg Exp $
d420 2
a421 4
				${SUDO} mkdir -p $(NFSDESTDIR)/X11R6 \
				    $(NFSRELEASEDIR)/X11R6; \
				${SUDO} ln -s $(NFSDESTDIR)/X11R6 dest; \
				${SUDO} ln -s $(NFSRELEASEDIR)/X11R6 rel; \
@


1.19.2.5
log
@argh. a backslash even adds the next line if it's a make expression
so we must use double code :(
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.19.2.4 2003/11/19 16:26:20 tg Exp $
d369 1
a369 1
.  if defined(RELEASEDIR)
d372 1
a372 1
.  else
d374 1
a374 1
.  endif
d392 1
a392 1
.  if defined(NFSDESTDIR) && defined(NFSRELEASEDIR)
d395 1
a395 1
.  else
d399 1
a399 1
.  endif
d403 1
a403 1
.  if defined(NFSDESTDIR) && defined(NFSRELEASEDIR)
d406 1
a406 1
.  else
d409 1
a409 1
.  endif
d414 1
a414 2
.  if defined(NFSDESTDIR) && defined(NFSRELEASEDIR)
	@@case "${SKIPDIR}" { \
d418 1
d424 1
a424 9
				${SUDO} ${MAKE} b-r; \
				echo "Build of X11 complete on $$(date)"; \
				;; \
	}
.  else
	@@case "${SKIPDIR}" { \
		*X-Window*)	echo 'NOT building X-Window!'; \
				;; \
		*)		cd ${BSDOBJDIR}/X-Window; \
d426 1
d430 1
a430 1
	}
a431 1
.  endif
@


1.19.2.6
log
@check for permissions of nfs mount first (rw, maproot=root)
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.19.2.5 2003/11/19 19:13:11 tg Exp $
a383 6
.  if defined(NFSDESTDIR) && defined(NFSRELEASEDIR)
	# Test if the targets are mounted suitable for root (BTSTF)
	touch $(NFSDESTDIR)/perms.test $(NFSRELEASEDIR)/perms.test
	chown root:wheel $(NFSDESTDIR)/perms.test $(NFSRELEASEDIR)/perms.test
	rm $(NFSDESTDIR)/perms.test $(NFSRELEASEDIR)/perms.test
.  endif
@


1.19.2.6.2.1
log
@this should be, except for distrib/notes/*/contents, the last bunch
of things to do for #7quater (everything else has been MFCd, checked,
backtagged, considered unimportant, not being wanted to take care of
for -stable because -current is sooo much better, or forgotten :)
@
text
@d1 1
a1 1
#	$MirBSD: src/Makefile,v 1.19.2.6 2003/11/20 12:09:30 tg Exp $
a398 1
	mkdir -p ${NFSDESTDIR}/base
d400 1
a400 1
	    release DESTDIR=$(NFSDESTDIR)/base RELEASEDIR=$(NFSRELEASEDIR)
d402 1
a402 1
	mkdir -p $(BSDOBJDIR)/D/base $(BSDOBJDIR)/R
d404 1
a404 1
	    release DESTDIR=$(BSDOBJDIR)/D/base RELEASEDIR=$(BSDOBJDIR)/R
d411 1
a411 2
	    DESTDIR=$(NFSDESTDIR)/base ${SUDO} sh checkflist
	cd $(NFSDESTDIR)/base/snapshot && ln -s ../etc etc
d414 1
a414 2
	    DESTDIR=$(BSDOBJDIR)/D/base ${SUDO} sh checkflist
	cd $(BSDOBJDIR)/D/base/snapshot && ln -s ../etc etc
@


1.18
log
@minor fixes to Makefile (b-r and contrelease)
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.17 2003/09/03 18:50:09 tg Exp $
d391 10
@


1.17
log
@add make contrelease, to be called after make build...
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.16 2003/09/02 08:54:40 tg Exp $
d364 2
a365 2
	@@(cd ${.CURDIR}/etc && \
	    DESTDIR=${DESTDIR} RELEASEDIR=${RELEASEDIR} ${MAKE} release)
d375 3
a377 3
	(cd ${.CURDIR} && ${MAKE} obj)
	(cd ${.CURDIR} && ${MAKE} build)
	(cd ${.CURDIR} && ${MAKE} contrelease)
d381 2
a382 2
	(cd ${.CURDIR}/etc && \
	    DESTDIR=$(BSDOBJDIR)/D RELEASEDIR=$(BSDOBJDIR)/R ${MAKE} release)
d386 2
a387 2
	@@(cd ${.CURDIR}/distrib/sets && \
	    DESTDIR=$(BSDOBJDIR)/D RELEASEDIR=$(BSDOBJDIR)/R sh checkflist)
@


1.16
log
@remove the workaround
while here, mark some targets as .PHONY
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.15 2003/09/02 08:43:30 tg Exp $
d377 3
@


1.15
log
@further shortening
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.14 2003/09/02 08:34:57 tg Exp $
d69 1
a69 1
build:
d89 1
a89 1
contbuild:
d363 1
a363 1
release:
d367 1
a367 1
b-r:
d371 1
a371 1
b-r:
d384 1
a384 3
	    DESTDIR=$(BSDOBJDIR)/D RELEASEDIR=$(BSDOBJDIR)/R sh checkflist \
	    | cat)
	@@echo ""
@


1.14
log
@shorten
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.13 2003/09/02 08:34:15 tg Exp $
a365 1
.endif
a366 1
.if defined(DESTDIR)
@


1.13
log
@fix make b-r when checkflist returns errors
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.12 2003/09/02 01:32:06 tg Exp $
d391 1
a391 1
	@@date; uname -amnlrsvM
@


1.12
log
@o start the checkflist script after make b-r completed
o niceify the output of make b-r
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.11 2003/07/20 20:58:27 tg Exp $
d385 3
a387 2
	(cd ${.CURDIR}/distrib/sets && \
	    DESTDIR=$(BSDOBJDIR)/D RELEASEDIR=$(BSDOBJDIR)/R sh checkflist)
d391 1
a391 1
	@@date; uname -amnplrsvM
@


1.11
log
@add b-r target (just build+release, suitable for nohup)
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.10 2003/07/19 20:21:18 tg Exp $
d374 3
d382 10
@


1.10
log
@merge OpenBSD tree; bump MirBSD minor
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.9 2003/06/30 15:47:27 tg Exp $
d366 13
@


1.9
log
@release only .if defined(DESTDIR)
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.8 2003/06/30 15:46:57 tg Exp $
d45 1
a45 2
SUBDIR+= sys lkm
SUBDIR+= distrib/crunch
@


1.8
log
@add nohup.out to cvsignore and 'release' target
to top-level Makefile (descends into etc, nothing else)
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.7 2003/06/02 16:30:20 tg Exp $
d363 1
d367 1
@


1.7
log
@"unbreak" X-Window, in the hope it will at least compile cleanly
(maybe even the man page problems will be fixed?)

replace 0x60 character (accent gravis) by proper syntax
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.6 2003/05/22 14:04:46 tg Exp $
d362 5
a366 1
 
@


1.6
log
@merge CVS import stuff
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.5 2003/05/18 22:40:12 tg Exp $
d39 1
a39 1
#SUBDIR+= X-Window #XXX need C++ compiler for that
d138 1
a138 1
	    MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH`
d156 2
a157 2
	@@echo TARGET_ARCH is `cat ${CROSSDIR}/TARGET_ARCH`
	@@eval `grep '^osr=' sys/conf/newvers.sh`; \
d161 1
a161 1
	@@-mkdir -p ${CROSSDIR}/usr/`cat ${CROSSDIR}/TARGET_CANON`
d163 1
a163 1
	    ${CROSSDIR}/usr/`cat ${CROSSDIR}/TARGET_CANON`/include
d165 2
a166 2
	    ${CROSSDIR}/usr/`cat ${CROSSDIR}/TARGET_CANON`/lib
	@@-mkdir -p ${CROSSDIR}/usr/`cat ${CROSSDIR}/TARGET_CANON`/bin
d175 1
a175 1
	    MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
d183 1
a183 1
	    MACHINE=${TARGET} MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
d185 1
a185 1
	    MACHINE=${TARGET} MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
d207 1
a207 1
	    --target `cat ${CROSSDIR}/TARGET_CANON` && \
d211 2
a212 2
	    TARGET_MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
	    MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
d214 2
a215 2
	    TARGET_MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
	    MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
d219 1
a219 1
	    ${CROSSDIR}/usr/`cat ${CROSSDIR}/TARGET_CANON`/bin/as
d221 2
a222 2
	    TARGET_MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
	    MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
d225 2
a226 2
	    TARGET_MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
	    MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
d230 1
a230 1
	    ${CROSSDIR}/usr/`cat ${CROSSDIR}/TARGET_CANON`/bin/ld
d236 1
a236 1
	    ${CROSSDIR}/usr/`cat ${CROSSDIR}/TARGET_CANON`/bin/ar
d242 1
a242 1
	    ${CROSSDIR}/usr/`cat ${CROSSDIR}/TARGET_CANON`/bin/ranlib
d245 2
a246 2
	    ${MAKE} TARGET_MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
	    MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
d249 2
a250 2
	    ${MAKE} TARGET_MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
	    MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
d253 1
a253 1
	    ${CROSSDIR}/usr/`cat ${CROSSDIR}/TARGET_CANON`/bin/strip
d256 2
a257 2
	    ${MAKE} TARGET_MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
	    MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
d262 1
a262 1
	    ${CROSSDIR}/usr/`cat ${CROSSDIR}/TARGET_CANON`/bin/size
d265 2
a266 2
	    ${MAKE} TARGET_MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
	    MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
d271 1
a271 1
	    ${CROSSDIR}/usr/`cat ${CROSSDIR}/TARGET_CANON`/bin/nm
d275 2
a276 2
	 -e ${CROSSDIR}/usr/bin/`cat ${CROSSDIR}/TARGET_CANON`-$$cmd ]; then \
	    ln -sf ${CROSSDIR}/usr/bin/`cat ${CROSSDIR}/TARGET_CANON`-$$cmd \
d279 1
a279 1
	 ! -e ${CROSSDIR}/usr/bin/`cat ${CROSSDIR}/TARGET_CANON`-$$cmd ]; then \
d281 1
a281 1
	        ${CROSSDIR}/usr/bin/`cat ${CROSSDIR}/TARGET_CANON`-$$cmd; \
d290 1
a290 1
	    --target `cat ${CROSSDIR}/TARGET_CANON` \
d298 1
a298 1
	ln -sf ${CROSSDIR}/usr/bin/`cat ${CROSSDIR}/TARGET_CANON`-gcc \
d300 1
a300 1
	ln -sf ${CROSSDIR}/usr/bin/`cat ${CROSSDIR}/TARGET_CANON`-g++ \
d314 1
a314 1
	MACHINE=${TARGET} MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH`; \
d327 1
a327 1
	MACHINE=${TARGET} MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH`; \
@


1.5
log
@XFree86 4.3.0 will be broken in MirBSD#5
unless someone volunteers to fix gcc 3.3 before.
The port is already there, just broken.
@
text
@d1 2
a2 2
#	$MirBSD: Makefile,v 1.4 2003/05/18 12:14:13 tg Exp $
#	$OpenBSD: Makefile,v 1.90 2003/04/17 03:48:56 drahn Exp $
a324 14
.if (${KERBEROS:L} == "yes")
	MACHINE=${TARGET} MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH`; \
	export MACHINE MACHINE_ARCH; \
	cd kerberosIV/lib; \
	${CROSSENV} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    ${MAKE} depend all install
.endif
.if (${KERBEROS5:L} == "yes")
	MACHINE=${TARGET} MACHINE_ARCH=`cat ${CROSSDIR}/TARGET_ARCH`; \
	export MACHINE MACHINE_ARCH; \
	cd kerberosV/lib; \
	${CROSSENV} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    ${MAKE} depend all install
.endif
@


1.4
log
@enable X-Window 'make obj'
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.3 2003/05/07 20:52:09 tg Exp $
d39 1
a39 1
SUBDIR+= X-Window
@


1.3
log
@merge conflicts; fix what(1) stdin
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.2 2003/03/23 21:43:33 tg Exp $
d37 4
@


1.2
log
@Merge MirBSD-old entirely
Remove krb, yp, afs, GPL'd stuff in kernel
Adjust some other stuff

Not to be compiled yet...
@
text
@d1 2
a2 2
#	$MirBSD: obsd.tygs,v 1.44 2003/03/22 22:33:30 tg Exp $
#	$OpenBSD: Makefile,v 1.89 2003/01/05 22:52:19 mickey Exp $
@


1.1
log
@Initial revision
@
text
@d1 1
d42 1
a42 8

.if (${KERBEROS:L} == "yes")
SUBDIR+= kerberosIV
.endif

.if (${KERBEROS5:L} == "yes")
SUBDIR+= kerberosV
.endif
d73 3
a79 8
.if (${KERBEROS:L} == "yes")
	cd ${.CURDIR}/kerberosIV/lib && ${MAKE} depend && ${MAKE} && \
	    NOMAN=1 exec ${SUDO} ${MAKE} install
.endif
.if (${KERBEROS5:L} == "yes")
	cd ${.CURDIR}/kerberosV/lib && ${MAKE} depend && ${MAKE} && \
	    NOMAN=1 exec ${SUDO} ${MAKE} install
.endif
d86 3
d185 3
a187 3
.if ${TARGET} == "alpha" || ${TARGET} == "hppa" || ${TARGET} == "macppc" || \
    ${TARGET} == "mvmeppc" || ${TARGET} == "sgi" || ${TARGET} == "sparc" || \
    ${TARGET} == "sparc64"
@


1.1.1.1
log
@Import OpenBSD 3.3 source repository from CTM 3132 the first time
This opens an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright © 1968-2003  The authors of And contributors to UNIX®, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@


1.1.1.2
log
@Import OpenBSD source tree of short before 17:00 UTC today
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.90 2003/04/17 03:48:56 drahn Exp $
d193 3
a195 3
.if ${TARGET} == "alpha" || ${TARGET} == "hppa" || ${TARGET} == "i386" || \
    ${TARGET} == "macppc" || ${TARGET} == "mvmeppc" || ${TARGET} == "sgi" || \
    ${TARGET} == "sparc" || ${TARGET} == "sparc64"
@


1.1.1.3
log
@Sync MirBSD main source tree against OpenBSD-current,
which should be fairly stable after the Hackathon now.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.92 2003/05/17 20:58:52 millert Exp $
d42 4
d83 4
d91 4
d329 7
@


1.1.1.4
log
@Time to import OpenBSD once again. Expect breakage.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.95 2003/12/14 10:02:57 matthieu Exp $
d79 4
d311 1
a311 1
	        eval ${CROSSENV} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
d314 2
a315 2
	    eval ${CROSSENV} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	        SKIPDIR=\"${NO_CROSS} libocurses/PSD.doc\" \
d317 7
d330 2
a331 2
	    eval ${CROSSENV} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	        SKIPDIR=\"${BINUTILS} ${NO_CROSS}\" \
@


1.1.1.5
log
@Import OpenBSD as of today again (seems pretty stable, I hope)

Prominent changes: more bgpd, tcpmd5; tcpdump/isakmpd fixes
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.97 2004/01/14 23:26:24 brad Exp $
d137 1
a137 1
		mvmeppc|macppc|pegasos) \
d184 1
a184 1
BINUTILS=	ar as ld nm ranlib objcopy objdump strings strip
d242 9
a258 2
	    ${CROSSDIR}/usr/`cat ${CROSSDIR}/TARGET_CANON`/bin/nm
	ln -sf ${CROSSDIR}/usr/bin/size \
@


1.1.1.6
log
@large-scale import of OpenBSD 3.5-current source base including many fixes
note: from now, we will not be binary compatible with OpenBSD apps any
longer (due to syscall numbering differences); both an OpenBSD compat and
a conversion tool for old MirOS #7 apps will be delivered later.

The src/ tree is locked from now.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.103 2004/05/03 15:18:18 drahn Exp $
d131 1
a131 1
		alpha|hppa|i386|m68k|m88k|powerpc|sparc|sparc64|vax|amd64) \
d133 1
a133 1
		amiga|hp300|mac68k|mvme68k) \
d135 1
a135 1
		luna88k|mvme88k) \
d137 1
a137 1
		macppc|mvmeppc) \
d177 3
a179 3
.if ${TARGET} == "alpha" || ${TARGET} == "amd64" || ${TARGET} == "hppa" || \
    ${TARGET} == "i386" || ${TARGET} == "macppc" || ${TARGET} == "mvmeppc" || \
    ${TARGET} == "sparc" || ${TARGET} == "sparc64" || ${TARGET} == "sgi"
d200 1
d203 1
d210 1
d214 1
d234 1
d238 1
a241 1
.endif
d245 1
d252 2
a253 1
	    ${CROSSDIR}/usr/`cat ${CROSSDIR}/TARGET_CANON`/bin/size
d270 1
a270 1
	    --with-gnu-as --with-gnu-ld --prefix ${CROSSDIR}/usr \
a271 1
	    --enable-languages="c,c++" --enable-cpp --disable-nls \
d274 1
a274 3
	    CFLAGS="${CFLAGS} -I${.CURDIR}/gnu/lib/libiberty/include" \
	    LIBIBERTY_INCLUDES=${.CURDIR}/gnu/lib/libiberty/include \
	    DEMANGLER_PROG= DEMANGLE_H= LDFLAGS="${LDSTATIC}" build_infodir=. \
a277 2
	    CFLAGS="${CFLAGS} -I${.CURDIR}/gnu/lib/libiberty/include" \
	    LIBIBERTY_INCLUDES=${.CURDIR}/gnu/lib/libiberty/include \
@


1.1.1.7
log
@your daily dose of bugfixes and security updates from obsd
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.108 2004/11/30 15:46:01 mickey Exp $
d131 1
a131 1
		alpha|amd64|hppa|hppa64|i386|m68k|m88k|powerpc|sparc|sparc64|vax) \
d140 1
a140 1
			echo mips64 ;;\
a171 1
	    MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
a173 1
	    MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
d177 3
a179 5
.if ${MACHINE_ARCH} == "m68k" || ${MACHINE_ARCH} == "m88k" || \
    ${MACHINE_ARCH} == "vax"
BINUTILS=	ar as ld nm ranlib objcopy objdump strings strip
NEW_BINUTILS?=	No
.else
d183 3
d190 7
a196 9
	(cd ${.CURDIR}/gnu/usr.bin/binutils; \
	    MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    TARGET_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
	    ${MAKE} -f Makefile.bsd-wrapper depend && \
	    MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    TARGET_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` \
	    ${MAKE} -f Makefile.bsd-wrapper all && \
	    DESTDIR=${CROSSDIR} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    ${MAKE} -f Makefile.bsd-wrapper install)
d239 2
a240 1
	    ${MAKE} NOMAN= depend all; \
a256 5
	 if [ -e ${CROSSDIR}/usr/bin/$$cmd -a \
	 ! -e ${CROSSDIR}/usr/`cat ${CROSSDIR}/TARGET_CANON`/bin/$$cmd ]; then \
	    ln -sf ${CROSSDIR}/usr/bin/$$cmd \
	        ${CROSSDIR}/usr/`cat ${CROSSDIR}/TARGET_CANON`/bin/$$cmd; \
	 fi ;\
a259 7
# bsd.own.mk can't do it for us
.if ${TARGET} == "amd64" || ${TARGET} == "cats" || \
    ${TARGET} == "hppa" || ${TARGET} == "hppa64" || \
    ${TARGET} == "sparc64" || ${TARGET} == "sgi"
USE_GCC3=yes
.endif

a260 15
.if ${USE_GCC3:L} == "yes"
	(cd ${.CURDIR}/gnu/usr.bin/gcc; \
	    MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    TARGET_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` CROSSDIR=${CROSSDIR} \
	    ${MAKE} -f Makefile.bsd-wrapper depend && \
	    MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    TARGET_ARCH=`cat ${CROSSDIR}/TARGET_ARCH` CROSSDIR=${CROSSDIR} \
	    ${MAKE} -f Makefile.bsd-wrapper all && \
	    DESTDIR=${CROSSDIR} MAKEOBJDIR=obj.${MACHINE}.${TARGET} \
	    ${MAKE} -f Makefile.bsd-wrapper install)
	ln -sf ${CROSSDIR}/usr/bin/`cat ${CROSSDIR}/TARGET_CANON`-g++ \
	    ${CROSSDIR}/usr/bin/c++
	ln -sf ${CROSSDIR}/usr/libexec/cpp \
	    ${CROSSDIR}/usr/bin/cpp
.else
a288 1
.endif
@


