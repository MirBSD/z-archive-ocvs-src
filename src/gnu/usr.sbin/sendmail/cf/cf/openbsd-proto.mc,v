head	1.20;
access;
symbols
	tg-mergetmp-mirosx-1:1.20
	tg-mergefixes-1-branch:1.20.0.4
	tg-mergefixes-1-base:1.20
	MIROS_X:1.20.0.2
	MIROS_X_BASE:1.20
	tg-mergetmp-3:1.20
	MIRBSD_XP_MIRPPC:1.15.0.4
	cvs-200410222320:1.1.1.4
	MIRBSD_XP_SPARC_BASE:1.15
	MIRBSD_XP_SPARC:1.15.0.2
	cvs-200406091940:1.1.1.3
	MIRBSD_7quater:1.12
	cvs-200405160640:1.1.1.3
	cvs-200401271800:1.1.1.3
	cvs-200401261630:1.1.1.3
	cvs-200401021645:1.1.1.3
	MIRBSD_7_ALPHA:1.8.0.6
	MIRBSD_7:1.12.0.2
	cvs-200312222040:1.1.1.3
	MIRBSD_7ter:1.8
	MIRBSD_7_DEV:1.8.0.2
	cvs-200310020700:1.1.1.2
	cvs-200309271030:1.1.1.2
	cvs-200309251530:1.1.1.2
	cvs-200309171845:1.1.1.1
	cvs-200308302005:1.1.1.1
	cvs-200308171200:1.1.1.1
	ctm-3496:1.1.1.1
	ctm-3449:1.1.1.1
	ctm-3437:1.1.1.1
	cvs-200307191805:1.1.1.1
	ctm-3425:1.1.1.1
	cvs-200307091500:1.1.1.1
	ctm-3389:1.1.1.1
	cvs-200306291430:1.1.1.1
	ctm-3341:1.1.1.1
	MIRBSD_5:1.3
	cvs-200306082100:1.1.1.1
	ctm-3316:1.1.1.1
	ctm-3272:1.1.1.1
	ctm-3264:1.1.1.1
	cvs-200305071630:1.1.1.1
	MIRBSD_4:1.3
	ctm-3203:1.1.1.1
	cvs-20030410-1130:1.1.1.1
	cvs-20030329-2200:1.1.1.1
	ctm-3155:1.1.1.1
	ctm-3132:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.20
date	2004.11.20.00.24.32;	author tg;	state Exp;
branches;
next	1.19;

1.19
date	2004.11.18.18.30.18;	author tg;	state Exp;
branches;
next	1.18;

1.18
date	2004.11.18.15.53.09;	author tg;	state Exp;
branches;
next	1.17;

1.17
date	2004.11.13.18.51.42;	author tg;	state Exp;
branches;
next	1.16;

1.16
date	2004.10.23.00.25.42;	author tg;	state Exp;
branches;
next	1.15;

1.15
date	2004.08.29.19.00.44;	author tg;	state Exp;
branches;
next	1.14;

1.14
date	2004.08.21.15.30.51;	author tg;	state Stab;
branches;
next	1.13;

1.13
date	2004.08.21.15.12.29;	author tg;	state Exp;
branches;
next	1.12;

1.12
date	2004.06.02.14.41.50;	author tg;	state Exp;
branches;
next	1.11;

1.11
date	2004.05.11.19.14.14;	author tg;	state Exp;
branches;
next	1.10;

1.10
date	2004.04.25.01.10.33;	author tg;	state Exp;
branches;
next	1.9;

1.9
date	2003.12.26.22.12.38;	author tg;	state Exp;
branches;
next	1.8;

1.8
date	2003.09.30.20.24.43;	author tg;	state Exp;
branches
	1.8.4.1;
next	1.7;

1.7
date	2003.09.27.14.16.38;	author tg;	state Exp;
branches;
next	1.6;

1.6
date	2003.09.27.14.14.58;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2003.09.25.20.59.47;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2003.07.06.20.21.32;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2003.03.31.14.36.41;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2003.03.23.21.49.07;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.22.17.44.32;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.03.22.17.44.32;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.09.25.16.27.19;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2003.12.22.20.57.36;	author tg;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2004.10.22.23.26.19;	author tg;	state Exp;
branches;
next	;

1.8.4.1
date	2004.04.25.01.11.57;	author tg;	state Exp;
branches;
next	;


desc
@@


1.20
log
@as per bsiegert@@ wish, don't say 8BITMIME when we're not really.
this allows us to default again to strip-8th-bit.
@
text
@divert(-1)dnl
#
# $MirBSD: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.19 2004/11/18 18:30:18 tg Exp $
#
# Copyright (c) 2002, 2003, 2004
#	Thorsten "mirabile" Glaser <tg@@66h.42h.de>
# Copyright (c) 1998 Sendmail, Inc.  All rights reserved.
# Copyright (c) 1983 Eric P. Allman.  All rights reserved.
# Copyright (c) 1988, 1993
#	The Regents of the University of California.  All rights reserved.
#
# By using this file, you agree to the terms and conditions set
# forth in the LICENSE file which can be found at the top level of
# the sendmail distribution.

#
#  This is the prototype file for a standard MirOS installation on
#  systems accepting eMail from the internet.
#

divert(0)dnl
VERSIONID(`@@(#)openbsd-proto.mc MirOS $Revision: 1.19 $')dnl
OSTYPE(openbsd)dnl
dnl
dnl If you have a non-static IP address you may wish to forward outgoing mail
dnl through your ISP's mail server to prevent matching one of the dialup
dnl DNS black holes.  Just uncomment the following line and replace
dnl mail.myisp.net with the hostname of your ISP's mail server.
dnl
dnl define(`SMART_HOST', `mail.myisp.net')dnl
dnl
dnl
dnl Disable EXPN and VRFY to help thwart address harvesters and require
dnl senders to say hello.
dnl
define(`confPRIVACY_FLAGS', `authwarnings,needmailhelo,noexpn,novrfy')dnl
dnl
dnl
dnl We wish to make the existence of the local-host-names and
dnl trusted-users files optional, hence the "-o" below.
dnl
define(`confCW_FILE', `-o MAIL_SETTINGS_DIR`'local-host-names')dnl
define(`confCT_FILE', `-o MAIL_SETTINGS_DIR`'trusted-users')dnl
dnl
dnl
dnl Use of UUCP-style addresses in the modern internet are generally
dnl an error (and sometimes used by spammers) so disable support for them.
dnl To simply treat '!' as a normal character, change `reject' to
dnl `nospecial'.
dnl
FEATURE(`nouucp', `reject')dnl
dnl
dnl
dnl The access database allows for certain actions to be taken
dnl based on the source address.
dnl The access database file should be considered optional.
dnl
FEATURE(`access_db', `hash -o -T<TMPF> MAIL_SETTINGS_DIR`'access')dnl
FEATURE(`blacklist_recipients')dnl
dnl
dnl
dnl Enable support for /etc/mail/local-host-names.
dnl Contains hostnames that should be considered local.
dnl
FEATURE(`use_cw_file')dnl
dnl
dnl
dnl Enable support for /etc/mail/mailertable.
dnl
FEATURE(`mailertable', `hash -o MAIL_SETTINGS_DIR`'mailertable')dnl
dnl
dnl
dnl Enable support for /etc/mail/trusted-users.
dnl Users listed herein may spoof mail from other users.
dnl
FEATURE(`use_ct_file')dnl
dnl
dnl
dnl Enable support for /etc/mail/virtusertable.
dnl Used to do N -> N address mapping.
dnl
FEATURE(`virtusertable', `hash -o MAIL_SETTINGS_DIR`'virtusertable')dnl
dnl
dnl
dnl Rewrite (unqualified) outgoing email addresses using the
dnl mapping listed in /etc/mail/genericstable
dnl
FEATURE(`genericstable', `hash -o MAIL_SETTINGS_DIR`'genericstable')dnl
dnl
dnl
dnl Normally only local addresses are rewritten.  By using
dnl generics_entire_domain and either GENERICS_DOMAIN
dnl or GENERICS_DOMAIN_FILE addresses from hosts in the
dnl specified domain(s) will be rewritten too.
dnl
dnl FEATURE(`generics_entire_domain')dnl
dnl GENERICS_DOMAIN(`othercompany.com')dnl
dnl GENERICS_DOMAIN_FILE(`MAIL_SETTINGS_DIR`'generics-domains')dnl
dnl
dnl
dnl Include the local host domain even on locally delivered mail
dnl (which would otherwise contain only the username).
FEATURE(`always_add_domain')dnl
dnl
dnl
dnl Bounce messages addressed to "address.REDIRECT".  This allows the
dnl admin to alias a user who has moved to "new_address.REDIRECT" so
dnl that senders will know the user's new address.
FEATURE(`redirect')dnl
dnl
dnl
dnl Accept incoming connections on any IPv4 or IPv6 interface for ports
dnl 25 (SMTP) and 587 (MSA).
dnl
FEATURE(`no_default_msa')dnl
DAEMON_OPTIONS(`Family=inet, address=0.0.0.0, Name=MTA')dnl
DAEMON_OPTIONS(`Family=inet6, address=::, Name=MTA6, M=O')dnl
DAEMON_OPTIONS(`Family=inet, address=0.0.0.0, Port=587, Name=MSA, M=E')dnl
DAEMON_OPTIONS(`Family=inet6, address=::, Port=587, Name=MSA6, M=O, M=E')dnl
dnl
dnl Use either IPv4 or IPv6 for outgoing connections.
dnl
CLIENT_OPTIONS(`Family=inet6, Address=::')dnl
CLIENT_OPTIONS(`Family=inet, Address=0.0.0.0')dnl
dnl
dnl
dnl Some broken nameservers will return SERVFAIL (a temporary failure)
dnl on T_AAAA (IPv6) lookups.
define(`confBIND_OPTS', `WorkAroundBrokenAAAA')dnl
dnl
dnl
dnl TLS/SSL support; read starttls(8) to use.
dnl
dnl MirOS speaks STARTTLS by default, but sendmail wants us to
dnl have a certificate, so use a SnakeOil Certificate for now.
dnl You should get a real certificate as soon as possible.
dnl
define(`confCACERT_PATH',	`/etc/ssl/certs')dnl
define(`confCACERT',		`/etc/ssl/deflt-ca.cer')dnl
define(`confSERVER_CERT',	`/etc/ssl/default.cer')dnl
define(`confCLIENT_CERT',	`/etc/ssl/default.cer')dnl
define(`confSERVER_KEY',	`/etc/ssl/private/default.key')dnl
define(`confCLIENT_KEY',	`/etc/ssl/private/default.key')dnl
dnl This one is just faster and as secure as /dev/urandom.
define(`confRAND_FILE',		`/dev/arandom')dnl
dnl
dnl
dnl Masquerading -- rewriting the From address to a specific domain.
dnl Please see the "MASQUERADING AND RELAYING" section of
dnl /usr/share/sendmail/README for details.
dnl
dnl MASQUERADE_AS(`mycompany.com')dnl
dnl
dnl
dnl Masquerade the envelope From in addition to the From: header.
dnl
dnl FEATURE(masquerade_envelope)dnl
dnl
dnl Masquerade host.sub.dom.ain as well as host.dom.ain.
dnl
dnl FEATURE(masquerade_entire_domain)dnl
dnl
dnl Only masquerade messages going outside the local domain.
dnl
dnl FEATURE(local_no_masquerade)dnl
dnl
dnl Rewrite addresses from user@@othercompany.com when relayed in
dnl addition to locally-generated messages.
dnl
dnl MASQUERADE_DOMAIN(`othercompany.com')dnl
dnl
dnl Specific hosts that should be excepted from MASQUERADE_DOMAIN.
dnl
dnl MASQUERADE_EXCEPTION(`host.othercompany.com')dnl
dnl
dnl Only masquerade for hosts listed by MASQUERADE_DOMAIN
dnl (normally any host considered local is also masqueraded).
dnl
dnl FEATURE(limited_masquerade)dnl
dnl
dnl Specific users that should be excepted from masquerading.
dnl
dnl EXPOSED_USER(`root')dnl
dnl EXPOSED_USER(`daemon')dnl
dnl EXPOSED_USER_FILE(`MAIL_SETTINGS_DIR`'exposed-users')dnl
dnl
dnl End of masquerading section.
dnl
dnl
dnl MirOS enables special handling of eMail by default in order
dnl to be compatible to most of the internet mail servers.
dnl
dnl Handling of unescaped 8-bit messages
dnl
dnl - Strip the eigth bit
define(`confSEVEN_BIT_INPUT', `True')dnl
dnl if confSEVEN_BIT_INPUT==False AND MIME8TO7 not =0 in Makefile
dnl - Convert them to valid MIME data
dnl define(`confEIGHT_BIT_HANDLING', `mimefy')dnl
dnl
dnl Sanitize default mailer flags
dnl Escape lines starting with unescaped "From "
dnl
define(`_DEF_LOCAL_MAILER_FLAGS', `LlsDFMAw5:/|@@q')dnl
define(`LOCAL_MAILER_FLAGS', `rmnS67E')dnl
define(`_DEF_LOCAL_SHELL_FLAGS', `LlsDFMoq')dnl
define(`LOCAL_SHELL_FLAGS', `eu67E')dnl
define(`_DEF_SMTP_MAILER_FLAGS', `LmDFMuX')dnl
define(`SMTP_MAILER_FLAGS', `67E')dnl
dnl
dnl Adhere to ~/.etc standard of MirOS
dnl
define(`confFORWARD_PATH', `$z/.etc/forward.$w:$z/.etc/forward:$z/.forward.$w:$z/.forward')dnl
dnl
dnl Say hello to our friendly user
dnl
define(`confSMTP_LOGIN_MSG',
`$j ready at $b\n >> Bitte keine Werbung einwerfen! <<\nWho do you wanna pretend to be today?')dnl
dnl
dnl
dnl That's all, folks.
dnl
dnl
MAILER(`local')dnl
MAILER(`smtp')dnl
dnl
dnl
dnl Enforce valid Message-Id to help stop spammers
dnl
LOCAL_RULESETS
HMessage-Id: $>CheckMessageId

SCheckMessageId
R< $+ @@ $+ >		$@@ OK
R$*			$#error $: 553 Header Error

dnl
dnl
dnl Enable to play "Towers of Hanoi"
dnl
############################################
###  Ruleset 49 -- a.s.r Towers of Hanoi ###
############################################
S49
RHANOI:$+	$:1 2 3$1
R$-$-$-$*[$+]	$:$1$2$3$4
R$-$-$-		$@@$1$2$3
R$-$-$-@@$*	$:$>49 $1$3$2$4
R$-$-$-$*	$:$>49 $2$3$1$4[Move top disc of peg $1 to peg $3]
R$-$-$-$*	$:$3$2$1@@$4

# Usage:
#   echo '49 HANOI:@@@@@@@@' | sendmail -bt -d21
dnl
dnl
dnl End of file.
dnl
@


1.19
log
@bsiegert@@ wants me not to unconditionally strip unescaped eight
bit messages (which violate RFC 821), but to mimefy them

with a laughing and a whining eye, ok tg@@
@
text
@d3 1
a3 1
# $MirBSD: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.18 2004/11/18 15:53:09 tg Exp $
d22 1
a22 1
VERSIONID(`@@(#)openbsd-proto.mc MirOS $Revision: 1.18 $')dnl
d195 5
a199 2
define(`confSEVEN_BIT_INPUT', `False')dnl
define(`confEIGHT_BIT_HANDLING', `mimefy')dnl
@


1.18
log
@fix default sendmail and httpd operation
@
text
@d3 1
a3 1
# $MirBSD: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.17 2004/11/13 18:51:42 tg Exp $
d22 1
a22 1
VERSIONID(`@@(#)openbsd-proto.mc MirOS $Revision: 1.17 $')dnl
d195 1
a195 1
define(`confSEVEN_BIT_INPUT', `True')dnl
@


1.17
log
@move sendmail certs to /etc/ssl/ and more sensible locations/names
@
text
@d3 1
a3 1
# $MirBSD: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.16 2004/10/23 00:25:42 tg Exp $
d22 1
a22 1
VERSIONID(`@@(#)openbsd-proto.mc MirOS $Revision: 1.16 $')dnl
d139 5
a143 5
define(`confCACERT',		`/etc/ssl/sendmail-ca.cer')dnl
define(`confSERVER_CERT',	`/etc/ssl/sendmail.cer')dnl
define(`confCLIENT_CERT',	`/etc/ssl/sendmail.cer')dnl
define(`confSERVER_KEY',	`/etc/ssl/private/sendmail.key')dnl
define(`confCLIENT_KEY',	`/etc/ssl/private/sendmail.key')dnl
@


1.16
log
@merge
@
text
@d3 1
a3 1
# $MirBSD: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.15 2004/08/29 19:00:44 tg Exp $
d22 1
a22 1
VERSIONID(`@@(#)openbsd-proto.mc MirOS $Revision: 1.15 $')dnl
d138 6
a143 6
define(`confCACERT',		`MAIL_SETTINGS_DIR`'private/my-ca.cer')dnl
define(`confCACERT_PATH',	`MAIL_SETTINGS_DIR`'certs')dnl
define(`confSERVER_CERT',	`MAIL_SETTINGS_DIR`'private/sendmail.cer')dnl
define(`confSERVER_KEY',	`MAIL_SETTINGS_DIR`'private/sendmail.key')dnl
define(`confCLIENT_CERT',	`MAIL_SETTINGS_DIR`'private/sendmail.cer')dnl
define(`confCLIENT_KEY',	`MAIL_SETTINGS_DIR`'private/sendmail.key')dnl
@


1.15
log
@adhere to ~/.etc -> move .forward there
(still knows the old location)
@
text
@d3 1
a3 1
# $MirBSD: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.14 2004/08/21 15:30:51 tg Stab $
d22 1
a22 1
VERSIONID(`@@(#)openbsd-proto.mc MirOS $Revision: 1.14 $')dnl
d150 1
a150 1
dnl /usr/share/sendmail/cf/cf/README for details.
@


1.14
log
@* add genericstable (from OpenBSD)
* generate databases (idea from OpenBSD)
* unify m4
* add even better comments
@
text
@d3 1
a3 1
# $MirBSD: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.13 2004/08/21 15:12:29 tg Exp $
d22 1
a22 1
VERSIONID(`@@(#)openbsd-proto.mc MirOS $Revision: 1.13 $')dnl
d207 4
@


1.13
log
@fix (c) and description
@
text
@d1 1
a1 1
divert(-1)
d3 1
a3 1
# $MirBSD: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.12 2004/06/02 14:41:50 tg Exp $
d22 1
a22 1
VERSIONID(`@@(#)openbsd-proto.mc MirOS $Revision: 1.12 $')dnl
d32 1
d38 1
d45 1
d51 10
a60 1
FEATURE(nouucp, `reject')
d65 1
a65 1
FEATURE(use_cw_file)dnl
a66 3
dnl The access database allows for certain actions to be taken based on
dnl the source address.
dnl The access database file should be considered optional.
d68 1
a68 2
FEATURE(access_db, `hash -T<TMPF> -o MAIL_SETTINGS_DIR`'access')dnl
FEATURE(blacklist_recipients)dnl
d70 1
a70 1
dnl Enable support for /etc/mail/mailertable.
a71 1
FEATURE(mailertable, `hash -o MAIL_SETTINGS_DIR`'mailertable')dnl
d76 2
a77 1
FEATURE(use_ct_file)dnl
d82 18
a99 1
FEATURE(virtusertable, `hash -o MAIL_SETTINGS_DIR`'virtusertable')dnl
d103 2
a104 1
FEATURE(always_add_domain)dnl
d109 2
a110 1
FEATURE(redirect)dnl
d115 1
a115 1
FEATURE(no_default_msa)
d118 5
a122 2
DAEMON_OPTIONS(`Family=inet, address=0.0.0.0, Port=587, Name=MSA, M=E')
DAEMON_OPTIONS(`Family=inet6, address=::, Port=587, Name=MSA6, M=O, M=E')
d126 1
d131 1
d138 9
a146 8
define(`confCACERT',      `MAIL_SETTINGS_DIR`'private/my-ca.cer')dnl
define(`confCACERT_PATH', `MAIL_SETTINGS_DIR`'certs')dnl
define(`confSERVER_CERT', `MAIL_SETTINGS_DIR`'private/sendmail.cer')dnl
define(`confSERVER_KEY',  `MAIL_SETTINGS_DIR`'private/sendmail.key')dnl
define(`confCLIENT_CERT', `MAIL_SETTINGS_DIR`'private/sendmail.cer')dnl
define(`confCLIENT_KEY',  `MAIL_SETTINGS_DIR`'private/sendmail.key')dnl
dnl This one is just faster and as secure, but exists only on OpenBSD.
define(`confRAND_FILE',   `/dev/arandom')dnl
d154 1
d189 6
d197 4
d210 3
a212 1
define(`confSMTP_LOGIN_MSG', `$j ready at $b\n >> Bitte keine Werbung einwerfen! <<\nWho do you wanna pretend to be today?')dnl
d216 4
a219 2
MAILER(local)
MAILER(smtp)
d230 4
d242 1
a242 1
R$-$-$-$*	$:$>49 $2$3$1$4[Move Top Disk Of Peg $1 To Peg $3]
d247 4
a250 1
# Have fun!
@


1.12
log
@optimize, wording
revive MSA
@
text
@d2 3
a4 1
# $MirBSD: openbsd-proto.mc,v 1.11 2004/05/11 19:14:14 tg Exp $
d6 1
a6 1
#	Thorsten Glaser <x86@@ePost.de>
a14 2
#
#
d17 2
a18 2
#  This is the prototype file for a configuration that supports nothing
#  but basic SMTP connections via TCP.
d22 1
a22 1
VERSIONID(`@@(#)openbsd-proto.mc MirOS $Revision: 1.11 $')dnl
d96 1
a96 1
dnl Some broken nameservers will return SERVFAIL (a temporary failure) 
@


1.11
log
@a solution for the bmf problem with unescaped "From "s at
the beginning of the line
also, slightly better adjustments to RFC821
@
text
@d2 1
a2 1
# $MirBSD: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.10 2004/04/25 01:10:33 tg Exp $
d22 1
a22 1
VERSIONID(`@@(#)openbsd-proto.mc MirOS $Revision: 1.10 $')dnl
d91 2
a92 3
dnl No Mail Submit Agent by default.
dnl DAEMON_OPTIONS(`Family=inet, address=0.0.0.0, Port=587, Name=MSA, M=E')
dnl DAEMON_OPTIONS(`Family=inet6, address=::, Port=587, Name=MSA6, M=O, M=E')
d102 3
a104 3
dnl MirBSD specific: SnakeOil Certificate installed by default,
dnl so any MirBSD system speaks STARTTLS from the beginning.
dnl Discussed with somebody from the CCC Cologne.
@


1.10
log
@set 8bit handling to mimefy
@
text
@d2 1
a2 1
# $MirBSD: openbsd-proto.mc,v 1.9 2003/12/26 22:12:38 tg Exp $
d22 1
a22 1
VERSIONID(`@@(#)openbsd-proto.mc MirOS $Revision: 1.9 $')dnl
d159 1
a159 1
define(`LOCAL_MAILER_FLAGS', `rmnS')dnl
d161 1
a161 1
define(`LOCAL_SHELL_FLAGS', `eu')dnl
d163 1
@


1.9
log
@merge OpenBSD and MirOSify a bit (XXX revisit *lex.c)
@
text
@d2 3
a4 2
# $MirBSD: openbsd-proto.mc,v 1.8 2003/09/30 20:24:43 tg Exp $
# Copyright (c) 2002, 2003 Thorsten Glaser <x86@@ePost.de>
d22 1
a22 1
VERSIONID(`@@(#)openbsd-proto.mc MirOS $Revision: 1.1.1.3 $')dnl
d101 1
a101 1
dnl TLS/SSL support; uncomment and read starttls(8) to use.
a155 3
dnl Voluntarily break RFC2822 and comply with RFC822 about
dnl 7-Bit security vs. 8-Bit transparency. Helps broken MUAs.
dnl
d157 1
@


1.8
log
@unbreak TLS support: install an empty my-ca.cer
("the certificate of the CA that signed my certificate").

while here, restructure and re-nicen the .mc file, making
it a bit more readible (I still prefer .cf), and test for
regressions.
@
text
@d2 1
a2 1
# $MirBSD: openbsd-proto.mc,v 1.7 2003/09/27 14:16:38 tg Exp $
d21 2
a22 2
VERSIONID(`@@(#)openbsd-proto.mc MirBSD $Revision: 1.7 $')
OSTYPE(openbsd)
d30 5
@


1.8.4.1
log
@MFC: fix eight bit handling
@
text
@d2 2
a3 3
# $MirBSD: src/gnu/usr.sbin/sendmail/cf/cf/openbsd-proto.mc,v 1.8 2003/09/30 20:24:43 tg Exp $
# Copyright (c) 2002, 2003, 2004
#	Thorsten Glaser <x86@@ePost.de>
d21 1
a21 1
VERSIONID(`@@(#)openbsd-proto.mc MirBSD $Revision: 1.8 $')
d150 3
a153 1
define(`confEIGHT_BIT_HANDLING', `mimefy')dnl
@


1.7
log
@use /dev/arandom as RandFile (it's faster than /dev/urandom)
@
text
@d2 1
a2 1
# $MirBSD: openbsd-proto.mc,v 1.6 2003/09/27 14:14:58 tg Exp $
d21 1
a21 1
VERSIONID(`@@(#)openbsd-proto.mc MirBSD $Revision: 1.6 $')
d51 1
d53 1
a53 1
FEATURE(access_db)dnl
d58 1
a58 1
FEATURE(`mailertable', `hash -o /etc/mail/mailertable')dnl
d63 1
a63 1
FEATURE(`use_ct_file')dnl
d68 1
a68 1
FEATURE(`virtusertable', `hash -o /etc/mail/virtusertable')dnl
d82 1
a82 1
FEATURE(`no_default_msa')
d85 1
d101 8
a108 7
dnl define(`confCACERT',      `/etc/mail/private/my-ca.cer')dnl
define(`confCACERT_PATH', `/etc/mail/certs')dnl
define(`confSERVER_CERT', `/etc/mail/private/sendmail.cer')dnl
define(`confSERVER_KEY',  `/etc/mail/private/sendmail.key')dnl
define(`confCLIENT_CERT', `/etc/mail/private/sendmail.cer')dnl
define(`confCLIENT_KEY',  `/etc/mail/private/sendmail.key')dnl
define(`confRAND_FILE', `/dev/arandom')dnl
d146 1
a146 1
dnl EXPOSED_USER_FILE(`/etc/mail/exposed-users')dnl
d149 4
a153 1
define(`confSMTP_LOGIN_MSG', `$j ready at $b\n >> Bitte keine Werbung einwerfen! <<\nWho do you wanna pretend to be today?')dnl
d159 7
@


1.6
log
@Install the following directories *NEW* by default:
o /etc/mail/certs
	content: same as /etc/ssl/certs.
		 (i.e. a hashed store of X509v3 CA Certificates)
o /etc/mail/private
	sendmail.key
	sendmail.cer
		 (i.e. a snake-oil STARTTLS certificate, so sendmail
		  at least encrypts anything that goes over the wire)
@
text
@d2 1
a2 1
# $MirBSD: openbsd-proto.mc,v 1.5 2003/09/25 20:59:47 tg Exp $
d21 1
a21 1
VERSIONID(`@@(#)openbsd-proto.mc MirBSD $Revision: 1.5 $')
d105 1
@


1.5
log
@Merge OpenBSD-current
@
text
@d2 1
a2 1
# $MirBSD: openbsd-proto.mc,v 1.4 2003/07/06 20:21:32 tg Exp $
d21 1
a21 1
VERSIONID(`@@(#)openbsd-proto.mc MirBSD $Revision: 1.4 $')
d95 4
a98 1
dnl define(`confCACERT_PATH', `/etc/mail/certs')dnl
d100 5
a104 4
dnl define(`confSERVER_CERT', `/etc/mail/private/sendmail.cer')dnl
dnl define(`confSERVER_KEY',  `/etc/mail/private/sendmail.key')dnl
dnl define(`confCLIENT_CERT', `/etc/mail/private/sendmail.cer')dnl
dnl define(`confCLIENT_KEY',  `/etc/mail/private/sendmail.key')dnl
@


1.4
log
@mop up
@
text
@d2 1
a2 1
# $MirBSD: openbsd-proto.mc,v 1.3 2003/03/31 14:36:41 tg Exp $
d21 1
a21 1
VERSIONID(`@@(#)openbsd-proto.mc MirBSD $Revision: 1.3 $')
d23 19
d43 4
a46 1
FEATURE(`no_default_msa')
d48 4
d54 28
a81 9
define(`confSEVEN_BIT_INPUT', `True')dnl
define(`confSMTP_LOGIN_MSG', `$j ready at $b\n >> Bitte keine Werbung einwerfen! <<\nWho do you wanna pretend to be today?')dnl
define(`_DEF_LOCAL_MAILER_FLAGS', `LlsDFMAw5:/|@@q')dnl
define(`LOCAL_MAILER_FLAGS', `rmnS')dnl
define(`_DEF_LOCAL_SHELL_FLAGS', `LlsDFMoq')dnl
define(`LOCAL_SHELL_FLAGS', `eu')dnl
define(`_DEF_SMTP_MAILER_FLAGS', `LmDFMuX')dnl
MAILER(local)
MAILER(smtp)
d92 58
@


1.3
log
@fix make release:
dnlFOO => dnl FOO
comments start with "dnl " in m4 files, I learned.
@
text
@d2 2
a3 2
# $MirBSD$
# Copyright (c) 2002-2003 Thorsten "mirabile" Glaser <x86@@ePost.de>
d21 1
a21 1
VERSIONID(`@@(#)openbsd-proto.mc MirBSD $Revision: 1.2 $')
@


1.2
log
@Merge MirBSD-old entirely
Remove krb, yp, afs, GPL'd stuff in kernel
Adjust some other stuff

Not to be compiled yet...
@
text
@d2 1
d21 1
a21 1
VERSIONID(`@@(#)openbsd-proto.mc $Revision: 1.1.1.1 $')
d39 2
a40 2
dnlDAEMON_OPTIONS(`Family=inet, address=0.0.0.0, Port=587, Name=MSA, M=E')
dnlDAEMON_OPTIONS(`Family=inet6, address=::, Port=587, Name=MSA6, M=O, M=E')
@


1.1
log
@Initial revision
@
text
@d2 1
a2 1
#
d20 1
a20 1
VERSIONID(`@@(#)openbsd-proto.mc $Revision: 1.6 $')
d24 10
d38 2
a39 2
DAEMON_OPTIONS(`Family=inet, address=0.0.0.0, Port=587, Name=MSA, M=E')
DAEMON_OPTIONS(`Family=inet6, address=::, Port=587, Name=MSA6, M=O, M=E')
d55 15
@


1.1.1.1
log
@Import OpenBSD 3.3 source repository from CTM 3132 the first time
This opens an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright © 1968-2003  The authors of And contributors to UNIX®, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@


1.1.1.2
log
@Release Time. Synchronize with OpenBSD 3.4-current (base system).
@
text
@d3 14
a16 2
# Default OpenBSD sendmail configuration for systems accepting mail
# from the internet.
a17 1
# Note that lines beginning with "dnl" below are comments.
d20 11
a30 68
VERSIONID(`@@(#)openbsd-proto.mc $Revision: 1.7 $')dnl
OSTYPE(openbsd)dnl
dnl
dnl If you have a non-static IP address you may wish to forward outgoing mail
dnl through your ISP's mail server to prevent matching one of the dialup
dnl DNS black holes.  Just uncomment the following line and replace
dnl mail.myisp.net with the hostname of your ISP's mail server.
dnl
dnl define(`SMART_HOST', `mail.myisp.net')dnl
dnl
dnl We wish to make the existence of the local-host-names and
dnl trusted-users files optional, hence the "-o" below.
dnl
define(`confCW_FILE', `-o MAIL_SETTINGS_DIR`'local-host-names')dnl
define(`confCT_FILE', `-o MAIL_SETTINGS_DIR`'trusted-users')dnl
dnl
dnl Use of UUCP-style addresses in the modern internet are generally
dnl an error (and sometimes used by spammers) so disable support for them.
dnl To simply treat '!' as a normal character, change `reject' to
dnl `nospecial'.
dnl
FEATURE(nouucp, `reject')dnl
dnl
dnl The access database allows for certain actions to be taken based on
dnl the source address.
dnl
FEATURE(`access_db', `hash -o -T<TMPF> /etc/mail/access')dnl
FEATURE(`blacklist_recipients')dnl
dnl
dnl Enable support for /etc/mail/local-host-names.
dnl Contains hostnames that should be considered local.
dnl
FEATURE(`use_cw_file')dnl
dnl
dnl Enable support for /etc/mail/mailertable.
dnl
FEATURE(`mailertable', `hash -o /etc/mail/mailertable')dnl
dnl
dnl Enable support for /etc/mail/trusted-users.
dnl Users listed herein may spoof mail from other users.
dnl
FEATURE(`use_ct_file')dnl
dnl
dnl Enable support for /etc/mail/virtusertable.
dnl Used to do N -> N address mapping.
dnl
FEATURE(`virtusertable', `hash -o /etc/mail/virtusertable')dnl
dnl
dnl Include the local host domain even on locally delivered mail
dnl (which would otherwise contain only the username).
FEATURE(always_add_domain)dnl
dnl
dnl Bounce messages addressed to "address.REDIRECT".  This allows the
dnl admin to alias a user who has moved to "new_address.REDIRECT" so
dnl that senders will know the user's new address.
FEATURE(redirect)dnl
dnl
dnl Accept incoming connections on any IPv4 or IPv6 interface for ports
dnl 25 (SMTP) and 587 (MSA).
dnl
FEATURE(`no_default_msa')dnl
DAEMON_OPTIONS(`Family=inet, Address=0.0.0.0, Name=MTA')dnl
DAEMON_OPTIONS(`Family=inet6, Address=::, Name=MTA6, M=O')dnl
DAEMON_OPTIONS(`Family=inet, Address=0.0.0.0, Port=587, Name=MSA, M=E')dnl
DAEMON_OPTIONS(`Family=inet6, Address=::, Port=587, Name=MSA6, M=O, M=E')dnl
dnl
dnl Use either IPv4 or IPv6 for outgoing connections.
dnl
a31 1
CLIENT_OPTIONS(`Family=inet6, Address=::')dnl
d33 1
a33 1
dnl Some broken nameservers will return SERVFAIL (a temporary failure)
a34 1
dnl
d37 1
a37 53
dnl TLS/SSL support; uncomment and read starttls(8) to use.
dnl
dnl define(`CERT_DIR', `MAIL_SETTINGS_DIR`'certs')dnl
dnl define(`confCACERT_PATH', `CERT_DIR')dnl
dnl define(`confCACERT', `CERT_DIR/mycert.pem')dnl
dnl define(`confSERVER_CERT', `CERT_DIR/mycert.pem')dnl
dnl define(`confSERVER_KEY', `CERT_DIR/mykey.pem')dnl
dnl define(`confCLIENT_CERT', `CERT_DIR/mycert.pem')dnl
dnl define(`confCLIENT_KEY', `CERT_DIR/mykey.pem')dnl
dnl
dnl Masquerading -- rewriting the From address to a specific domain.
dnl Please see the "MASQUERADING AND RELAYING" section of
dnl /usr/share/sendmail/cf/cf/README for details.
dnl
dnl MASQUERADE_AS(`mycompany.com')dnl
dnl
dnl Masquerade the envelope From in addition to the From: header.
dnl
dnl FEATURE(masquerade_envelope)dnl
dnl
dnl Masquerade host.sub.dom.ain as well as host.dom.ain.
dnl
dnl FEATURE(masquerade_entire_domain)dnl
dnl
dnl Only masquerade messages going outside the local domain.
dnl
dnl FEATURE(local_no_masquerade)dnl
dnl
dnl Rewrite addresses from user@@othercompany.com when relayed in
dnl addition to locally-generated messages.
dnl
dnl MASQUERADE_DOMAIN(`othercompany.com')dnl
dnl
dnl Specific hosts that should be excepted from MASQUERADE_DOMAIN.
dnl
dnl MASQUERADE_EXCEPTION(`host.othercompany.com')dnl
dnl
dnl Only masquerade for hosts listed by MASQUERADE_DOMAIN
dnl (normally any host considered local is also masqueraded).
dnl
dnl FEATURE(limited_masquerade)dnl
dnl
dnl Specific users that should be excepted from masquerading.
dnl
dnl EXPOSED_USER(`root')dnl
dnl EXPOSED_USER(`daemon')dnl
dnl EXPOSED_USER_FILE(`/etc/mail/exposed-users')dnl
dnl
dnl End of masquerading section.
MAILER(local)dnl
MAILER(smtp)dnl
dnl
dnl Enforce valid Message-Id to help stop spammers.
@


1.1.1.3
log
@Time to import OpenBSD once again. Expect breakage.
@
text
@d9 1
a9 1
VERSIONID(`@@(#)openbsd-proto.mc $Revision: 1.8 $')dnl
a17 5
dnl
dnl Disable EXPN and VRFY to help thwart address harvesters and require
dnl senders to say hello.
dnl
define(`confPRIVACY_FLAGS', `authwarnings,needmailhelo,noexpn,novrfy')dnl
@


1.1.1.4
log
@update to sendmail 8.13.1/8.13.1
@
text
@d9 1
a9 1
VERSIONID(`@@(#)openbsd-proto.mc $Revision: 1.10 $')dnl
a61 14
dnl Rewrite (unqualified) outgoing email addresses using the
dnl mapping listed in /etc/mail/genericstable
dnl
FEATURE(genericstable, `hash -o /etc/mail/genericstable')dnl
dnl
dnl Normally only local addresses are rewritten.  By using
dnl generics_entire_domain and either GENERICS_DOMAIN
dnl or GENERICS_DOMAIN_FILE addresses from hosts in the
dnl specified domain(s) will be rewritten too.
dnl
dnl FEATURE(generics_entire_domain)dnl
dnl GENERICS_DOMAIN(`othercompany.com')dnl
dnl GENERICS_DOMAIN_FILE(`/etc/mail/generics-domains')dnl
dnl
d102 1
a102 1
dnl /usr/share/sendmail/README for details.
@


