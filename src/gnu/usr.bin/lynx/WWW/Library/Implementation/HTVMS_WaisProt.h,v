head	1.6;
access;
symbols
	lynx-2_8_6dev10:1.1.2.1
	FSF:1.1.2
	tg-mergetmp-mirosx-1:1.6
	tg-mergefixes-1-branch:1.6.0.8
	tg-mergefixes-1-base:1.6
	MIROS_X:1.6.0.6
	MIROS_X_BASE:1.6
	MIRBSD_XP_MIRPPC:1.6.0.4
	lynx-2_8_6dev_7b:1.1.3.4
	lynx-2_8_6dev_6:1.1.3.4
	MIRBSD_XP_SPARC_BASE:1.6
	MIRBSD_XP_SPARC:1.6.0.2
	lynx-2_8_6dev_5-iz2:1.1.3.4
	lynx-2_8_6dev_5:1.1.3.4
	cvs-200406091940:1.1.1.1
	MIRBSD_7quater:1.3
	cvs-200405160640:1.1.1.1
	lynx-2_8_6dev2:1.1.3.3
	lynx-2_8_5:1.1.3.2
	cvs-200401271800:1.1.1.1
	cvs-200401261630:1.1.1.1
	lynx_2-8-5_dev17d:1.1.3.2
	cvs-200401021645:1.1.1.1
	MIRBSD_7_ALPHA:1.3.0.6
	MIRBSD_7:1.3.0.4
	cvs-200312222040:1.1.1.1
	MIRBSD_7ter:1.3
	MIRBSD_7_DEV:1.3.0.2
	cvs-200310020700:1.1.1.1
	lynx_2-8-5_dev16c:1.1.3.1
	cvs-200309271030:1.1.1.1
	cvs-200309251530:1.1.1.1
	lynx_2-8-5_dev16:1.1.3.1
	tg:1.1.3
	cvs-200308302005:1.1.1.1
	cvs-200308171200:1.1.1.1
	ctm-3496:1.1.1.1
	ctm-3449:1.1.1.1
	ctm-3437:1.1.1.1
	cvs-200307191805:1.1.1.1
	ctm-3425:1.1.1.1
	cvs-200307091500:1.1.1.1
	VENDOR_LYNX_285dev16:1.3
	ctm-3389:1.1.1.1
	cvs-200306291430:1.1.1.1
	ctm-3341:1.1.1.1
	MIRBSD_5:1.1.1.1
	cvs-200306082100:1.1.1.1
	ctm-3316:1.1.1.1
	ctm-3272:1.1.1.1
	ctm-3264:1.1.1.1
	cvs-200305071630:1.1.1.1
	MIRBSD_4:1.1.1.1
	ctm-3203:1.1.1.1
	cvs-20030410-1130:1.1.1.1
	ctm-3155:1.1.1.1
	ctm-3132:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@ * @;


1.6
date	2004.07.15.18.16.40;	author tg;	state Stab;
branches;
next	1.5;

1.5
date	2004.04.30.16.32.28;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2004.01.18.16.55.50;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2003.07.07.18.58.04;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2003.07.07.18.49.10;	author tg;	state dead;
branches;
next	1.1;

1.1
date	2003.03.22.17.42.14;	author tg;	state Exp;
branches
	1.1.1.1
	1.1.2.1
	1.1.3.1;
next	;

1.1.1.1
date	2003.03.22.17.42.14;	author tg;	state Exp;
branches;
next	;

1.1.2.1
date	2005.01.03.00.26.52;	author tg;	state Exp;
branches;
next	;

1.1.3.1
date	2003.09.17.14.19.48;	author tg;	state Exp;
branches;
next	1.1.3.2;

1.1.3.2
date	2004.01.18.15.34.23;	author tg;	state Exp;
branches;
next	1.1.3.3;

1.1.3.3
date	2004.04.30.16.15.09;	author tg;	state Exp;
branches;
next	1.1.3.4;

1.1.3.4
date	2004.07.15.15.46.16;	author tg;	state Exp;
branches;
next	;


desc
@@


1.6
log
@automatic merge of lynx-current
@
text
@/*							HTVMS_WAISProt.h
 *
 *	Adaptation for Lynx by F.Macrides (macrides@@sci.wfeb.edu)
 *
 *	31-May-1994 FM	Initial version.
 *
 *----------------------------------------------------------------------*/

/*
 *	Routines originally from WProt.h -- FM
 *
 *----------------------------------------------------------------------*/
/* WIDE AREA INFORMATION SERVER SOFTWARE:
 * No guarantees or restrictions.  See the readme file for the full standard
 * disclaimer.
 *
 *  3.26.90	Harry Morris, morris@@think.com
 *  3.30.90  Harry Morris
 *			-	removed chunk code from WAISSearchAPDU,
 *			-	added makeWAISQueryType1Query() and readWAISType1Query() which
 *				replace makeWAISQueryTerms() and makeWAISQueryDocs().
 *  4.11.90  HWM - added definitions of wais element set names
 *  4.14.90  HWM - changed symbol for relevance feedback query from QT_3 to
 *				  QT_RelevanceFeedbackQuery added QT_TextRetrievalQuery as a
 *				  synonym for QT_BooleanQuery
 *				- renamed makeWAISType1Query() to makeWAISTextQuery()
 *				  renamed readWAISType1Query() to readWAISTextQuery()
 *  5.29.90  TS - added CSTFreeWAISFoo functions
 */

#ifndef _H_WAIS_protocol_
#define _H_WAIS_protocol_

#ifndef HTUTILS_H
#include <HTUtils.h>
#endif

#include <HTVMS_WaisUI.h>

/*----------------------------------------------------------------------*/
/* Data types / constants */

/* date factor constants */
#define	DF_INDEPENDENT		1
#define DF_LATER		2
#define DF_EARLIER		3
#define DF_SPECIFIED_RANGE	4

/* chunk types */
#define CT_document		0
#define CT_byte			1
#define CT_line			2
#define CT_paragraph	3

/* relevance feedback query */
#define QT_RelevanceFeedbackQuery	"3"
#define QT_TextRetrievalQuery		QT_BooleanQuery

/* new data tags */
#define DT_UserInformationLength	(data_tag)99
#define	DT_ChunkCode			(data_tag)100
#define	DT_ChunkIDLength		(data_tag)101
#define	DT_ChunkMarker			(data_tag)102
#define	DT_HighlightMarker		(data_tag)103
#define	DT_DeHighlightMarker		(data_tag)104
#define	DT_NewlineCharacters		(data_tag)105
#define	DT_SeedWords			(data_tag)106
#define	DT_DocumentIDChunk		(data_tag)107
#define	DT_ChunkStartID			(data_tag)108
#define	DT_ChunkEndID			(data_tag)109
#define	DT_TextList			(data_tag)110
#define	DT_DateFactor			(data_tag)111
#define	DT_BeginDateRange		(data_tag)112
#define	DT_EndDateRange			(data_tag)113
#define	DT_MaxDocumentsRetrieved	(data_tag)114
#define	DT_SeedWordsUsed		(data_tag)115
#define	DT_DocumentID			(data_tag)116
#define	DT_VersionNumber		(data_tag)117
#define	DT_Score			(data_tag)118
#define	DT_BestMatch			(data_tag)119
#define	DT_DocumentLength		(data_tag)120
#define	DT_Source			(data_tag)121
#define	DT_Date				(data_tag)122
#define	DT_Headline			(data_tag)123
#define	DT_OriginCity			(data_tag)124
#define	DT_PresentStartByte		(data_tag)125
#define	DT_TextLength			(data_tag)126
#define	DT_DocumentText			(data_tag)127
#define	DT_StockCodes			(data_tag)128
#define	DT_CompanyCodes			(data_tag)129
#define	DT_IndustryCodes		(data_tag)130

/* added by harry */
#define DT_DocumentHeaderGroup		(data_tag)150
#define DT_DocumentShortHeaderGroup	(data_tag)151
#define DT_DocumentLongHeaderGroup	(data_tag)152
#define DT_DocumentTextGroup		(data_tag)153
#define DT_DocumentHeadlineGroup	(data_tag)154
#define DT_DocumentCodeGroup		(data_tag)155
#define DT_Lines			(data_tag)131
#define	DT_TYPE_BLOCK			(data_tag)132
#define DT_TYPE				(data_tag)133

/* wais element sets */
#define ES_DocumentHeader		"Document Header"
#define ES_DocumentShortHeader		"Document Short Header"
#define ES_DocumentLongHeader		"Document Long Header"
#define ES_DocumentText			"Document Text"
#define ES_DocumentHeadline		"Document Headline"
#define ES_DocumentCodes		"Document Codes"

typedef struct DocObj {		/* specifies a section of a document */
    any *DocumentID;
    char *Type;
    long ChunkCode;
    union {
	long Pos;
	any *ID;
    } ChunkStart;
    union {
	long Pos;
	any *ID;
    } ChunkEnd;
} DocObj;

/*----------------------------------------------------------------------*/
/* WAIS APDU extensions */

typedef struct WAISInitResponse {
    long ChunkCode;
    long ChunkIDLength;
    char *ChunkMarker;
    char *HighlightMarker;
    char *DeHighlightMarker;
    char *NewlineCharacters;
    /* XXX  need to add UpdateFrequency and Update Time */
} WAISInitResponse;

typedef struct WAISSearch {
    char *SeedWords;
    DocObj **Docs;
    char **TextList;
    long DateFactor;
    char *BeginDateRange;
    char *EndDateRange;
    long MaxDocumentsRetrieved;
} WAISSearch;

typedef struct WAISDocumentHeader {
    any *DocumentID;
    long VersionNumber;
    long Score;
    long BestMatch;
    long DocumentLength;
    long Lines;
    char **Types;
    char *Source;
    char *Date;
    char *Headline;
    char *OriginCity;
} WAISDocumentHeader;

typedef struct WAISDocumentShortHeader {
    any *DocumentID;
    long VersionNumber;
    long Score;
    long BestMatch;
    long DocumentLength;
    long Lines;
} WAISDocumentShortHeader;

typedef struct WAISDocumentLongHeader {
    any *DocumentID;
    long VersionNumber;
    long Score;
    long BestMatch;
    long DocumentLength;
    long Lines;
    char **Types;
    char *Source;
    char *Date;
    char *Headline;
    char *OriginCity;
    char *StockCodes;
    char *CompanyCodes;
    char *IndustryCodes;
} WAISDocumentLongHeader;

typedef struct WAISDocumentText {
    any *DocumentID;
    long VersionNumber;
    any *DocumentText;
} WAISDocumentText;

typedef struct WAISDocumentHeadlines {
    any *DocumentID;
    long VersionNumber;
    char *Source;
    char *Date;
    char *Headline;
    char *OriginCity;
} WAISDocumentHeadlines;

typedef struct WAISDocumentCodes {
    any *DocumentID;
    long VersionNumber;
    char *StockCodes;
    char *CompanyCodes;
    char *IndustryCodes;
} WAISDocumentCodes;

typedef struct WAISSearchResponse {
    char *SeedWordsUsed;
    WAISDocumentHeader **DocHeaders;
    WAISDocumentShortHeader **ShortHeaders;
    WAISDocumentLongHeader **LongHeaders;
    WAISDocumentText **Text;
    WAISDocumentHeadlines **Headlines;
    WAISDocumentCodes **Codes;
    diagnosticRecord **Diagnostics;
} WAISSearchResponse;

/*----------------------------------------------------------------------*/
/* Functions */

char *generate_search_apdu(char *buff,	/* buffer to hold the apdu */
			   long *buff_len,	/* number of bytes written to the buffer */
			   char *seed_words,	/* string of the seed words */
			   char *database_name,
			   DocObj **docobjs,
			   long maxDocsRetrieved);

DocObj *makeDocObjUsingWholeDocument(any *aDocID, char *type);
DocObj *makeDocObjUsingBytes(any *aDocID, char *type, long start, long end);
DocObj *makeDocObjUsingLines(any *aDocID, char *type, long start, long end);
DocObj *makeDocObjUsingParagraphs(any *aDocID, char *type, any *start, any *end);
void freeDocObj(DocObj *doc);

WAISInitResponse *makeWAISInitResponse(long chunkCode, long chunkIDLen,
				       char *chunkMarker, char *highlightMarker,
				       char *deHighlightMarker, char *newLineChars);
void freeWAISInitResponse(WAISInitResponse *init);

WAISSearch *makeWAISSearch(char *seedWords,
			   DocObj **docs,
			   char **textList,
			   long dateFactor,
			   char *beginDateRange,
			   char *endDateRange,
			   long maxDocsRetrieved);
void freeWAISSearch(WAISSearch *query);

WAISDocumentHeader *makeWAISDocumentHeader(any *aDocID,
					   long versionNumber,
					   long score,
					   long bestMatch,
					   long docLen,
					   long lines,
					   char **types,
					   char *source,
					   char *date,
					   char *headline,
					   char *originCity);
void freeWAISDocumentHeader(WAISDocumentHeader *header);
char *writeWAISDocumentHeader(WAISDocumentHeader *header, char *buffer, long *len);
char *readWAISDocumentHeader(WAISDocumentHeader **header, char *buffer);

WAISDocumentShortHeader *makeWAISDocumentShortHeader(any *aDocID,
						     long versionNumber,
						     long score,
						     long bestMatch,
						     long docLen,
						     long lines);
void freeWAISDocumentShortHeader(WAISDocumentShortHeader *header);
char *writeWAISDocumentShortHeader(WAISDocumentShortHeader *header,
				   char *buffer, long *len);
char *readWAISDocumentShortHeader(WAISDocumentShortHeader **header, char *buffer);

WAISDocumentLongHeader *makeWAISDocumentLongHeader(any *aDocID,
						   long versionNumber,
						   long score,
						   long bestMatch,
						   long docLen,
						   long lines,
						   char **types,
						   char *source,
						   char *date, char *headline,
						   char *originCity,
						   char *stockCodes,
						   char *companyCodes,
						   char *industryCodes);
void freeWAISDocumentLongHeader(WAISDocumentLongHeader *header);
char *writeWAISDocumentLongHeader(WAISDocumentLongHeader *header,
				  char *buffer,
				  long *len);
char *readWAISDocumentLongHeader(WAISDocumentLongHeader **header, char *buffer);

WAISSearchResponse *makeWAISSearchResponse(char *seedWordsUsed,
					   WAISDocumentHeader **docHeaders,
					   WAISDocumentShortHeader **shortHeaders,
					   WAISDocumentLongHeader **longHeaders,
					   WAISDocumentText **text, WAISDocumentHeadlines **headlines,
					   WAISDocumentCodes **codes,
					   diagnosticRecord ** diagnostics);
void freeWAISSearchResponse(WAISSearchResponse * response);

WAISDocumentText *makeWAISDocumentText(any *aDocID, long versionNumber,
				       any *documentText);
void freeWAISDocumentText(WAISDocumentText *docText);
char *writeWAISDocumentText(WAISDocumentText *docText, char *buffer, long *len);
char *readWAISDocumentText(WAISDocumentText **docText, char *buffer);

WAISDocumentHeadlines *makeWAISDocumentHeadlines(any *aDocID,
						 long versionNumber,
						 char *source,
						 char *date,
						 char *headline,
						 char *originCity);
void freeWAISDocumentHeadlines(WAISDocumentHeadlines *docHeadline);
char *writeWAISDocumentHeadlines(WAISDocumentHeadlines *docHeadline,
				 char *buffer,
				 long *len);
char *readWAISDocumentHeadlines(WAISDocumentHeadlines **docHeadline, char *buffer);

WAISDocumentCodes *makeWAISDocumentCodes(any *aDocID,
					 long versionNumber,
					 char *stockCodes,
					 char *companyCodes,
					 char *industryCodes);
void freeWAISDocumentCodes(WAISDocumentCodes *docCodes);
char *writeWAISDocumentCodes(WAISDocumentCodes *docCodes, char *buffer, long *len);
char *readWAISDocumentCodes(WAISDocumentCodes **docCodes, char *buffer);

any *makeWAISTextQuery(DocObj **docs);
DocObj **readWAISTextQuery(any *terms);

void CSTFreeWAISInitResponse(WAISInitResponse *init);
void CSTFreeWAISSearch(WAISSearch *query);
void CSTFreeDocObj(DocObj *doc);
void CSTFreeWAISDocumentHeader(WAISDocumentHeader *header);
void CSTFreeWAISDocumentShortHeader(WAISDocumentShortHeader *header);
void CSTFreeWAISDocumentLongHeader(WAISDocumentLongHeader *header);
void CSTFreeWAISSearchResponse(WAISSearchResponse * response);
void CSTFreeWAISDocumentText(WAISDocumentText *docText);
void CSTFreeWAISDocHeadlines(WAISDocumentHeadlines *docHeadline);
void CSTFreeWAISDocumentCodes(WAISDocumentCodes *docCodes);
void CSTFreeWAISTextQuery(any *query);

/*----------------------------------------------------------------------*/

#endif /* ndef _H_WAIS_protocol_ */

/*
 *	Routines originally from WMessage.h -- FM
 *
 *----------------------------------------------------------------------*/
/* WIDE AREA INFORMATION SERVER SOFTWARE
 * No guarantees or restrictions.  See the readme file for the full standard
 * disclaimer.
 * 3.26.90
 */

/* wais-message.h
 *
 * This is the header outside of WAIS Z39.50 messages.  The header will be
 * printable ascii, so as to be transportable.  This header will precede each
 * Z39.50 APDU, or zero-length message if it is an ACK or NACK.  Be sure to
 * change hdr_vers current value if you change the structure of the header.
 *
 * The characters in the header are case insensitive so that the systems from
 * the past that only handle one case can at least read the header.
 *
 * 7.5.90 HWM - added constants
 * 7/5/90 brewster added funtion prototypes and comments
 * 11/30/90 HWM - went to version 2 (inits and typed retrieval)
 */

#ifndef WMESSAGE_H
#define WMESSAGE_H

#ifndef HTUTILS_H
#include <HTUtils.h>
#endif

#include <HTVMS_WaisUI.h>

typedef struct wais_header {
    char msg_len[10];		/* length in bytes of following message */
    char msg_type;		/* type of message: 'z'=Z39.50 APDU,
				   'a'=ACK, 'n'=NACK */
    char hdr_vers;		/* version of this header, currently = '2' */
    char server[10];		/* name or address of server */
    char compression;		/* <sp>=no compression, 'u'=unix compress */
    char encoding;		/* <sp>=no encoding, 'h'=hexize,
				   'u'=uuencode */
    char msg_checksum;		/* XOR of every byte of message */
} WAISMessage;

#define HEADER_LENGTH	25	/* number of bytes needed to write a
				   wais-header (not sizeof(wais_header)) */

#define HEADER_VERSION	(long)'2'

/* message type */
#define Z3950			'z'
#define ACK			'a'
#define	NAK			'n'

/* compression */
#define NO_COMPRESSION		' '
#define UNIX_COMPRESSION	'u'

/* encoding */
#define NO_ENCODING		' '
#define HEX_ENCODING		'h'	/* Swartz 4/3 encoding */
#define IBM_HEXCODING		'i'	/* same as h but uses characters acceptable for IBM mainframes */
#define UUENCODE		'u'

void readWAISPacketHeader(char *msgBuffer, WAISMessage * header_struct);
long getWAISPacketLength(WAISMessage * header);
void writeWAISPacketHeader(char *header, long dataLen, long type,
			   char *server, long compression,
			   long encoding, long version);

#endif /* ndef WMESSAGE_H */
@


1.5
log
@pretty much automatic merge of Lynx update
now, we live in an ANSI C world...
@
text
@d2 6
a7 6
**
**	Adaptation for Lynx by F.Macrides (macrides@@sci.wfeb.edu)
**
**	31-May-1994 FM	Initial version.
**
**----------------------------------------------------------------------*/
d10 3
a12 3
**	Routines originally from WProt.h -- FM
**
**----------------------------------------------------------------------*/
d14 16
a29 16
   No guarantees or restrictions.  See the readme file for the full standard
   disclaimer.

   3.26.90	Harry Morris, morris@@think.com
   3.30.90  Harry Morris
			-	removed chunk code from WAISSearchAPDU,
			-	added makeWAISQueryType1Query() and readWAISType1Query() which
				replace makeWAISQueryTerms() and makeWAISQueryDocs().
   4.11.90  HWM - added definitions of wais element set names
   4.14.90  HWM - changed symbol for relevance feedback query from QT_3 to
				  QT_RelevanceFeedbackQuery added QT_TextRetrievalQuery as a
				  synonym for QT_BooleanQuery
				- renamed makeWAISType1Query() to makeWAISTextQuery()
				  renamed readWAISType1Query() to readWAISTextQuery()
   5.29.90  TS - added CSTFreeWAISFoo functions
*/
d112 13
a124 13
typedef struct DocObj { /* specifies a section of a document */
	any*	DocumentID;
	char*   Type;
	long	ChunkCode;
	union {
		long	Pos;
		any*	ID;
	} ChunkStart;
	union {
		long	Pos;
		any*	ID;
	} ChunkEnd;
	} DocObj;
d130 8
a137 8
	long				ChunkCode;
	long				ChunkIDLength;
	char*				ChunkMarker;
	char*				HighlightMarker;
	char*				DeHighlightMarker;
	char*				NewlineCharacters;
	/* XXX  need to add UpdateFrequency and Update Time */
	} WAISInitResponse;
d140 8
a147 8
	char*				SeedWords;
	DocObj**			Docs;
	char**				TextList;
	long				DateFactor;
	char*				BeginDateRange;
	char*				EndDateRange;
	long				MaxDocumentsRetrieved;
	} WAISSearch;
d150 12
a161 12
	any*				DocumentID;
	long				VersionNumber;
	long				Score;
	long				BestMatch;
	long				DocumentLength;
	long				Lines;
	char**				Types;
	char*				Source;
	char*				Date;
	char*				Headline;
	char*				OriginCity;
	} WAISDocumentHeader;
d164 7
a170 7
	any*				DocumentID;
	long				VersionNumber;
	long				Score;
	long				BestMatch;
	long				DocumentLength;
	long				Lines;
	} WAISDocumentShortHeader;
d173 15
a187 15
	any*				DocumentID;
	long				VersionNumber;
	long				Score;
	long				BestMatch;
	long				DocumentLength;
	long				Lines;
	char**				Types;
	char*				Source;
	char*				Date;
	char*				Headline;
	char*				OriginCity;
	char*				StockCodes;
	char*				CompanyCodes;
	char*				IndustryCodes;
	} WAISDocumentLongHeader;
d190 4
a193 4
	any*				DocumentID;
	long				VersionNumber;
	any*				DocumentText;
	} WAISDocumentText;
d196 7
a202 7
	any*				DocumentID;
	long				VersionNumber;
	char*				Source;
	char*				Date;
	char*				Headline;
	char*				OriginCity;
	} WAISDocumentHeadlines;
d205 6
a210 6
	any*				DocumentID;
	long				VersionNumber;
	char*				StockCodes;
	char*				CompanyCodes;
	char*				IndustryCodes;
	} WAISDocumentCodes;
d213 9
a221 9
	char*					SeedWordsUsed;
	WAISDocumentHeader**		DocHeaders;
	WAISDocumentShortHeader**	ShortHeaders;
	WAISDocumentLongHeader**	LongHeaders;
	WAISDocumentText**			Text;
	WAISDocumentHeadlines**		Headlines;
	WAISDocumentCodes**			Codes;
	diagnosticRecord**			Diagnostics;
	} WAISSearchResponse;
d226 122
a347 91
char *
generate_search_apdu (char* buff,  /* buffer to hold the apdu */
			  long *buff_len, /* number of bytes written to the buffer */
			  char *seed_words, /* string of the seed words */
			  char *database_name,
			  DocObj** docobjs,
			  long maxDocsRetrieved
			  );

DocObj* makeDocObjUsingWholeDocument (any* aDocID,char* type);
DocObj* makeDocObjUsingBytes (any* aDocID,char* type,long start,long end);
DocObj* makeDocObjUsingLines (any* aDocID,char* type,long start,long end);
DocObj* makeDocObjUsingParagraphs (any* aDocID,char* type,any* start,any* end);
void freeDocObj (DocObj* doc);

WAISInitResponse* makeWAISInitResponse (long chunkCode,long chunkIDLen,
					    char* chunkMarker,char* highlightMarker,
					    char* deHighlightMarker,char* newLineChars);
void freeWAISInitResponse (WAISInitResponse* init);

WAISSearch* makeWAISSearch (
	char* seedWords,DocObj** docs,char** textList,
	long dateFactor,char* beginDateRange,char* endDateRange,
	long maxDocsRetrieved);
void freeWAISSearch (WAISSearch* query);

WAISDocumentHeader* makeWAISDocumentHeader (
	any* aDocID,long versionNumber,long score,long bestMatch,long docLen,
	long lines,char** types,char* source,char* date,char* headline,char* originCity);
void freeWAISDocumentHeader (WAISDocumentHeader* header);
char* writeWAISDocumentHeader (WAISDocumentHeader* header,char* buffer,long* len);
char* readWAISDocumentHeader (WAISDocumentHeader** header,char* buffer);

WAISDocumentShortHeader* makeWAISDocumentShortHeader (
	any* aDocID,long versionNumber,long score,long bestMatch,long docLen,long lines);
void freeWAISDocumentShortHeader (WAISDocumentShortHeader* header);
char* writeWAISDocumentShortHeader (WAISDocumentShortHeader* header,
                                   char* buffer,long* len);
char* readWAISDocumentShortHeader (WAISDocumentShortHeader** header,char* buffer);

WAISDocumentLongHeader* makeWAISDocumentLongHeader (
	any* aDocID,long versionNumber,long score,long bestMatch,long docLen,
	long lines,char** types,char* source,char* date, char* headline,char* originCity,
	char* stockCodes,char* companyCodes,char* industryCodes);
void freeWAISDocumentLongHeader (WAISDocumentLongHeader* header);
char* writeWAISDocumentLongHeader (WAISDocumentLongHeader* header,char* buffer,long* len);
char* readWAISDocumentLongHeader (WAISDocumentLongHeader** header,char* buffer);

WAISSearchResponse* makeWAISSearchResponse (
	char* seedWordsUsed,WAISDocumentHeader** docHeaders,
	WAISDocumentShortHeader** shortHeaders,
	WAISDocumentLongHeader** longHeaders,
	WAISDocumentText** text,WAISDocumentHeadlines** headlines,
	WAISDocumentCodes** codes,
	diagnosticRecord** diagnostics);
void freeWAISSearchResponse (WAISSearchResponse* response);

WAISDocumentText* makeWAISDocumentText (any* aDocID,long versionNumber,
				       any* documentText);
void freeWAISDocumentText (WAISDocumentText* docText);
char* writeWAISDocumentText (WAISDocumentText* docText,char* buffer,long* len);
char* readWAISDocumentText (WAISDocumentText** docText,char* buffer);

WAISDocumentHeadlines* makeWAISDocumentHeadlines (
	any* aDocID,long versionNumber,char* source,char* date,char* headline,
	char* originCity);
void freeWAISDocumentHeadlines (WAISDocumentHeadlines* docHeadline);
char* writeWAISDocumentHeadlines (WAISDocumentHeadlines* docHeadline,char* buffer,long* len);
char* readWAISDocumentHeadlines (WAISDocumentHeadlines** docHeadline,char* buffer);

WAISDocumentCodes* makeWAISDocumentCodes (
	any* aDocID,long versionNumber,char* stockCodes,char* companyCodes,
	char* industryCodes);
void freeWAISDocumentCodes (WAISDocumentCodes* docCodes);
char* writeWAISDocumentCodes (WAISDocumentCodes* docCodes,char* buffer,long* len);
char* readWAISDocumentCodes (WAISDocumentCodes** docCodes,char* buffer);

any* makeWAISTextQuery (DocObj** docs);
DocObj** readWAISTextQuery (any* terms);

void CSTFreeWAISInitResponse (WAISInitResponse* init);
void CSTFreeWAISSearch (WAISSearch* query);
void CSTFreeDocObj (DocObj* doc);
void CSTFreeWAISDocumentHeader (WAISDocumentHeader* header);
void CSTFreeWAISDocumentShortHeader (WAISDocumentShortHeader* header);
void CSTFreeWAISDocumentLongHeader (WAISDocumentLongHeader* header);
void CSTFreeWAISSearchResponse (WAISSearchResponse* response);
void CSTFreeWAISDocumentText (WAISDocumentText* docText);
void CSTFreeWAISDocHeadlines (WAISDocumentHeadlines* docHeadline);
void CSTFreeWAISDocumentCodes (WAISDocumentCodes* docCodes);
void CSTFreeWAISTextQuery ( any* query);
a352 1

d354 3
a356 3
**	Routines originally from WMessage.h -- FM
**
**----------------------------------------------------------------------*/
d358 4
a361 4
   No guarantees or restrictions.  See the readme file for the full standard
   disclaimer.
   3.26.90
*/
d388 7
a394 7
        char    msg_len[10];    /* length in bytes of following message */
        char    msg_type;       /* type of message: 'z'=Z39.50 APDU,
                                   'a'=ACK, 'n'=NACK */
        char    hdr_vers;       /* version of this header, currently = '2' */
        char    server[10];     /* name or address of server */
        char    compression;    /* <sp>=no compression, 'u'=unix compress */
        char    encoding;       /* <sp>=no encoding, 'h'=hexize,
d396 2
a397 2
        char    msg_checksum;   /* XOR of every byte of message */
        } WAISMessage;
d415 2
a416 2
#define HEX_ENCODING		'h'  /* Swartz 4/3 encoding */
#define IBM_HEXCODING		'i'  /* same as h but uses characters acceptable for IBM mainframes */
d419 5
a423 6

void readWAISPacketHeader (char* msgBuffer,WAISMessage *header_struct);
long getWAISPacketLength (WAISMessage* header);
void writeWAISPacketHeader (char* header,long dataLen,long type,
				char* server,long compression,
				long encoding,long version);
@


1.4
log
@Upgrade lynx to 2.8.5dev.17d, retaining local changes if needed
@
text
@d227 1
a227 1
generate_search_apdu PARAMS((char* buff,  /* buffer to hold the apdu */
d233 1
a233 1
			  ));
d235 5
a239 5
DocObj* makeDocObjUsingWholeDocument PARAMS((any* aDocID,char* type));
DocObj* makeDocObjUsingBytes PARAMS((any* aDocID,char* type,long start,long end));
DocObj* makeDocObjUsingLines PARAMS((any* aDocID,char* type,long start,long end));
DocObj* makeDocObjUsingParagraphs PARAMS((any* aDocID,char* type,any* start,any* end));
void freeDocObj PARAMS((DocObj* doc));
d241 1
a241 1
WAISInitResponse* makeWAISInitResponse PARAMS((long chunkCode,long chunkIDLen,
d243 2
a244 2
					    char* deHighlightMarker,char* newLineChars));
void freeWAISInitResponse PARAMS((WAISInitResponse* init));
d246 1
a246 1
WAISSearch* makeWAISSearch PARAMS((
d249 2
a250 2
	long maxDocsRetrieved));
void freeWAISSearch PARAMS((WAISSearch* query));
d252 1
a252 1
WAISDocumentHeader* makeWAISDocumentHeader PARAMS((
d254 11
a264 11
	long lines,char** types,char* source,char* date,char* headline,char* originCity));
void freeWAISDocumentHeader PARAMS((WAISDocumentHeader* header));
char* writeWAISDocumentHeader PARAMS((WAISDocumentHeader* header,char* buffer,long* len));
char* readWAISDocumentHeader PARAMS((WAISDocumentHeader** header,char* buffer));

WAISDocumentShortHeader* makeWAISDocumentShortHeader PARAMS((
	any* aDocID,long versionNumber,long score,long bestMatch,long docLen,long lines));
void freeWAISDocumentShortHeader PARAMS((WAISDocumentShortHeader* header));
char* writeWAISDocumentShortHeader PARAMS((WAISDocumentShortHeader* header,
                                   char* buffer,long* len));
char* readWAISDocumentShortHeader PARAMS((WAISDocumentShortHeader** header,char* buffer));
d266 1
a266 1
WAISDocumentLongHeader* makeWAISDocumentLongHeader PARAMS((
d269 4
a272 4
	char* stockCodes,char* companyCodes,char* industryCodes));
void freeWAISDocumentLongHeader PARAMS((WAISDocumentLongHeader* header));
char* writeWAISDocumentLongHeader PARAMS((WAISDocumentLongHeader* header,char* buffer,long* len));
char* readWAISDocumentLongHeader PARAMS((WAISDocumentLongHeader** header,char* buffer));
d274 1
a274 1
WAISSearchResponse* makeWAISSearchResponse PARAMS((
d280 2
a281 2
	diagnosticRecord** diagnostics));
void freeWAISSearchResponse PARAMS((WAISSearchResponse* response));
d283 5
a287 5
WAISDocumentText* makeWAISDocumentText PARAMS((any* aDocID,long versionNumber,
				       any* documentText));
void freeWAISDocumentText PARAMS((WAISDocumentText* docText));
char* writeWAISDocumentText PARAMS((WAISDocumentText* docText,char* buffer,long* len));
char* readWAISDocumentText PARAMS((WAISDocumentText** docText,char* buffer));
d289 1
a289 1
WAISDocumentHeadlines* makeWAISDocumentHeadlines PARAMS((
d291 4
a294 4
	char* originCity));
void freeWAISDocumentHeadlines PARAMS((WAISDocumentHeadlines* docHeadline));
char* writeWAISDocumentHeadlines PARAMS((WAISDocumentHeadlines* docHeadline,char* buffer,long* len));
char* readWAISDocumentHeadlines PARAMS((WAISDocumentHeadlines** docHeadline,char* buffer));
d296 1
a296 1
WAISDocumentCodes* makeWAISDocumentCodes PARAMS((
d298 19
a316 19
	char* industryCodes));
void freeWAISDocumentCodes PARAMS((WAISDocumentCodes* docCodes));
char* writeWAISDocumentCodes PARAMS((WAISDocumentCodes* docCodes,char* buffer,long* len));
char* readWAISDocumentCodes PARAMS((WAISDocumentCodes** docCodes,char* buffer));

any* makeWAISTextQuery PARAMS((DocObj** docs));
DocObj** readWAISTextQuery PARAMS((any* terms));

void CSTFreeWAISInitResponse PARAMS((WAISInitResponse* init));
void CSTFreeWAISSearch PARAMS((WAISSearch* query));
void CSTFreeDocObj PARAMS((DocObj* doc));
void CSTFreeWAISDocumentHeader PARAMS((WAISDocumentHeader* header));
void CSTFreeWAISDocumentShortHeader PARAMS((WAISDocumentShortHeader* header));
void CSTFreeWAISDocumentLongHeader PARAMS((WAISDocumentLongHeader* header));
void CSTFreeWAISSearchResponse PARAMS((WAISSearchResponse* response));
void CSTFreeWAISDocumentText PARAMS((WAISDocumentText* docText));
void CSTFreeWAISDocHeadlines PARAMS((WAISDocumentHeadlines* docHeadline));
void CSTFreeWAISDocumentCodes PARAMS((WAISDocumentCodes* docCodes));
void CSTFreeWAISTextQuery PARAMS(( any* query));
d390 3
a392 3
void readWAISPacketHeader PARAMS((char* msgBuffer,WAISMessage *header_struct));
long getWAISPacketLength PARAMS((WAISMessage* header));
void writeWAISPacketHeader PARAMS((char* header,long dataLen,long type,
d394 1
a394 1
				long encoding,long version));
@


1.3
log
@un-tar the file
>>> lynx2.8.5dev.16.tar.gz
from http://lynx.isc.org/current/

the following files need -kb:
- LYStyle.c
- Xsystem.c
- WWW HTMIME.c
@
text
@d15 2
a16 2
   disclaimer.	
  
d18 4
a21 4
   3.30.90  Harry Morris 
   			-	removed chunk code from WAISSearchAPDU,
   			-	added makeWAISQueryType1Query() and readWAISType1Query() which
   				replace makeWAISQueryTerms() and makeWAISQueryDocs().
d23 3
a25 3
   4.14.90  HWM - changed symbol for relevance feedback query from QT_3 to 
   				  QT_RelevanceFeedbackQuery added QT_TextRetrievalQuery as a
   				  synonym for QT_BooleanQuery
d98 1
a98 1
#define DT_DocumentHeadlineGroup 	(data_tag)154
d100 3
a102 3
#define DT_Lines					(data_tag)131 
#define	DT_TYPE_BLOCK				(data_tag)132
#define DT_TYPE						(data_tag)133
d106 2
a107 2
#define ES_DocumentShortHeader	"Document Short Header"
#define ES_DocumentLongHeader	"Document Long Header"
d125 1
a125 1
	
d134 1
a134 1
	char* 				DeHighlightMarker;
d152 2
a153 2
	long				Score;     
	long				BestMatch; 
d155 1
a155 1
	long 				Lines;
d166 2
a167 2
	long				Score;     
	long				BestMatch; 
d169 3
a171 3
	long 				Lines;
 	} WAISDocumentShortHeader;
 
d175 2
a176 2
	long				Score;     
	long				BestMatch; 
d178 1
a178 1
	long 				Lines;
d185 1
a185 1
	char* 				CompanyCodes;
d187 1
a187 1
 	} WAISDocumentLongHeader;
d194 1
a194 1
	
d203 1
a203 1
	
d211 1
a211 1
	
d213 4
a216 4
	char*			       		SeedWordsUsed;
	WAISDocumentHeader** 		DocHeaders;
	WAISDocumentShortHeader** 	ShortHeaders;
	WAISDocumentLongHeader** 	LongHeaders;
d329 1
a329 1
   disclaimer.    
d354 1
a354 1
 
d364 1
a364 1
        char    encoding;       /* <sp>=no encoding, 'h'=hexize, 
d369 1
a369 1
#define HEADER_LENGTH 	25	/* number of bytes needed to write a 
d372 1
a372 1
#define HEADER_VERSION 	(long)'2'
d375 3
a377 3
#define Z3950			'z'  
#define ACK			'a'  
#define	NAK			'n'  
d380 2
a381 2
#define NO_COMPRESSION 		' ' 
#define UNIX_COMPRESSION 	'u' 
d384 4
a387 4
#define NO_ENCODING		' '  
#define HEX_ENCODING	'h'  /* Swartz 4/3 encoding */
#define IBM_HEXCODING	'i'	 /* same as h but uses characters acceptable for IBM mainframes */
#define UUENCODE		'u'  
d393 1
a393 1
				char* server,long compression,	
@


1.2
log
@remove lynx 2.8.4 patchlevel 1d
@
text
@@


1.1
log
@Initial revision
@
text
@@


1.1.2.1
log
@Lynx 2.8.6dev.10 as imported into ncvs
@
text
@d2 6
a7 6
 *
 *	Adaptation for Lynx by F.Macrides (macrides@@sci.wfeb.edu)
 *
 *	31-May-1994 FM	Initial version.
 *
 *----------------------------------------------------------------------*/
d10 3
a12 3
 *	Routines originally from WProt.h -- FM
 *
 *----------------------------------------------------------------------*/
d14 16
a29 16
 * No guarantees or restrictions.  See the readme file for the full standard
 * disclaimer.
 *
 *  3.26.90	Harry Morris, morris@@think.com
 *  3.30.90  Harry Morris
 *			-	removed chunk code from WAISSearchAPDU,
 *			-	added makeWAISQueryType1Query() and readWAISType1Query() which
 *				replace makeWAISQueryTerms() and makeWAISQueryDocs().
 *  4.11.90  HWM - added definitions of wais element set names
 *  4.14.90  HWM - changed symbol for relevance feedback query from QT_3 to
 *				  QT_RelevanceFeedbackQuery added QT_TextRetrievalQuery as a
 *				  synonym for QT_BooleanQuery
 *				- renamed makeWAISType1Query() to makeWAISTextQuery()
 *				  renamed readWAISType1Query() to readWAISTextQuery()
 *  5.29.90  TS - added CSTFreeWAISFoo functions
 */
d98 1
a98 1
#define DT_DocumentHeadlineGroup	(data_tag)154
d100 3
a102 3
#define DT_Lines			(data_tag)131
#define	DT_TYPE_BLOCK			(data_tag)132
#define DT_TYPE				(data_tag)133
d106 2
a107 2
#define ES_DocumentShortHeader		"Document Short Header"
#define ES_DocumentLongHeader		"Document Long Header"
d112 14
a125 14
typedef struct DocObj {		/* specifies a section of a document */
    any *DocumentID;
    char *Type;
    long ChunkCode;
    union {
	long Pos;
	any *ID;
    } ChunkStart;
    union {
	long Pos;
	any *ID;
    } ChunkEnd;
} DocObj;

d130 8
a137 8
    long ChunkCode;
    long ChunkIDLength;
    char *ChunkMarker;
    char *HighlightMarker;
    char *DeHighlightMarker;
    char *NewlineCharacters;
    /* XXX  need to add UpdateFrequency and Update Time */
} WAISInitResponse;
d140 8
a147 8
    char *SeedWords;
    DocObj **Docs;
    char **TextList;
    long DateFactor;
    char *BeginDateRange;
    char *EndDateRange;
    long MaxDocumentsRetrieved;
} WAISSearch;
d150 12
a161 12
    any *DocumentID;
    long VersionNumber;
    long Score;
    long BestMatch;
    long DocumentLength;
    long Lines;
    char **Types;
    char *Source;
    char *Date;
    char *Headline;
    char *OriginCity;
} WAISDocumentHeader;
d164 8
a171 8
    any *DocumentID;
    long VersionNumber;
    long Score;
    long BestMatch;
    long DocumentLength;
    long Lines;
} WAISDocumentShortHeader;

d173 15
a187 15
    any *DocumentID;
    long VersionNumber;
    long Score;
    long BestMatch;
    long DocumentLength;
    long Lines;
    char **Types;
    char *Source;
    char *Date;
    char *Headline;
    char *OriginCity;
    char *StockCodes;
    char *CompanyCodes;
    char *IndustryCodes;
} WAISDocumentLongHeader;
d190 5
a194 5
    any *DocumentID;
    long VersionNumber;
    any *DocumentText;
} WAISDocumentText;

d196 8
a203 8
    any *DocumentID;
    long VersionNumber;
    char *Source;
    char *Date;
    char *Headline;
    char *OriginCity;
} WAISDocumentHeadlines;

d205 7
a211 7
    any *DocumentID;
    long VersionNumber;
    char *StockCodes;
    char *CompanyCodes;
    char *IndustryCodes;
} WAISDocumentCodes;

d213 9
a221 9
    char *SeedWordsUsed;
    WAISDocumentHeader **DocHeaders;
    WAISDocumentShortHeader **ShortHeaders;
    WAISDocumentLongHeader **LongHeaders;
    WAISDocumentText **Text;
    WAISDocumentHeadlines **Headlines;
    WAISDocumentCodes **Codes;
    diagnosticRecord **Diagnostics;
} WAISSearchResponse;
d226 91
a316 122
char *generate_search_apdu(char *buff,	/* buffer to hold the apdu */
			   long *buff_len,	/* number of bytes written to the buffer */
			   char *seed_words,	/* string of the seed words */
			   char *database_name,
			   DocObj **docobjs,
			   long maxDocsRetrieved);

DocObj *makeDocObjUsingWholeDocument(any *aDocID, char *type);
DocObj *makeDocObjUsingBytes(any *aDocID, char *type, long start, long end);
DocObj *makeDocObjUsingLines(any *aDocID, char *type, long start, long end);
DocObj *makeDocObjUsingParagraphs(any *aDocID, char *type, any *start, any *end);
void freeDocObj(DocObj *doc);

WAISInitResponse *makeWAISInitResponse(long chunkCode, long chunkIDLen,
				       char *chunkMarker, char *highlightMarker,
				       char *deHighlightMarker, char *newLineChars);
void freeWAISInitResponse(WAISInitResponse *init);

WAISSearch *makeWAISSearch(char *seedWords,
			   DocObj **docs,
			   char **textList,
			   long dateFactor,
			   char *beginDateRange,
			   char *endDateRange,
			   long maxDocsRetrieved);
void freeWAISSearch(WAISSearch *query);

WAISDocumentHeader *makeWAISDocumentHeader(any *aDocID,
					   long versionNumber,
					   long score,
					   long bestMatch,
					   long docLen,
					   long lines,
					   char **types,
					   char *source,
					   char *date,
					   char *headline,
					   char *originCity);
void freeWAISDocumentHeader(WAISDocumentHeader *header);
char *writeWAISDocumentHeader(WAISDocumentHeader *header, char *buffer, long *len);
char *readWAISDocumentHeader(WAISDocumentHeader **header, char *buffer);

WAISDocumentShortHeader *makeWAISDocumentShortHeader(any *aDocID,
						     long versionNumber,
						     long score,
						     long bestMatch,
						     long docLen,
						     long lines);
void freeWAISDocumentShortHeader(WAISDocumentShortHeader *header);
char *writeWAISDocumentShortHeader(WAISDocumentShortHeader *header,
				   char *buffer, long *len);
char *readWAISDocumentShortHeader(WAISDocumentShortHeader **header, char *buffer);

WAISDocumentLongHeader *makeWAISDocumentLongHeader(any *aDocID,
						   long versionNumber,
						   long score,
						   long bestMatch,
						   long docLen,
						   long lines,
						   char **types,
						   char *source,
						   char *date, char *headline,
						   char *originCity,
						   char *stockCodes,
						   char *companyCodes,
						   char *industryCodes);
void freeWAISDocumentLongHeader(WAISDocumentLongHeader *header);
char *writeWAISDocumentLongHeader(WAISDocumentLongHeader *header,
				  char *buffer,
				  long *len);
char *readWAISDocumentLongHeader(WAISDocumentLongHeader **header, char *buffer);

WAISSearchResponse *makeWAISSearchResponse(char *seedWordsUsed,
					   WAISDocumentHeader **docHeaders,
					   WAISDocumentShortHeader **shortHeaders,
					   WAISDocumentLongHeader **longHeaders,
					   WAISDocumentText **text, WAISDocumentHeadlines **headlines,
					   WAISDocumentCodes **codes,
					   diagnosticRecord ** diagnostics);
void freeWAISSearchResponse(WAISSearchResponse * response);

WAISDocumentText *makeWAISDocumentText(any *aDocID, long versionNumber,
				       any *documentText);
void freeWAISDocumentText(WAISDocumentText *docText);
char *writeWAISDocumentText(WAISDocumentText *docText, char *buffer, long *len);
char *readWAISDocumentText(WAISDocumentText **docText, char *buffer);

WAISDocumentHeadlines *makeWAISDocumentHeadlines(any *aDocID,
						 long versionNumber,
						 char *source,
						 char *date,
						 char *headline,
						 char *originCity);
void freeWAISDocumentHeadlines(WAISDocumentHeadlines *docHeadline);
char *writeWAISDocumentHeadlines(WAISDocumentHeadlines *docHeadline,
				 char *buffer,
				 long *len);
char *readWAISDocumentHeadlines(WAISDocumentHeadlines **docHeadline, char *buffer);

WAISDocumentCodes *makeWAISDocumentCodes(any *aDocID,
					 long versionNumber,
					 char *stockCodes,
					 char *companyCodes,
					 char *industryCodes);
void freeWAISDocumentCodes(WAISDocumentCodes *docCodes);
char *writeWAISDocumentCodes(WAISDocumentCodes *docCodes, char *buffer, long *len);
char *readWAISDocumentCodes(WAISDocumentCodes **docCodes, char *buffer);

any *makeWAISTextQuery(DocObj **docs);
DocObj **readWAISTextQuery(any *terms);

void CSTFreeWAISInitResponse(WAISInitResponse *init);
void CSTFreeWAISSearch(WAISSearch *query);
void CSTFreeDocObj(DocObj *doc);
void CSTFreeWAISDocumentHeader(WAISDocumentHeader *header);
void CSTFreeWAISDocumentShortHeader(WAISDocumentShortHeader *header);
void CSTFreeWAISDocumentLongHeader(WAISDocumentLongHeader *header);
void CSTFreeWAISSearchResponse(WAISSearchResponse * response);
void CSTFreeWAISDocumentText(WAISDocumentText *docText);
void CSTFreeWAISDocHeadlines(WAISDocumentHeadlines *docHeadline);
void CSTFreeWAISDocumentCodes(WAISDocumentCodes *docCodes);
void CSTFreeWAISTextQuery(any *query);
d322 1
d324 3
a326 3
 *	Routines originally from WMessage.h -- FM
 *
 *----------------------------------------------------------------------*/
d328 4
a331 4
 * No guarantees or restrictions.  See the readme file for the full standard
 * disclaimer.
 * 3.26.90
 */
d354 1
a354 1

d358 7
a364 7
    char msg_len[10];		/* length in bytes of following message */
    char msg_type;		/* type of message: 'z'=Z39.50 APDU,
				   'a'=ACK, 'n'=NACK */
    char hdr_vers;		/* version of this header, currently = '2' */
    char server[10];		/* name or address of server */
    char compression;		/* <sp>=no compression, 'u'=unix compress */
    char encoding;		/* <sp>=no encoding, 'h'=hexize,
d366 2
a367 2
    char msg_checksum;		/* XOR of every byte of message */
} WAISMessage;
d369 1
a369 1
#define HEADER_LENGTH	25	/* number of bytes needed to write a
d372 1
a372 1
#define HEADER_VERSION	(long)'2'
d375 3
a377 3
#define Z3950			'z'
#define ACK			'a'
#define	NAK			'n'
d380 2
a381 2
#define NO_COMPRESSION		' '
#define UNIX_COMPRESSION	'u'
d384 11
a394 10
#define NO_ENCODING		' '
#define HEX_ENCODING		'h'	/* Swartz 4/3 encoding */
#define IBM_HEXCODING		'i'	/* same as h but uses characters acceptable for IBM mainframes */
#define UUENCODE		'u'

void readWAISPacketHeader(char *msgBuffer, WAISMessage * header_struct);
long getWAISPacketLength(WAISMessage * header);
void writeWAISPacketHeader(char *header, long dataLen, long type,
			   char *server, long compression,
			   long encoding, long version);
@


1.1.3.1
log
@Import Lynx 2.8.5.dev16 again, this time via a vendor branch (tg),
to ease tracking of the upcoming dev17 (2.8.6-prerelease) update.
@
text
@@


1.1.3.2
log
@Lynx 2.8.5dev.17 Patchlevel d

This fixes, among many others, the following:
* correct some mismatches between INSTALLATION and "configure --help" (prompted
  by discussion with Stef Caunter) -TD
* amend check for refresh-URL to ensure it only prepends a link for text/html
  content type (report by Carlton Anderson).
* do not strip parameters from refresh-URL (report by Carlton Anderson gave an
  example of their use) -TD
* remove obsolete XMOSAIC_HACK defines -TD
* improve check for Unix-style shell given in $SHELL by limiting the check to
  the base-name (discussion with GV, DK) -TD
* modify increment_tagged_htline() to reallocate its HTLine parameter if the
  result would be larger than the allocation.  This can happen when a large
  textarea is adjusted (report by Thorsten Glaser)  -TD
* add ifdef'd logic to change HTLine to calloc() rather than memory pools,
  making it possible to use valgrind, etc., for debugging -LP
* add check for broken ProFTPD 1.2.5rc1, e.g., at ftp://ftp.oldskool.org/pub,
  and force a reconnection if an error 550 is detected when doing RETR.  This
  is ifdef'd with BROKEN_PROFTPD and checks version (reports by GV, DK) -TD
* modify file-upload to not print a warning message if the form-field is empty
  (Frank Heckenbach).
* add a few null-pointer checks to GridText.c (addresses symptoms reported by
  Frederic L W Meunier when nested-tables are toggled off) -TD
* modify LYTrimNewline() to trim carriage-returns as well as line-feeds, making
  it possible to share cookie files between platforms that have different
  line-terminations (report by Frederic L W Meunier) -TD
* rename EXP_PERSISTENT_COOKIES ifdef to USE_PERSISTENT_COOKIES -TD
* rename EXP_READPROGRESS ifdef to USE_READPROGRESS -TD
* rename SOURCE_CACHE ifdef to USE_SOURCE_CACHE -TD
* change a few configure script defaults to "enable":  source-cache, prettysrc
  and read-eta.  Also change default for read-eta configuration flag to "Show
  KB/Sec" (requests by LP, Frederic L W Meunier) -TD
* change configure script to compile-in file-upload by default, change its
  corresponding ifdef to USE_FILE_UPLOAD -TD
* revert table-layout changes from dev.15/dev.16 because of unresolved
  issues -TD
* add configure option --with-bzlib -TD
* implement support for bzip compression by internal calls to libbz2 -IZ
* if a document is in the cache (the rendering is in memory), on reload it
  should not be cleared from the cache until the connection to the server is
  opened; if the connection fails, the user will reuse the old version (request
  by IZ) -LP
* correct strings in LYOptions.c so ENABLE_LYNXRC works for bookmark_file
  and run_all_execution_links -DK
* fix pathname generated for "View temporary file" in LYDownload.c using new
  function LYAddPathToSave() (report by P.J.Walsh) -TD
* change code to match lynx.cfg description for FORCE_COOKIE_PROMPT and
  FORCE_SSL_PROMPT, making "prompt" rather than "default" the keyword to use
  when telling lynx to prompt (report by DK) -TD
* modify ifdef's to use mkdtemp() if it is available (prompted by MirBSD
  patch) -TD
* several fixes from Thorsten Glaser (MirBSD):
  + workaround for invoking shell scripts when executable permissions are
    discarded as a result from using CVS.
  + adjust buffer-size used in a readlink() call in case the result is too
    long to include trailing null.
  + change default ftp mode to passive.
  + if ftp connection fails, automatically retry, switching between passive
    and active modes.  Do this retry switching only when connecting to a
    different host.  A new variable ftp_local_passive distinguishes this
    from the user preference in ftp_passive.
  + improved certificate handling (case-insensitive domain-comparison, strip
    port-numbers from comparison).
  + fix a few typos & compiler-warnings.
* modify configure script to not use "head -1", which does not work for some
  platforms when POSIXLY_CORRECT (sic) is set -TD
* fix configure script check for term.h, which may be <ncursesw/term.h> -TD
* amend change in dev.15 to HTParse() to escape spaces, to exclude non-URL
  strings such as absolute filenames (report by Patrick Ash) -TD
* modify LYParseTagParam() (added in dev.13) to not stop on ';' (fixes a bug
  reported by LV which broke complicated refresh-URL containing "&amp;") -TD
* change default start page to lynx.isc.org, since lynx.browser.org is not
  maintained -TD
@
text
@d15 2
a16 2
   disclaimer.

d18 4
a21 4
   3.30.90  Harry Morris
			-	removed chunk code from WAISSearchAPDU,
			-	added makeWAISQueryType1Query() and readWAISType1Query() which
				replace makeWAISQueryTerms() and makeWAISQueryDocs().
d23 3
a25 3
   4.14.90  HWM - changed symbol for relevance feedback query from QT_3 to
				  QT_RelevanceFeedbackQuery added QT_TextRetrievalQuery as a
				  synonym for QT_BooleanQuery
d98 1
a98 1
#define DT_DocumentHeadlineGroup	(data_tag)154
d100 3
a102 3
#define DT_Lines			(data_tag)131
#define	DT_TYPE_BLOCK			(data_tag)132
#define DT_TYPE				(data_tag)133
d106 2
a107 2
#define ES_DocumentShortHeader		"Document Short Header"
#define ES_DocumentLongHeader		"Document Long Header"
d125 1
a125 1

d134 1
a134 1
	char*				DeHighlightMarker;
d152 2
a153 2
	long				Score;
	long				BestMatch;
d155 1
a155 1
	long				Lines;
d166 2
a167 2
	long				Score;
	long				BestMatch;
d169 3
a171 3
	long				Lines;
	} WAISDocumentShortHeader;

d175 2
a176 2
	long				Score;
	long				BestMatch;
d178 1
a178 1
	long				Lines;
d185 1
a185 1
	char*				CompanyCodes;
d187 1
a187 1
	} WAISDocumentLongHeader;
d194 1
a194 1

d203 1
a203 1

d211 1
a211 1

d213 4
a216 4
	char*					SeedWordsUsed;
	WAISDocumentHeader**		DocHeaders;
	WAISDocumentShortHeader**	ShortHeaders;
	WAISDocumentLongHeader**	LongHeaders;
d329 1
a329 1
   disclaimer.
d354 1
a354 1

d364 1
a364 1
        char    encoding;       /* <sp>=no encoding, 'h'=hexize,
d369 1
a369 1
#define HEADER_LENGTH	25	/* number of bytes needed to write a
d372 1
a372 1
#define HEADER_VERSION	(long)'2'
d375 3
a377 3
#define Z3950			'z'
#define ACK			'a'
#define	NAK			'n'
d380 2
a381 2
#define NO_COMPRESSION		' '
#define UNIX_COMPRESSION	'u'
d384 4
a387 4
#define NO_ENCODING		' '
#define HEX_ENCODING		'h'  /* Swartz 4/3 encoding */
#define IBM_HEXCODING		'i'  /* same as h but uses characters acceptable for IBM mainframes */
#define UUENCODE		'u'
d393 1
a393 1
				char* server,long compression,
@


1.1.3.3
log
@A three-days old development version of Lynx, the best web browser ever,
which follows the OpenBSD paradigma to only provide high-quality, func-
tional snapshots.
@
text
@d227 1
a227 1
generate_search_apdu (char* buff,  /* buffer to hold the apdu */
d233 1
a233 1
			  );
d235 5
a239 5
DocObj* makeDocObjUsingWholeDocument (any* aDocID,char* type);
DocObj* makeDocObjUsingBytes (any* aDocID,char* type,long start,long end);
DocObj* makeDocObjUsingLines (any* aDocID,char* type,long start,long end);
DocObj* makeDocObjUsingParagraphs (any* aDocID,char* type,any* start,any* end);
void freeDocObj (DocObj* doc);
d241 1
a241 1
WAISInitResponse* makeWAISInitResponse (long chunkCode,long chunkIDLen,
d243 2
a244 2
					    char* deHighlightMarker,char* newLineChars);
void freeWAISInitResponse (WAISInitResponse* init);
d246 1
a246 1
WAISSearch* makeWAISSearch (
d249 2
a250 2
	long maxDocsRetrieved);
void freeWAISSearch (WAISSearch* query);
d252 1
a252 1
WAISDocumentHeader* makeWAISDocumentHeader (
d254 11
a264 11
	long lines,char** types,char* source,char* date,char* headline,char* originCity);
void freeWAISDocumentHeader (WAISDocumentHeader* header);
char* writeWAISDocumentHeader (WAISDocumentHeader* header,char* buffer,long* len);
char* readWAISDocumentHeader (WAISDocumentHeader** header,char* buffer);

WAISDocumentShortHeader* makeWAISDocumentShortHeader (
	any* aDocID,long versionNumber,long score,long bestMatch,long docLen,long lines);
void freeWAISDocumentShortHeader (WAISDocumentShortHeader* header);
char* writeWAISDocumentShortHeader (WAISDocumentShortHeader* header,
                                   char* buffer,long* len);
char* readWAISDocumentShortHeader (WAISDocumentShortHeader** header,char* buffer);
d266 1
a266 1
WAISDocumentLongHeader* makeWAISDocumentLongHeader (
d269 4
a272 4
	char* stockCodes,char* companyCodes,char* industryCodes);
void freeWAISDocumentLongHeader (WAISDocumentLongHeader* header);
char* writeWAISDocumentLongHeader (WAISDocumentLongHeader* header,char* buffer,long* len);
char* readWAISDocumentLongHeader (WAISDocumentLongHeader** header,char* buffer);
d274 1
a274 1
WAISSearchResponse* makeWAISSearchResponse (
d280 2
a281 2
	diagnosticRecord** diagnostics);
void freeWAISSearchResponse (WAISSearchResponse* response);
d283 5
a287 5
WAISDocumentText* makeWAISDocumentText (any* aDocID,long versionNumber,
				       any* documentText);
void freeWAISDocumentText (WAISDocumentText* docText);
char* writeWAISDocumentText (WAISDocumentText* docText,char* buffer,long* len);
char* readWAISDocumentText (WAISDocumentText** docText,char* buffer);
d289 1
a289 1
WAISDocumentHeadlines* makeWAISDocumentHeadlines (
d291 4
a294 4
	char* originCity);
void freeWAISDocumentHeadlines (WAISDocumentHeadlines* docHeadline);
char* writeWAISDocumentHeadlines (WAISDocumentHeadlines* docHeadline,char* buffer,long* len);
char* readWAISDocumentHeadlines (WAISDocumentHeadlines** docHeadline,char* buffer);
d296 1
a296 1
WAISDocumentCodes* makeWAISDocumentCodes (
d298 19
a316 19
	char* industryCodes);
void freeWAISDocumentCodes (WAISDocumentCodes* docCodes);
char* writeWAISDocumentCodes (WAISDocumentCodes* docCodes,char* buffer,long* len);
char* readWAISDocumentCodes (WAISDocumentCodes** docCodes,char* buffer);

any* makeWAISTextQuery (DocObj** docs);
DocObj** readWAISTextQuery (any* terms);

void CSTFreeWAISInitResponse (WAISInitResponse* init);
void CSTFreeWAISSearch (WAISSearch* query);
void CSTFreeDocObj (DocObj* doc);
void CSTFreeWAISDocumentHeader (WAISDocumentHeader* header);
void CSTFreeWAISDocumentShortHeader (WAISDocumentShortHeader* header);
void CSTFreeWAISDocumentLongHeader (WAISDocumentLongHeader* header);
void CSTFreeWAISSearchResponse (WAISSearchResponse* response);
void CSTFreeWAISDocumentText (WAISDocumentText* docText);
void CSTFreeWAISDocHeadlines (WAISDocumentHeadlines* docHeadline);
void CSTFreeWAISDocumentCodes (WAISDocumentCodes* docCodes);
void CSTFreeWAISTextQuery ( any* query);
d390 3
a392 3
void readWAISPacketHeader (char* msgBuffer,WAISMessage *header_struct);
long getWAISPacketLength (WAISMessage* header);
void writeWAISPacketHeader (char* header,long dataLen,long type,
d394 1
a394 1
				long encoding,long version);
@


1.1.3.4
log
@Lynx 2.8.6dev.5 fresh from the ISC
@
text
@d2 6
a7 6
 *
 *	Adaptation for Lynx by F.Macrides (macrides@@sci.wfeb.edu)
 *
 *	31-May-1994 FM	Initial version.
 *
 *----------------------------------------------------------------------*/
d10 3
a12 3
 *	Routines originally from WProt.h -- FM
 *
 *----------------------------------------------------------------------*/
d14 16
a29 16
 * No guarantees or restrictions.  See the readme file for the full standard
 * disclaimer.
 *
 *  3.26.90	Harry Morris, morris@@think.com
 *  3.30.90  Harry Morris
 *			-	removed chunk code from WAISSearchAPDU,
 *			-	added makeWAISQueryType1Query() and readWAISType1Query() which
 *				replace makeWAISQueryTerms() and makeWAISQueryDocs().
 *  4.11.90  HWM - added definitions of wais element set names
 *  4.14.90  HWM - changed symbol for relevance feedback query from QT_3 to
 *				  QT_RelevanceFeedbackQuery added QT_TextRetrievalQuery as a
 *				  synonym for QT_BooleanQuery
 *				- renamed makeWAISType1Query() to makeWAISTextQuery()
 *				  renamed readWAISType1Query() to readWAISTextQuery()
 *  5.29.90  TS - added CSTFreeWAISFoo functions
 */
d112 13
a124 13
typedef struct DocObj {		/* specifies a section of a document */
    any *DocumentID;
    char *Type;
    long ChunkCode;
    union {
	long Pos;
	any *ID;
    } ChunkStart;
    union {
	long Pos;
	any *ID;
    } ChunkEnd;
} DocObj;
d130 8
a137 8
    long ChunkCode;
    long ChunkIDLength;
    char *ChunkMarker;
    char *HighlightMarker;
    char *DeHighlightMarker;
    char *NewlineCharacters;
    /* XXX  need to add UpdateFrequency and Update Time */
} WAISInitResponse;
d140 8
a147 8
    char *SeedWords;
    DocObj **Docs;
    char **TextList;
    long DateFactor;
    char *BeginDateRange;
    char *EndDateRange;
    long MaxDocumentsRetrieved;
} WAISSearch;
d150 12
a161 12
    any *DocumentID;
    long VersionNumber;
    long Score;
    long BestMatch;
    long DocumentLength;
    long Lines;
    char **Types;
    char *Source;
    char *Date;
    char *Headline;
    char *OriginCity;
} WAISDocumentHeader;
d164 7
a170 7
    any *DocumentID;
    long VersionNumber;
    long Score;
    long BestMatch;
    long DocumentLength;
    long Lines;
} WAISDocumentShortHeader;
d173 15
a187 15
    any *DocumentID;
    long VersionNumber;
    long Score;
    long BestMatch;
    long DocumentLength;
    long Lines;
    char **Types;
    char *Source;
    char *Date;
    char *Headline;
    char *OriginCity;
    char *StockCodes;
    char *CompanyCodes;
    char *IndustryCodes;
} WAISDocumentLongHeader;
d190 4
a193 4
    any *DocumentID;
    long VersionNumber;
    any *DocumentText;
} WAISDocumentText;
d196 7
a202 7
    any *DocumentID;
    long VersionNumber;
    char *Source;
    char *Date;
    char *Headline;
    char *OriginCity;
} WAISDocumentHeadlines;
d205 6
a210 6
    any *DocumentID;
    long VersionNumber;
    char *StockCodes;
    char *CompanyCodes;
    char *IndustryCodes;
} WAISDocumentCodes;
d213 9
a221 9
    char *SeedWordsUsed;
    WAISDocumentHeader **DocHeaders;
    WAISDocumentShortHeader **ShortHeaders;
    WAISDocumentLongHeader **LongHeaders;
    WAISDocumentText **Text;
    WAISDocumentHeadlines **Headlines;
    WAISDocumentCodes **Codes;
    diagnosticRecord **Diagnostics;
} WAISSearchResponse;
d226 91
a316 122
char *generate_search_apdu(char *buff,	/* buffer to hold the apdu */
			   long *buff_len,	/* number of bytes written to the buffer */
			   char *seed_words,	/* string of the seed words */
			   char *database_name,
			   DocObj **docobjs,
			   long maxDocsRetrieved);

DocObj *makeDocObjUsingWholeDocument(any *aDocID, char *type);
DocObj *makeDocObjUsingBytes(any *aDocID, char *type, long start, long end);
DocObj *makeDocObjUsingLines(any *aDocID, char *type, long start, long end);
DocObj *makeDocObjUsingParagraphs(any *aDocID, char *type, any *start, any *end);
void freeDocObj(DocObj *doc);

WAISInitResponse *makeWAISInitResponse(long chunkCode, long chunkIDLen,
				       char *chunkMarker, char *highlightMarker,
				       char *deHighlightMarker, char *newLineChars);
void freeWAISInitResponse(WAISInitResponse *init);

WAISSearch *makeWAISSearch(char *seedWords,
			   DocObj **docs,
			   char **textList,
			   long dateFactor,
			   char *beginDateRange,
			   char *endDateRange,
			   long maxDocsRetrieved);
void freeWAISSearch(WAISSearch *query);

WAISDocumentHeader *makeWAISDocumentHeader(any *aDocID,
					   long versionNumber,
					   long score,
					   long bestMatch,
					   long docLen,
					   long lines,
					   char **types,
					   char *source,
					   char *date,
					   char *headline,
					   char *originCity);
void freeWAISDocumentHeader(WAISDocumentHeader *header);
char *writeWAISDocumentHeader(WAISDocumentHeader *header, char *buffer, long *len);
char *readWAISDocumentHeader(WAISDocumentHeader **header, char *buffer);

WAISDocumentShortHeader *makeWAISDocumentShortHeader(any *aDocID,
						     long versionNumber,
						     long score,
						     long bestMatch,
						     long docLen,
						     long lines);
void freeWAISDocumentShortHeader(WAISDocumentShortHeader *header);
char *writeWAISDocumentShortHeader(WAISDocumentShortHeader *header,
				   char *buffer, long *len);
char *readWAISDocumentShortHeader(WAISDocumentShortHeader **header, char *buffer);

WAISDocumentLongHeader *makeWAISDocumentLongHeader(any *aDocID,
						   long versionNumber,
						   long score,
						   long bestMatch,
						   long docLen,
						   long lines,
						   char **types,
						   char *source,
						   char *date, char *headline,
						   char *originCity,
						   char *stockCodes,
						   char *companyCodes,
						   char *industryCodes);
void freeWAISDocumentLongHeader(WAISDocumentLongHeader *header);
char *writeWAISDocumentLongHeader(WAISDocumentLongHeader *header,
				  char *buffer,
				  long *len);
char *readWAISDocumentLongHeader(WAISDocumentLongHeader **header, char *buffer);

WAISSearchResponse *makeWAISSearchResponse(char *seedWordsUsed,
					   WAISDocumentHeader **docHeaders,
					   WAISDocumentShortHeader **shortHeaders,
					   WAISDocumentLongHeader **longHeaders,
					   WAISDocumentText **text, WAISDocumentHeadlines **headlines,
					   WAISDocumentCodes **codes,
					   diagnosticRecord ** diagnostics);
void freeWAISSearchResponse(WAISSearchResponse * response);

WAISDocumentText *makeWAISDocumentText(any *aDocID, long versionNumber,
				       any *documentText);
void freeWAISDocumentText(WAISDocumentText *docText);
char *writeWAISDocumentText(WAISDocumentText *docText, char *buffer, long *len);
char *readWAISDocumentText(WAISDocumentText **docText, char *buffer);

WAISDocumentHeadlines *makeWAISDocumentHeadlines(any *aDocID,
						 long versionNumber,
						 char *source,
						 char *date,
						 char *headline,
						 char *originCity);
void freeWAISDocumentHeadlines(WAISDocumentHeadlines *docHeadline);
char *writeWAISDocumentHeadlines(WAISDocumentHeadlines *docHeadline,
				 char *buffer,
				 long *len);
char *readWAISDocumentHeadlines(WAISDocumentHeadlines **docHeadline, char *buffer);

WAISDocumentCodes *makeWAISDocumentCodes(any *aDocID,
					 long versionNumber,
					 char *stockCodes,
					 char *companyCodes,
					 char *industryCodes);
void freeWAISDocumentCodes(WAISDocumentCodes *docCodes);
char *writeWAISDocumentCodes(WAISDocumentCodes *docCodes, char *buffer, long *len);
char *readWAISDocumentCodes(WAISDocumentCodes **docCodes, char *buffer);

any *makeWAISTextQuery(DocObj **docs);
DocObj **readWAISTextQuery(any *terms);

void CSTFreeWAISInitResponse(WAISInitResponse *init);
void CSTFreeWAISSearch(WAISSearch *query);
void CSTFreeDocObj(DocObj *doc);
void CSTFreeWAISDocumentHeader(WAISDocumentHeader *header);
void CSTFreeWAISDocumentShortHeader(WAISDocumentShortHeader *header);
void CSTFreeWAISDocumentLongHeader(WAISDocumentLongHeader *header);
void CSTFreeWAISSearchResponse(WAISSearchResponse * response);
void CSTFreeWAISDocumentText(WAISDocumentText *docText);
void CSTFreeWAISDocHeadlines(WAISDocumentHeadlines *docHeadline);
void CSTFreeWAISDocumentCodes(WAISDocumentCodes *docCodes);
void CSTFreeWAISTextQuery(any *query);
d322 1
d324 3
a326 3
 *	Routines originally from WMessage.h -- FM
 *
 *----------------------------------------------------------------------*/
d328 4
a331 4
 * No guarantees or restrictions.  See the readme file for the full standard
 * disclaimer.
 * 3.26.90
 */
d358 7
a364 7
    char msg_len[10];		/* length in bytes of following message */
    char msg_type;		/* type of message: 'z'=Z39.50 APDU,
				   'a'=ACK, 'n'=NACK */
    char hdr_vers;		/* version of this header, currently = '2' */
    char server[10];		/* name or address of server */
    char compression;		/* <sp>=no compression, 'u'=unix compress */
    char encoding;		/* <sp>=no encoding, 'h'=hexize,
d366 2
a367 2
    char msg_checksum;		/* XOR of every byte of message */
} WAISMessage;
d385 2
a386 2
#define HEX_ENCODING		'h'	/* Swartz 4/3 encoding */
#define IBM_HEXCODING		'i'	/* same as h but uses characters acceptable for IBM mainframes */
d389 6
a394 5
void readWAISPacketHeader(char *msgBuffer, WAISMessage * header_struct);
long getWAISPacketLength(WAISMessage * header);
void writeWAISPacketHeader(char *header, long dataLen, long type,
			   char *server, long compression,
			   long encoding, long version);
@


1.1.1.1
log
@Import OpenBSD 3.3 source repository from CTM 3132 the first time
This opens an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright  1968-2003  The authors of And contributors to UNIX, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@
