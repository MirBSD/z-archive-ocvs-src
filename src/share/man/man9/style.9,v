head	1.10;
access;
symbols
	tg-mergetmp-mirosx-1:1.10
	tg-mergefixes-1-branch:1.10.0.4
	tg-mergefixes-1-base:1.10
	MIROS_X:1.10.0.2
	MIROS_X_BASE:1.10
	tg-mergetmp-3:1.10
	MIRBSD_XP_MIRPPC:1.6.0.4
	MIRBSD_XP_SPARC_BASE:1.6
	MIRBSD_XP_SPARC:1.6.0.2
	MIRBSD_7quater:1.1.1.4
	cvs-200405160640:1.1.1.6
	cvs-200401271800:1.1.1.5
	cvs-200401261630:1.1.1.5
	cvs-200401021645:1.1.1.5
	MIRBSD_7_ALPHA:1.1.1.4.0.6
	MIRBSD_7:1.1.1.4.0.4
	cvs-200312222040:1.1.1.5
	MIRBSD_7ter:1.1.1.4
	MIRBSD_7_DEV:1.1.1.4.0.2
	cvs-200310020700:1.1.1.4
	cvs-200309271030:1.1.1.3
	cvs-200309251530:1.1.1.3
	cvs-200308302005:1.1.1.3
	cvs-200308221505:1.1.1.3
	cvs-200308171200:1.1.1.3
	ctm-3496:1.1.1.3
	ctm-3449:1.1.1.3
	ctm-3437:1.1.1.3
	cvs-200307191805:1.1.1.3
	ctm-3425:1.1.1.3
	cvs-200307091500:1.1.1.3
	cvs-200307072125:1.1.1.3
	ctm-3389:1.1.1.3
	cvs-200306291430:1.1.1.3
	ctm-3341:1.1.1.2
	MIRBSD_5:1.1.1.2
	cvs-200306082100:1.1.1.2
	ctm-3316:1.1.1.2
	ctm-3272:1.1.1.2
	ctm-3264:1.1.1.2
	cvs-200305071630:1.1.1.2
	MIRBSD_4:1.1.1.1
	ctm-3203:1.1.1.1
	cvs-20030410-1130:1.1.1.1
	ctm-3155:1.1.1.1
	ctm-3132:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@.\" @;


1.10
date	2004.11.03.21.09.13;	author tg;	state Exp;
branches;
next	1.9;

1.9
date	2004.10.21.12.37.17;	author tg;	state Exp;
branches;
next	1.8;

1.8
date	2004.10.21.12.27.25;	author tg;	state Exp;
branches;
next	1.7;

1.7
date	2004.10.21.12.20.55;	author tg;	state Exp;
branches;
next	1.6;

1.6
date	2004.10.08.05.24.06;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2004.08.06.23.37.12;	author tg;	state Stab;
branches;
next	1.4;

1.4
date	2004.08.06.23.23.00;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2004.05.23.16.00.10;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2004.05.23.15.57.38;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.22.17.49.09;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.03.22.17.49.09;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.05.07.17.45.09;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2003.06.29.17.28.41;	author tg;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2003.10.02.07.49.05;	author tg;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2003.12.22.21.12.15;	author tg;	state Exp;
branches;
next	1.1.1.6;

1.1.1.6
date	2004.05.16.08.27.53;	author tg;	state Exp;
branches;
next	;


desc
@@


1.10
log
@add comment about positiveness of error codes
idea when miod@@openbsd prodded reyk (he scolded me for that one too, once)
@
text
@.\" $MirBSD: src/share/man/man9/style.9,v 1.9 2004/10/21 12:37:17 tg Exp $
.\"
.\" Copyright (c) 2002-2004 The MirOS Project.
.\" Copyright (c) ? OpenBSD
.\" Copyright (c) 1995 FreeBSD Inc.
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL [your name] OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"	$OpenBSD: style.9,v 1.38 2004/04/10 09:10:16 jmc Exp $
.\"
.Dd June 18, 2001
.Dt STYLE 9
.Os
.Sh NAME
.Nm style
.Nd "Kernel source file style guide (KNF)"
.Sh DESCRIPTION
This file specifies the preferred style for kernel source files in the
.Mx
source tree.
It is also a guide for preferred user land code style.
These guidelines should be followed for all new code.
In general, code can be considered
.Dq new code
when it makes up about 50% or more of the file(s) involved.
This is enough to break precedents in the existing code and use the
current style guidelines.
.Bd -literal -offset indent
/*
 * Style guide for the MirOS Project's Coding Styles,
 * derived from the OpenBSD KNF (Kernel Normal Form).
 */

/*
 * VERY important single-line comments look like this.
 */

/* Most small single-line comments look like this */
/* Others are sentences, thus end with a full stop. */

/*
 * Multi-line comments look like this. Make them real sentences,
 * in contrast to single-line comments. Fill them so they look
 * like real paragraphs.
 * British spelling is preferred in general. Restrict yourself
 * to the ISO_646.irv:1991 7-bit character set.
 */
.Ed
.Pp
Kernel include files (i.e.,
.Aq Pa sys/*.h )
come first; normally, you'll need
.Aq Pa sys/types.h
OR
.Aq Pa sys/param.h ,
but not both!
.Aq Pa sys/param.h
includes
.Aq Pa sys/types.h ,
which in turn
includes
.Aq Pa sys/cdefs.h ,
and it's okay to depend on that.
.Bd -literal -offset indent
#include <sys/types.h>	/* Non-local includes in brackets */
.Ed
.Pp
If it's a network programme, put the network include files next.
.Bd -literal -offset indent
#include <net/if.h>
#include <net/if_dl.h>
#include <net/route.h>
#include <netinet/in.h>
#include <protocols/rwhod.h>
.Ed
.Pp
Then there's a blank line, followed by the
.Pa /usr/include
files.
The
.Pa /usr/include
files should be sorted!
.Bd -literal -offset indent
#include <stdio.h>
.Ed
.Pp
Global pathnames are defined in
.Aq Pa paths.h .
Pathnames local to the programme go in
.Dq Pa pathnames.h
in the local directory.
.Bd -literal -offset indent
#include <paths.h>
.Ed
.Pp
Then there's a blank line, and the user include files.
.Bd -literal -offset indent
#include "pathnames.h"	/* Local includes in double quotes */
.Ed
.Pp
After the includes block, you should add the RCS ID of the file,
and if taking over old source, the SCCS ID as well.
These two macros are defined in
.Aq Pa sys/cdefs.h .
.Bd -literal -offset indent
__SCCSID("@@(#)foo.c     4.5 (Berkeley) 4/18/91");
__RCSID("$MirBSD\&$");
.Ed
.Pp
All functions are prototyped somewhere.
.Pp
Function prototypes for private functions (i.e., functions not used
elsewhere) go at the top of the first source module.
In user land, functions local to one source module should be declared
.Ql static .
This should not be done in kernel land since it makes it impossible
to use the kernel debugger.
.Pp
Functions used from other parts of the kernel are prototyped in the
relevant include file.
.Pp
Functions that are used locally in more than one module go into a
separate header file, e.g.,
.Dq Pa extern.h .
.Pp
Use of the
.Li __P
macro has been deprecated.
It is allowed in code imported from other sources but should not be
used in native
.Mx
code.
Prototypes should not have variable names associated with the types; i.e.,
.Bd -literal -offset indent
void	function(int);
.Ed
not:
.Bd -literal -offset indent -compact
void	function(int a);
.Ed
.Pp
Prototypes may have an extra space after a tab to enable function names
to line up, although lining up needs not be used:
.Bd -literal -offset indent
static char	*function(int, const char *);
static void	 usage(void);
.Ed
.Pp
There should be no space between the function (or macro) name
and the argument list, only after keywords.
.Pp
Use
.Li __dead
from
.Aq Pa sys/cdefs.h
for functions that don't return, i.e.,
.Bd -literal -offset indent
__dead void	abort(void);
.Ed
.Pp
In header files, put function prototypes within
.Dv __BEGIN_DECLS / __END_DECLS
matching pairs.
This makes the header file usable from C++.
.Pp
Macros are capitalized and parenthesized, and should avoid side-effects.
If they are an inline expansion of a function, the function is defined
all in lowercase; the macro has the same name all in uppercase.
If the macro needs more than a single line, use braces.
Right-justify the backslashes, as the resulting definition is easier to read.
If the macro encapsulates a compound statement, enclose it in a
.Dq Li do
loop,
so that it can safely be used in
.Dq Li if
statements.
Any final statement-terminating semicolon should be
supplied by the macro invocation rather than the macro, to make parsing easier
for pretty-printers and editors.
.Bd -literal -offset indent
#define	MACRO(x, y) do {					\e
	variable = (x) + (y);					\e
	(y) += 2;						\e
} while (0)
.Ed
.Pp
Enumeration values are all uppercase.
.Bd -literal -offset indent
enum enumtype { ONE, TWO } et;
.Ed
.Pp
When declaring variables in structures, declare them sorted by use, then
by size (largest to smallest), then by alphabetical order.
The first category normally doesn't apply, but there are exceptions.
Each one gets its own line.
Put a tab after the first word, i.e., use
.Ql int^Ix;
and
.Ql struct^Ifoo *x; .
.Pp
Major structures should be declared at the top of the file in which they
are used, or in separate header files if they are used in multiple
source files.
Use of the structures should be by separate declarations and should be
.Dq Li extern
if they are declared in a header file.
.Bd -literal -offset indent
struct foo {
	struct	foo *next;	/* List of active foo */
	struct	mumble amumble;	/* Comment for mumble */
	int	bar;
};
struct foo *foohead;		/* Head of global foo list */
.Ed
.Pp
Use
.Xr queue 3
macros rather than rolling your own lists, whenever possible.
Thus, the previous example would be better written:
.Bd -literal -offset indent
#include <sys/queue.h>
struct	foo {
	LIST_ENTRY(foo)	link;	/* Queue macro glue for foo lists */
	struct	mumble amumble;	/* Comment for mumble */
	int	bar;
};
LIST_HEAD(, foo) foohead;	/* Head of global foo list */
.Ed
.Pp
Avoid using typedefs for structure types.
This makes it impossible
for applications to use pointers to such a structure opaquely, which
is both possible and beneficial when using an ordinary struct tag.
When convention requires a typedef, make its name match the struct tag.
Avoid typedefs ending in
.Dq Li \&_t ,
except as specified in Standard C or by
.Tn POSIX .
Don't use the same name for a struct tag and a typedef, as this makes
the code unusable from C++.
.Bd -literal -offset indent
/* Make the structure name match the typedef */
typedef struct _bar {
	int	level;
} BAR;
.Ed
.Bd -literal -offset indent
/*
 * All major routines should have a comment briefly describing what
 * they do. The comment before the "main" routine should describe
 * what the programme does.
 */
int
main(int argc, char *argv[])
{
	long num;
	int ch;
	char *ep;

.Ed
.Pp
For consistency,
.Xr getopt 3
should be used to parse options.
Options should be sorted in the
.Xr getopt 3
call and the switch statement, unless
parts of the switch cascade.
Elements in a switch statement that cascade should have a FALLTHROUGH comment.
Numerical arguments should be checked for accuracy.
Code that cannot be reached should have a NOTREACHED comment.
.Bd -literal -offset indent
while ((ch = getopt(argc, argv, "abn:")) != -1)
	switch (ch) {		/* Indent the switch */
	case 'a':		/* Don't indent the case */
		aflag = 1;
		/* FALLTHROUGH */
	case 'b':
		bflag = 1;
		break;
	case 'n':
		num = strtol(optarg, &ep, 10);
		if (num <= 0 || *ep != '\e0') {
			warnx("illegal number, -n argument -- %s",
			    optarg);
			usage();
		}
		break;
	case '?':
	default:
		usage();
		/* NOTREACHED */
	}
argc -= optind;
argv += optind;
.Ed
.Pp
Use a space after keywords
.Pf ( Li if ,
.Li while ,
.Li for ,
.Li return ,
.Li switch ) .
No braces are
used for control statements with zero or only a single statement unless that
statement is more than a single line, in which case they are permitted.
Forever loops are done with
.Li for ,
not
.Li while .
.Bd -literal -offset indent
for (p = buf; *p != '\e0'; ++p)
	;	/* nothing */
for (;;)
	stmt;
for (;;) {
	z = a + really + long + statement + that + needs +
	    two + lines + gets + indented + four + spaces +
	    on + the + second + and + subsequent + lines;
}
for (;;) {
	if (cond)
		stmt;
}
.Ed
.Pp
Parts of a for loop may be left empty.
Don't put declarations inside blocks unless the routine is
unusually complicated.
.Bd -literal -offset indent
for (; cnt < 15; cnt++) {
	stmt1;
	stmt2;
}
.Ed
.Pp
Indentation is an 8 character tab.
Second level indents are four spaces.
.Bd -literal -offset indent
while (cnt < 20)
	z = a + really + long + statement + that + needs +
	    two lines + gets + indented + four + spaces +
	    on + the + second + and + subsequent + lines;
.Ed
.Pp
Do not add whitespace at the end of a line, and only use tabs
followed by spaces to form the indentation.
Do not use more spaces than a tab will produce
and do not use spaces in front of tabs.
.Pp
Closing and opening braces go on the same line as the else.
Braces that aren't necessary may be left out, unless they cause
a compiler warning.
.Bd -literal -offset indent
if (test)
	stmt;
else if (bar) {
	stmt;
	stmt;
} else
	stmt;
.Ed
.Pp
Do not use spaces after function names.
Commas have a space after them.
Do not use spaces after
.Sq \&(
or
.Sq \&[
or preceding
.Sq \&]
or
.Sq \&)
characters.
.Bd -literal -offset indent
if ((error = function(a1, a2)))
	exit(error);
.Ed
.Pp
Use positive error codes.
Negative errors (except \-1) are something only the Other OS does.
.Pp
Unary operators don't require spaces; binary operators do.
Don't use parentheses unless they're required for precedence, the statement
is confusing without them, or the compiler generates a warning without them.
Remember that other people may be confused more easily than you.
Do YOU understand the following?
.Bd -literal -offset indent
a = b->c[0] + ~d == (e || f) || g && h ? i : j >> 1;
k = !(l & FLAGS);
.Ed
.Pp
Also, it's much better to break before an operator,
not after it, if you have got to apply line breaks.
This is especially true for shell scripts.
The above example could be rewritten as:
.Bd -literal -offset indent
a = b->c[0] +
    ( ~d == (e || f) || g && h ) ? i : ( j >> 1 );
k = !(l
    & FLAGS);
.Ed
.Pp
Exits should be 0 on success, or non-zero for errors.
.Bd -literal -offset indent
exit(0);	/*
		 * Avoid obvious comments such as
		 * "Exit 0 on success."
		 */
}
.Ed
.Pp
The function type should be on a line by itself
preceding the function.
.Bd -literal -offset indent
static char *
function(int a1, int a2, float fl, int a4)
{
.Ed
.Pp
When declaring variables in functions, declare them sorted by size (largest to
smallest), then in alphabetical order; multiple ones per line are okay.
Old style function declarations should be avoided; we live in an ANSI C world,
and ISO C99 is already coming.
ANSI style function declarations should go in an include file such as
.Dq Pa extern.h .
If a line overflows, reuse the type keyword.
.Pp
Be careful not to obfuscate the code by initializing variables in
the declarations.
Use this feature only thoughtfully.
DO NOT use function calls in initializers!
.Bd -literal -offset indent
struct foo one, *two;
double three;
int *four, five;
char *six, seven, eight, nine, ten, eleven, twelve;

four = myfunction();
.Ed
.Pp
Do not declare functions inside other functions: ANSI C says that
such declarations have file scope regardless of the nesting of the
declaration.
Hiding file declarations in what appears to be a local scope is
undesirable and will elicit complaints from a good compiler, such as
.Dq Li gcc -Wtraditional .
.Pp
Casts and
.Fn sizeof
calls are not followed by a space.
Note that
.Xr indent 1
does not understand this rule.
.Pp
Use of the
.Dq register
specifier is discouraged in new code.
Optimizing compilers such as gcc can generally do a better job
of choosing which variables to place in registers to improve
code performance.
The exception to this is in functions containing assembly code where the
.Dq register
specifier is required for proper code generation in the absence of
compiler optimization.
.Pp
When using
.Fn longjmp
or
.Fn vfork
in a programme, the
.Fl W
or
.Fl Wall
flag should be used to verify that the compiler does not generate
warnings such as
.Bd -literal -offset indent
warning: variable `foo' might be clobbered by `longjmp' or `vfork'.
.Ed
.Pp
If any warnings of this type occur, you must apply the
.Dq volatile
type-qualifier to the variable in question.
Failure to do so may result in improper code generation when optimization
is enabled.
Note that for pointers, the location of
.Dq volatile
specifies if the type-qualifier applies to the pointer, or the thing being
pointed to.
A volatile pointer is declared with
.Dq volatile
to the right of the
.Dq * .
Example:
.Bd -literal -offset indent
char *volatile foo;
.Ed
.Pp
says that
.Dq foo
is volatile, but
.Dq *foo
is not.
To make
.Dq *foo
volatile use the syntax
.Bd -literal -offset indent
volatile char *foo;
.Ed
.Pp
If both the pointer and the thing pointed to are volatile use
.Bd -literal -offset indent
volatile char *volatile foo;
.Ed
.Pp
.Dq const
is also a type-qualifier and the same rules apply.
The description of a read-only hardware register might look something like:
.Bd -literal -offset indent
const volatile char *reg;
.Ed
.Pp
Global flags set inside signal handlers should be of type
.Dq volatile sig_atomic_t
if possible.
This guarantees that the variable may be accessed as an atomic entity,
even when a signal has been delivered.
Global variables of other types (such as structures) are not
guaranteed to have consistent values when accessed via a signal handler.
.Pp
.Dv NULL
is the preferred null pointer constant.
Use
.Dv NULL
instead of
(type\ *)0 or (type\ *)NULL in contexts where the compiler knows the
type, e.g., in assignments.
Use (type\ *)NULL in other contexts, in particular for all function args.
(Casting is essential for variadic args and is necessary for other args
if the function prototype might not be in scope.)
Test pointers
against
.Dv NULL ,
i.e., use:
.Bd -literal -offset indent
(p = f()) == NULL
.Ed
not:
.Bd -literal -offset indent -compact
!(p = f())
.Ed
.Pp
Don't use
.Ql \&!
for tests unless it's a boolean, i.e., use
.Bd -literal -offset indent
if (*p == '\e0')
.Ed
not
.Bd -literal -offset indent -compact
if (!*p)
.Ed
.Pp
Routines returning
.Li void *
should not have their return values cast to any pointer type.
.Pp
Use
.Xr err 3
or
.Xr warn 3 ,
don't roll your own!
.Bd -literal -offset indent
if ((four = malloc(sizeof(struct foo))) == NULL)
	err(1, (char *)NULL);
if ((six = (int *)overflow()) == NULL)
	errx(1, "Number overflowed.");
return (eight);
}
.Ed
.Pp
Old-style function declarations look like this:
.Bd -literal -offset indent
static char *
function(a1, a2, fl, a4)
	int a1, a2;	/* Declare ints, too, don't default them */
	float fl;	/* Beware double vs. float prototype differences */
	int a4;		/* List in order declared */
{
	...
}
.Ed
.Pp
Use ANSI function declarations unless you explicitly need K&R compatibility.
Long parameter lists are wrapped with a normal four space indent.
.Pp
Variable numbers of arguments should look like this:
.Bd -literal -offset indent
#include <stdarg.h>

void
vaf(const char *fmt, ...)
{
	va_list ap;
	va_start(ap, fmt);

	STUFF;

	va_end(ap);

	/* No return needed for void functions. */
}

static void
usage(void)
{
	extern char *__progname;	/* from crt0.o */
.Ed
.Pp
Usage statements should look like the manual pages.
Options without
operands come first, in alphabetical order inside a single set of
braces, followed by options with operands, in alphabetical order,
each in braces, followed by required arguments in the order they
are specified, followed by optional arguments in the order they
are specified.
.Pp
A bar
.Pq Sq \&|
separates either-or options/arguments,
and multiple options/arguments which are specified together are
placed in a single set of braces.
.Pp
If numbers are used as options, they should be placed first,
as shown in the example below.
Uppercase letters take precedence over lowercase.
Note that the options list in manual pages should be purely alphabetical.
That is, with no regard to whether an option takes an argument.
.Bd -literal -offset indent
"usage: f [-12aDde] [-b b_arg] [-m m_arg] req1 req2 [opt1 [opt2]]\en"
"usage: f [-a | -b] [-c [-de] [-n number]]\en"
.Ed
.Pp
The
.Li __progname
string, should be used instead of hard-coding the programme's name.
.Bd -literal -offset indent
(void)fprintf(stderr, "usage: %s [-ab]\en", __progname);
exit(1);
}
.Ed
.Pp
New core kernel code should be reasonably compliant with the style guides.
The guidelines for third-party maintained modules and device drivers are more
relaxed but at a minimum should be internally consistent with their style.
.Pp
Stylistic changes (including whitespace changes) are hard on the source
repository and are to be avoided without good reason.
Code that is approximately KNF compliant in the repository must not diverge
from compliance.
.Pp
Whenever possible, code should be run through a code checker
(e.g.,
.Dq Li gcc -Wall -W -Wtraditional -Wpointer-arith -Wbad-function-cast ... ,
.Xr lint 1
or lclint from the ports tree) and produce minimal warnings.
.Sh FILES
.Bl -tag -width "/usr/share/misc/licence.template " -compact
.It Pa /usr/share/misc/licence.template
Licence preferred for new code.
Attention: this template is different from the
.Ox
sample licence.
.El
.Pp
.Pa ~/.indent.pro
should contain at least the following items:
.Pp
.Fl c0
.Fl ci4
.Fl di0
.Fl ncsp
.Fl nfc1
.Fl nlp
.Fl nlpi
.Fl Tint16_t
.Fl Tint32_t
.Fl Tint64_t
.Fl Tint8_t
.Fl Tintmax_t
.Fl Tintptr_t
.Fl Toff_t
.Fl Tpid_t
.Fl Tptrdiff_t
.Fl Tquad_t
.Fl Trecno_t
.Fl Tsize_t
.Fl Tssize_t
.Fl Ttime_t
.Fl Tu_char
.Fl Tu_int
.Fl Tu_int16_t
.Fl Tu_int32
.Fl Tu_int32_t
.Fl Tu_int64_t
.Fl Tu_int8_t
.Fl Tu_long
.Fl Tu_quad_t
.Fl Tu_short
.Fl Tuid_t
.Fl Tuint
.Fl Tuint16_t
.Fl Tuint32_t
.Fl Tuint64_t
.Fl Tuint8_t
.Fl Tuintmax_t
.Fl Tuintptr_t
.Fl Tulong
.Fl Tunchar
.Fl Tvaddr_t
and a bunch of others.
The
.Fl c0
option might be problematic for existing code.
It's often better to leave it out.
.Pp
A more complete list can be fount at
.Pa src/usr.bin/indent/.indent.pro
in the
.Mx
source code, which is kept up-to-date as the developers
stumble upon new typedefs.
.Pp
Even then,
.Xr indent 1
does only basic help to apply KNF.
Be warned.
.Sh SEE ALSO
.Xr indent 1 ,
.Xr err 3 ,
.Xr queue 3 ,
.Xr warn 3
.Sh HISTORY
This man page is largely based on the src/admin/style/style file from
the
.Tn BSD
4.4-Lite2 release, with updates to reflect the current practice and
desire of the
.Ox
project, with a few annotations for the
.Mx
source.
@


1.9
log
@the trend goes to not /* comment like GNU.  */ or /* like this. */
but /* like this */.
@
text
@d1 1
a1 1
.\" $MirBSD: src/share/man/man9/style.9,v 1.8 2004/10/21 12:27:25 tg Exp $
d399 3
@


1.8
log
@make inheritance and spaces more clear
@
text
@d1 1
a1 1
.\" $MirBSD: src/share/man/man9/style.9,v 1.7 2004/10/21 12:20:55 tg Exp $
d58 2
a59 1
/* Most single-line comments look like this. */
d62 4
a65 3
 * Multi-line comments look like this.  Make them real sentences.
 * Fill them so they look like real paragraphs.
 * British spelling is preferred in general.  Restrict yourself
d85 1
a85 1
#include <sys/types.h>	/* Non-local includes in brackets. */
d118 1
a118 1
#include "pathnames.h"	/* Local includes in double quotes. */
d262 1
a262 1
/* Make the structure name match the typedef. */
d270 1
a270 1
 * they do.  The comment before the "main" routine should describe
d294 2
a295 2
	switch (ch) {		/* Indent the switch. */
	case 'a':		/* Don't indent the case. */
d603 3
a605 3
	int a1, a2;	/* Declare ints, too, don't default them. */
	float fl;	/* Beware double vs. float prototype differences. */
	int a4;		/* List in order declared. */
@


1.7
log
@* fixup a bit
* add 'wrap before operator'
  XXX someone come up with a better example
  XXX someone add one level or so more round braces here
* add (c)
@
text
@d1 1
a1 1
.\" $MirBSD: src/share/man/man9/style.9,v 1.6 2004/10/08 05:24:06 tg Exp $
d50 2
a51 1
 * Style guide for the OpenBSD/MirOS KNF (Kernel Normal Form).
d167 2
a168 1
There should be no space between the function name and the argument list.
@


1.6
log
@move most typedefs out of the manpage
@
text
@d1 1
a1 1
.\" $MirBSD: src/share/man/man9/style.9,v 1.5 2004/08/06 23:37:12 tg Stab $
d3 2
d123 1
a123 1
__SCCSID("@@(#) BSD blahblah");
d404 11
@


1.5
log
@the 150 most basic typedefs :)
@
text
@d1 1
a1 1
.\" $MirBSD: src/share/man/man9/style.9,v 1.4 2004/08/06 23:23:00 tg Exp $
a685 32
.Fl TBOOL
.Fl TByte
.Fl TDBM
.Fl TDBT
.Fl TRCDB
.Fl Tattr_t
.Fl Tbitstr_t
.Fl Tbool
.Fl Tboolean
.Fl Tboolean_t
.Fl Tbpf_u_int32
.Fl Tbregister_t
.Fl Tbus_addr_t
.Fl Tbus_dma_segment_t
.Fl Tbus_dma_tag_t
.Fl Tbus_dmamap_t
.Fl Tbus_size_t
.Fl Tbus_space_handle_t
.Fl Tbus_space_tag_t
.Fl Tcaddr_t
.Fl Tclock_t
.Fl Tclockid_t
.Fl Tdaddr_t
.Fl Tdev_t
.Fl Tfpos_t
.Fl Tfsid_t
.Fl Tgid_t
.Fl Tid_t
.Fl Tin_addr_t
.Fl Tin_port_t
.Fl Tindx_t
.Fl Tino_t
a689 9
.Fl Tint_fast16_t
.Fl Tint_fast32_t
.Fl Tint_fast64_t
.Fl Tint_fast8_t
.Fl Tint_least16_t
.Fl Tint_least32_t
.Fl Tint_least64_t
.Fl Tint_least8_t
.Fl Tint_type
a691 13
.Fl Tip_addr_t
.Fl Tipx_port_t
.Fl Tkbd_t
.Fl Tkeysym_t
.Fl Tkvm_t
.Fl Tlock_data_t
.Fl Tlock_t
.Fl Tmbuf_t
.Fl Tmode_t
.Fl Tnfsfh_t
.Fl Tnfsquad_t
.Fl Tnl_item
.Fl Tnlink_t
a692 1
.Fl Tpaddr_t
a693 16
.Fl Tpmap_t
.Fl Tpointer
.Fl Tpsize_t
.Fl Tpt_entry_t
.Fl Tpthread_addr_t
.Fl Tpthread_alloc
.Fl Tpthread_attr_t
.Fl Tpthread_cond_t
.Fl Tpthread_condattr_t
.Fl Tpthread_key_t
.Fl Tpthread_mutex_t
.Fl Tpthread_mutexattr_t
.Fl Tpthread_once_t
.Fl Tpthread_rwlock_t
.Fl Tpthread_rwlockattr_t
.Fl Tpthread_t
a694 1
.Fl Tqaddr_t
a696 12
.Fl Tregex_t
.Fl Tregister_t
.Fl Tregoff_t
.Fl Tretval_t
.Fl Trlim_t
.Fl Tsa_family_t
.Fl Tsem_t
.Fl Tshmatt_t
.Fl Tsig_atomic_t
.Fl Tsigset_t
.Fl Tsimple_lock_data_t
.Fl Tsimple_lock_t
a697 2
.Fl Tsocket_t
.Fl Tsocklen_t
a698 2
.Fl Ttai64_t
.Fl Ttai64na_t
a699 11
.Fl Ttimer_t
.Fl Tu16
.Fl Tu32
.Fl Tu8
.Fl TuByte
.Fl TuDWord
.Fl TuInt
.Fl TuIntf
.Fl TuLong
.Fl TuLongf
.Fl TuWord
a709 1
.Fl Tucontext_t
a715 8
.Fl Tuint_fast16_t
.Fl Tuint_fast32_t
.Fl Tuint_fast64_t
.Fl Tuint_fast8_t
.Fl Tuint_least16_t
.Fl Tuint_least32_t
.Fl Tuint_least64_t
.Fl Tuint_least8_t
d721 12
a732 7
.Fl Tvoff_t
.Fl Tvoidp
.Fl Tvsize_t
.Fl Twchar_t
.Fl Twint_t
.Fl Tyy_state_type
.Fl Tz_streamp
@


1.4
log
@hint to indent(1) and give sample options
indents switch() {} handling is slightly broken
if you call return from within a switch stmt, tho.
@
text
@d1 1
a1 1
.\" $MirBSD: src/share/man/man9/style.9,v 1.3 2004/05/23 16:00:10 tg Exp $
d686 3
d690 28
d722 46
a767 1
.Fl TRCDB
d769 12
d782 4
d787 25
d816 20
a835 4
.Fl Tu_int16_t
.Fl Tu_int32_t
.Fl Tu_int64_t
.Fl Tu_int8_t
@


1.3
log
@as a matter of fact, I've successfully persuaded myself why
always exporting __progname to every function, and putting it
into a "should be" kernel header file, is a bad idea. revert.
@
text
@d1 1
a1 1
.\" $MirBSD: src/share/man/man9/style.9,v 1.2 2004/05/23 15:57:38 tg Exp $
d675 33
@


1.2
log
@* merge OpenBSD 3.5-current
* fix every single Makefile for papers/USD/PSD/SMM
* improve <bsd.doc.mk> - tbl(1) is called by default now
* move programme definitions from <bsd.doc.mk> into <bsd.own.mk>
* move a bunch of compiler selection stuff from /etc/mk.conf
  into <bsd.own.mk> and improve it largely
* overhaul gcc-local(1) and style(9), referencing our licence
  template in the latter
* overhaul (mostly shorten and clarify) the COPYRIGHT file;
  make clear where the other licences (Apache, Sendmail, GNU, ...)
  are listed, by pathname and www URI
* employ new mechanism to check for paper/doc Makefiles/SUBDIRs
* fix mdoc macros
* merge more acronymes from NetBSD

This merge took me more than three hours, just FYI
@
text
@d1 1
a1 1
.\" $MirBSD$
d617 1
a617 1
	extern char *__progname;	/* from crt0.o, see below */
d646 1
a646 3
string, should be used instead of hard-coding the programme's name;
it is defined in
.Aq Pa sys/param.h .
@


1.1
log
@Initial revision
@
text
@d1 2
d27 1
a27 1
.\"	$OpenBSD: style.9,v 1.31 2003/02/26 15:05:07 david Exp $
d37 1
a37 1
.Ox
d46 1
a46 1
.Bd -literal -offset 0i
d48 1
a48 1
 * Style guide for the OpenBSD KNF (Kernel Normal Form).
d58 4
a61 2
 * Multi-line comments look like this.  Make them real sentences.  Fill
 * them so they look like real paragraphs.
d66 1
a66 1
.Pa Aq sys/*.h )
d68 1
a68 1
.Pa Aq sys/types.h
d70 1
a70 1
.Pa Aq sys/param.h ,
d72 1
a72 1
.Pa Aq sys/types.h
d74 4
a77 1
.Pa Aq sys/cdefs.h ,
d79 2
a80 2
.Bd -literal -offset 0i
#include <sys/types.h>		/* Non-local includes in brackets. */
d83 2
a84 2
If it's a network program, put the network include files next.
.Bd -literal -offset 0i
d93 2
a94 2
.Pa /usr
include files.
d96 3
a98 3
.Pa /usr
include files should be sorted!
.Bd -literal -offset 0i
d103 3
a105 3
.Pa /usr/include/paths.h .
Pathnames local to the program go in
.Pa pathnames.h
d107 1
a107 1
.Bd -literal -offset 0i
d111 12
a122 3
Then, there's a blank line, and the user include files.
.Bd -literal -offset 0i
#include "pathnames.h"		/* Local includes in double quotes. */
d139 1
a139 1
.Pa extern.h .
d146 1
a146 1
.Ox
d148 2
a149 2
Prototypes should not have variable names associated with the types; i.e.:
.Bd -literal -compact -offset 0i
a151 1
.Pp
d153 1
a153 1
.Bd -literal -compact -offset 0i
d158 2
a159 2
to line up:
.Bd -literal -offset 0i
d169 1
a169 1
.Pa Aq sys/cdefs.h
d171 1
a171 1
.Bd -literal -offset 0i
d194 4
a197 4
.Bd -literal -offset 0i
#define	MACRO(x, y) do {						\e
	variable = (x) + (y);						\e
	(y) += 2;							\e
d202 1
a202 1
.Bd -literal -offset 0i
d221 1
a221 1
.Bd -literal -offset 0i
d234 1
a234 1
.Bd -literal -offset 0i
d255 1
a255 1
.Bd -literal -offset 0i
d261 1
a261 2
.Pp
.Bd -literal -offset 0i
d265 1
a265 1
 * what the program does.
d286 14
a299 19
.Bd -literal -offset 0i
	while ((ch = getopt(argc, argv, "abn:")) != -1)
		switch (ch) {		/* Indent the switch. */
		case 'a':		/* Don't indent the case. */
			aflag = 1;
			/* FALLTHROUGH */
		case 'b':
			bflag = 1;
			break;
		case 'n':
			num = strtol(optarg, &ep, 10);
			if (num <= 0 || *ep != '\e0') {
				warnx("illegal number, -n argument -- %s",
				    optarg);
				usage();
			}
			break;
		case '?':
		default:
a300 1
			/* NOTREACHED */
d302 8
a309 3
	argc -= optind;
	argv += optind;

d312 1
a312 1
Use space after keywords
d325 12
a336 4
.Bd -literal -offset 0i
	for (p = buf; *p != '\e0'; ++p)
		;	/* nothing */
	for (;;)
d338 1
a338 9
	for (;;) {
		z = a + really + long + statement + that + needs +
		    two + lines + gets + indented + four + spaces +
		    on + the + second + and + subsequent + lines;
	}
	for (;;) {
		if (cond)
			stmt;
	}
d344 5
a348 5
.Bd -literal -offset 0i
	for (; cnt < 15; cnt++) {
		stmt1;
		stmt2;
	}
d353 5
a357 5
.Bd -literal -offset 0i
	while (cnt < 20)
		z = a + really + long + statement + that + needs +
		    two lines + gets + indented + four + spaces +
		    on + the + second + and + subsequent + lines;
d368 8
a375 8
.Bd -literal -offset 0i
	if (test)
		stmt;
	else if (bar) {
		stmt;
		stmt;
	} else
		stmt;
d389 3
a391 3
.Bd -literal -offset 0i
	if ((error = function(a1, a2)))
		exit(error);
d399 3
a401 3
.Bd -literal -offset 0i
	a = b->c[0] + ~d == (e || f) || g && h ? i : j >> 1;
	k = !(l & FLAGS);
d405 5
a409 5
.Bd -literal -offset 0i
	exit(0);	/*
			 * Avoid obvious comments such as
			 * "Exit 0 on success."
			 */
d415 1
a415 1
.Bd -literal -offset 0i
d421 1
a421 1
When declaring variables in functions declare them sorted by size (largest to
d423 2
a424 1
Old style function declarations should be avoided.
d427 1
a427 1
If a line overflows reuse the type keyword.
d433 5
a437 5
.Bd -literal -offset 0i
	struct foo one, *two;
	double three;
	int *four, five;
	char *six, seven, eight, nine, ten, eleven, twelve;
d439 1
a439 1
	four = myfunction();
d442 1
a442 1
Do not declare functions inside other functions; ANSI C says that
d449 2
a450 2
Casts and 
.Fn sizeof 
d471 1
a471 1
in a program, the
d477 1
a477 1
.Bd -literal -offset 0i
d481 1
a481 1
If any warnings of this type occur you must apply the
d483 1
a483 1
specifier to the variable in question.
d495 1
a495 1
.Bd -literal -offset 0i
d507 1
a507 1
.Bd -literal -offset 0i
d512 1
a512 1
.Bd -literal -offset 0i
d519 1
a519 1
.Bd -literal -offset 0i
d545 1
a545 1
.Bd -literal -offset 0i
a547 1
.Pp
d549 1
a549 1
.Bd -literal -offset 0i
d556 1
a556 1
.Bd -literal -offset 0i
a558 1
.Pp
d560 1
a560 1
.Bd -literal -offset 0i
d573 6
a578 6
.Bd -literal -offset 0i
	if ((four = malloc(sizeof(struct foo))) == NULL)
		err(1, (char *)NULL);
	if ((six = (int *)overflow()) == NULL)
		errx(1, "Number overflowed.");
	return (eight);
d583 1
a583 1
.Bd -literal -offset 0i
d598 1
a598 1
.Bd -literal -offset 0i
d617 1
a617 1
	extern char *__progname;	/* from crt0.o */
d627 1
d634 7
a640 2
.Bd -ragged -offset 0.3i
"usage: f [-ade] [-b b_arg] [-m m_arg] req1 req2 [opt1 [opt2]]\en"
d646 6
a651 4
string, should be used instead of hard-coding the program name.
.Bd -literal -offset 0i
	(void)fprintf(stderr, "usage: %s [-ab]\en", __progname);
	exit(1);
d669 8
d689 3
a691 1
project.
@


1.1.1.1
log
@Import OpenBSD 3.3 source repository from CTM 3132 the first time
This opens an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright © 1968-2003  The authors of And contributors to UNIX®, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@


1.1.1.2
log
@Import OpenBSD source tree of short before 17:00 UTC today
@
text
@d25 1
a25 1
.\"	$OpenBSD: style.9,v 1.32 2003/04/20 20:04:17 jmc Exp $
d435 2
a436 2
Casts and
.Fn sizeof
@


1.1.1.3
log
@the previous cvs import did not finish due to 'memory fault'
sync with OpenBSD-cvs
@
text
@d25 1
a25 1
.\"	$OpenBSD: style.9,v 1.33 2003/06/29 13:26:04 jmc Exp $
d62 1
a62 1
.Aq Pa sys/*.h )
d64 1
a64 1
.Aq Pa sys/types.h
d66 1
a66 1
.Aq Pa sys/param.h ,
d68 1
a68 1
.Aq Pa sys/types.h
d70 1
a70 1
.Aq Pa sys/cdefs.h ,
d154 1
a154 1
.Aq Pa sys/cdefs.h
@


1.1.1.4
log
@Import OpenBSD source tree again, with critical bug fixes
(OpenSSL, bc, dc, sensorsd, pf, ...)
@
text
@d25 1
a25 1
.\"	$OpenBSD: style.9,v 1.34 2003/09/29 11:29:20 jmc Exp $
d86 2
a87 2
.Pa /usr/include
files.
d89 2
a90 2
.Pa /usr/include
files should be sorted!
@


1.1.1.5
log
@Time to import OpenBSD once again. Expect breakage.
@
text
@d25 1
a25 1
.\"	$OpenBSD: style.9,v 1.35 2003/10/04 11:35:31 jmc Exp $
a614 1
.Pp
a620 5
If numbers are used as options, they should be placed first,
as shown in the example below.
Uppercase letters take precedence over lowercase.
Note that the options list in manual pages should be purely alphabetical.
That is, with no regard to whether an option takes an argument.
d622 1
a622 1
"usage: f [-12aDde] [-b b_arg] [-m m_arg] req1 req2 [opt1 [opt2]]\en"
@


1.1.1.6
log
@large-scale import of OpenBSD 3.5-current source base including many fixes
note: from now, we will not be binary compatible with OpenBSD apps any
longer (due to syscall numbering differences); both an OpenBSD compat and
a conversion tool for old MirOS #7 apps will be delivered later.

The src/ tree is locked from now.
@
text
@d25 1
a25 1
.\"	$OpenBSD: style.9,v 1.38 2004/04/10 09:10:16 jmc Exp $
d44 1
a44 1
.Bd -literal -offset indent
d56 2
a57 2
 * Multi-line comments look like this.  Make them real sentences.
 * Fill them so they look like real paragraphs.
d72 2
a73 2
.Bd -literal -offset indent
#include <sys/types.h>	/* Non-local includes in brackets. */
d77 1
a77 1
.Bd -literal -offset indent
d91 1
a91 1
.Bd -literal -offset indent
d100 1
a100 1
.Bd -literal -offset indent
d104 3
a106 3
Then there's a blank line, and the user include files.
.Bd -literal -offset indent
#include "pathnames.h"	/* Local includes in double quotes. */
d132 2
a133 2
Prototypes should not have variable names associated with the types; i.e.,
.Bd -literal -offset indent
d136 1
d138 1
a138 1
.Bd -literal -offset indent -compact
d144 1
a144 1
.Bd -literal -offset indent
d156 1
a156 1
.Bd -literal -offset indent
d179 4
a182 4
.Bd -literal -offset indent
#define	MACRO(x, y) do {					\e
	variable = (x) + (y);					\e
	(y) += 2;						\e
d187 1
a187 1
.Bd -literal -offset indent
d206 1
a206 1
.Bd -literal -offset indent
d219 1
a219 1
.Bd -literal -offset indent
d240 1
a240 1
.Bd -literal -offset indent
d246 2
a247 1
.Bd -literal -offset indent
d272 19
a290 14
.Bd -literal -offset indent
while ((ch = getopt(argc, argv, "abn:")) != -1)
	switch (ch) {		/* Indent the switch. */
	case 'a':		/* Don't indent the case. */
		aflag = 1;
		/* FALLTHROUGH */
	case 'b':
		bflag = 1;
		break;
	case 'n':
		num = strtol(optarg, &ep, 10);
		if (num <= 0 || *ep != '\e0') {
			warnx("illegal number, -n argument -- %s",
			    optarg);
d292 1
d294 3
a296 8
		break;
	case '?':
	default:
		usage();
		/* NOTREACHED */
	}
argc -= optind;
argv += optind;
d299 1
a299 1
Use a space after keywords
d312 4
a315 12
.Bd -literal -offset indent
for (p = buf; *p != '\e0'; ++p)
	;	/* nothing */
for (;;)
	stmt;
for (;;) {
	z = a + really + long + statement + that + needs +
	    two + lines + gets + indented + four + spaces +
	    on + the + second + and + subsequent + lines;
}
for (;;) {
	if (cond)
d317 9
a325 1
}
d331 5
a335 5
.Bd -literal -offset indent
for (; cnt < 15; cnt++) {
	stmt1;
	stmt2;
}
d340 5
a344 5
.Bd -literal -offset indent
while (cnt < 20)
	z = a + really + long + statement + that + needs +
	    two lines + gets + indented + four + spaces +
	    on + the + second + and + subsequent + lines;
d355 8
a362 8
.Bd -literal -offset indent
if (test)
	stmt;
else if (bar) {
	stmt;
	stmt;
} else
	stmt;
d376 3
a378 3
.Bd -literal -offset indent
if ((error = function(a1, a2)))
	exit(error);
d386 3
a388 3
.Bd -literal -offset indent
a = b->c[0] + ~d == (e || f) || g && h ? i : j >> 1;
k = !(l & FLAGS);
d392 5
a396 5
.Bd -literal -offset indent
exit(0);	/*
		 * Avoid obvious comments such as
		 * "Exit 0 on success."
		 */
d402 1
a402 1
.Bd -literal -offset indent
d408 1
a408 1
When declaring variables in functions, declare them sorted by size (largest to
d413 1
a413 1
If a line overflows, reuse the type keyword.
d419 5
a423 5
.Bd -literal -offset indent
struct foo one, *two;
double three;
int *four, five;
char *six, seven, eight, nine, ten, eleven, twelve;
d425 1
a425 1
four = myfunction();
d428 1
a428 1
Do not declare functions inside other functions: ANSI C says that
d463 1
a463 1
.Bd -literal -offset indent
d467 1
a467 1
If any warnings of this type occur, you must apply the
d469 1
a469 1
type-qualifier to the variable in question.
d481 1
a481 1
.Bd -literal -offset indent
d493 1
a493 1
.Bd -literal -offset indent
d498 1
a498 1
.Bd -literal -offset indent
d505 1
a505 1
.Bd -literal -offset indent
d531 1
a531 1
.Bd -literal -offset indent
d534 1
d536 1
a536 1
.Bd -literal -offset indent -compact
d543 1
a543 1
.Bd -literal -offset indent
d546 1
d548 1
a548 1
.Bd -literal -offset indent -compact
d561 6
a566 6
.Bd -literal -offset indent
if ((four = malloc(sizeof(struct foo))) == NULL)
	err(1, (char *)NULL);
if ((six = (int *)overflow()) == NULL)
	errx(1, "Number overflowed.");
return (eight);
d571 1
a571 1
.Bd -literal -offset indent
d586 1
a586 1
.Bd -literal -offset indent
d627 1
a627 1
.Bd -literal -offset indent
d635 3
a637 3
.Bd -literal -offset indent
(void)fprintf(stderr, "usage: %s [-ab]\en", __progname);
exit(1);
a654 5
.Sh FILES
.Bl -tag -width "/usr/share/misc/license.template " -compact
.It Pa /usr/share/misc/license.template
Example license for new code.
.El
@


