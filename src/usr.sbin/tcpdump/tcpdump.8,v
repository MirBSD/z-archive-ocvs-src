head	1.4;
access;
symbols
	tg-mergetmp-mirosx-1:1.4
	tg-mergefixes-1-branch:1.4.0.4
	tg-mergefixes-1-base:1.4
	MIROS_X:1.4.0.2
	MIROS_X_BASE:1.4
	tg-mergetmp-3:1.4
	MIRBSD_XP_MIRPPC:1.3.0.4
	cvs-200410222040:1.1.1.10
	tg-mergetmp-1:1.1.1.9
	MIRBSD_XP_SPARC_BASE:1.3
	MIRBSD_XP_SPARC:1.3.0.2
	MIRBSD_7quater:1.1.1.7
	cvs-200405160640:1.1.1.9
	cvs-200401271800:1.1.1.8
	cvs-200401261630:1.1.1.8
	cvs-200401021645:1.1.1.8
	MIRBSD_7_ALPHA:1.1.1.7.0.6
	MIRBSD_7:1.1.1.7.0.4
	cvs-200312222040:1.1.1.8
	MIRBSD_7ter:1.1.1.7
	MIRBSD_7_DEV:1.1.1.7.0.2
	cvs-200310020700:1.1.1.7
	cvs-200309271030:1.1.1.7
	cvs-200309251530:1.1.1.7
	cvs-200308302005:1.1.1.6
	cvs-200308171200:1.1.1.5
	ctm-3496:1.1.1.5
	ctm-3449:1.1.1.5
	ctm-3437:1.1.1.5
	cvs-200307191805:1.1.1.5
	ctm-3425:1.1.1.5
	cvs-200307091500:1.1.1.4
	ctm-3389:1.1.1.4
	cvs-200306291430:1.1.1.4
	ctm-3341:1.1.1.4
	MIRBSD_5:1.1.1.3
	cvs-200306082100:1.1.1.3
	ctm-3316:1.1.1.3
	ctm-3272:1.1.1.3
	ctm-3264:1.1.1.2
	cvs-200305071630:1.1.1.2
	MIRBSD_4:1.1.1.2
	ctm-3203:1.1.1.2
	cvs-20030410-1130:1.1.1.2
	ctm-3155:1.1.1.1
	ctm-3132:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@.\" @;


1.4
date	2004.10.22.21.53.51;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2004.05.21.20.08.58;	author tg;	state Stab;
branches;
next	1.2;

1.2
date	2004.01.04.19.54.03;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.22.17.56.05;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.03.22.17.56.05;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.04.10.15.01.44;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2003.05.21.19.28.00;	author tg;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2003.06.19.12.58.00;	author tg;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2003.07.18.14.00.12;	author tg;	state Exp;
branches;
next	1.1.1.6;

1.1.1.6
date	2003.08.31.00.00.10;	author tg;	state Exp;
branches;
next	1.1.1.7;

1.1.1.7
date	2003.09.25.16.46.24;	author tg;	state Exp;
branches;
next	1.1.1.8;

1.1.1.8
date	2003.12.22.21.20.04;	author tg;	state Exp;
branches;
next	1.1.1.9;

1.1.1.9
date	2004.05.16.07.25.14;	author tg;	state Exp;
branches;
next	1.1.1.10;

1.1.1.10
date	2004.10.22.20.52.20;	author tg;	state Exp;
branches;
next	;


desc
@@


1.4
log
@merge; fix; whitespace; bump libc level
XXX untested
@
text
@.\"	$OpenBSD: tcpdump.8,v 1.49 2004/09/16 11:29:51 markus Exp $
.\"
.\" Copyright (c) 1987, 1988, 1989, 1990, 1991, 1992, 1994, 1995, 1996
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that: (1) source code distributions
.\" retain the above copyright notice and this paragraph in its entirety, (2)
.\" distributions including binary code include the above copyright notice and
.\" this paragraph in its entirety in the documentation or other materials
.\" provided with the distribution, and (3) all advertising materials mentioning
.\" features or use of this software display the following acknowledgement:
.\" ``This product includes software developed by the University of California,
.\" Lawrence Berkeley Laboratory and its contributors.'' Neither the name of
.\" the University nor the names of its contributors may be used to endorse
.\" or promote products derived from this software without specific prior
.\" written permission.
.\" THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED
.\" WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
.\"
.Dd May 25, 1999
.Dt TCPDUMP 8
.Os
.Sh NAME
.Nm tcpdump
.Nd dump traffic on a network
.Sh SYNOPSIS
.Nm tcpdump
.Bk -words
.Op Fl adeflnNoOpqStvxX
.Op Fl c Ar count
.Op Fl E Oo Ar espalg: Oc Ar espkey
.Op Fl F Ar file
.Op Fl i Ar interface
.Op Fl r Ar file
.Op Fl s Ar snaplen
.Op Fl T Ar type
.Op Fl w Ar file
.Op Ar expression
.Ek
.Sh DESCRIPTION
.Nm
prints out the headers of packets on a network interface that match the boolean
.Ar expression .
You must have read access to
.Pa /dev/bpf* .
.Pp
The options are as follows:
.Bl -tag -width "-c count"
.It Fl a
Attempt to convert network and broadcast addresses to names.
.It Fl c Ar count
Exit after receiving
.Ar count
packets.
.It Fl d
Dump the compiled packet-matching code in a human readable form to
standard output and stop.
.It Fl dd
Dump packet-matching code as a C program fragment.
.It Fl ddd
Dump packet-matching code as decimal numbers
preceded with a count.
.It Fl e
Print the link-level header on each dump line.
.It Xo
.Fl E Oo Ar espalg: Oc Ar espkey
.Xc
Try to decrypt RFC 2406 ESP
.Pq Encapsulating Security Payload
traffic using the specified hex key
.Ar espkey .
Supported algorithms for
.Ar espalg
are:
.Cm aes128 ,
.Cm aes128-hmac96 ,
.Cm blowfish ,
.Cm blowfish-hmac96 ,
.Cm cast ,
.Cm cast-hmac96 ,
.Cm des3 ,
.Cm des3-hmac96 ,
.Cm des
and
.Cm des-hmac96 .
The algorithm defaults to
.Cm aes128-hmac96 .
This option should be used for debugging only, since the key will show up in
.Xr ps 1
output.
.It Fl f
Print
.Dq foreign
internet addresses numerically rather than symbolically.
This option is intended to get around serious brain damage in
Sun's yp server \(em usually it hangs forever translating non-local
internet numbers.
.It Fl F Ar file
Use
.Ar file
as input for the filter expression.
Any additional expressions given on the command line are ignored.
.It Fl i Ar interface
Listen on
.Ar interface .
If unspecified,
.Nm
searches the system interface list for the lowest numbered, configured
.Dq up
interface
.Pq excluding loopback .
Ties are broken by choosing the earliest match.
.It Fl l
Make stdout line buffered.
Useful if you want to see the data while capturing it.
E.g.,
.Pp
.Dl # tcpdump -l | tee dat
or
.Dl # tcpdump -l > dat & tail -f dat
.It Fl n
Do not convert addresses
.Pq host addresses, port numbers, etc.
to names.
.It Fl N
Do not print domain name qualification of host names.
For example, if you specify this flag then
.Nm
will print
.Dq nic
instead of
.Dq nic.ddn.mil .
.It Fl o
Print a guess of the possible operating system(s) of hosts that sent
TCP SYN packets.
See
.Xr pf.os 5
for a description of the passive operating system fingerprints.
.It Fl O
Do not run the packet-matching code optimizer.
This is useful only if you suspect a bug in the optimizer.
.It Fl p
Do not put the interface into promiscuous mode.
The interface might be in promiscuous mode for some other reason; hence,
.Fl p
cannot be used as an abbreviation for
.Dq ether host \&"{local-hw-addr}\&"
or
.Dq ether broadcast .
.It Fl q
Quick
.Pq quiet?
output.
Print less protocol information so output lines are shorter.
.It Fl r Ar file
Read packets from a
.Ar file
which was created with the
.Fl w
option.
Standard input is used if
.Ar file
is
.Ql - .
.It Fl s Ar snaplen
Analyze at most the first
.Ar snaplen
bytes of data from each packet rather than the default of 96.
96 bytes is adequate for IP, ICMP, TCP, and UDP,
but may truncate protocol information from name server and NFS packets
.Pq see below .
Packets truncated because of a limited
.Ar snaplen
are indicated in the output with
.Dq Op \*(Ba Ns Em proto ,
where
.Em proto
is the name of the protocol level at which the truncation has occurred.
Taking larger snapshots both increases the amount of time it takes
to process packets and, effectively, decreases the amount of packet buffering.
This may cause packets to be lost.
You should limit
.Ar snaplen
to the smallest number that will capture the protocol information
you're interested in.
.It Fl S
Print absolute, rather than relative, TCP sequence numbers.
.It Fl t
Do not print a timestamp on each dump line.
.It Fl tt
Print an unformatted timestamp on each dump line.
.It Fl ttt
Print day and month in timestamp.
.It Fl tttt
Print timestamp difference between packets.
.It Fl ttttt
Print timestamp difference since the first packet.
.It Fl T Ar type
Force packets selected by
.Ar expression
to be interpreted as the specified
.Ar type .
Currently known types are
.Cm vrrp
.Pq Virtual Router Redundancy protocol ,
.Cm cnfp
.Pq Cisco NetFlow protocol ,
.Cm rpc
.Pq Remote Procedure Call ,
.Cm rtp
.Pq Real-Time Applications protocol ,
.Cm rtcp
.Pq Real-Time Applications control protocol ,
.Cm sack
.Pq RFC 2018 TCP Selective Acknowledgements Options ,
.Cm tcp
.Pq Transmission Control Protocol ,
.Cm vat
.Pq Visual Audio Tool ,
and
.Cm wb
.Pq distributed White Board .
.It Fl v
.Pq Slightly more
verbose output.
For example, the time to live
.Pq TTL
and type of service
.Pq ToS
information in an IP packet are printed.
.It Fl vv
Even more verbose output.
For example, additional fields are printed from NFS reply packets.
.It Fl w Ar file
Write the raw packets to
.Ar file
rather than parsing and printing them out.
They can be analyzed later with the
.Fl r
option.
Standard output is used if
.Ar file
is
.Ql - .
.It Fl x
Print each packet
.Pq minus its link-level header
in hex.
The smaller of the entire packet or
.Ar snaplen
bytes will be printed.
.It Fl X
Like
.Fl x
but dumps the packet in emacs-hexl like format.
.El
.Pp
.Ar expression
selects which packets will be dumped.
If no
.Ar expression
is given, all packets on the net will be dumped.
Otherwise, only packets satisfying
.Ar expression
will be dumped.
.Pp
The
.Ar expression
consists of one or more primitives.
Primitives usually consist of an
.Ar id
.Pq name or number
preceded by one or more qualifiers.
There are three different kinds of qualifiers:
.Bl -tag -width "proto"
.It Ar type
Specify which kind of address component the
.Ar id
name or number refers to.
Possible types are
.Cm host ,
.Cm net
and
.Cm port .
E.g.,
.Dq host foo ,
.Dq net 128.3 ,
.Dq port 20 .
If there is no type qualifier,
.Cm host
is assumed.
.It Ar dir
Specify a particular transfer direction to and/or from
.Ar id .
Possible directions are
.Cm src ,
.Cm dst ,
.Cm src or dst ,
and
.Cm src and dst .
E.g.,
.Dq src foo ,
.Dq dst net 128.3 ,
.Dq src or dst port ftp-data .
If there is no
.Ar dir
qualifier,
.Cm src or dst
is assumed.
For null link layers (i.e., point-to-point protocols such as SLIP
.Pq Serial Line Internet Protocol
or the
.Xr pflog 4
header), the
.Cm inbound
and
.Cm outbound
qualifiers can be used to specify a desired direction.
.It Ar proto
Restrict the match to a particular protocol.
Possible protocols are:
.Cm arp ,
.Cm decnet ,
.Cm ether ,
.Cm fddi ,
.Cm ip ,
.Cm lat ,
.Cm mopdl ,
.Cm moprc ,
.Cm rarp ,
.Cm tcp ,
and
.Cm udp .
E.g.,
.Dq ether src foo ,
.Dq arp net 128.3 ,
.Dq tcp port 21 .
If there is no protocol qualifier,
all protocols consistent with the type are assumed.
E.g.,
.Dq src foo
means
.Do
.Pq ip or arp or rarp
src foo
.Dc
.Pq except the latter is not legal syntax ;
.Dq net bar
means
.Do
.Pq ip or arp or rarp
net bar
.Dc ;
and
.Dq port 53
means
.Do
.Pq TCP or UDP
port 53
.Dc .
.Pp
.Cm fddi
is actually an alias for
.Cm ether ;
the parser treats them identically as meaning
.Qo
the data link level used on the specified network interface
.Qc .
FDDI
.Pq Fiber Distributed Data Interface
headers contain Ethernet-like source and destination addresses,
and often contain Ethernet-like packet types,
so you can filter on these FDDI fields just as with the analogous
Ethernet fields.
FDDI headers also contain other fields,
but you cannot name them explicitly in a filter expression.
.El
.Pp
In addition to the above, there are some special primitive
keywords that don't follow the pattern:
.Cm gateway ,
.Cm broadcast ,
.Cm less ,
.Cm greater ,
and arithmetic expressions.
All of these are described below.
.Pp
More complex filter expressions are built up by using the words
.Cm and ,
.Cm or ,
and
.Cm not
to combine primitives
e.g.,
.Do
host foo and not port ftp and not port ftp-data
.Dc .
To save typing, identical qualifier lists can be omitted
e.g.,
.Dq tcp dst port ftp or ftp-data or domain
is exactly the same as
.Do
tcp dst port ftp or tcp dst port ftp-data or tcp dst port domain
.Dc .
.Pp
Allowable primitives are:
.Bl -tag -width "ether proto proto"
.It Cm dst host Ar host
True if the IP destination field of the packet is
.Ar host ,
which may be either an address or a name.
.It Cm src host Ar host
True if the IP source field of the packet is
.Ar host .
.It Cm host Ar host
True if either the IP source or destination of the packet is
.Ar host .
.Pp
Any of the above
.Ar host
expressions can be prepended with the keywords,
.Cm ip ,
.Cm arp ,
or
.Cm rarp
as in:
.Pp
.D1 Cm ip host Ar host
.Pp
which is equivalent to:
.Bd -ragged -offset indent
.Cm ether proto
.Ar ip
.Cm and host
.Ar host
.Ed
.Pp
If
.Ar host
is a name with multiple IP addresses, each address will be checked for a match.
.It Cm ether dst Ar ehost
True if the Ethernet destination address is
.Ar ehost .
.Ar ehost
may be either a name from
.Pa /etc/ethers
or a number (see
.Xr ethers 3
for a numeric format).
.It Cm ether src Ar ehost
True if the Ethernet source address is
.Ar ehost .
.It Cm ether host Ar ehost
True if either the Ethernet source or destination address is
.Ar ehost .
.It Cm gateway Ar host
True if the packet used
.Ar host
as a gateway; i.e., the Ethernet source or destination address was
.Ar host
but neither the IP source nor the IP destination was
.Ar host .
.Ar host
must be a name and must be found in both
.Pa /etc/hosts
and
.Pa /etc/ethers .
An equivalent expression is
.Bd -ragged -offset indent
.Cm ether host
.Ar ehost
.Cm and not host
.Ar host
.Ed
.Pp
which can be used with either names or numbers for
.Ar host Ns / Ns Ar ehost .
.It Cm dst net Ar net
True if the IP destination address of the packet has a network number of
.Ar net .
.Ar net
may be either a name from
.Pa /etc/networks
or a network number (see
.Xr networks 5
for details).
.It Cm src net Ar net
True if the IP source address of the packet has a network number of
.Ar net .
.It Cm net Ar net
True if either the IP source or destination address of the packet
has a network number of
.Ar net .
.It Cm dst port Ar port
True if the packet is IP/TCP or IP/UDP and has a destination port value of
.Ar port .
The
.Ar port
can be a number or a name used in
.Pa /etc/services
(see
.Xr tcp 4
and
.Xr udp 4 ) .
If a name is used, both the port number and protocol are checked.
If a number or ambiguous name is used, only the port number is checked;
e.g.,
.Dq Cm dst port No 513
will print both TCP/login traffic and UDP/who traffic, and
.Dq Cm dst port No domain
will print both TCP/domain and UDP/domain traffic.
.It Cm src port Ar port
True if the packet has a source port value of
.Ar port .
.It Cm port Ar port
True if either the source or destination port of the packet is
.Ar port .
.Pp
Any of the above port expressions can be prepended with the keywords
.Cm tcp
or
.Cm udp ,
as in:
.Pp
.D1 Cm tcp src port Ar port
.Pp
which matches only TCP packets whose source port is
.Ar port .
.It Cm less Ar length
True if the packet has a length less than or equal to
.Ar length .
This is equivalent to:
.Pp
.D1 Cm len <= Ar length
.Pp
.It Cm greater Ar length
True if the packet has a length greater than or equal to
.Ar length .
This is equivalent to:
.Pp
.D1 Cm len >= Ar length
.Pp
.It Cm ip proto Ar proto
True if the packet is an IP packet (see
.Xr ip 4 )
of protocol type
.Ar proto .
.Ar proto
can be a number or one of the names
.Cm icmp ,
.Cm udp ,
.Cm nd ,
or
.Cm tcp .
The identifiers
.Cm tcp ,
.Cm udp ,
and
.Cm icmp
are also shell keywords and must be escaped.
.It Cm ether broadcast
True if the packet is an Ethernet broadcast packet.
The
.Cm ether
keyword is optional.
.It Cm ip broadcast
True if the packet is an IP broadcast packet.
It checks for both the all-zeroes and all-ones broadcast conventions
and looks up the local subnet mask.
.It Cm ether multicast
True if the packet is an Ethernet multicast packet.
The
.Cm ether
keyword is optional.
This is shorthand for
.Do
.Cm ether Ns [0] & 1 != 0
.Dc .
.It Cm ip multicast
True if the packet is an IP multicast packet.
.It Cm ether proto Ar proto
True if the packet is of ether type
.Ar proto .
.Ar proto
can be a number or a name like
.Cm ip ,
.Cm arp ,
or
.Cm rarp .
These identifiers are also shell keywords and must be escaped.
In the case of FDDI (e.g.,
.Dq Cm fddi protocol arp ) ,
the protocol identification comes from the 802.2 Logical Link Control
.Pq LLC
header, which is usually layered on top of the FDDI header.
.Nm
assumes, when filtering on the protocol identifier, that all FDDI packets
include an LLC header, and that the LLC header is in so-called SNAP format.
.It Cm decnet src Ar host
True if the
.Tn DECNET
source address is
.Ar host ,
which may be an address of the form
.Dq 10.123 ,
or a
.Tn DECNET
host name.
.Tn DECNET
host name support is only available on systems that are configured to run
.Tn DECNET .
.It Cm decnet dst Ar host
True if the
.Tn DECNET
destination address is
.Ar host .
.It Cm decnet host Ar host
True if either the
.Tn DECNET
source or destination address is
.Ar host .
.It Cm ifname Ar interface
True if the packet was logged as coming from the specified interface
(applies only to packets logged by
.Xr pf 4 ) .
.It Cm on Ar interface
Synonymous with the
.Ar ifname
modifier.
.It Cm rnr Ar num
True if the packet was logged as matching the specified PF rule number
in the main ruleset (applies only to packets logged by
.Xr pf 4 ) .
.It Cm rulenum Ar num
Synonymous with the
.Ar rnr
modifier.
.It Cm reason Ar code
True if the packet was logged with the specified PF reason code.
The known codes are:
.Ar match ,
.Ar bad-offset ,
.Ar fragment ,
.Ar bad-timestamp ,
.Ar short ,
.Ar normalize ,
and
.Ar memory
(applies only to packets logged by
.Xr pf 4 ) .
.It Cm rset Ar name
True if the packet was logged as matching the specified PF ruleset
name of an anchored ruleset (applies only to packets logged by
.Xr pf 4 ) .
.It Cm ruleset Ar name
Synonymous with the
.Ar rset
modifier.
.It Cm srnr Ar num
True if the packet was logged as matching the specified PF rule number
of an anchored ruleset (applies only to packets logged by
.Xr pf 4 ) .
.It Cm subrulenum Ar num
Synonymous with the
.Ar srnr
modifier.
.It Cm action Ar act
True if PF took the specified action when the packet was logged.
Known actions are:
.Ar pass ,
and
.Ar block
(applies only to packets logged by
.Xr pf 4 ) .
.It Xo Cm ip ,
.Cm arp ,
.Cm rarp ,
.Cm decnet ,
.Cm lat ,
.Cm moprc ,
.Cm mopdl
.Xc
Abbreviations for:
.Pp
.D1 Cm ether proto Ar p
.Pp
where
.Ar p
is one of the above protocols.
.Nm
does not currently know how to parse
.Cm lat ,
.Cm moprc ,
or
.Cm mopdl .
.It Cm tcp , udp , icmp
Abbreviations for:
.Cm ip proto Ar p
where
.Ar p
is one of the above protocols.
.It Ar expr relop expr
True if the relation holds, where
.Ar relop
is one of
.Ql > ,
.Ql < ,
.Ql >= ,
.Ql <= ,
.Ql = ,
.Ql != ,
and
.Ar expr
is an arithmetic expression composed of integer constants
.Pq expressed in standard C syntax ,
the normal binary operators
.Pf ( Ns Ql + ,
.Ql - ,
.Ql * ,
.Ql / ,
.Ql & ,
.Ql | ) ,
a length operator, and special packet data accessors.
To access data inside the packet, use the following syntax:
.Sm off
.Bd -ragged -offset indent
.Ar proto Op Ar expr : Ar size
.Ed
.Sm on
.Pp
.Ar proto
is one of
.Cm ether ,
.Cm fddi ,
.Cm ip ,
.Cm arp ,
.Cm rarp ,
.Cm tcp ,
.Cm udp ,
or
.Cm icmp ,
and indicates the protocol layer for the index operation.
The byte offset, relative to the indicated protocol layer, is given by
.Ar expr .
.Ar size
is optional and indicates the number of bytes in the field of interest;
it can be either one, two, or four, and defaults to one.
The length operator, indicated by the keyword
.Cm len ,
gives the length of the packet.
.Pp
For example,
.Dq Cm ether Ns [0] & 1 != 0
catches all multicast traffic.
The expression
.Dq Cm ip Ns [0] & 0xf != 5
catches all IP packets with options.
The expression
.Dq Cm ip Ns [6:2] & 0x1fff = 0
catches only unfragmented datagrams and frag zero of fragmented datagrams.
This check is implicitly applied to the
.Cm tcp
and
.Cm udp
index operations.
For instance,
.Dq Cm tcp Ns [0]
always means the first byte of the TCP header,
and never means the first byte of an intervening fragment.
.El
.Pp
Primitives may be combined using a parenthesized group of primitives and
operators.
Parentheses are special to the shell and must be escaped.
Allowable primitives and operators are:
.Bd -ragged -offset indent
Negation
.Po
.Dq Cm \&!
or
.Dq Cm not
.Pc

Concatenation
.Po
.Dq Cm &&
or
.Dq Cm and
.Pc

Alternation
.Po
.Dq Cm ||
or
.Dq Cm or
.Pc
.Ed
.Pp
Negation has highest precedence.
Alternation and concatenation have equal precedence and associate left to right.
Explicit
.Cm and
tokens, not juxtaposition,
are now required for concatenation.
.Pp
If an identifier is given without a keyword, the most recent keyword is assumed.
For example,
.Bd -ragged -offset indent
.Cm not host
vs
.Cm and
ace
.Ed
.Pp
is short for
.Bd -ragged -offset indent
.Cm not host
vs
.Cm and host
ace
.Ed
.Pp
which should not be confused with
.Bd -ragged -offset indent
.Cm not
.Pq Cm host No vs Cm or No ace
.Ed
.Pp
Expression arguments can be passed to
.Nm
as either a single argument or as multiple arguments,
whichever is more convenient.
Generally, if the expression contains shell metacharacters,
it is easier to pass it as a single, quoted argument.
Multiple arguments are concatenated with spaces before being parsed.
.Sh EXAMPLES
To print all packets arriving at or departing from sundown:
.Pp
.Dl # tcpdump host sundown
.Pp
To print traffic between helios and either hot or ace
(the expression is quoted to prevent the shell from mis-interpreting
the parentheses):
.Pp
.Dl # tcpdump 'host helios and (hot or ace)'
.Pp
To print all IP packets between ace and any host except helios:
.Pp
.Dl # tcpdump ip host ace and not helios
.Pp
To print all traffic between local hosts and hosts at Berkeley:
.Pp
.Dl # tcpdump net ucb-ether
.Pp
To print all FTP traffic through internet gateway snup:
.Pp
.Dl # tcpdump 'gateway snup and (port ftp or ftp-data)'
.Pp
To print traffic neither sourced from nor destined for local hosts
(if you gateway to one other net, this stuff should never make it onto
your local net):
.Pp
.Dl # tcpdump ip and not net localnet
.Pp
To print the start and end packets
.Pq the SYN and FIN packets
of each TCP connection that involves a non-local host:
.Bd -literal -offset indent
# tcpdump 'tcp[13] & 3 != 0 and not src and dst net localnet'
.Ed
.Pp
To print IP packets longer than 576 bytes sent through gateway snup:
.Pp
.Dl # tcpdump 'gateway snup and ip[2:2] > 576'
.Pp
To print IP broadcast or multicast packets that were
.Em not
sent via Ethernet broadcast or multicast:
.Bd -literal -offset indent
# tcpdump 'ether[0] & 1 = 0 and ip[16] >= 224'
.Ed
.Pp
To print all ICMP packets that are not echo requests/replies
.Pq i.e., not ping packets :
.Pp
.Dl # tcpdump 'icmp[0] != 8 and icmp[0] != 0'
.Pp
To print and decrypt all ESP packets with SPI 0x00001234:
.Pp
.Dl # tcpdump -E des3-hmac96:ab...def 'ip[20:4] = 0x00001234'
.Sh OUTPUT FORMAT
The output of
.Nm
is protocol dependent.
The following gives a brief description and examples of most of the formats.
.Ss Link Level Headers
If the
.Fl e
option is given, the link level header is printed out.
On Ethernets, the source and destination addresses, protocol,
and packet length are printed.
.Pp
On the packet filter logging interface
.Xr pflog 4 ,
logging reason
.Pq rule match, bad-offset, fragment, short, normalize, memory ,
action taken
.Pq pass/block ,
direction
.Pq in/out
and interface information are printed out for each packet.
.Pp
On FDDI networks, the
.Fl e
option causes
.Nm
to print the frame control field, the source and destination addresses,
and the packet length.
The frame control field governs the interpretation of the rest of the packet.
Normal packets
.Pq such as those containing IP datagrams
are
.Dq async
packets, with a priority value between 0 and 7; for example,
.Sy async4 .
Such packets are assumed to contain an 802.2 Logical Link Control
.Pq LLC
packet; the LLC header is printed if it is
.Em not
an ISO datagram or a so-called SNAP packet.
.Pp
The following description assumes familiarity with the
SLIP compression algorithm described in RFC 1144.
.Pp
On SLIP links, a direction indicator
.Po
.Ql I
for inbound,
.Ql O
for outbound
.Pc ,
packet type, and compression information are printed out.
The packet type is printed first.
The three types are
.Cm ip ,
.Cm utcp ,
and
.Cm ctcp .
No further link information is printed for IP packets.
For TCP packets, the connection identifier is printed following the type.
If the packet is compressed, its encoded header is printed out.
The special cases are printed out as
.Cm *S+ Ns Ar n
and
.Cm *SA+ Ns Ar n ,
where
.Ar n
is the amount by which the sequence number
.Pq or sequence number and ack
has changed.
If it is not a special case, zero or more changes are printed.
A change is indicated by
.Sq U
.Pq urgent pointer ,
.Sq W
.Pq window ,
.Sq A
.Pq ack ,
.Sq S
.Pq sequence number ,
and
.Sq I
.Pq packet ID ,
followed by a delta
.Pq +n or -n ,
or a new value
.Pq =n .
Finally, the amount of data in the packet and compressed header length
are printed.
.Pp
For example, the following line shows an outbound compressed TCP packet,
with an implicit connection identifier; the ack has changed by 6,
the sequence number by 49, and the packet ID by 6;
there are 3 bytes of data and 6 bytes of compressed header:
.Bd -ragged -offset indent
O
.Cm ctcp No *
.Cm A No +6
.Cm S No +49
.Cm I No +6 3
.Pq 6
.Ed
.Ss ARP/RARP Packets
arp/rarp output shows the type of request and its arguments.
The format is intended to be self-explanatory.
Here is a short sample taken from the start of an rlogin
from host rtsg to host csam:
.Bd -literal -offset indent
arp who-has csam tell rtsg
arp reply csam is-at CSAM
.Ed
.Pp
In this example, Ethernet addresses are in caps and internet addresses
in lower case.
The first line says that rtsg sent an arp packet asking for
the Ethernet address of internet host csam.
csam replies with its Ethernet address CSAM.
.Pp
This would look less redundant if we had done
.Nm
.Fl n :
.Bd -literal -offset indent
arp who-has 128.3.254.6 tell 128.3.254.68
arp reply 128.3.254.6 is-at 02:07:01:00:01:c4
.Ed
.Pp
If we had done
.Nm
.Fl e ,
the fact that the first packet is
broadcast and the second is point-to-point would be visible:
.Bd -literal -offset indent
RTSG Broadcast 0806 64: arp who-has csam tell rtsg
CSAM RTSG 0806 64: arp reply csam is-at CSAM
.Ed
.Pp
For the first packet this says the Ethernet source address is RTSG,
the destination is the Ethernet broadcast address,
the type field contained hex 0806 (type
.Dv ETHER_ARP )
and the total length was 64 bytes.
.Ss TCP Packets
The following description assumes familiarity with the TCP protocol
described in RFC 793.
If you are not familiar with the protocol, neither this description nor
.Nm
will be of much use to you.
.Pp
The general format of a TCP protocol line is:
.Bd -ragged -offset indent
.Ar src No > Ar dst :
.Ar flags src-os data-seqno ack window urgent options
.Ed
.Pp
.Ar src
and
.Ar dst
are the source and destination IP addresses and ports.
.Ar flags
is some combination of
.Sq S
.Pq Tn SYN ,
.Sq F
.Pq Tn FIN ,
.Sq P
.Pq Tn PUSH ,
or
.Sq R
.Pq Tn RST ,
.Sq W
.Pq Tn congestion Window reduced ,
.Sq E
.Pq Tn ecn ECHO
or a single
.Ql \&.
.Pq no flags .
.Ar src-os
will list a guess of the source host's operating system if the
.Fl o
command line flag was passed to
.Nm tcpdump .
.Ar data-seqno
describes the portion of sequence space covered
by the data in this packet
.Pq see example below .
.Ar ack
is the sequence number of the next data expected by the other
end of this connection.
.Ar window
is the number of bytes of receive buffer space available
at the other end of this connection.
.Ar urg
indicates there is urgent data in the packet.
.Ar options
are TCP options enclosed in angle brackets e.g.,
.Aq mss 1024 .
.Pp
.Ar src , dst
and
.Ar flags
are always present.
The other fields depend on the contents of the packet's TCP protocol header and
are output only if appropriate.
.Pp
Here is the opening portion of an rlogin from host rtsg to host csam.
.Bd -unfilled -offset 2n
rtsg.1023 > csam.login: S 768512:768512(0) win 4096 <mss 1024>
csam.login > rtsg.1023: S 947648:947648(0) ack 768513 win 4096 <mss 1024>
rtsg.1023 > csam.login: . ack 1 win 4096
rtsg.1023 > csam.login: P 1:2(1) ack 1 win 4096
csam.login > rtsg.1023: . ack 2 win 4096
rtsg.1023 > csam.login: P 2:21(19) ack 1 win 4096
csam.login > rtsg.1023: P 1:2(1) ack 21 win 4077
csam.login > rtsg.1023: P 2:3(1) ack 21 win 4077 urg 1
csam.login > rtsg.1023: P 3:4(1) ack 21 win 4077 urg 1
.Ed
.Pp
The first line says that TCP port 1023 on rtsg sent a packet
to port login on host csam.
The
.Ql S
indicates that the SYN flag was set.
The packet sequence number was 768512 and it contained no data.
The notation is
.Sm off
.So
.Ar first : last
.Po Ar nbytes
.Pc
.Sc
.Sm on
which means sequence numbers
.Ar first
up to but not including
.Ar last
which is
.Ar nbytes
bytes of user data.
There was no piggy-backed ack, the available receive window was 4096
bytes and there was a max-segment-size option requesting an mss of 1024 bytes.
.Pp
Csam replies with a similar packet except it includes a piggy-backed
ack for rtsg's SYN.
Rtsg then acks csam's SYN.
The
.Ql \&.
means no flags were set.
The packet contained no data so there is no data sequence number.
The ack sequence number is a 32-bit integer.
The first time
.Nm
sees a TCP connection, it prints the sequence number from the packet.
On subsequent packets of the connection, the difference between
the current packet's sequence number and this initial sequence number
is printed.
This means that sequence numbers after the first can be interpreted
as relative byte positions in the connection's data stream
.Po
with the first data byte each direction being 1
.Pc .
.Fl S
will override this
feature, causing the original sequence numbers to be output.
.Pp
On the 6th line, rtsg sends csam 19 bytes of data
.Po
bytes 2 through 20
in the rtsg -> csam side of the connection
.Pc .
The PUSH flag is set in the packet.
On the 7th line, csam says it's received data sent by rtsg up to
but not including byte 21.
Most of this data is apparently sitting in the socket buffer
since csam's receive window has gotten 19 bytes smaller.
Csam also sends one byte of data to rtsg in this packet.
On the 8th and 9th lines,
csam sends two bytes of urgent, pushed data to rtsg.
.Ss UDP Packets
UDP format is illustrated by this rwho packet:
.Pp
.D1 actinide.who > broadcast.who: udp 84
.Pp
This says that port who on host actinide sent a UDP datagram to port
who on host broadcast, the Internet broadcast address.
The packet contained 84 bytes of user data.
.Pp
Some UDP services are recognized
.Pq from the source or destination port number
and the higher level protocol information printed.
In particular, Domain Name service requests
.Pq RFC 1034/1035
and Sun RPC calls
.Pq RFC 1050
to NFS.
.Ss UDP Name Server Requests
The following description assumes familiarity with
the Domain Service protocol described in RFC 1035.
If you are not familiar with the protocol,
the following description will appear to be written in Greek.
.Pp
Name server requests are formatted as
.Bd -ragged -offset indent
.Ar src
>
.Ar dst :
.Ar id op Ns \&?
.Ar flags qtype qclass name
.Pq Ar len
.Ed
.Pp
e.g.,
.Pp
.D1 h2opolo.1538 > helios.domain: 3+ A? ucbvax.berkeley.edu. (37)
.Pp
Host h2opolo asked the domain server on helios for an address record
.Pq Ar qtype Ns =A
associated with the name
ucbvax.berkeley.edu.
The query
.Ar id
was 3.
The
.Ql +
indicates the recursion desired flag was set.
The query length was 37 bytes, not including the UDP and IP protocol headers.
The query operation was the normal one
.Pq Query
so the
.Ar op
field was omitted.
If
.Ar op
had been anything else, it would have been printed between the 3 and the
.Ql + .
Similarly, the
.Ar qclass
was the normal one
.Pq Tn C_IN
and was omitted.
Any other
.Ar qclass
would have been printed immediately after the A.
.Pp
A few anomalies are checked and may result in extra fields enclosed in
square brackets: if a query contains an answer, name server or
authority section,
.Ar ancount ,
.Ar nscount ,
or
.Ar arcount
are printed as
.Dq Bq Ar n Ns a ,
.Dq Bq Ar n Ns n ,
or
.Dq Bq Ar n Ns au
where
.Ar n
is the appropriate count.
If any of the response bits are set
.Po
AA, RA or rcode
.Pc
or any of the
.Dq must be zero
bits are set in bytes two and three,
.Dq Bq b2&3= Ns Ar x
is printed, where
.Ar x
is the hex value of header bytes two and three.
.Ss UDP Name Server Responses
Name server responses are formatted as
.Bd -ragged -offset indent
.Ar src No > Ar dst :
.Ar id op rcode flags
.Ar a
/
.Ar n
/
.Ar au
.Ar type class data
.Pq Ar len
.Ed
.Pp
e.g.,
.Bd -unfilled -offset indent
helios.domain > h2opolo.1538: 3 3/3/7 A 128.32.137.3 (273)
helios.domain > h2opolo.1537: 2 NXDomain* 0/1/0 (97)
.Ed
.Pp
In the first example, helios responds to query
.Ar id
3 from h2opolo
with 3 answer records, 3 name server records and 7 authority records.
The first answer record is type A
.Pq address and its data is internet
address 128.32.137.3.
The total size of the response was 273 bytes, excluding UDP and IP headers.
The
.Ar op
.Pq Query
and
.Ar rcode
.Pq NoError
were omitted, as was the
.Ar class
.Pq C_IN
of the A record.
.Pp
In the second example, helios responds to query
.Ar op
2 with an
.Ar rcode
of non-existent domain
.Pq NXDomain
with no answers,
one name server and no authority records.
The
.Ql *
indicates that the authoritative answer bit was set.
Since there were no answers, no
.Ar type ,
.Ar class
or
.Ar data
were printed.
.Pp
Other flag characters that might appear are
.Sq -
(recursion available, RA,
.Em not
set)
and
.Sq \*(Ba
.Pq truncated message, TC, set .
If the question section doesn't contain exactly one entry,
.Dq Bq Ar n Ns q
is printed.
.Pp
Name server requests and responses tend to be large and the default
.Ar snaplen
of 96 bytes may not capture enough of the packet to print.
Use the
.Fl s
flag to increase the
.Ar snaplen
if you need to seriously investigate name server traffic.
.Dq Fl s No 128
has worked well for me.
.Ss NFS Requests and Replies
Sun NFS
.Pq Network File System
requests and replies are printed as:
.Bd -ragged -offset indent
.Ar src Ns . Ns Ar xid
>
.Ar dst Ns . Ns Ar nfs :
.Ns Ar len
.Ns Ar op args

.Ar src Ns . Ns Ar nfs
>
.Ar dst Ns . Ns Ar xid :
.Ns Ar reply stat len op results
.Ed
.Bd -unfilled -offset indent
sushi.6709 > wrl.nfs: 112 readlink fh 21,24/10.73165
wrl.nfs > sushi.6709: reply ok 40 readlink "../var"
sushi.201b > wrl.nfs:
	144 lookup fh 9,74/4096.6878 "xcolors"
wrl.nfs > sushi.201b:
	reply ok 128 lookup fh 9,74/4134.3150
.Ed
.Pp
In the first line, host sushi sends a transaction with ID 6709 to wrl.
The number following the src host is a transaction ID,
.Em not
the source port.
The request was 112 bytes, excluding the UDP and IP headers.
The
.Ar op
was a readlink
.Pq read symbolic link
on fh
.Pq Dq file handle
21,24/10.731657119.
If one is lucky, as in this case, the file handle can be interpreted
as a major,minor device number pair, followed by the inode number and
generation number.
Wrl replies with a
.Ar stat
of ok and the contents of the link.
.Pp
In the third line, sushi asks wrl to look up the name
.Dq xcolors
in directory file 9,74/4096.6878.
The data printed depends on the operation type.
The format is intended to be self-explanatory
if read in conjunction with an NFS protocol spec.
.Pp
If the
.Fl v
.Pq verbose
flag is given, additional information is printed.
For example:
.Bd -unfilled -offset indent
sushi.1372a > wrl.nfs:
	148 read fh 21,11/12.195 8192 bytes @@ 24576
wrl.nfs > sushi.1372a:
	reply ok 1472 read REG 100664 ids 417/0 sz 29388
.Ed
.Pp
.Fl v
also prints the IP header TTL, ID, and fragmentation fields,
which have been omitted from this example.
In the first line, sushi asks wrl to read 8192 bytes from file 21,11/12.195,
at byte offset 24576.
Wrl replies with a
.Ar stat of
ok;
the packet shown on the second line is the first fragment of the reply,
and hence is only 1472 bytes long.
The other bytes will follow in subsequent fragments,
but these fragments do not have NFS or even UDP headers and so might not be
printed, depending on the filter expression used.
Because the
.Fl v
flag is given, some of the file attributes
.Po
which are returned in addition to the file data
.Pc
are printed: the file type
.Pq So REG Sc , No for regular file ,
the file mode
.Pq in octal ,
the UID and GID, and the file size.
.Pp
If the
.Fl v
flag is given more than once, even more details are printed.
.Pp
NFS requests are very large and much of the detail won't be printed unless
.Ar snaplen
is increased.
Try using
.Dq Fl s No 192
to watch NFS traffic.
.Pp
NFS reply packets do not explicitly identify the RPC operation.
Instead,
.Nm
keeps track of
.Dq recent
requests, and matches them to the replies using the
.Ar xid
.Pq transaction ID .
If a reply does not closely follow the corresponding request,
it might not be parsable.
.Ss KIP AppleTalk (DDP in UDP)
AppleTalk DDP packets encapsulated in UDP datagrams
are de-encapsulated and dumped as DDP packets
.Pq i.e., all the UDP header information is discarded .
The file
.Pa /etc/atalk.names
is used to translate AppleTalk net and node numbers to names.
Lines in this file have the form
.Bl -column "number" "name" -offset indent
.It Sy "number" Ta Ta Sy "name"
.It "1.254" Ta Ta "ether"
.It "16.1" Ta Ta "icsd-net"
.It "1.254.110" Ta Ta "ace"
.El
.Pp
The first two lines give the names of AppleTalk networks.
The third line gives the name of a particular host
(a host is distinguished from a net by the 3rd octet in the number;
a net number
.Em must
have two octets and a host number
.Em must
have three octets).
The number and name should be separated by whitespace (blanks or tabs).
The
.Pa /etc/atalk.names
file may contain blank lines or comment lines
(lines starting with a
.Ql # ) .
.Pp
AppleTalk addresses are printed in the form
.Bd -ragged -offset indent
.Ar net Ns . Ns Ar host Ns .
.Ns Ar port
.Ed
.Pp
e.g.,
.Bd -unfilled -offset indent
144.1.209.2 > icsd-net.112.220
office.2 > icsd-net.112.220
jssmag.149.235 > icsd-net.2
.Ed
.Pp
If
.Pa /etc/atalk.names
doesn't exist or doesn't contain an entry for some AppleTalk
host/net number, addresses are printed in numeric form.
In the first example, NBP
.Pq DDP port 2
on net 144.1 node 209
is sending to whatever is listening on port 220 of net icsd-net node 112.
The second line is the same except the full name of the source node is known
.Pq Dq office .
The third line is a send from port 235 on
net jssmag node 149 to broadcast on the icsd-net NBP port.
The broadcast address
.Pq 255
is indicated by a net name with no host number;
for this reason it is a good idea to keep node names and net names distinct in
.Pa /etc/atalk.names .
.Pp
NBP
.Pq name binding protocol
and ATP
.Pq AppleTalk transaction protocol
packets have their contents interpreted.
Other protocols just dump the protocol name
.Po
or number if no name is registered for the protocol
.Pc
and packet size.
.Pp
NBP packets are formatted like the following examples:
.Bd -unfilled
icsd-net.112.220 > jssmag.2: nbp-lkup 190: "=:LaserWriter@@*"
jssmag.209.2 > icsd-net.112.220: nbp-reply 190: "RM1140:LaserWriter@@*" 250
techpit.2 > icsd-net.112.220: nbp-reply 190: "techpit:LaserWriter@@*" 186
.Ed
.Pp
The first line is a name lookup request for laserwriters sent by
net icsdi-net host
112 and broadcast on net jssmag.
The nbp ID for the lookup is 190.
The second line shows a reply for this request
.Pq note that it has the same ID
from host jssmag.209 saying that it has a laserwriter
resource named RM1140 registered on port 250.
The third line is another reply to the same request
saying host techpit has laserwriter techpit registered on port 186.
.Pp
ATP packet formatting is demonstrated by the following example:
.Bd -unfilled -offset indent
jssmag.209.165 > helios.132: atp-req  12266<0-7> 0xae030001
helios.132 > jssmag.209.165: atp-resp 12266:0 (512) 0xae040000
helios.132 > jssmag.209.165: atp-resp 12266:1 (512) 0xae040000
helios.132 > jssmag.209.165: atp-resp 12266:2 (512) 0xae040000
helios.132 > jssmag.209.165: atp-resp 12266:3 (512) 0xae040000
helios.132 > jssmag.209.165: atp-resp 12266:4 (512) 0xae040000
helios.132 > jssmag.209.165: atp-resp 12266:5 (512) 0xae040000
helios.132 > jssmag.209.165: atp-resp 12266:6 (512) 0xae040000
helios.132 > jssmag.209.165: atp-resp*12266:7 (512) 0xae040000
jssmag.209.165 > helios.132: atp-req  12266<3,5> 0xae030001
helios.132 > jssmag.209.165: atp-resp 12266:3 (512) 0xae040000
helios.132 > jssmag.209.165: atp-resp 12266:5 (512) 0xae040000
jssmag.209.165 > helios.132: atp-rel  12266<0-7> 0xae030001
jssmag.209.133 > helios.132: atp-req* 12267<0-7> 0xae030002
.Ed
.Pp
Jssmag.209 initiates transaction ID 12266 with host helios by requesting
up to 8 packets
.Sm off
.Pq the Dq Aq 0\-7 .
.Sm on
The hex number at the end of the line is the value of the
.Ar userdata
field in the request.
.Pp
Helios responds with 8 512-byte packets.
The
.Dq : Ns Ar n
following the
transaction ID gives the packet sequence number in the transaction
and the number in parentheses is the amount of data in the packet,
excluding the ATP header.
The
.Ql *
on packet 7 indicates that the EOM bit was set.
.Pp
Jssmag.209 then requests that packets 3 & 5 be retransmitted.
Helios resends them then jssmag.209 releases the transaction.
Finally, jssmag.209 initiates the next request.
The
.Ql *
on the request indicates that XO
.Pq exactly once
was
.Em not
set.
.Ss IP Fragmentation
Fragmented Internet datagrams are printed as
.Bd -ragged -offset indent
.Po
.Cm frag Ar id
:
.Ar size
@@
.Ar offset
.Op +
.Pc
.Ed
.Pp
A
.Ql +
indicates there are more fragments.
The last fragment will have no
.Ql + .
.Pp
.Ar id
is the fragment ID.
.Ar size
is the fragment size
.Pq in bytes
excluding the IP header.
.Ar offset
is this fragment's offset
.Pq in bytes
in the original datagram.
.Pp
The fragment information is output for each fragment.
The first fragment contains the higher level protocol header and the fragment
info is printed after the protocol info.
Fragments after the first contain no higher level protocol header and the
fragment info is printed after the source and destination addresses.
For example, here is part of an FTP from arizona.edu to lbl-rtsg.arpa
over a CSNET connection that doesn't appear to handle 576 byte datagrams:
.Bd -unfilled -offset indent
arizona.ftp-data > rtsg.1170: . 1024:1332(308) ack 1 win 4096 (frag 595a:328@@0+)
arizona > rtsg: (frag 595a:204@@328)
rtsg.1170 > arizona.ftp-data: . ack 1536 win 2560
.Ed
.Pp
There are a couple of things to note here: first, addresses in the
2nd line don't include port numbers.
This is because the TCP protocol information is all in the first fragment
and we have no idea what the port or sequence numbers are when we print
the later fragments.
Second, the TCP sequence information in the first line is printed as if there
were 308 bytes of user data when, in fact, there are 512 bytes
.Po
308 in the first frag and 204 in the second
.Pc .
If you are looking for holes in the sequence space or trying to match up acks
with packets, this can fool you.
.Pp
A packet with the IP
.Sy don't fragment
flag is marked with a trailing
.Dq Pq Tn DF .
.Ss Timestamps
By default, all output lines are preceded by a timestamp.
The timestamp is the current clock time in the form
.Sm off
.Ar hh : mm : ss . frac
.Sm on
and is as accurate as the kernel's clock.
The timestamp reflects the time the kernel first saw the packet.
No attempt is made to account for the time lag between when the
Ethernet interface removed the packet from the wire and when the kernel
serviced the
.Dq new packet
interrupt.
.Sh SEE ALSO
.\" traffic(1C), nit(4P),
.Xr ethers 3 ,
.Xr pcap 3 ,
.Xr bpf 4 ,
.Xr ip 4 ,
.Xr pf 4 ,
.Xr pflog 4 ,
.Xr tcp 4 ,
.Xr udp 4 ,
.Xr networks 5 ,
.Xr pf.os 5
.Rs
.%R RFC 793
.%T Transmission Control Protocol
.%D September 1981
.Re
.Rs
.%R RFC 1034
.%T Domain Names \- Concepts and Facilities
.%D November 1987
.Re
.Rs
.%R RFC 1035
.%T Domain Names \- Implementation and Specification
.%D November 1987
.Re
.Rs
.%R RFC 1050
.%T RPC: Remote Procedure Call
.%D April 1988
.Re
.Rs
.%R RFC 1144
.%T Compressing TCP/IP Headers for Low-Speed Serial Links
.%D February 1990
.Re
.Rs
.%R RFC 2018
.%T TCP Selective Acknowledgement Options
.%D October 1996
.Re
.Rs
.%R RFC 2406
.%T IP Encapsulating Security Payload (ESP)
.%D November 1998
.Re
.Sh AUTHORS
.An Van Jacobson Aq van@@ee.lbl.gov ,
.An Craig Leres Aq leres@@ee.lbl.gov ,
and
.An Steven McCanne Aq mccanne@@ee.lbl.gov ,
all of the Lawrence Berkeley Laboratory, University of California, Berkeley, CA.
.Sh BUGS
Please send bug reports to
.Aq tcpdump@@ee.lbl.gov
or
.Aq libpcap@@ee.lbl.gov .
.Pp
Some attempt should be made to reassemble IP fragments,
or at least to compute the right length for the higher level protocol.
.Pp
Name server inverse queries are not dumped correctly: The
.Pq empty
question section is printed rather than the real query in the answer section.
Some believe that inverse queries are themselves a bug and
prefer to fix the program generating them rather than
.Nm tcpdump .
.Pp
Apple Ethertalk DDP packets could be dumped as easily as KIP DDP packets
but aren't.
Even if we were inclined to do anything to promote the use of Ethertalk
(we aren't, LBL doesn't allow Ethertalk on any of its
networks so we'd have no way of testing this code).
.Pp
A packet trace that crosses a daylight saving time change will give
skewed time stamps
.Pq the time change is ignored .
.Pp
Filter expressions that manipulate FDDI headers assume that all FDDI packets
are encapsulated Ethernet packets.
This is true for IP, ARP, and
.Tn DECNET
Phase IV,
but is not true for protocols such as ISO CLNS.
Therefore, the filter may inadvertently accept certain packets that
do not properly match the filter expression.
@


1.3
log
@* merge OpenBSD 3.5-current
* re-sort entries in Makefile
  => not a bunch of adds any more; all alphabetic
  => remove obsolete SUBDIRS_ONLY_BSD for now
     (MirLinux won't come that soon due to a certain lawsuit,
      licence issues with unwillingly GNU fanatics, and my
      chronic unwillingness to do masochistic work)
* spacing, RCS IDs, etc.
* pkg gets folded into pkg_install, so we only have one dir
  to worry about
* pkg_add leaves the tree - nobody cared about this kind
  of package tools anyways, and they're not part of MirBSD
  (although still supported by MirPorts)
* mopd leaves - we don't have VAX support anyways
@
text
@d1 1
a1 1
.\"	$OpenBSD: tcpdump.8,v 1.46 2004/05/06 11:25:11 jmc Exp $
d196 4
d218 2
@


1.2
log
@this should fix the manpages
@
text
@d1 1
a1 1
.\"	$OpenBSD: tcpdump.8,v 1.43 2003/10/12 10:59:47 dhartmei Exp $
d202 2
d640 1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
.\"	$OpenBSD: tcpdump.8,v 1.32 2002/12/01 16:59:20 margarida Exp $
d30 2
a31 1
.Op Fl adeflnNOpqStvxX
d33 1
d41 1
d44 1
a44 2
prints out the headers of packets on a network interface
that match the boolean
d47 1
a47 1
.Pa /dev/bpf\&* .
d50 1
a50 1
.Bl -tag -width Ds
d61 1
a61 3
Dump packet-matching code as a
.Tn C
program fragment.
d67 26
d110 1
a110 2
searches the system interface list for the
lowest numbered, configured
d112 2
a113 1
interface (excluding loopback).
d117 4
a120 6
Useful if you want to see the data while capturing it. e.g.,
.Bd -ragged -offset indent
.Nm
.Fl l
| tee dat
.Ed
d122 1
a122 8
.br
.Bd -ragged -offset indent -compact
.Nm
.Fl l
> dat & tail
.Fl f
dat
.Ed
d124 2
a125 1
Do not convert addresses (i.e., host addresses, port numbers, etc.)
d135 6
d149 1
a149 1
.Dq ether host "{local\&-hw\&-addr}"
d153 3
a155 1
Quick (quiet?) output.
d170 4
a173 11
bytes of data from each packet rather than the
default of 68.
68 bytes is adequate for
.Tn IP ,
.Tn ICMP ,
.Tn TCP ,
and
.Tn UDP
but may truncate protocol information from name server and
.Tn NFS
packets (see below).
d181 2
a182 3
Taking larger snapshots both increases
the amount of time it takes to process packets and, effectively,
decreases the amount of packet buffering.
d186 10
a195 2
to the smallest number that will
capture the protocol information you're interested in.
d199 1
a199 2
to be interpreted as the
specified
d207 1
a207 1
.Pq Real\&-Time Applications protocol ,
d209 1
a209 1
.Pq Real\&-Time Applications control protocol ,
d211 1
a211 4
.Po
.Tn RFC 2018
No Selective Acknowledgements
.Pc ,
a216 10
.It Fl S
Print absolute, rather than relative,
.Tn TCP
sequence numbers.
.It Fl t
Do not print a timestamp on each dump line.
.It Fl tt
Print an unformatted timestamp on each dump line.
.It Fl ttt
Print day and month in timestamp.
d218 2
a219 1
(Slightly more) verbose output.
d221 4
a224 3
and type of service information in an
.Tn IP
packet are printed.
d227 1
a227 3
For example, additional fields are printed from
.Tn NFS
reply packets.
d231 1
a231 2
rather than parsing and printing
them out.
d240 2
a241 1
Print each packet (minus its link-level header)
d250 3
a252 1
.It Ar expression
d266 1
a266 1
(name or number)
d270 1
a270 1
.It Fa type
d298 1
a298 1
.Dq src or dst port ftp\&-data .
d304 5
a308 4
For null link layers (i.e., point-to-point protocols such as
.Tn SLIP
or the pflog header)
the
d316 2
a320 3
.Cm arp ,
.Cm rarp ,
.Cm decnet ,
d322 1
d324 1
a324 1
.Cm mopdl ,
d332 3
a334 3
If there is
no protocol qualifier, all protocols consistent with the type are
assumed. e.g.,
d341 1
a341 1
(except the latter is not legal syntax),
d347 1
a347 1
.Dc
d352 1
a352 1
.Pq tcp or udp
d363 7
a369 8
.Tn FDDI
headers contain Ethernet-like source
and destination addresses, and often contain Ethernet-like packet
types, so you can filter on these
.Tn FDDI
fields just as with the analogous Ethernet fields.
.Tn FDDI
headers also contain other fields,
d387 1
a387 1
to combine primitives.
d392 1
a392 1
To save typing, identical qualifier lists can be omitted.
d403 1
a403 3
True if the
.Tn IP
destination field of the packet is
d407 1
a407 3
True if the
.Tn IP
source field of the packet is
d410 1
a410 3
True if either the
.Tn IP
source or destination of the packet is
d421 2
a422 3
.Bd -literal -offset indent
.Cm ip host Ar host
.Ed
d428 1
a428 1
.Cm Cm and host
d430 1
a431 1
.Ed
d434 1
a434 4
is a name with multiple
.Tn IP
addresses, each address will
be checked for a match.
d455 1
a455 5
but neither the
.Tn IP
source nor the
.Tn IP
destination was
d471 1
a471 1
.Ar host Ns \&/ Ns Ar ehost .
d473 1
a473 4
True if the
.Tn IP
destination address of the packet has a network
number of
d482 1
a482 4
True if the
.Tn IP
source address of the packet has a network
number of
d485 2
a486 4
True if either the
.Tn IP
source or destination address of the packet has a network
number of
d489 1
a489 2
True if the packet is ip/tcp or ip/udp and has a
destination port value of
d499 2
a500 3
If a name is used, both the port
number and protocol are checked.
If a number or ambiguous name is used only the port number is checked;
d503 1
a503 2
will print both
tcp/login traffic and udp/who traffic, and
d505 1
a505 2
will print
both tcp/domain and udp/domain traffic.
a517 3
.Bd -literal -offset indent
.Cm tcp src port Ar port
.Ed
d519 3
a521 3
which matches only
.Tn TCP
packets whose source port is
d527 2
a528 3
.Bd -literal -offset indent
.Cm len \*(<= Ar length .
.Ed
d534 2
a535 3
.Bd -literal -offset indent
.Cm len \*(>= Ar length .
.Ed
d538 1
a538 3
True if the packet is an
.Tn IP
packet (see
d561 3
a563 6
True if the packet is an
.Tn IP
broadcast packet.
It checks for both
the all-zeroes and all-ones broadcast conventions and looks up
the local subnet mask.
d571 1
a571 1
.Cm ether Ns [0] \&& 1 !\&= 0
d574 1
a574 3
True if the packet is an
.Tn IP
multicast packet.
d584 2
a585 5
These identifiers are also shell keywords
and must be escaped.
In the case of
.Tn FDDI
(e.g.,
d587 3
a589 6
the
protocol identification comes from the 802.2 Logical Link Control
.Pq Tn LLC
header, which is usually layered on top of the
.Tn FDDI
header.
d591 2
a592 11
assumes, when filtering on the protocol identifier,
that all
.Tn FDDI
packets include an
.Tn LLC
header, and that the
.Tn LLC
header
is in so-called
.Tn SNAP
format.
d604 1
a604 2
host name support is only available on
systems that are configured to run
d617 3
a619 3
True if the packet was logged as coming from the specified interface (applies
only to packets logged by
.Xr pf 4 ).
d626 2
a627 2
(applies only to packets logged by
.Xr pf 4 ).
d629 1
a629 1
Synonomous with the
d633 2
a634 2
True if the packet was logged with the specified PF reason code.  The known
codes are:
d641 1
a641 1
.Ar memory .
d643 17
a659 1
.Xr pf 4 ).
d661 2
a662 2
True if PF took the specified action when the packet was logged.  Known actions
are:
d665 1
a665 1
.Ar block .
d667 1
a667 1
.Xr pf 4 ).
d677 2
a678 3
.Bd -literal -offset indent
.Cm ether proto Ar p
.Ed
d708 1
a708 3
(expressed in standard
.Tn C
syntax),
d717 2
a718 2
To access
data inside the packet, use the following syntax:
d720 1
a720 1
.Ar proto Op Ar expr No : Ar size
d722 1
d735 2
a736 4
and
indicates the protocol layer for the index operation.
The byte offset, relative to the indicated protocol layer, is
given by
d739 2
a740 2
is optional and indicates the number of bytes in the
field of interest; it can be either one, two, or four, and defaults to one.
d743 1
a743 2
gives the
length of the packet.
d746 1
a746 1
.Dq Cm ether Ns [0] \&& 1 !\&= 0
d749 2
a750 4
.Dq Cm ip Ns [0] \&& 0xf !\&= 5
catches all
.Tn IP
packets with options.
d752 1
a752 1
.Dq Cm ip Ns [6:2] \&& 0x1fff \&= 0
d757 1
a757 1
.C, udp
d761 2
a762 6
always means the first
byte of the
.Tn TCP
header,
and never means the first byte of an
intervening fragment.
d765 2
a766 2
Primitives may be combined using
a parenthesized group of primitives and operators.
d768 1
a768 1
Allowed primitives and operators are:
d772 1
a772 1
.Dq Cm !
d776 1
a776 1
.br
d779 1
a779 1
.Dq Cm \&&\&&
d783 1
a783 1
.br
d793 1
a793 2
Alternation and concatenation have equal precedence and associate
left to right.
d799 1
a799 2
If an identifier is given without a keyword, the most recent keyword
is assumed.
d824 4
a827 4
as either a single argument
or as multiple arguments, whichever is more convenient.
Generally, if the expression contains shell metacharacters, it is
easier to pass it as a single, quoted argument.
a830 4
.Bd -ragged -offset indent
.Nm
.Cm host No sundown
.Ed
d832 9
a840 8
To print traffic between helios and either hot or ace:
.Bd -ragged -offset indent
.Nm
.Cm host
helios
.Cm and
.Pq hot Cm or No ace
.Ed
d842 1
a842 10
To print all
.Tn IP
packets between ace and any host except helios:
.Bd -ragged -offset indent
.Nm
.Cm ip host
ace
.Cm and not
helios
.Ed
a844 5
.Bd -ragged -offset indent
.Nm
.Cm net
ucb\(enether
.Ed
d846 3
a848 11
To print all
.Tn FTP
traffic through internet gateway snup:
.Bd -ragged -offset indent
.Nm
\&'
.Cm gateway
snup
.Cm and
.Pq Cm port No ftp Cm or No ftp\&-data
\&'
d850 1
a850 3
The expression is quoted to prevent the shell from
mis\(eninterpreting the parentheses.
.Ed
d853 10
a862 8
.Po
if you gateway to one other net, this stuff should never make it
onto your local net
.Pc :
.Bd -ragged -offset indent
.Nm
.Cm ip and not net
localnet
d865 1
a865 16
To print the start and end packets (the
.Tn SYN
and
.Tn FIN
packets)
of each
.Tn TCP
connection that involves a non-local host:
.Bd -ragged -offset indent
.Nm
\&'
.Cm tcp Ns [13] \&& 3 !\&= 0
.Cm and not src and dst net
localnet
\&'
.Ed
d867 1
a867 9
To print
.Tn IP
packets longer than 576 bytes sent through gateway snup:
.Bd -ragged -offset indent
.Nm
\&'
.Cm gateway snup and ip Ns [2:2] \&> 576
\&'
.Ed
d869 1
a869 3
To print
.Tn IP
broadcast or multicast packets that were
d872 2
a873 6
.Bd -ragged -offset indent
.Nm
\&'
.Cm ether Ns [0] \&& 1 = 0
.Cm and ip Ns [16] \&>\&= 224
\&'
d876 8
a883 11
To print all
.Tn ICMP
packets that are not echo requests/replies (i.e., not ping packets):
.Bd -ragged -offset indent
.Nm
\&'
.Cm icmp Ns [0] != 8
.Cm and icmp Ns [0] !\&= 0
\&'
.Ed
.El
d889 1
a889 3
.Pp
.Em Link Level Headers
.Pp
d897 10
a906 8
.Pa pflog ,
logging reason (rule match, bad-offset, fragment, short,
normalize, memory), action taken (pass/block), direction (in/out) and interface
information are printed out for each packet.
.Pp
On
.Tn FDDI
networks, the
d910 1
a910 2
to print the frame control
field, the source and destination addresses,
d912 3
a914 5
The frame control field governs the
interpretation of the rest of the packet.
Normal packets (such as those containing
.Tn IP
datagrams)
d917 1
a917 2
packets, with a priority
value between 0 and 7; for example,
d919 3
a921 7
Such packets
are assumed to contain an 802.2 Logical Link Control
.Pq Tn LLC
packet;
the
.Tn LLC
header is printed if it is
d923 4
a926 6
an
.Tn ISO
datagram or a
so-called
.Tn SNAP
packet.
d928 1
a928 9
The following description assumes familiarity with
the
.Tn SLIP
compression algorithm described in
.Tn RFC 1144 .
.Pp
On
.Tn SLIP
links, a direction indicator
d931 1
a931 1
for inbound ,
d942 2
a943 6
No further link information is printed for
.Cm ip
packets.
For
.Tn TCP
packets, the connection identifier is printed following the type.
d946 1
a946 1
.Cm \&*S\&+ Ns Ar n
d948 1
a948 1
.Cm \&*SA\&+ Ns Ar n ,
d951 2
a952 2
is the amount by which
the sequence number (or sequence number and ack)
d968 1
a968 1
.Pq \&+n or \&-n ,
d970 1
a970 1
.Pq \&=n .
d974 1
a974 3
For example, the following line shows an outbound compressed
.Tn TCP
packet,
d976 2
a977 3
the sequence number by 49, and the packet ID
by 6; there are 3 bytes of
data and 6 bytes of compressed header:
d980 4
a983 4
.Cm ctcp No \&*
.Cm A No \&+6
.Cm S No \&+49
.Cm I No \&+6 3
d986 1
a986 3
.Pp
.Tn Em ARP\&/ Ns Tn Em RARP Packets
.Pp
d989 2
a990 2
Here is a short sample taken from the start of an
rlogin from host rtsg to host csam:
d992 2
a993 2
arp who\&-has csam tell rtsg
arp reply csam is\&-at CSAM
d996 5
a1000 5
In this example, Ethernet addresses are in caps and internet
addresses in lower case.
The first line says that rtsg sent an arp packet asking
for the Ethernet address of internet host csam. csam
replies with its Ethernet address CSAM.
d1006 1
a1006 1
arp who\&-has 128.3.254.6 tell 128.3.254.68
d1020 3
a1022 3
For the first packet this says the Ethernet source address is RTSG, the
destination is the Ethernet broadcast address, the type field
contained hex 0806 (type
d1025 4
a1028 10
.Pp
.Tn Em TCP Packets
.Pp
The following description assumes familiarity with
the
.Tn TCP
protocol described in
.Tn RFC 793 .
If you are not familiar
with the protocol, neither this description nor
d1032 1
a1032 1
The general format of a tcp protocol line is:
d1034 2
a1035 2
.Ar src No \&> Ar dst :
.Ar flags data\&-seqno ack window urgent options
d1041 1
a1041 3
are the source and destination
.Tn IP
addresses and ports.
d1060 6
a1065 1
.Ar data\&-seqno
d1067 2
a1068 1
by the data in this packet (see example below).
d1078 2
a1079 2
are tcp options enclosed in angle brackets (e.g.,
.Aq mss 1024 ) .
d1081 1
a1081 1
.Ar src , Ar dst
d1085 1
a1085 1
The other fields depend on the contents of the packet's tcp protocol header and
d1089 1
a1089 1
.Bd -literal -offset indent
d1101 1
a1101 1
The first line says that tcp port 1023 on rtsg sent a packet
d1105 1
a1105 3
indicates that the
.Tn SYN
flag was set.
d1110 2
a1111 2
.Ar first : Ns Ar last
.Ns Po Ns Ar nbytes
d1115 1
a1115 3
which means
sequence
numbers
d1123 1
a1123 2
bytes and there was a max-segment-size option requesting an mss of
1024 bytes.
d1126 2
a1127 4
ack for rtsg's
.Tn SYN .
Rtsg then acks csam's
.Tn SYN .
d1135 1
a1135 1
sees a tcp connection, it prints the sequence number from the packet.
d1153 1
a1153 3
The
.Tn PUSH
flag is set in the packet.
d1156 2
a1157 2
Most of this data is apparently sitting in the
socket buffer since csam's receive window has gotten 19 bytes smaller.
d1161 2
d1164 1
a1164 7
.Tn Em UDP Packets
.Pp
.Tn UDP
format is illustrated by this rwho packet:
.Bd -literal -offset indent
actinide.who \&> broadcast.who: udp 84
.Ed
d1166 2
a1167 3
This says that port who on host actinide sent a udp datagram to port
who on host broadcast, the Internet
broadcast address.
d1170 2
a1171 3
Some
.Tn UDP
services are recognized (from the source or destination port number)
d1174 5
a1178 10
.Pq Tn RFC 1034/1035
and
.Tn Sun RPC
calls
.Pq Tn RFC 1050
to
.Tn NFS .
.Pp
.Tn Em UDP Name Server Requests
.Pp
d1180 3
a1182 5
the Domain Service protocol described in
.Tn RFC 1035 .
If you are not familiar
with the protocol, the following description will appear to be written
in greek.
d1189 1
a1189 1
.Ar id op Ns ?
d1192 1
d1196 1
a1196 2
h2opolo.1538 > helios.domain: 3+ A? ucbvax.berkeley.edu. (37)
.Ed
d1199 1
a1199 1
.Pq Ar qtype Ns \&=A
d1208 1
a1208 5
The query length was 37 bytes, not including the
.Tn UDP
and
.Tn IP
protocol headers.
d1216 1
a1216 3
had been anything else, it would
have been printed between the
3 and the
d1244 1
a1244 2
.Tn AA , RA
or rcode
d1249 1
a1249 1
.Dq Bq b2\&&3\&= Ns Ar x
d1253 1
a1253 3
.Pp
.Tn Em UDP Name Server Responses
.Pp
d1265 1
d1268 1
a1268 1
.Pp
a1269 1
.br
d1280 1
a1280 5
The total size of the response was 273 bytes, excluding
.Tn UDP
and
.Tn IP
headers.
d1289 1
a1289 1
.Pq Tn C_IN
d1292 1
a1292 2
In the second example,
helios responds to query
d1294 1
a1294 1
2 with a
d1311 2
a1312 3
.Ql -
(recursion available,
.Tn RA ,
d1316 2
a1317 4
.Dq \*(Ba
(truncated message,
.Tn TC ,
set).
d1322 1
a1322 2
Name server requests and responses tend to be large and the
default
d1324 1
a1324 2
of 68 bytes may not capture enough of the packet
to print.
d1329 1
a1329 2
if you
need to seriously investigate name server traffic.
d1332 2
a1333 4
.Pp
.Tn Em NFS Requests and Replies
.Pp
.Tn Sun NFS
d1342 1
a1342 1
.br
d1348 1
a1348 2
.Pp
.Bd -literal -offset indent
d1357 1
a1357 2
In the first line, host sushi sends a transaction with ID
6709 to wrl.
d1361 1
a1361 5
The request was 112 bytes, excluding the
.Tn UDP
and
.Tn IP
headers.
d1364 2
a1365 1
was a readlink (read symbolic link)
d1376 1
a1376 1
In the third line, sushi asks wrl to lookup the name
d1381 1
a1381 3
if read in conjunction with an
.Tn NFS
protocol spec.
d1388 1
a1388 1
.Bd -literal -offset indent
d1396 3
a1398 5
also prints the
.Tn IP No header Tn TTL , ID ,
and fragmentation fields, which have been omitted from this example.
In the first line, sushi asks wrl
to read 8192 bytes from file 21,11/12.195,
d1403 4
a1406 9
the packet shown on the
second line is the first fragment of the reply, and hence is only 1472
bytes long.
The other bytes will follow in subsequent fragments, but
these fragments do not have
.Tn NFS
or even
.Tn UDP
headers and so might not be
d1424 1
a1424 3
.Tn NFS
requests are very large and much of the detail won't be printed
unless
d1429 3
a1431 8
to watch
.Tn NFS
traffic.
.Pp
.Tn NFS
reply packets do not explicitly identify the
.Tn RPC
operation.
d1436 1
a1436 2
requests, and matches them to the
replies using the
d1439 6
a1444 18
If a reply does not closely follow the
corresponding request, it might not be parsable.
.Pp
.Tn Em KIP AppleTalk
.Em Pq Tn DDP No in Tn UDP
.Pp
AppleTalk
.Tn DDP
packets encapsulated in
.Tn UDP
datagrams are de-encapsulated and dumped as
.Tn DDP
packets
.Po
i.e., all the
.Tn UDP
header information is discarded
.Pc .
d1449 6
a1454 7
.Bd -literal -offset indent
.Ar number		name

1.254		ether
16.1		icsd-net
1.254.110	ace
.Ed
d1475 1
d1478 1
a1478 1
.Pp
a1479 1
.br
a1480 1
.br
d1488 2
a1489 3
In the first example,
.Tn NBP
.Pq Tn DDP No port 2
d1492 1
a1492 2
The second line is the same except the full name of the source node
is known
d1495 5
a1499 6
net jssmag node 149 to broadcast on the icsd-net
.Tn NBP
port.
The broadcast address (255) is indicated by a net name with no host
number; for this reason it is a good idea to keep node names and
net names distinct in
d1502 1
a1502 1
.Tn NBP
d1504 1
a1504 2
and
.Tn ATP
d1509 1
a1509 2
or number if no name is registered for the
protocol
d1513 2
a1514 3
.Tn NBP
packets are formatted like the following examples:
.Bd -literal -offet indent
d1520 2
a1521 2
The first line is a name lookup request for laserwriters sent by net
icsdi-net host
d1525 1
a1525 1
.Pq note that it has the same id
d1528 2
a1529 3
The third line is
another reply to the same request saying host techpit has laserwriter
techpit registered on port 186.
d1531 2
a1532 3
.Tn ATP
packet formatting is demonstrated by the following example:
.Bd -literal -offset indent
d1549 1
a1549 1
Jssmag.209 initiates transaction id 12266 with host helios by requesting
d1552 1
a1552 1
.Pq the Dq Aq 0 \&- 7 .
d1558 1
a1558 1
Helios responds with 8 512\(enbyte packets.
d1562 1
a1562 1
transaction id gives the packet sequence number in the transaction
d1564 1
a1564 1
excluding the atp header.
d1567 1
a1567 3
on packet 7 indicates that the
.Tn EOM
bit was set.
d1579 1
a1579 3
.Pp
.Tn Em IP Fragmentation
.Pp
d1588 1
a1588 1
.Op \&+
d1603 1
a1603 3
excluding the
.Tn IP
header.
d1614 3
a1616 5
For example, here is part of an ftp from arizona.edu to lbl\(enrtsg.arpa
over a
.Tn CSNET
connection that doesn't appear to handle 576 byte datagrams:
.Bd -literal -offset indent
d1624 4
a1627 5
This is because the
.Tn TCP
protocol information is all in the first fragment and we have no idea
what the port or sequence numbers are when we print the later fragments.
Second, the tcp sequence information in the first line is printed as if there
d1632 1
a1632 2
If you are looking for holes
in the sequence space or trying to match up acks
d1635 3
a1637 5
A packet with the
.Tn IP
.Sy don\&'t fragment
flag is marked with a
trailing
d1639 1
a1639 3
.Pp
.Em Timestamps
.Pp
d1654 2
d1657 42
a1698 1
.Xr pcap 3
d1700 5
a1704 8
Van Jacobson
.Pq van@@ee.lbl.gov ,
Craig Leres
.Pq leres@@ee.lbl.gov
and Steven McCanne
.Pq mccanne@@ee.lbl.gov ,
all of the
Lawrence Berkeley Laboratory, University of California, Berkeley, CA.
d1706 4
a1709 1
Please send bug reports to tcpdump@@ee.lbl.gov or libpcap@@ee.lbl.gov.
d1711 2
a1712 4
Some attempt should be made to reassemble
.Tn IP
fragments or, at least
to compute the right length for the higher level protocol.
d1716 1
a1716 2
question section is printed rather than the real query in the answer
section.
d1721 5
a1725 10
Apple Ethertalk
.Tn DDP
packets could be dumped as easily as
.Tn KIP DDP
packets but aren't.
Even if we were inclined to do anything to promote the use of
Ethertalk (we aren't,
.Tn LBL
doesn't allow Ethertalk on any of its
networks so we'd would have no way of testing this code).
d1728 2
a1729 1
skewed time stamps (the time change is ignored).
d1731 3
a1733 9
Filter expressions that manipulate
.Tn FDDI
headers assume that all
.Tn FDDI
packets are encapsulated Ethernet packets.
This is true for
.Tn IP ,
.Tn ARP ,
and
d1736 1
a1736 2
but is not true for protocols such as
.Tn ISO CLNS .
@


1.1.1.1
log
@Import OpenBSD 3.3 source repository from CTM 3132 the first time
This opens an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright  1968-2003  The authors of And contributors to UNIX, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@


1.1.1.2
log
@Import OpenBSD cvs as of roughly 11:11 UTC today,
or CTM delta 3188/3189/3190.
@
text
@d1 1
a1 1
.\"	$OpenBSD: tcpdump.8,v 1.33 2003/04/08 01:21:11 david Exp $
d788 1
a788 1
.Cm udp
@


1.1.1.3
log
@Sync MirBSD main source tree against OpenBSD-current,
which should be fairly stable after the Hackathon now.
@
text
@d1 1
a1 1
.\"	$OpenBSD: tcpdump.8,v 1.34 2003/05/14 08:50:37 canacar Exp $
d666 1
a666 1
in the main ruleset (applies only to packets logged by
a683 16
.It Cm rset Ar name
True if the packet was logged as matching the specified PF ruleset
name of an anchored ruleset (applies only to packets logged by
.Xr pf 4 ).
.It Cm ruleset Ar name
Synonomous with the
.Ar rset
modifier.
.It Cm srnr Ar num
True if the packet was logged as matching the specified PF rule number
of an anchored ruleset (applies only to packets logged by
.Xr pf 4 ).
.It Cm subrulenum Ar num
Synonomous with the
.Ar srnr
modifier.
@


1.1.1.4
log
@sync with OpenBSD, this gives us a fair amount of fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: tcpdump.8,v 1.35 2003/06/12 12:59:53 jmc Exp $
d91 1
a91 2
Useful if you want to see the data while capturing it.
E.g.,
d319 1
a319 2
assumed.
E.g.,
d659 1
a659 1
.Xr pf 4 ) .
d667 1
a667 1
.Xr pf 4 ) .
d673 2
a674 2
True if the packet was logged with the specified PF reason code.
The known codes are:
d683 1
a683 1
.Xr pf 4 ) .
d687 1
a687 1
.Xr pf 4 ) .
d695 1
a695 1
.Xr pf 4 ) .
d701 2
a702 2
True if PF took the specified action when the packet was logged.
Known actions are:
d707 1
a707 1
.Xr pf 4 ) .
d1136 2
a1137 2
for the Ethernet address of internet host csam.
csam replies with its Ethernet address CSAM.
d1895 2
a1896 2
.Xr pcap 3 ,
.Xr bpf 4
@


1.1.1.5
log
@Synchronize source tree with OpenBSD
note: due to recent changes in the codebase of OpenBSD,
out libcom_err will be incompatible with theirs...
but this is no issue because we don't provide a dynamically
linked one, and theirs won't be provided longer any more anyways.
@
text
@d1 1
a1 1
.\"	$OpenBSD: tcpdump.8,v 1.37 2003/07/17 08:45:37 markus Exp $
a37 1
.Op Fl E Oo Ar espalg: Oc Ar espkey
a195 28
.It Xo
.Fl E Oo Ar espalg: Oc Ar espkey
.Xc
Try to decrypt
.Tn RFC 2406
.Cm ESP
traffic using the specified hex key
.Ar espkey .
Supported algorithms for
.Ar espalg
are:
.Cm aes128 ,
.Cm aes128-hmac96 ,
.Cm blowfish ,
.Cm blowfish-hmac96 ,
.Cm cast ,
.Cm cast-hmac96 ,
.Cm des3 ,
.Cm des3-hmac96 ,
.Cm des
and
.Cm des-hmac96 .
The algorithm defaults to
.Cm aes128-hmac96 .
This option should be used for debugging only, since
the key will show up in
.Xr ps 1
output.
d415 3
a417 2
.Pp
.D1 Cm ip host Ar host
d423 1
a423 1
.Cm and host
d532 3
a534 2
.Pp
.D1 Cm tcp src port Ar port
d544 3
a546 2
.Pp
.D1 Cm len \*(Le Ar length .
d552 3
a554 2
.Pp
.D1 Cm len \*(Ge Ar length .
d719 3
a721 2
.Pp
.D1 Cm ether proto Ar p
a994 13
.Pp
To print and decrypt all
.Tn ESP
packets with
.Tn SPI
0x00001234:
.Bd -ragged -offset indent
.Nm
-E des3-hmac96:ab...def
\&'
.Cm ip Ns [20:4] = 0x00001234
\&'
.Ed
d1533 1
d1650 1
a1650 1
.Pq Tn DDP No in Tn UDP
d1668 1
a1668 1
.Bd -unfilled -offset indent
d1741 1
a1741 1
.Bd -literal
@


1.1.1.6
log
@Synchronize with OpenBSD 3.4-beta
@
text
@d1 1
a1 1
.\"	$OpenBSD: tcpdump.8,v 1.39 2003/08/28 09:41:22 jmc Exp $
d30 1
a30 1
.Op Fl adeflnNoOpqStvxX
a118 6
.It Fl o
Print a guess of the possible operating system(s) of hosts that sent TCP SYN
packets.
See
.Xr pf.os 5
for a description of the passive operating system fingerprints.
d1217 1
a1217 1
.Ar flags src\&-os data\&-seqno ack window urgent options
a1243 5
.Ar src\&-os
will list a guess of the source host's operating system if the
.Fl o
command line flag was passed to
.Nm tcpdump .
d1934 1
a1934 2
.Xr bpf 4 ,
.Xr pf.os 5
@


1.1.1.7
log
@Release Time. Synchronize with OpenBSD 3.4-current (base system).
@
text
@d1 1
a1 1
.\"	$OpenBSD: tcpdump.8,v 1.42 2003/09/25 13:32:58 jmc Exp $
a29 1
.Bk -words
a31 1
.Op Fl E Oo Ar espalg: Oc Ar espkey
d38 1
a39 1
.Ek
d42 2
a43 1
prints out the headers of packets on a network interface that match the boolean
d46 1
a46 1
.Pa /dev/bpf* .
d49 1
a49 1
.Bl -tag -width "-c count"
d60 3
a62 1
Dump packet-matching code as a C program fragment.
a67 26
.It Xo
.Fl E Oo Ar espalg: Oc Ar espkey
.Xc
Try to decrypt RFC 2406 ESP
.Pq Encapsulating Security Payload
traffic using the specified hex key
.Ar espkey .
Supported algorithms for
.Ar espalg
are:
.Cm aes128 ,
.Cm aes128-hmac96 ,
.Cm blowfish ,
.Cm blowfish-hmac96 ,
.Cm cast ,
.Cm cast-hmac96 ,
.Cm des3 ,
.Cm des3-hmac96 ,
.Cm des
and
.Cm des-hmac96 .
The algorithm defaults to
.Cm aes128-hmac96 .
This option should be used for debugging only, since the key will show up in
.Xr ps 1
output.
d85 2
a86 1
searches the system interface list for the lowest numbered, configured
d88 1
a88 2
interface
.Pq excluding loopback .
d94 5
a98 2
.Pp
.Dl # tcpdump -l | tee dat
d100 8
a107 1
.Dl # tcpdump -l > dat & tail -f dat
d109 1
a109 2
Do not convert addresses
.Pq host addresses, port numbers, etc.
d120 2
a121 2
Print a guess of the possible operating system(s) of hosts that sent
TCP SYN packets.
d133 1
a133 1
.Dq ether host \&"{local-hw-addr}\&"
d137 1
a137 3
Quick
.Pq quiet?
output.
d152 11
a162 4
bytes of data from each packet rather than the default of 68.
68 bytes is adequate for IP, ICMP, TCP, and UDP,
but may truncate protocol information from name server and NFS packets
.Pq see below .
d170 3
a172 2
Taking larger snapshots both increases the amount of time it takes
to process packets and, effectively, decreases the amount of packet buffering.
d176 2
a177 10
to the smallest number that will capture the protocol information
you're interested in.
.It Fl S
Print absolute, rather than relative, TCP sequence numbers.
.It Fl t
Do not print a timestamp on each dump line.
.It Fl tt
Print an unformatted timestamp on each dump line.
.It Fl ttt
Print day and month in timestamp.
d181 2
a182 1
to be interpreted as the specified
d190 1
a190 1
.Pq Real-Time Applications protocol ,
d192 1
a192 1
.Pq Real-Time Applications control protocol ,
d194 4
a197 1
.Pq RFC 2018 TCP Selective Acknowledgements Options ,
d203 38
d242 1
a242 2
.Pq Slightly more
verbose output.
d244 3
a246 4
.Pq TTL
and type of service
.Pq ToS
information in an IP packet are printed.
d249 3
a251 1
For example, additional fields are printed from NFS reply packets.
d255 2
a256 1
rather than parsing and printing them out.
d265 1
a265 2
Print each packet
.Pq minus its link-level header
d274 1
a274 3
.El
.Pp
.Ar expression
d288 1
a288 1
.Pq name or number
d292 1
a292 1
.It Ar type
d320 1
a320 1
.Dq src or dst port ftp-data .
d326 4
a329 5
For null link layers (i.e., point-to-point protocols such as SLIP
.Pq Serial Line Internet Protocol
or the
.Xr pflog 4
header), the
a336 2
.Cm arp ,
.Cm decnet ,
d340 3
d344 1
a345 2
.Cm moprc ,
.Cm rarp ,
d353 3
a355 2
If there is no protocol qualifier,
all protocols consistent with the type are assumed.
d363 1
a363 1
.Pq except the latter is not legal syntax ;
d369 1
a369 1
.Dc ;
d374 1
a374 1
.Pq TCP or UDP
d385 8
a392 7
FDDI
.Pq Fiber Distributed Data Interface
headers contain Ethernet-like source and destination addresses,
and often contain Ethernet-like packet types,
so you can filter on these FDDI fields just as with the analogous
Ethernet fields.
FDDI headers also contain other fields,
d410 1
a410 1
to combine primitives
d415 1
a415 1
To save typing, identical qualifier lists can be omitted
d426 3
a428 1
True if the IP destination field of the packet is
d432 3
a434 1
True if the IP source field of the packet is
d437 3
a439 1
True if either the IP source or destination of the packet is
d459 1
a460 1
.Pp
d463 4
a466 1
is a name with multiple IP addresses, each address will be checked for a match.
d487 5
a491 1
but neither the IP source nor the IP destination was
d507 1
a507 1
.Ar host Ns / Ns Ar ehost .
d509 4
a512 1
True if the IP destination address of the packet has a network number of
d521 4
a524 1
True if the IP source address of the packet has a network number of
d527 4
a530 2
True if either the IP source or destination address of the packet
has a network number of
d533 2
a534 1
True if the packet is IP/TCP or IP/UDP and has a destination port value of
d544 3
a546 2
If a name is used, both the port number and protocol are checked.
If a number or ambiguous name is used, only the port number is checked;
d549 2
a550 1
will print both TCP/login traffic and UDP/who traffic, and
d552 2
a553 1
will print both TCP/domain and UDP/domain traffic.
d569 3
a571 1
which matches only TCP packets whose source port is
d578 1
a578 1
.D1 Cm len <= Ar length
d585 1
a585 1
.D1 Cm len >= Ar length
d588 3
a590 1
True if the packet is an IP packet (see
d613 6
a618 3
True if the packet is an IP broadcast packet.
It checks for both the all-zeroes and all-ones broadcast conventions
and looks up the local subnet mask.
d626 1
a626 1
.Cm ether Ns [0] & 1 != 0
d629 3
a631 1
True if the packet is an IP multicast packet.
d641 5
a645 2
These identifiers are also shell keywords and must be escaped.
In the case of FDDI (e.g.,
d647 6
a652 3
the protocol identification comes from the 802.2 Logical Link Control
.Pq LLC
header, which is usually layered on top of the FDDI header.
d654 11
a664 2
assumes, when filtering on the protocol identifier, that all FDDI packets
include an LLC header, and that the LLC header is in so-called SNAP format.
d676 2
a677 1
host name support is only available on systems that are configured to run
d690 2
a691 2
True if the packet was logged as coming from the specified interface
(applies only to packets logged by
d702 1
a702 1
Synonymous with the
d714 1
a714 1
.Ar memory
d722 1
a722 1
Synonymous with the
d730 1
a730 1
Synonymous with the
d738 1
a738 1
.Ar block
d781 3
a783 1
.Pq expressed in standard C syntax ,
d792 2
a793 2
To access data inside the packet, use the following syntax:
.Sm off
d795 1
a795 1
.Ar proto Op Ar expr : Ar size
a796 1
.Sm on
d809 4
a812 2
and indicates the protocol layer for the index operation.
The byte offset, relative to the indicated protocol layer, is given by
d815 2
a816 2
is optional and indicates the number of bytes in the field of interest;
it can be either one, two, or four, and defaults to one.
d819 2
a820 1
gives the length of the packet.
d823 1
a823 1
.Dq Cm ether Ns [0] & 1 != 0
d826 4
a829 2
.Dq Cm ip Ns [0] & 0xf != 5
catches all IP packets with options.
d831 1
a831 1
.Dq Cm ip Ns [6:2] & 0x1fff = 0
d840 6
a845 2
always means the first byte of the TCP header,
and never means the first byte of an intervening fragment.
d848 2
a849 2
Primitives may be combined using a parenthesized group of primitives and
operators.
d851 1
a851 1
Allowable primitives and operators are:
d855 1
a855 1
.Dq Cm \&!
d859 1
a859 1

d862 1
a862 1
.Dq Cm &&
d866 1
a866 1

d876 2
a877 1
Alternation and concatenation have equal precedence and associate left to right.
d883 2
a884 1
If an identifier is given without a keyword, the most recent keyword is assumed.
d909 4
a912 4
as either a single argument or as multiple arguments,
whichever is more convenient.
Generally, if the expression contains shell metacharacters,
it is easier to pass it as a single, quoted argument.
d916 4
d921 8
a928 1
.Dl # tcpdump host sundown
d930 10
a939 9
To print traffic between helios and either hot or ace
(the expression is quoted to prevent the shell from mis-interpreting
the parentheses):
.Pp
.Dl # tcpdump 'host helios and (hot or ace)'
.Pp
To print all IP packets between ace and any host except helios:
.Pp
.Dl # tcpdump ip host ace and not helios
d942 5
d948 11
a958 1
.Dl # tcpdump net ucb-ether
d960 3
a962 3
To print all FTP traffic through internet gateway snup:
.Pp
.Dl # tcpdump 'gateway snup and (port ftp or ftp-data)'
d965 9
a973 2
(if you gateway to one other net, this stuff should never make it onto
your local net):
d975 16
a990 1
.Dl # tcpdump ip and not net localnet
d992 8
a999 5
To print the start and end packets
.Pq the SYN and FIN packets
of each TCP connection that involves a non-local host:
.Bd -literal -offset indent
# tcpdump 'tcp[13] & 3 != 0 and not src and dst net localnet'
d1002 3
a1004 5
To print IP packets longer than 576 bytes sent through gateway snup:
.Pp
.Dl # tcpdump 'gateway snup and ip[2:2] > 576'
.Pp
To print IP broadcast or multicast packets that were
d1007 6
a1012 2
.Bd -literal -offset indent
# tcpdump 'ether[0] & 1 = 0 and ip[16] >= 224'
d1015 10
a1024 2
To print all ICMP packets that are not echo requests/replies
.Pq i.e., not ping packets :
d1026 13
a1038 5
.Dl # tcpdump 'icmp[0] != 8 and icmp[0] != 0'
.Pp
To print and decrypt all ESP packets with SPI 0x00001234:
.Pp
.Dl # tcpdump -E des3-hmac96:ab...def 'ip[20:4] = 0x00001234'
d1044 3
a1046 1
.Ss Link Level Headers
d1054 8
a1061 10
.Xr pflog 4 ,
logging reason
.Pq rule match, bad-offset, fragment, short, normalize, memory ,
action taken
.Pq pass/block ,
direction
.Pq in/out
and interface information are printed out for each packet.
.Pp
On FDDI networks, the
d1065 2
a1066 1
to print the frame control field, the source and destination addresses,
d1068 5
a1072 3
The frame control field governs the interpretation of the rest of the packet.
Normal packets
.Pq such as those containing IP datagrams
d1075 2
a1076 1
packets, with a priority value between 0 and 7; for example,
d1078 7
a1084 3
Such packets are assumed to contain an 802.2 Logical Link Control
.Pq LLC
packet; the LLC header is printed if it is
d1086 6
a1091 1
an ISO datagram or a so-called SNAP packet.
d1093 9
a1101 4
The following description assumes familiarity with the
SLIP compression algorithm described in RFC 1144.
.Pp
On SLIP links, a direction indicator
d1104 1
a1104 1
for inbound,
d1115 6
a1120 2
No further link information is printed for IP packets.
For TCP packets, the connection identifier is printed following the type.
d1123 1
a1123 1
.Cm *S+ Ns Ar n
d1125 1
a1125 1
.Cm *SA+ Ns Ar n ,
d1128 2
a1129 2
is the amount by which the sequence number
.Pq or sequence number and ack
d1145 1
a1145 1
.Pq +n or -n ,
d1147 1
a1147 1
.Pq =n .
d1151 3
a1153 1
For example, the following line shows an outbound compressed TCP packet,
d1155 3
a1157 2
the sequence number by 49, and the packet ID by 6;
there are 3 bytes of data and 6 bytes of compressed header:
d1160 4
a1163 4
.Cm ctcp No *
.Cm A No +6
.Cm S No +49
.Cm I No +6 3
d1166 3
a1168 1
.Ss ARP/RARP Packets
d1171 2
a1172 2
Here is a short sample taken from the start of an rlogin
from host rtsg to host csam:
d1174 2
a1175 2
arp who-has csam tell rtsg
arp reply csam is-at CSAM
d1178 4
a1181 4
In this example, Ethernet addresses are in caps and internet addresses
in lower case.
The first line says that rtsg sent an arp packet asking for
the Ethernet address of internet host csam.
d1188 1
a1188 1
arp who-has 128.3.254.6 tell 128.3.254.68
d1202 3
a1204 3
For the first packet this says the Ethernet source address is RTSG,
the destination is the Ethernet broadcast address,
the type field contained hex 0806 (type
d1207 10
a1216 4
.Ss TCP Packets
The following description assumes familiarity with the TCP protocol
described in RFC 793.
If you are not familiar with the protocol, neither this description nor
d1220 1
a1220 1
The general format of a TCP protocol line is:
d1222 2
a1223 2
.Ar src No > Ar dst :
.Ar flags src-os data-seqno ack window urgent options
d1229 3
a1231 1
are the source and destination IP addresses and ports.
d1250 1
a1250 1
.Ar src-os
d1255 1
a1255 1
.Ar data-seqno
d1257 1
a1257 2
by the data in this packet
.Pq see example below .
d1267 2
a1268 2
are TCP options enclosed in angle brackets e.g.,
.Aq mss 1024 .
d1270 1
a1270 1
.Ar src , dst
d1274 1
a1274 1
The other fields depend on the contents of the packet's TCP protocol header and
d1278 1
a1278 1
.Bd -unfilled -offset 2n
d1290 1
a1290 1
The first line says that TCP port 1023 on rtsg sent a packet
d1294 3
a1296 1
indicates that the SYN flag was set.
d1301 2
a1302 2
.Ar first : last
.Po Ar nbytes
d1306 3
a1308 1
which means sequence numbers
d1316 2
a1317 1
bytes and there was a max-segment-size option requesting an mss of 1024 bytes.
d1320 4
a1323 2
ack for rtsg's SYN.
Rtsg then acks csam's SYN.
d1331 1
a1331 1
sees a TCP connection, it prints the sequence number from the packet.
d1349 3
a1351 1
The PUSH flag is set in the packet.
d1354 2
a1355 2
Most of this data is apparently sitting in the socket buffer
since csam's receive window has gotten 19 bytes smaller.
a1358 2
.Ss UDP Packets
UDP format is illustrated by this rwho packet:
d1360 7
a1366 1
.D1 actinide.who > broadcast.who: udp 84
d1368 3
a1370 2
This says that port who on host actinide sent a UDP datagram to port
who on host broadcast, the Internet broadcast address.
d1373 3
a1375 2
Some UDP services are recognized
.Pq from the source or destination port number
d1378 10
a1387 5
.Pq RFC 1034/1035
and Sun RPC calls
.Pq RFC 1050
to NFS.
.Ss UDP Name Server Requests
d1389 5
a1393 3
the Domain Service protocol described in RFC 1035.
If you are not familiar with the protocol,
the following description will appear to be written in Greek.
d1400 1
a1400 1
.Ar id op Ns ?\&
a1402 1
.Ed
d1406 2
a1407 1
.D1 h2opolo.1538 > helios.domain: 3+ A? ucbvax.berkeley.edu. (37)
d1410 1
a1410 1
.Pq Ar qtype Ns =A
d1419 5
a1423 1
The query length was 37 bytes, not including the UDP and IP protocol headers.
d1431 3
a1433 1
had been anything else, it would have been printed between the 3 and the
d1461 2
a1462 1
AA, RA or rcode
d1467 1
a1467 1
.Dq Bq b2&3= Ns Ar x
d1471 3
a1473 1
.Ss UDP Name Server Responses
a1484 1
.Ed
d1487 1
a1487 1
.Bd -unfilled -offset indent
d1489 1
d1500 5
a1504 1
The total size of the response was 273 bytes, excluding UDP and IP headers.
d1513 1
a1513 1
.Pq C_IN
d1516 2
a1517 1
In the second example, helios responds to query
d1519 1
a1519 1
2 with an
d1536 3
a1538 2
.Sq -
(recursion available, RA,
d1542 4
a1545 2
.Sq \*(Ba
.Pq truncated message, TC, set .
d1550 2
a1551 1
Name server requests and responses tend to be large and the default
d1553 2
a1554 1
of 68 bytes may not capture enough of the packet to print.
d1559 2
a1560 1
if you need to seriously investigate name server traffic.
d1563 4
a1566 2
.Ss NFS Requests and Replies
Sun NFS
d1575 1
a1575 1

d1581 1
a1581 1
.Bd -unfilled -offset indent
d1590 2
a1591 1
In the first line, host sushi sends a transaction with ID 6709 to wrl.
d1595 5
a1599 1
The request was 112 bytes, excluding the UDP and IP headers.
d1602 1
a1602 2
was a readlink
.Pq read symbolic link
d1613 1
a1613 1
In the third line, sushi asks wrl to look up the name
d1618 3
a1620 1
if read in conjunction with an NFS protocol spec.
d1627 1
a1627 1
.Bd -unfilled -offset indent
d1635 5
a1639 3
also prints the IP header TTL, ID, and fragmentation fields,
which have been omitted from this example.
In the first line, sushi asks wrl to read 8192 bytes from file 21,11/12.195,
d1644 9
a1652 4
the packet shown on the second line is the first fragment of the reply,
and hence is only 1472 bytes long.
The other bytes will follow in subsequent fragments,
but these fragments do not have NFS or even UDP headers and so might not be
d1670 3
a1672 1
NFS requests are very large and much of the detail won't be printed unless
d1677 8
a1684 3
to watch NFS traffic.
.Pp
NFS reply packets do not explicitly identify the RPC operation.
d1689 2
a1690 1
requests, and matches them to the replies using the
d1693 18
a1710 6
If a reply does not closely follow the corresponding request,
it might not be parsable.
.Ss KIP AppleTalk (DDP in UDP)
AppleTalk DDP packets encapsulated in UDP datagrams
are de-encapsulated and dumped as DDP packets
.Pq i.e., all the UDP header information is discarded .
d1715 7
a1721 6
.Bl -column "number" "name" -offset indent
.It Sy "number" Ta Ta Sy "name"
.It "1.254" Ta Ta "ether"
.It "16.1" Ta Ta "icsd-net"
.It "1.254.110" Ta Ta "ace"
.El
a1741 1
.Ed
d1744 1
a1744 1
.Bd -unfilled -offset indent
d1746 1
d1748 1
d1756 3
a1758 2
In the first example, NBP
.Pq DDP port 2
d1761 2
a1762 1
The second line is the same except the full name of the source node is known
d1765 6
a1770 5
net jssmag node 149 to broadcast on the icsd-net NBP port.
The broadcast address
.Pq 255
is indicated by a net name with no host number;
for this reason it is a good idea to keep node names and net names distinct in
d1773 1
a1773 1
NBP
d1775 2
a1776 1
and ATP
d1781 2
a1782 1
or number if no name is registered for the protocol
d1786 3
a1788 2
NBP packets are formatted like the following examples:
.Bd -unfilled
d1794 2
a1795 2
The first line is a name lookup request for laserwriters sent by
net icsdi-net host
d1799 1
a1799 1
.Pq note that it has the same ID
d1802 3
a1804 2
The third line is another reply to the same request
saying host techpit has laserwriter techpit registered on port 186.
d1806 3
a1808 2
ATP packet formatting is demonstrated by the following example:
.Bd -unfilled -offset indent
d1825 1
a1825 1
Jssmag.209 initiates transaction ID 12266 with host helios by requesting
d1828 1
a1828 1
.Pq the Dq Aq 0\-7 .
d1834 1
a1834 1
Helios responds with 8 512-byte packets.
d1838 1
a1838 1
transaction ID gives the packet sequence number in the transaction
d1840 1
a1840 1
excluding the ATP header.
d1843 3
a1845 1
on packet 7 indicates that the EOM bit was set.
d1857 3
a1859 1
.Ss IP Fragmentation
d1868 1
a1868 1
.Op +
d1883 3
a1885 1
excluding the IP header.
d1896 5
a1900 3
For example, here is part of an FTP from arizona.edu to lbl-rtsg.arpa
over a CSNET connection that doesn't appear to handle 576 byte datagrams:
.Bd -unfilled -offset indent
d1908 5
a1912 4
This is because the TCP protocol information is all in the first fragment
and we have no idea what the port or sequence numbers are when we print
the later fragments.
Second, the TCP sequence information in the first line is printed as if there
d1917 2
a1918 1
If you are looking for holes in the sequence space or trying to match up acks
d1921 5
a1925 3
A packet with the IP
.Sy don't fragment
flag is marked with a trailing
d1927 3
a1929 1
.Ss Timestamps
a1943 1
.Xr ethers 3 ,
a1945 6
.Xr ip 4 ,
.Xr pf 4 ,
.Xr pflog 4 ,
.Xr tcp 4 ,
.Xr udp 4 ,
.Xr networks 5 ,
a1946 35
.Rs
.%R RFC 793
.%T Transmission Control Protocol
.%D September 1981
.Re
.Rs
.%R RFC 1034
.%T Domain Names \- Concepts and Facilities
.%D November 1987
.Re
.Rs
.%R RFC 1035
.%T Domain Names \- Implementation and Specification
.%D November 1987
.Re
.Rs
.%R RFC 1050
.%T RPC: Remote Procedure Call
.%D April 1988
.Re
.Rs
.%R RFC 1144
.%T Compressing TCP/IP Headers for Low-Speed Serial Links
.%D February 1990
.Re
.Rs
.%R RFC 2018
.%T TCP Selective Acknowledgement Options
.%D October 1996
.Re
.Rs
.%R RFC 2406
.%T IP Encapsulating Security Payload (ESP)
.%D November 1998
.Re
d1948 8
a1955 5
.An Van Jacobson Aq van@@ee.lbl.gov ,
.An Craig Leres Aq leres@@ee.lbl.gov ,
and
.An Steven McCanne Aq mccanne@@ee.lbl.gov ,
all of the Lawrence Berkeley Laboratory, University of California, Berkeley, CA.
d1957 1
a1957 4
Please send bug reports to
.Aq tcpdump@@ee.lbl.gov
or
.Aq libpcap@@ee.lbl.gov .
d1959 4
a1962 2
Some attempt should be made to reassemble IP fragments,
or at least to compute the right length for the higher level protocol.
d1966 2
a1967 1
question section is printed rather than the real query in the answer section.
d1972 10
a1981 5
Apple Ethertalk DDP packets could be dumped as easily as KIP DDP packets
but aren't.
Even if we were inclined to do anything to promote the use of Ethertalk
(we aren't, LBL doesn't allow Ethertalk on any of its
networks so we'd have no way of testing this code).
d1984 1
a1984 2
skewed time stamps
.Pq the time change is ignored .
d1986 9
a1994 3
Filter expressions that manipulate FDDI headers assume that all FDDI packets
are encapsulated Ethernet packets.
This is true for IP, ARP, and
d1997 2
a1998 1
but is not true for protocols such as ISO CLNS.
@


1.1.1.8
log
@Time to import OpenBSD once again. Expect breakage.
@
text
@d1 1
a1 1
.\"	$OpenBSD: tcpdump.8,v 1.43 2003/10/12 10:59:47 dhartmei Exp $
d170 2
a171 2
bytes of data from each packet rather than the default of 96.
96 bytes is adequate for IP, ICMP, TCP, and UDP,
d1324 1
a1324 1
of 96 bytes may not capture enough of the packet to print.
@


1.1.1.9
log
@large-scale import of OpenBSD 3.5-current source base including many fixes
note: from now, we will not be binary compatible with OpenBSD apps any
longer (due to syscall numbering differences); both an OpenBSD compat and
a conversion tool for old MirOS #7 apps will be delivered later.

The src/ tree is locked from now.
@
text
@d1 1
a1 1
.\"	$OpenBSD: tcpdump.8,v 1.46 2004/05/06 11:25:11 jmc Exp $
a201 2
.Cm vrrp
.Pq Virtual Router Redundancy protocol ,
a637 1
.Ar bad-timestamp ,
@


1.1.1.10
log
@import some updates/fixes from openbsd
@
text
@d1 1
a1 1
.\"	$OpenBSD: tcpdump.8,v 1.49 2004/09/16 11:29:51 markus Exp $
a195 4
.It Fl tttt
Print timestamp difference between packets.
.It Fl ttttt
Print timestamp difference since the first packet.
a213 2
.Cm tcp
.Pq Transmission Control Protocol ,
@


