head	1.6;
access;
symbols
	tg-mergetmp-mirosx-1:1.6
	tg-mergefixes-1-branch:1.6.0.4
	tg-mergefixes-1-base:1.6
	MIROS_X:1.6.0.2
	MIROS_X_BASE:1.6
	tg-mergetmp-3:1.6
	cvs-200412121715:1.1.1.3
	cvs-200412040100:1.1.1.2
	MIRBSD_XP_MIRPPC:1.5.0.4
	aphttpd-1_3_33:1.1.8.2
	cvs-200410222040:1.1.1.2
	tg-mergetmp-1:1.1.1.2
	MIRBSD_XP_SPARC_BASE:1.5
	MIRBSD_XP_SPARC:1.5.0.2
	cvs-200408220000:1.1.1.2
	aphttpd-1_3_31:1.1.8.2
	ASF:1.1.8
	MIRBSD_7quater:1.2
	cvs-200405160640:1.1.1.2
	cvs-200401271800:1.1.1.2
	cvs-200401261630:1.1.1.2
	cvs-200401021645:1.1.1.2
	MIRBSD_7_ALPHA:1.2.0.6
	MIRBSD_7:1.2.0.4
	cvs-200312222040:1.1.1.2
	MIRBSD_7ter:1.2
	apache-1_3_29:1.1.8.1
	apache-1_3_28:1.1.8.1
	apache:1.1.8
	MIRBSD_7_DEV:1.2.0.2
	cvs-200310020700:1.1.1.2
	cvs-200309271030:1.1.1.2
	cvs-200309261655:1.1.1.2
	cvs-200309251530:1.1.1.2
	cvs-200308302005:1.1.1.2
	cvs-200308171200:1.1.1.1
	ctm-3496:1.1.1.1
	ctm-3449:1.1.1.1
	ctm-3437:1.1.1.1
	cvs-200307191805:1.1.1.1
	ctm-3425:1.1.1.1
	cvs-200307091500:1.1.1.1
	ctm-3389:1.1.1.1
	cvs-200306291430:1.1.1.1
	ctm-3341:1.1.1.1
	MIRBSD_5:1.1.1.1
	cvs-200306082100:1.1.1.1
	ctm-3316:1.1.1.1
	ctm-3272:1.1.1.1
	ctm-3264:1.1.1.1
	cvs-200305071630:1.1.1.1
	MIRBSD_4:1.1.1.1
	ctm-3203:1.1.1.1
	cvs-20030410-1130:1.1.1.1
	ctm-3155:1.1.1.1
	ctm-3132:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@.\" @;


1.6
date	2004.12.12.18.03.28;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2004.09.12.15.48.22;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2004.08.21.22.58.06;	author tg;	state Stab;
branches;
next	1.3;

1.3
date	2004.07.15.19.11.25;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2003.07.19.16.11.49;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.22.17.55.41;	author tg;	state Exp;
branches
	1.1.1.1
	1.1.8.1;
next	;

1.1.1.1
date	2003.03.22.17.55.41;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.08.30.23.56.40;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2004.12.12.17.20.56;	author tg;	state Exp;
branches;
next	;

1.1.8.1
date	2003.10.29.14.15.30;	author tg;	state Exp;
branches;
next	1.1.8.2;

1.1.8.2
date	2004.07.15.17.06.13;	author tg;	state Exp;
branches;
next	;


desc
@@


1.6
log
@go back from base-upon-ASF-httpd-1.3.33 to 1.3.29 then up via OpenBSD;
unmerge stuff not needed; shuffle stuff around, etc.
add some RCS IDs

builds, serves default pages on odem successfully
@
text
@.\"	$OpenBSD: apxs.8,v 1.13 2004/12/07 22:00:04 jmc Exp $
.\"
.\" ====================================================================
.\" The Apache Software License, Version 1.1
.\"
.\" Copyright (c) 2000-2003 The Apache Software Foundation.  All rights
.\" reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\"
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\"
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in
.\"    the documentation and/or other materials provided with the
.\"    distribution.
.\"
.\" 3. The end-user documentation included with the redistribution,
.\"    if any, must include the following acknowledgment:
.\"       "This product includes software developed by the
.\"        Apache Software Foundation (http://www.apache.org/)."
.\"    Alternately, this acknowledgment may appear in the software itself,
.\"    if and wherever such third-party acknowledgments normally appear.
.\"
.\" 4. The names "Apache" and "Apache Software Foundation" must
.\"    not be used to endorse or promote products derived from this
.\"    software without prior written permission. For written
.\"    permission, please contact apache@@apache.org.
.\"
.\" 5. Products derived from this software may not be called "Apache",
.\"    nor may "Apache" appear in their name, without prior written
.\"    permission of the Apache Software Foundation.
.\"
.\" THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
.\" WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
.\" DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
.\" ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
.\" SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
.\" LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
.\" USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
.\" ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
.\" OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
.\" OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\" ====================================================================
.\"
.\" This software consists of voluntary contributions made by many
.\" individuals on behalf of the Apache Software Foundation.  For more
.\" information on the Apache Software Foundation, please see
.\" <http://www.apache.org/>.
.\"
.\" Portions of this software are based upon public domain software
.\" originally written at the National Center for Supercomputing Applications,
.\" University of Illinois, Urbana-Champaign.
.\"
.Dd December 7, 2004
.Dt APXS 8
.Os
.Sh NAME
.Nm apxs
.Nd APache eXtenSion tool
.Sh SYNOPSIS
.Nm
.Bk -words
.Fl c
.Xo
.Oo Fl D
.Ar variable Ns Oo = Ns Ar value Oc Oc
.Xc
.Op Fl I Ar incdir
.Op Fl L Ar libdir
.Op Fl l Ar libname
.No \ \&\ \& Op Fl o Ar dsofile
.Xo
.Oo Fl S
.Ar variable Ns = Ns Ar value Oc
.Xc
.Op Fl Wc , Ns Ar compiler-flags
.No \ \&\ \& Op Fl Wl , Ns Ar linker-flags
.Ar file ...
.Ek
.Nm
.Fl e
.Op Fl Aa
.Op Fl n Ar name
.Xo
.Oo Fl S
.Ar variable Ns = Ns Ar value Oc
.Xc
.Ar dsofile ...
.Nm
.Fl g
.Xo
.Oo Fl S
.Ar variable Ns = Ns Ar value Oc
.Xc
.Fl n Ar name
.Nm
.Fl i
.Op Fl Aa
.Op Fl n Ar name
.Xo
.Oo Fl S
.Ar variable Ns = Ns Ar value Oc
.Xc
.Ar dsofile ...
.Nm
.Fl q
.Xo
.Oo Fl S
.Ar variable Ns = Ns Ar value Oc
.Xc
.Ar query ...
.Sh DESCRIPTION
.Nm
is a tool for building and installing extension modules for the
HyperText Transfer Protocol (HTTP) server,
.Xr httpd 8 .
This is achieved by building a
Dynamic Shared Object (DSO)
from one or more source or object files
which can then be loaded into httpd at runtime via the
.Ic LoadModule
directive from
.Ic mod_so .
To use this extension mechanism,
your platform has to support the DSO feature
and the httpd binary has to be built with the
.Ic mod_so
module.
The
.Nm
tool automatically complains if this is not the case.
Check by manually running the following command:
.Pp
.Dl $ httpd -l
.Pp
The module
.Ic mod_so
should be part of the displayed list.
If these requirements are fulfilled,
httpd's functionality can be extended by
installing modules with the DSO mechanism,
with the help of the
.Nm
tool:
.Bd -literal -offset indent
# apxs -i -a -c mod_foo.c
gcc -O2 -pipe -DDEV_RANDOM=/dev/arandom -DMOD_SSL=208116 -DEAPI -DUSE_EXPAT -DUSE_SETUSERCONTEXT -fPIC -DSHARED_MODULE -I/usr/libexec/httpd/include  -c mod_foo.c
[activating module `foo' in /var/www/conf/httpd.conf]
cp mod_foo.so /usr/libexec/httpd/modules/mod_foo.so
chmod 755 /usr/libexec/httpd/modules/mod_foo.so
cp /var/www/conf/httpd.conf /var/www/conf/httpd.conf.bak
cp /var/www/conf/httpd.conf.new /var/www/conf/httpd.conf
rm /var/www/conf/httpd.conf.new
# kill $(</var/www/logs/httpd.pid)
# httpd [flags]
.Ed
.Pp
The argument
.Ar file
can be any C source file (.c),
an object file (.o),
or even a library archive (.a).
The
.Nm
tool automatically recognizes these extensions and automatically uses the C
source files for compilation,
whereas it just uses the object and archive files for the linking phase.
But when using such pre-compiled objects,
make sure they are compiled for Position Independent Code (PIC)
to be able to use them for a DSO.
For instance, with
.Xr gcc 1
just use
.Fl fpic .
For other
C compilers, please consult their manual pages or watch for the flags
.Nm
uses to compile the object files.
.Pp
For more details about DSO support in httpd,
first read the background information about DSO in
.Pa htdocs/manual/dso.html ,
then read the documentation of
.Ic mod_so .
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl A
Same as the
.Fl a
option but the created
.Ic LoadModule
directive is prefixed with a hash sign (#),
i.e. the module is just prepared for later activation but initially disabled.
.It Fl a
This activates the module by automatically adding a corresponding
.Ic LoadModule
line to httpd's httpd.conf configuration file,
or by enabling it if it already exists.
.It Fl c
Compile.
This option first compiles the C source files (.c) of
.Ar file ...\&
into corresponding object files (.o) and then builds a DSO in
.Ar dsofile
by linking these object files plus the remaining object files (.o and .a) of
.Ar file ...
If no
.Fl o
option is specified,
the output file is guessed from the first filename in
.Ar file ...\&
and thus usually defaults to
.No mod_ Ns Ar name Ns \&.so
.It Xo
.Fl D
.Ar variable Ns Op = Ns Ar value
.Xc
This option is directly passed through to the compilation command(s).
Use this to add your own defines to the build process.
.It Fl e
Edit.
This option can be used with the
.Fl a
and
.Fl A
options to edit the
configuration file,
.Pa /var/www/conf/httpd.conf ,
without attempting to install the module.
.It Fl g
Template generation.
This option generates a subdirectory
.Ar name
(see the
.Fl n
option)
and two files:
a sample module source file named
.No mod_ Ns Ar name Ns \&.c ,
which can be used as a template for creating your own modules or
as a quick start for playing with the
.Nm
mechanism,
and a corresponding
.Pa Makefile
for even easier building and installing of this module.
.It Fl I Ar incdir
This option is directly passed through to the compilation command(s).
Use this to add your own include directories to search to the build process.
.It Fl i
Install.
This option installs one or more DSOs into the server's
.Ar libexec
directory.
.It Fl L Ar libdir
This option is directly passed through to the linker command.
Use this to add your own library directories to search to the build process.
.It Fl l Ar libname
This option is directly passed through to the linker command.
Use this to add your own libraries to search to the build process.
.It Fl n Ar name
This explicitly sets the module name for the
.Fl i
(install)
and
.Fl g
(template generation) option.
Use this to explicitly specify the module name.
For option
.Fl g
this is required;
for option
.Fl i ,
.Nm
tries to determine the name from the source or (as a fallback) at least
by guessing it from the filename.
.It Fl o Ar dsofile
Explicitly specifies the filename of the created DSO file.
If not specified and the name cannot be guessed from the
.Ar file ...\&
list,
the fallback name
.Ar mod_unknown.so
is used.
.It Fl q
Query.
This option performs a query for
.Nm apxs Ns 's
knowledge about certain settings.
The
.Ar query
parameters can be one or more of the following variable names:
.Bd -literal -offset indent
CC              TARGET
CFLAGS          SBINDIR
CFLAGS_SHLIB    INCLUDEDIR
LD_SHLIB        LIBEXECDIR
LDFLAGS_SHLIB   SYSCONFDIR
LIBS_SHLIB      PREFIX
.Ed
.Pp
Use this for manually determining settings.
For instance,
use the following inside your own Makefiles if you need manual access
to httpd's C header files:
.Pp
.Dl INC=-I`apxs -q INCLUDEDIR`
.It Fl S Ar variable Ns = Ns Ar value
This option changes the
.Nm
settings described above.
.It Fl Wc , Ns Ar compiler-flags
This option passes
.Ar compiler-flags
as additional flags to the compiler command.
Use this to add local compiler-specific options.
This option may be specified multiple times
in order to pass multiple flags.
.It Fl Wl , Ns Ar linker-flags
This option passes
.Ar linker-flags
as additional flags to the linker command.
Use this to add local linker-specific options.
This option may be specified multiple times
in order to pass multiple flags.
.El
.Sh EXAMPLES
Assume you have a module named
.Dq mod_foo.c
available which should extend httpd's functionality.
To accomplish this,
first compile the C source into a DSO
suitable for loading into httpd at runtime via the following command:
.Bd -literal -offset indent
# apxs -c mod_foo.c
gcc -O2 -pipe -DDEV_RANDOM=/dev/arandom -DMOD_SSL=208116 -DEAPI -DUSE_EXPAT -DUSE_SETUSERCONTEXT -fPIC -DSHARED_MODULE -I/usr/libexec/httpd/include  -c mod_foo.c
gcc -shared -fPIC -DSHARED_MODULE -o mod_foo.so mod_foo.o
.Ed
.Pp
Then a
.Ic LoadModule
directive has to be added to httpd's configuration file to load the DSO.
To simplify this step,
.Nm
provides an automatic way to install the DSO in the
.Dq libexec
directory and update the httpd.conf file accordingly.
This can be achieved by running the following:
.Bd -literal -offset indent
$ apxs -i -a mod_foo.so
[activating module `foo' in /var/www/conf/httpd.conf]
cp mod_foo.so /usr/libexec/httpd/modules/mod_foo.so
chmod 755 /usr/libexec/httpd/modules/mod_foo.so
cp /var/www/conf/httpd.conf /var/www/conf/httpd.conf.bak
cp /var/www/conf/httpd.conf.new /var/www/conf/httpd.conf
rm /var/www/conf/httpd.conf.new
.Ed
.Pp
This way a line such as the following
is added to the configuration file:
.Pp
.Dl LoadModule foo_module /usr/libexec/httpd/modules/mod_foo.so
.Pp
If you want the module added to the configuration file
without it being enabled,
use the
.Fl A
option instead:
.Pp
.Dl $ apxs -i -A mod_foo.so
.Pp
For a quick test of the
.Nm
mechanism,
create a sample module template plus a corresponding
.Ar Makefile
via:
.Bd -literal -offset indent
# apxs -g -n foo
Creating [DIR]  foo
Creating [FILE] foo/Makefile
Creating [FILE] foo/mod_foo.c
.Ed
.Pp
The sample module can then be immediately compiled into a DSO
and loaded into the httpd server:
.Bd -literal -offset indent
$ cd foo
$ make all reload
apxs -c    mod_foo.c
gcc -O2 -pipe -DDEV_RANDOM=/dev/arandom -DMOD_SSL=208116 -DEAPI -DUSE_EXPAT -DUSE_SETUSERCONTEXT -fPIC -DSHARED_MODULE -I/usr/libexec/httpd/include  -c mod_foo.c
gcc -shared -fPIC -DSHARED_MODULE -o mod_foo.so mod_foo.o
apxs -i -a -n 'foo' mod_foo.so
[activating module `foo' in /var/www/conf/httpd.conf]
cp mod_foo.so /usr/libexec/httpd/modules/mod_foo.so
chmod 755 /usr/libexec/httpd/modules/mod_foo.so
cp /var/www/conf/httpd.conf /var/www/conf/httpd.conf.bak
cp /var/www/conf/httpd.conf.new /var/www/conf/httpd.conf
rm /var/www/conf/httpd.conf.new
kill $(</var/www/logs/httpd.pid)
httpd [flags]
.Ed
.Pp
.Nm
can even be used to compile complex modules
outside the httpd source tree,
like PHP3,
because
.Nm
automatically recognizes C source files and object files.
.Bd -literal -offset indent
$ cd php3
$ ./configure --with-shared-apache=../httpd
$ apxs -c -o libphp3.so mod_php3.c libmodphp3-so.a
gcc -fpic -DSHARED_MODULE -I/tmp/httpd/include  -c mod_php3.c
ld -Bshareable -o libphp3.so mod_php3.o libmodphp3-so.a
.Ed
.Pp
Only C source files are compiled,
while remaining object files are used for the linking phase.
.Sh SEE ALSO
.Xr gcc 1 ,
.Xr httpd 8
@


1.5
log
@nuke apache(TM)ctl

I didn't trust it (for starting), and chroot'd httpds don't often
reload correctly.

to stop httpd:
kill $(</var/www/logs/httpd.pid)

to start it anew:
first, look what flags are given in rc/rc.conf/rc.conf.local (eg. -DSSL)
then sudo httpd flags (or just sudo httpd)
@
text
@d1 1
a1 2
.TH apxs 8 "February 2004"
.\" Copyright 1999-2004 The Apache Software Foundation
d3 125
a127 98
.\" Licensed under the Apache License, Version 2.0 (the "License");
.\" you may not use this file except in compliance with the License.
.\" You may obtain a copy of the License at
.\"
.\"     http://www.apache.org/licenses/LICENSE-2.0
.\"
.\" Unless required by applicable law or agreed to in writing, software
.\" distributed under the License is distributed on an "AS IS" BASIS,
.\" WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
.\" See the License for the specific language governing permissions and
.\" limitations under the License.
.\"
.SH NAME
apxs \- APache eXtenSion tool
.SH SYNOPSIS
.B apxs
.B \-g
[
.BI \-S " variable=value
]
.BI \-n " name"

.B apxs
.B \-q
[
.BI \-S " variable=value
]
.IR query " ..."

.B apxs
.B \-c
[
.BI \-S " variable=value
]
[
.BI \-o " dsofile"
]
[
.BI \-I " incdir"
]
[
.BI \-D " variable[=value]"
]
[
.BI \-L " libdir"
]
[
.BI \-l " libname"
]
[
.BI \-Wc, "compiler-flags"
]
[
.BI \-Wl, "linker-flags"
]
.IR files " ..."

.B apxs
.B \-i
[
.BI \-S " variable=value
]
[
.BI \-n " name"
]
[
.B \-a
]
[
.B \-A
]
.IR dsofile " ..."

.B apxs
.B \-e
[
.BI \-S " variable=value
]
[
.BI \-n " name"
]
[
.B \-a
]
[
.B \-A
]
.IR dsofile " ..."
.PP
.SH DESCRIPTION
.B apxs
is a tool for building and installing extension modules for the Apache
HyperText Transfer Protocol (HTTP) server. This is achieved by building a
Dynamic Shared Object (DSO) from one or more source or object
.I files
which can then be loaded into
the Apache server at runtime via the
.B LoadModule
d129 5
a133 8
.BR mod_so.

So to use this extension mechanism, your platform has
to support the DSO feature and your
Apache
.B httpd
binary has to be built with the
.B mod_so
d136 1
a136 1
.B apxs
d138 4
a141 6
You can check this yourself by manually running the command

.nf
  $ httpd -l
.fi

d143 1
a143 1
.B mod_so
d145 5
a149 4
If these requirements are fulfilled, you can easily extend
your Apache server's functionality by installing your own
modules with the DSO mechanism, with the help of this
.B apxs
d151 13
a163 13

.nf
  $ apxs -i -a -c mod_foo.c
  gcc -fpic -DSHARED_MODULE -I/path/to/apache/include -c mod_foo.c
  ld -Bshareable -o mod_foo.so mod_foo.o
  cp mod_foo.so /path/to/apache/libexec/mod_foo.so
  chmod 755 /path/to/apache/libexec/mod_foo.so
  [activating module `foo' in /path/to/apache/etc/httpd.conf]
  $ kill $(</var/www/logs/httpd.pid)
  $ httpd [flags]
  $ _
.fi

d165 6
a170 4
.I files
can be any C source file (.c), an object file (.o) or
even a library archive (.a). The
.B apxs
d172 9
a180 5
source files for compilation, whereas it just uses the object and archive
files for the linking phase. But when using such pre-compiled objects,
make sure they are compiled for Position Independent Code (PIC) to be able
to use them for a DSO. For instance, with GCC you just have to always use
.BR -fpic .
d182 2
a183 3
C compilers, please consult their manual
pages or watch for the flags
.B apxs
d185 25
a209 79

For more details about DSO support in Apache, first read the background
information about DSO in htdocs/manual/dso.html, then read the documentation
of
.BR mod_so .

.PP
.SH OPTIONS
Common options:
.TP 12
.BI \-n " name"
This explicitly sets the module name for the
.B \-i
(install)
and
.B \-g
(template generation) option. Use this to explicitly specify the module name.
For option
.B \-g
this is required, for option
.B \-i
the
.B apxs
tool tries to determine the name from the source or (as a fallback) at least
by guessing it from the filename.
.PP
Query options:
.TP 12
.B \-q
Performs a query for
.BR apxs 's
knowledge about certain settings. The
.I query
parameters can be one or more of the following variable names:
.nf
  CC              TARGET
  CFLAGS          SBINDIR
  CFLAGS_SHLIB    INCLUDEDIR
  LD_SHLIB        LIBEXECDIR
  LDFLAGS_SHLIB   SYSCONFDIR
  LIBS_SHLIB      PREFIX
.fi
Use this for manually determining settings. For instance use
.nf
  INC=-I`apxs -q INCLUDEDIR`
.fi
inside your own Makefiles if you need manual access
to Apache's C header files.
.PP
Configuration options:
.TP 12
.BI \-S " variable=value"
This option changes the
.B apxs
settings described above.
.PP
Template Generation options:
.TP 12
.B \-g
This generates a subdirectory
.I name
(see option
.BR \-n ")"
and two files: A sample module source file named
.BI mod_ name.c
which can be used as a template for creating your own modules or
as a quick start for playing with the
.B apxs
mechanism.
And a corresponding
.B Makefile
for even easier building and installing of this module.
.PP
DSO compilation options:
.TP 12
.B \-c
This indicates the compilation operation. It first compiles the C source
files (.c) of
.I files
d211 3
a213 4
.I dsofile
by linking these object files plus the remaining
object files (.o and .a) of
.I files
d215 2
a216 2
.B \-o
option is specified
d218 1
a218 1
.I files
d220 5
a224 11
.BI mod_ name.so
.TP 12
.BI \-o " dsofile"
Explicitly specifies the filename of the created DSO file. If
not specified and the name cannot be guessed from the
.I files
list, the fallback name
.B mod_unknown.so
is used.
.TP 12
.BI \-D " variable[=value]"
d227 28
a254 2
.TP 12
.BI \-I " incdir"
d257 6
a262 2
.TP 12
.BI \-L " libdir"
d265 1
a265 2
.TP 12
.BI \-l " libname"
d268 52
a319 2
.TP 12
.BI \-Wc, "compiler-flags"
d321 1
a321 1
.I compiler-flags
d324 3
a326 2
.TP 12
.BI \-Wl, "linker-flags"
d328 1
a328 1
.I linker-flags
d331 21
a351 54
.PP
DSO installation and configuration options:
.TP 12
.B \-i
This indicates the installation operation and installs one or more
DSOs into the
server's
.I libexec
directory.
.TP 12
.B \-a
This activates the module by automatically adding a corresponding
.B LoadModule
line to Apache's
.B httpd.conf
configuration file, or by enabling it if it already exists.
.TP 12
.B \-A
Same as option
.B \-a
but the created
.B LoadModule
directive is prefixed with a hash sign (#), i.e. the module is
just prepared for later activation but initially disabled.
.TP 12
.B \-e
This indicates the editing operation, which can be used with the
.B \-a
and
.B \-A
options similarly to the
.B \-i
operation to edit Apache's
.B httpd.conf
configuration file, without attempting to install the module.
.PD
.SH EXAMPLES
Assume you have an Apache module named mod_foo.c available which should extend
Apache's server functionality. To accomplish this you first have to compile
the C source into a DSO suitable for loading into the Apache server
under runtime via the following command:

.nf
  $ apxs -c mod_foo.c
  gcc -fpic -DSHARED_MODULE -I/path/to/apache/include -c mod_foo.c
  ld -Bshareable -o mod_foo.so mod_foo.o
  $ _
.fi

Then you have to update the Apache configuration by making sure a
.B LoadModule
directive is present to load this DSO. To simplify this
step
.B apxs
d353 26
a378 27
"libexec" directory and updating the
.B httpd.conf
file accordingly. This can be achieved by running:

.nf
  $ apxs -i -a mod_foo.c
  cp mod_foo.so /path/to/apache/libexec/mod_foo.so
  chmod 755 /path/to/apache/libexec/mod_foo.so
  [activating module `foo' in /path/to/apache/etc/httpd.conf]
  $ _
.fi

This way a line named

.nf
  LoadModule foo_module libexec/mod_foo.so
.fi

is added to the configuration file, if still not present.
If you want this operation to be disabled, use the
.B \-A
option, i.e.

.nf
  $ apxs -i -A mod_foo.c
.fi

d380 4
a383 4
.B apxs
mechanism you can create a sample Apache module
template plus a corresponding
.B Makefile
d385 32
a416 31

.nf
  $ apxs -g -n foo
  Creating [DIR]  foo
  Creating [FILE] foo/Makefile
  Creating [FILE] foo/mod_foo.c
  $ _
.fi

Then you can immediately compile this sample module into a DSO and
load it into the Apache server:

.nf
  $ cd foo
  $ make all reload
  apxs -c mod_foo.c
  gcc -fpic -DSHARED_MODULE -I/path/to/apache/include -c mod_foo.c
  ld -Bshareable -o mod_foo.so mod_foo.o
  apxs -i -a -n "foo" mod_foo.so
  cp mod_foo.so /path/to/apache/libexec/mod_foo.so
  chmod 755 /path/to/apache/libexec/mod_foo.so
  [activating module `foo' in /path/to/apache/etc/httpd.conf]
  $ kill $(</var/www/logs/httpd.pid)
  $ httpd [flags]
  $ _
.fi

You can even use
.B apxs
to compile complex modules outside the Apache source tree, like PHP3, because
.B apxs
d418 13
a430 20

.nf
  $ cd php3
  $ ./configure --with-shared-apache=../apache-1.3
  $ apxs -c -o libphp3.so mod_php3.c libmodphp3-so.a
  gcc -fpic -DSHARED_MODULE -I/tmp/apache/include  -c mod_php3.c
  ld -Bshareable -o libphp3.so mod_php3.o libmodphp3-so.a
  $ _
.fi

Only C source files are compiled, while remaining object files are used for the
linking phase.

.PD
.SH SEE ALSO
.BR rc(8),
.BR rc.conf(8),
.BR rc.conf.local(8),
.BR httpd(8).
.
@


1.4
log
@update to an older version of my httpd work
@
text
@d137 2
a138 4
  $ apachectl restart
  /path/to/apache/sbin/apachectl restart: httpd not running, trying to start
  [Tue Mar 31 11:27:55 1998] [debug] mod_so.c(303): loaded module foo_module
  /path/to/apache/sbin/apachectl restart: httpd started
d395 2
a396 4
  apachectl restart
  /path/to/apache/sbin/apachectl restart: httpd not running, trying to start
  [Tue Mar 31 11:27:55 1998] [debug] mod_so.c(303): loaded module foo_module
  /path/to/apache/sbin/apachectl restart: httpd started
d420 3
a422 1
.BR apachectl(1),
@


1.3
log
@merge... attempt I (I hate ASF httpd)
@
text
@d150 3
a152 3
source files for compilation, whereas it just uses the object and archive 
files for the linking phase. But when using such pre-compiled objects, 
make sure they are compiled for Position Independent Code (PIC) to be able 
d188 2
a189 2
.B \-q 
Performs a query for 
d196 4
a199 4
  CFLAGS          SBINDIR    
  CFLAGS_SHLIB    INCLUDEDIR 
  LD_SHLIB        LIBEXECDIR 
  LDFLAGS_SHLIB   SYSCONFDIR 
d212 2
a213 2
This option changes the 
.B apxs 
d226 1
a226 1
as a quick start for playing with the 
d277 1
a277 1
This option passes 
d283 1
a283 1
This option passes 
d307 1
a307 1
but the created 
d310 1
a310 1
just prepared for later activation but initially disabled. 
d369 1
a369 1
For a quick test of the 
d372 2
a373 2
template plus a corresponding 
.B Makefile 
d407 2
a408 2
.B apxs 
automatically recognizes C source files and object files.  
@


1.2
log
@o Update to Apache 1.3.28
o Retain OpenBSD changes
o Retain IPv6 changes
o Retain local (MirBSD) changes
o Remove some unused files
  o SSL stuff is in src/etc/ssl.certs.shar
  o SSL demonstration stuff is not needed
  o Windows®, Novell® Netware®, OS/2®, Cygwin, etc.
@
text
@d1 2
a2 3
.TH apxs 8 "April 1998"
.\" ====================================================================
.\" The Apache Software License, Version 1.1
d4 11
a14 53
.\" Copyright (c) 2000-2003 The Apache Software Foundation.  All rights
.\" reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\"
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\"
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in
.\"    the documentation and/or other materials provided with the
.\"    distribution.
.\"
.\" 3. The end-user documentation included with the redistribution,
.\"    if any, must include the following acknowledgment:
.\"       "This product includes software developed by the
.\"        Apache Software Foundation (http://www.apache.org/)."
.\"    Alternately, this acknowledgment may appear in the software itself,
.\"    if and wherever such third-party acknowledgments normally appear.
.\"
.\" 4. The names "Apache" and "Apache Software Foundation" must
.\"    not be used to endorse or promote products derived from this
.\"    software without prior written permission. For written
.\"    permission, please contact apache@@apache.org.
.\"
.\" 5. Products derived from this software may not be called "Apache",
.\"    nor may "Apache" appear in their name, without prior written
.\"    permission of the Apache Software Foundation.
.\"
.\" THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
.\" WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
.\" DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
.\" ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
.\" SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
.\" LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
.\" USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
.\" ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
.\" OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
.\" OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\" ====================================================================
.\"
.\" This software consists of voluntary contributions made by many
.\" individuals on behalf of the Apache Software Foundation.  For more
.\" information on the Apache Software Foundation, please see
.\" <http://www.apache.org/>.
.\"
.\" Portions of this software are based upon public domain software
.\" originally written at the National Center for Supercomputing Applications,
.\" University of Illinois, Urbana-Champaign.
@


1.1
log
@Initial revision
@
text
@d5 1
a5 1
.\" Copyright (c) 2000-2002 The Apache Software Foundation.  All rights
@


1.1.8.1
log
@Import Apache HTTPD 1.3.28 into vendor branch to ease update
@
text
@d5 1
a5 1
.\" Copyright (c) 2000-2003 The Apache Software Foundation.  All rights
d142 2
a143 2
which then can be loaded into
the Apache server under runtime via the
d169 1
a169 1
modules with the DSO mechanism by the help of this
d187 1
a187 1
The arguments
d189 1
a189 1
can be any C source file (.c), a object file (.o) or
d193 4
a196 4
source files for compilation while it just uses the object and archive files for
the linking phase. But when using such pre-compiled objects, make sure they are
compiled for Position Independend Code (PIC) to be able to use them for a
DSO. For instance with GCC you always just have to use
d199 2
a200 2
C compilers please consult its manual
page or watch for the flags
d266 1
a266 1
and there two files: A sample module source file named
d364 1
a364 1
configuration file without attempting to install the module.
d403 2
a404 2
is added to the configuration file if still not present.
If you want to have this operation to be disabled, use the
d451 1
a451 1
automatically recognized C source files and object files.  
d462 1
a462 1
Only C source files are compiled while remaining object files are used for the
@


1.1.8.2
log
@The Apache(TM) Webserver, version 1.3.31
@
text
@d1 3
a3 2
.TH apxs 8 "February 2004"
.\" Copyright 1999-2004 The Apache Software Foundation
d5 53
a57 11
.\" Licensed under the Apache License, Version 2.0 (the "License");
.\" you may not use this file except in compliance with the License.
.\" You may obtain a copy of the License at
.\"
.\"     http://www.apache.org/licenses/LICENSE-2.0
.\"
.\" Unless required by applicable law or agreed to in writing, software
.\" distributed under the License is distributed on an "AS IS" BASIS,
.\" WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
.\" See the License for the specific language governing permissions and
.\" limitations under the License.
@


1.1.1.1
log
@Import OpenBSD 3.3 source repository from CTM 3132 the first time
This opens an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright © 1968-2003  The authors of And contributors to UNIX®, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@


1.1.1.2
log
@Synchronize with OpenBSD 3.4-beta
@
text
@d5 1
a5 1
.\" Copyright (c) 2000-2003 The Apache Software Foundation.  All rights
@


1.1.1.3
log
@OpenBSD httpd -HEAD
@
text
@d1 1
a1 2
.\"	$OpenBSD: apxs.8,v 1.13 2004/12/07 22:00:04 jmc Exp $
.\"
d59 86
a144 68
.Dd December 7, 2004
.Dt APXS 8
.Os
.Sh NAME
.Nm apxs
.Nd APache eXtenSion tool
.Sh SYNOPSIS
.Nm
.Bk -words
.Fl c
.Xo
.Oo Fl D
.Ar variable Ns Oo = Ns Ar value Oc Oc
.Xc
.Op Fl I Ar incdir
.Op Fl L Ar libdir
.Op Fl l Ar libname
.No \ \&\ \& Op Fl o Ar dsofile
.Xo
.Oo Fl S
.Ar variable Ns = Ns Ar value Oc
.Xc
.Op Fl Wc , Ns Ar compiler-flags
.No \ \&\ \& Op Fl Wl , Ns Ar linker-flags
.Ar file ...
.Ek
.Nm
.Fl e
.Op Fl Aa
.Op Fl n Ar name
.Xo
.Oo Fl S
.Ar variable Ns = Ns Ar value Oc
.Xc
.Ar dsofile ...
.Nm
.Fl g
.Xo
.Oo Fl S
.Ar variable Ns = Ns Ar value Oc
.Xc
.Fl n Ar name
.Nm
.Fl i
.Op Fl Aa
.Op Fl n Ar name
.Xo
.Oo Fl S
.Ar variable Ns = Ns Ar value Oc
.Xc
.Ar dsofile ...
.Nm
.Fl q
.Xo
.Oo Fl S
.Ar variable Ns = Ns Ar value Oc
.Xc
.Ar query ...
.Sh DESCRIPTION
.Nm
is a tool for building and installing extension modules for the
Apache HyperText Transfer Protocol (HTTP) server,
.Xr httpd 8 .
This is achieved by building a
Dynamic Shared Object (DSO)
from one or more source or object files
which can then be loaded into httpd at runtime via the
.Ic LoadModule
d146 8
a153 5
.Ic mod_so .
To use this extension mechanism,
your platform has to support the DSO feature
and the httpd binary has to be built with the
.Ic mod_so
d156 1
a156 1
.Nm
d158 6
a163 4
Check by manually running the following command:
.Pp
.Dl $ httpd -l
.Pp
d165 1
a165 1
.Ic mod_so
d167 4
a170 5
If these requirements are fulfilled,
httpd's functionality can be extended by
installing modules with the DSO mechanism,
with the help of the
.Nm
d172 15
a186 14
.Bd -literal -offset indent
# apxs -i -a -c mod_foo.c
cc -O2 -pipe -DDEV_RANDOM=/dev/arandom -DMOD_SSL=208116 -DEAPI -DUSE_EXPAT -I../lib/expat-lite -DUSE_SETUSERCONTEXT -fPIC -DSHARED_MODULE -I/usr/lib/apache/include  -c mod_foo.c
[activating module `foo' in /var/www/conf/httpd.conf]
cp mod_foo.so /usr/lib/apache/modules/mod_foo.so
chmod 755 /usr/lib/apache/modules/mod_foo.so
cp /var/www/conf/httpd.conf /var/www/conf/httpd.conf.bak
cp /var/www/conf/httpd.conf.new /var/www/conf/httpd.conf
rm /var/www/conf/httpd.conf.new
# apachectl restart
/usr/sbin/apachectl restart: httpd not running, trying to start
/usr/sbin/apachectl restart: httpd started
.Ed
.Pp
d188 4
a191 6
.Ar file
can be any C source file (.c),
an object file (.o),
or even a library archive (.a).
The
.Nm
d193 5
a197 9
source files for compilation,
whereas it just uses the object and archive files for the linking phase.
But when using such pre-compiled objects,
make sure they are compiled for Position Independent Code (PIC)
to be able to use them for a DSO.
For instance, with
.Xr cc 1
just use
.Fl fpic .
d199 3
a201 2
C compilers, please consult their manual pages or watch for the flags
.Nm
d203 79
a281 25
.Pp
For more details about DSO support in Apache,
first read the background information about DSO in
.Pa htdocs/manual/dso.html ,
then read the documentation of
.Ic mod_so .
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl A
Same as the
.Fl a
option but the created
.Ic LoadModule
directive is prefixed with a hash sign (#),
i.e. the module is just prepared for later activation but initially disabled.
.It Fl a
This activates the module by automatically adding a corresponding
.Ic LoadModule
line to Apache's httpd.conf configuration file,
or by enabling it if it already exists.
.It Fl c
Compile.
This option first compiles the C source files (.c) of
.Ar file ...\&
d283 4
a286 3
.Ar dsofile
by linking these object files plus the remaining object files (.o and .a) of
.Ar file ...
d288 2
a289 2
.Fl o
option is specified,
d291 1
a291 1
.Ar file ...\&
d293 11
a303 5
.No mod_ Ns Ar name Ns \&.so
.It Xo
.Fl D
.Ar variable Ns Op = Ns Ar value
.Xc
d306 2
a307 28
.It Fl e
Edit.
This option can be used with the
.Fl a
and
.Fl A
options to edit the
configuration file,
.Pa /var/www/conf/httpd.conf ,
without attempting to install the module.
.It Fl g
Template generation.
This option generates a subdirectory
.Ar name
(see the
.Fl n
option)
and two files:
a sample module source file named
.No mod_ Ns Ar name Ns \&.c ,
which can be used as a template for creating your own modules or
as a quick start for playing with the
.Nm
mechanism,
and a corresponding
.Pa Makefile
for even easier building and installing of this module.
.It Fl I Ar incdir
d310 2
a311 6
.It Fl i
Install.
This option installs one or more DSOs into the server's
.Ar libexec
directory.
.It Fl L Ar libdir
d314 2
a315 1
.It Fl l Ar libname
d318 4
a321 54
.It Fl n Ar name
This explicitly sets the module name for the
.Fl i
(install)
and
.Fl g
(template generation) option.
Use this to explicitly specify the module name.
For option
.Fl g
this is required;
for option
.Fl i ,
.Nm
tries to determine the name from the source or (as a fallback) at least
by guessing it from the filename.
.It Fl o Ar dsofile
Explicitly specifies the filename of the created DSO file.
If not specified and the name cannot be guessed from the
.Ar file ...\&
list,
the fallback name
.Ar mod_unknown.so
is used.
.It Fl q
Query.
This option performs a query for
.Nm apxs Ns 's
knowledge about certain settings.
The
.Ar query
parameters can be one or more of the following variable names:
.Bd -literal -offset indent
CC              TARGET
CFLAGS          SBINDIR
CFLAGS_SHLIB    INCLUDEDIR
LD_SHLIB        LIBEXECDIR
LDFLAGS_SHLIB   SYSCONFDIR
LIBS_SHLIB      PREFIX
.Ed
.Pp
Use this for manually determining settings.
For instance,
use the following inside your own Makefiles if you need manual access
to Apache's C header files:
.Pp
.Dl INC=-I`apxs -q INCLUDEDIR`
.It Fl S Ar variable Ns = Ns Ar value
This option changes the
.Nm
settings described above.
.It Fl Wc , Ns Ar compiler-flags
This option passes
.Ar compiler-flags
d324 4
a327 5
This option may be specified multiple times
in order to pass multiple flags.
.It Fl Wl , Ns Ar linker-flags
This option passes
.Ar linker-flags
d330 54
a383 21
This option may be specified multiple times
in order to pass multiple flags.
.El
.Sh EXAMPLES
Assume you have a module named
.Dq mod_foo.c
available which should extend httpd's functionality.
To accomplish this,
first compile the C source into a DSO
suitable for loading into httpd at runtime via the following command:
.Bd -literal -offset indent
# apxs -c mod_foo.c
cc -O2 -pipe -DDEV_RANDOM=/dev/arandom -DMOD_SSL=208116 -DEAPI -DUSE_EXPAT -I../lib/expat-lite -DUSE_SETUSERCONTEXT -fPIC -DSHARED_MODULE -I/usr/lib/apache/include  -c mod_foo.c
cc -shared -fPIC -DSHARED_MODULE -o mod_foo.so mod_foo.o
.Ed
.Pp
Then a
.Ic LoadModule
directive has to be added to httpd's configuration file to load the DSO.
To simplify this step,
.Nm
d385 32
a416 31
.Dq libexec
directory and update the httpd.conf file accordingly.
This can be achieved by running the following:
.Bd -literal -offset indent
$ apxs -i -a mod_foo.so
[activating module `foo' in /var/www/conf/httpd.conf]
cp mod_foo.so /usr/lib/apache/modules/mod_foo.so
chmod 755 /usr/lib/apache/modules/mod_foo.so
cp /var/www/conf/httpd.conf /var/www/conf/httpd.conf.bak
cp /var/www/conf/httpd.conf.new /var/www/conf/httpd.conf
rm /var/www/conf/httpd.conf.new
.Ed
.Pp
This way a line such as the following
is added to the configuration file:
.Pp
.Dl LoadModule foo_module /usr/lib/apache/modules/mod_foo.so
.Pp
If you want the module added to the configuration file
without it being enabled,
use the
.Fl A
option instead:
.Pp
.Dl $ apxs -i -A mod_foo.so
.Pp
For a quick test of the
.Nm
mechanism,
create a sample module template plus a corresponding
.Ar Makefile
d418 52
a469 48
.Bd -literal -offset indent
# apxs -g -n foo
Creating [DIR]  foo
Creating [FILE] foo/Makefile
Creating [FILE] foo/mod_foo.c
.Ed
.Pp
The sample module can then be immediately compiled into a DSO
and loaded into the httpd server:
.Bd -literal -offset indent
$ cd foo
$ make all reload
apxs -c    mod_foo.c
cc -O2 -pipe -DDEV_RANDOM=/dev/arandom -DMOD_SSL=208116 -DEAPI -DUSE_EXPAT -I../lib/expat-lite -DUSE_SETUSERCONTEXT -fPIC -DSHARED_MODULE -I/usr/lib/apache/include  -c mod_foo.c
cc -shared -fPIC -DSHARED_MODULE -o mod_foo.so mod_foo.o
apxs -i -a -n 'foo' mod_foo.so
[activating module `foo' in /var/www/conf/httpd.conf]
cp mod_foo.so /usr/lib/apache/modules/mod_foo.so
chmod 755 /usr/lib/apache/modules/mod_foo.so
cp /var/www/conf/httpd.conf /var/www/conf/httpd.conf.bak
cp /var/www/conf/httpd.conf.new /var/www/conf/httpd.conf
rm /var/www/conf/httpd.conf.new
apachectl restart
/usr/sbin/apachectl restart: httpd not running, trying to start
/usr/sbin/apachectl restart: httpd started
.Ed
.Pp
.Nm
can even be used to compile complex modules
outside the httpd source tree,
like PHP3,
because
.Nm
automatically recognizes C source files and object files.
.Bd -literal -offset indent
$ cd php3
$ ./configure --with-shared-apache=../apache-1.3
$ apxs -c -o libphp3.so mod_php3.c libmodphp3-so.a
gcc -fpic -DSHARED_MODULE -I/tmp/apache/include  -c mod_php3.c
ld -Bshareable -o libphp3.so mod_php3.o libmodphp3-so.a
.Ed
.Pp
Only C source files are compiled,
while remaining object files are used for the linking phase.
.Sh SEE ALSO
.Xr apachectl 1 ,
.Xr cc 1 ,
.Xr httpd 8
@


