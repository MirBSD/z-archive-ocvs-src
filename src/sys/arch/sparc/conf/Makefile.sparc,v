head	1.15;
access;
symbols
	tg-mergetmp-mirosx-1:1.15
	tg-mergefixes-1-branch:1.15.0.4
	tg-mergefixes-1-base:1.15
	MIROS_X:1.15.0.2
	MIROS_X_BASE:1.15
	tg-mergetmp-3:1.15
	MIRBSD_XP_SPARC:1.12.0.2
	MIRBSD_7quater:1.2.2.2.2.3
	cvs-200405160640:1.1.1.5
	cvs-200401271800:1.1.1.5
	cvs-200401261630:1.1.1.5
	cvs-200401021645:1.1.1.5
	MIRBSD_7_ALPHA:1.2.2.2.0.4
	MIRBSD_7:1.2.2.2.0.2
	cvs-200312222040:1.1.1.5
	MIRBSD_7ter:1.2.2.2
	MIRBSD_7_DEV:1.2.0.2
	cvs-200310020700:1.1.1.4
	cvs-200309271030:1.1.1.4
	cvs-200309261655:1.1.1.4
	cvs-200309251530:1.1.1.4
	cvs-200308302005:1.1.1.4
	cvs-200308171200:1.1.1.4
	ctm-3496:1.1.1.4
	ctm-3449:1.1.1.4
	ctm-3437:1.1.1.3
	cvs-200307191805:1.1.1.3
	ctm-3425:1.1.1.3
	cvs-200307091500:1.1.1.3
	cvs-200307072125:1.1.1.3
	ctm-3389:1.1.1.3
	cvs-200307021520:1.1.1.3
	cvs-200306291430:1.1.1.3
	ctm-3341:1.1.1.3
	cvs-200306082100:1.1.1.3
	ctm-3316:1.1.1.3
	ctm-3272:1.1.1.2
	ctm-3264:1.1.1.1
	cvs-200305071630:1.1.1.1
	ctm-3255:1.1.1.1
	ctm-3229:1.1.1.1
	ctm-3203:1.1.1.1
	cvs-20030410-1130:1.1.1.1
	ctm-3155:1.1.1.1
	ctm-3132:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.15
date	2004.12.11.16.50.11;	author tg;	state Exp;
branches;
next	1.14;

1.14
date	2004.11.13.02.25.13;	author tg;	state Exp;
branches;
next	1.13;

1.13
date	2004.07.15.19.31.38;	author tg;	state dead;
branches;
next	1.12;

1.12
date	2004.07.14.11.21.24;	author tg;	state Exp;
branches;
next	1.11;

1.11
date	2004.06.17.19.52.44;	author tg;	state Exp;
branches;
next	1.10;

1.10
date	2004.06.04.15.46.52;	author tg;	state Exp;
branches;
next	1.9;

1.9
date	2004.05.07.17.21.15;	author tg;	state Exp;
branches;
next	1.8;

1.8
date	2004.04.30.17.29.56;	author tg;	state Exp;
branches;
next	1.7;

1.7
date	2004.04.23.21.05.35;	author tg;	state Exp;
branches;
next	1.6;

1.6
date	2003.12.28.01.01.22;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2003.12.27.19.55.02;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2003.12.25.20.28.44;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2003.12.17.18.26.30;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2003.04.06.04.29.49;	author tg;	state dead;
branches
	1.2.2.1;
next	1.1;

1.1
date	2003.03.22.17.50.10;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.03.22.17.50.10;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.05.21.19.06.24;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2003.06.05.17.36.05;	author tg;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2003.07.26.13.18.11;	author tg;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2003.12.22.21.00.10;	author tg;	state Exp;
branches;
next	;

1.2.2.1
date	2003.10.23.21.33.10;	author tg;	state Exp;
branches;
next	1.2.2.2;

1.2.2.2
date	2003.10.23.21.59.03;	author tg;	state Exp;
branches
	1.2.2.2.2.1;
next	;

1.2.2.2.2.1
date	2004.04.10.22.42.00;	author tg;	state Exp;
branches;
next	1.2.2.2.2.2;

1.2.2.2.2.2
date	2004.04.24.19.25.21;	author tg;	state Exp;
branches;
next	1.2.2.2.2.3;

1.2.2.2.2.3
date	2004.06.04.15.21.05;	author tg;	state Exp;
branches;
next	;


desc
@@


1.15
log
@Another round of mega-commit-death:
* compile fixes (pre-removal)
* distrib list sync (pre-removal)
* throw out more orphaned profiling stuff
* sync with reality (post-removal)
  -> e.g. don't call comsatd in inetd.conf
* general clean-up phase for touched files,
  or stuff "while here"
* partial distrib list sync (post-removal)
* replace echo with print in /etc/profile

kernel builds; will do a make b-r in two jiffies
@
text
@# $MirBSD: src/sys/arch/sparc/conf/Makefile.sparc,v 1.12 2004/07/14 11:21:24 tg Exp $
# $OpenBSD: Makefile.sparc,v 1.33 2003/11/20 08:38:52 espie Exp $
# $NetBSD: Makefile.sparc,v 1.32.4.1 1996/06/12 20:26:32 pk Exp $

# Makefile for MirOS BSD
#
# This makefile is constructed from a machine description:
#	config machineid
# Most changes should be made in the machine description
#	/sys/arch/sparc/conf/MACHINEID
# after which you should do
#	config machineid
# Machine generic makefile changes should be made in
#	/sys/arch/sparc/conf/Makefile.sparc
# after which config should be rerun for all machines of that type.
#
# N.B.: NO DEPENDENCIES ON FOLLOWING FLAGS ARE VISIBLE TO MAKEFILE
#	IF YOU CHANGE THE DEFINITION OF ANY OF THESE RECOMPILE EVERYTHING
#
# -DTRACE	compile in kernel tracing hooks
# -DQUOTA	compile in file system quotas

# DEBUG is set to -g if debugging.

.include <bsd.own.mk>

MKDEP?=	mkdep
SIZE?=	size
STRIP?=	strip

# source tree is located via $S relative to the compilation directory
.ifndef S
S!=	cd ../../../..; pwd
.endif
SPARC=	$S/arch/sparc

.include "${SPARC}/Makefile.reloc"

INCLUDES=	-nostdinc -I. -I$S/arch -I$S
CPPFLAGS=	${INCLUDES} ${IDENT} -D_KERNEL -Dsparc

CDIAGFLAGS=	-Werror -Wall -Wstrict-prototypes -Wmissing-prototypes \
		-Wno-uninitialized -Wno-format -Wno-main -ffreestanding

.if ${IDENT:M-DSUN*} == ${IDENT:M-DSUN4M}
CMACHFLAGS=	-mcpu=supersparc
.else
CMACHFLAGS=
.endif
.if ${IDENT:M-DNO_PROPOLICE}
CMACHFLAGS+=	-fno-stack-protector
.endif
CMACHFLAGS+=	-fno-builtin-printf -fno-builtin-log

COPTS?=		-Os
CFLAGS=		${DEBUG} ${CDIAGFLAGS} ${CMACHFLAGS} \
		${COPTS:S/-g//} ${PIPE} ${CSYS}
AFLAGS=		-x assembler-with-cpp -traditional-cpp -D_LOCORE
LINKFLAGS=	-N -e start -Ttext F8004000
STRIPFLAGS=	-g -X -x

HOSTCC=		${CC}
HOSTED_CPPFLAGS=${CPPFLAGS:S/^-nostdinc$//}
HOSTED_CFLAGS=	${CFLAGS}

### find out what to use for libkern
.include "$S/lib/libkern/Makefile.inc"
LIBKERN=	${KERNLIB}

### find out what to use for libcompat
.include "$S/compat/common/Makefile.inc"
LIBCOMPAT=	${COMPATLIB}

# compile rules: rules are named ${TYPE}_${SUFFIX}${CONFIG_DEP}
# where TYPE is NORMAL or DRIVER; SUFFIX is the file suffix,
# capitalized (e.g. C for a .c file), and CONFIG_DEP is _C if the file
# is marked as config-dependent.

NORMAL_C=	${CC} ${CFLAGS} ${CPPFLAGS} -c $<
NORMAL_C_C=	${CC} ${CFLAGS} ${CPPFLAGS} ${PARAM} -c $<

DRIVER_C=	${CC} ${CFLAGS} ${CPPFLAGS} -c $<
DRIVER_C_C=	${CC} ${CFLAGS} ${CPPFLAGS} ${PARAM} -c $<

NORMAL_S=	${CC} ${AFLAGS} ${CPPFLAGS} -c $<
NORMAL_S_C=	${CC} ${AFLAGS} ${CPPFLAGS} ${PARAM} -c $<

HOSTED_C=	${HOSTCC} ${HOSTED_CFLAGS} ${HOSTED_CPPFLAGS} -c $<

%OBJS

%CFILES

%SFILES

# load lines for config "xxx" will be emitted as:
# xxx: ${SYSTEM_DEP} swapxxx.o
#	${SYSTEM_LD_HEAD}
#	${SYSTEM_LD} swapxxx.o
#	${SYSTEM_LD_TAIL}
SYSTEM_OBJ=	locore.o \
		param.o ioconf.o ${OBJS} ${LIBKERN} ${LIBCOMPAT}
SYSTEM_DEP=	Makefile ${SYSTEM_OBJ}
SYSTEM_LD_HEAD=	@@rm -f $@@
SYSTEM_LD=	@@echo ${LD} ${LINKFLAGS} -o $@@ '$${SYSTEM_OBJ}' vers.o; \
		${LD} ${LINKFLAGS} -o $@@ ${SYSTEM_OBJ} vers.o
SYSTEM_LD_TAIL=	@@${SIZE} $@@; chmod 755 $@@; /bin/ksh -c \
		' typeset -i10 "relocval=16\#${RELOC2:S/^0x//}"; \
		  set -A kstmp -- $$(/bin/ls -l $@@); \
		  typeset -i10 "ksize=16384+$${kstmp[4]}"; \
		  if ((ksize<relocval)); then \
		    print "Kernel size ($${kstmp[4]}) below" \
		      "reloc value ($$relocval), OK"; else \
		    print "ATTENTION: Kernel ($$ksize) is" \
		      "too big; must shrink below $$relocval"; fi '

DEBUG?=
.if ${DEBUG} == "-g"
LINKFLAGS+=	-X
SYSTEM_LD_TAIL+=; \
		echo cp $@@ $@@.gdb; rm -f $@@.gdb; cp $@@ $@@.gdb; \
		echo ${STRIP} ${STRIPFLAGS} $@@; ${STRIP} ${STRIPFLAGS} $@@
.else
LINKFLAGS+=	-x
.endif

%LOAD

assym.h: $S/kern/genassym.sh ${SPARC}/sparc/genassym.cf Makefile
	${SHELL} $S/kern/genassym.sh ${CC} ${CFLAGS} ${CPPFLAGS} \
	    ${PARAM} <${SPARC}/sparc/genassym.cf >assym.h.tmp && \
	    mv -f assym.h.tmp assym.h

param.c: $S/conf/param.c
	rm -f param.c
	cp $S/conf/param.c .

param.o: param.c Makefile
	${NORMAL_C_C}

ioconf.o: ioconf.c
	${NORMAL_C}

newvers: ${SYSTEM_DEP} ${SYSTEM_SWAP_DEP}
	${SHELL} $S/conf/newvers.sh "${OSrev}" "${OSrpl}" \
	    "${OSREV:C/^${OSrev}.//}" "${OScompat}"
	${CC} ${CFLAGS} ${CPPFLAGS} -c vers.c


clean::
	rm -f eddep *bsd *bsd.gdb tags *.[io] [a-z]*.s \
	    [Ee]rrs linterrs makelinks genassym genassym.o assym.h

lint:
	@@lint -hbxncez -DGENERIC -Dvolatile= ${CPPFLAGS} ${PARAM} -UKGDB \
	    ${CFILES} ioconf.c param.c | \
	    grep -v 'static function .* unused'

tags:
	@@echo "see $S/kern/Makefile for tags"

links:
	egrep '#if' ${CFILES} | sed -f $S/conf/defines | \
	  sed -e 's/:.*//' -e 's/\.c/.o/' | sort -u >dontlink
	echo ${CFILES} | tr -s ' ' '\12' | sed 's/\.c/.o/' | \
	  sort -u | comm -23 - dontlink | \
	  sed 's,../.*/\(.*.o\),rm -f \1; ln -s ../GENERIC/\1 \1,' >makelinks
	${SHELL} makelinks && rm -f dontlink

SRCS=	${SPARC}/sparc/locore.s \
	param.c ioconf.c ${CFILES} ${SFILES}
depend:: .depend
.depend: ${SRCS} assym.h param.c
	${MKDEP} ${AFLAGS} ${CPPFLAGS} ${SPARC}/sparc/locore.s
	${MKDEP} -a ${CFLAGS} ${CPPFLAGS} param.c ioconf.c ${CFILES}
.if !empty(SFILES)
	${MKDEP} -a ${AFLAGS} ${CPPFLAGS} ${SFILES}
.endif
	${SHELL} $S/kern/genassym.sh ${MKDEP} -f assym.dep ${CFLAGS} \
	    ${CPPFLAGS} <${SPARC}/sparc/genassym.cf
	@@sed -e 's/.*\.o:.* /assym.h: /' <assym.dep >>.depend
	@@rm -f assym.dep


# depend on root or device configuration
autoconf.o conf.o: Makefile

# depend on network or filesystem configuration
uipc_proto.o vfs_conf.o: Makefile

# depend on maxusers
machdep.o: Makefile

# depend on CPU configuration
bwtwo.o cgsix.o cgthree.o cgtwo.o cons.o dma.o esp.o fb.o if_ie.o: Makefile
ms.c obio.o zs.c autoconf.o clock.o cpu.o disksubr.o locore.o: Makefile
machdep.o mem.o openprom.o pmap.o vm_machdep.o: Makefile


locore.o: ${SPARC}/sparc/locore.s assym.h
	${NORMAL_S}

# The install target can be redefined by putting a
# install-kernel-${MACHINE_NAME} target into /etc/mk.conf
MACHINE_NAME!=  uname -n
install: install-kernel-${MACHINE_NAME}
.if !target(install-kernel-${MACHINE_NAME}})
install-kernel-${MACHINE_NAME}:
	rm -f /obsd
	ln /bsd /obsd
	cp bsd /nbsd
	mv /nbsd /bsd
.endif

%RULES
@


1.14
log
@welcome back, sparc
(usr.bin/pmdb was never deleted)
@
text
@a23 1
# PROF is set to -pg if profiling.
a67 1
.ifndef PROF
a68 3
.else
LIBKERN=	${KERNLIB_PROF}
.endif
a71 1
.ifndef PROF
a72 3
.else
LIBCOMPAT=	${COMPATLIB_PROF}
.endif
d75 1
a75 1
# where TYPE is NORMAL, DRIVER, or PROFILE}; SUFFIX is the file suffix,
d79 2
a80 2
NORMAL_C=	${CC} ${CFLAGS} ${CPPFLAGS} ${PROF} -c $<
NORMAL_C_C=	${CC} ${CFLAGS} ${CPPFLAGS} ${PROF} ${PARAM} -c $<
d82 2
a83 2
DRIVER_C=	${CC} ${CFLAGS} ${CPPFLAGS} ${PROF} -c $<
DRIVER_C_C=	${CC} ${CFLAGS} ${CPPFLAGS} ${PROF} ${PARAM} -c $<
d147 1
a147 1
	${CC} ${CFLAGS} ${CPPFLAGS} ${PROF} -c vers.c
@


1.13
log
@sparc has to die :(

it was nice while it lasted, but I couldn't even live up to
my promise to provide XFree86 4.4.0 on sparc due to lack of
time (and money and health).

also, compat_freebsd dies, without prejudice.

<mirabile> benz: sparc darf sterben?
<mirabile> compat_freebsd darf sterben?
<benz> na gut

in addition, some set shuffling (it was a good idea originally
to pull out gcc3 specifics to the egcs set, but with gcc3 being
the only compiler that isn't it any more)
@
text
@@


1.12
log
@put in some effort to
* fix the boot loader output
* fix ramdisk root device selection
* make release with as few sudo as possible
* fix COPTS selection for the anoncvsbin
* fix COPTS (no -g) for the kernel
  (a kernel with DEBUG=-g needs a higher ulimit -d)
* clean up in general
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/sparc/conf/Makefile.sparc,v 1.11 2004/06/17 19:52:44 tg Exp $
@


1.11
log
@preliminary build fixes, whitespace fixes, dependency fixes,
manpage installation and naming fixes, programme hard-link
fixes & addition to <bsd.cfwrap.mk>, removal-of-NOPROFILE-option
fixes etc.

you should be able to build kernel & userland with this set
of source and the following line in /etc/mk.conf added:
| CSYS+=		-D"ETHER_ALIGN=2"
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/sparc/conf/Makefile.sparc,v 1.10 2004/06/04 15:46:52 tg Exp $
d57 2
a58 1
CFLAGS=		${DEBUG} ${CDIAGFLAGS} ${CMACHFLAGS} ${COPTS} ${PIPE} ${CSYS}
@


1.10
log
@* sync with #7-stable
* spacing etc. and cleanup while here
* remove gcc 2.7.2(sic!) bug workaround
* default to -Os not -O2 (I have a reason...)
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/sparc/conf/Makefile.sparc,v 1.9 2004/05/07 17:21:15 tg Exp $
d62 1
a62 1
HOSTCC=	${CC}
@


1.9
log
@sh -> ${SHELL}
ksh -> ${SHELL}
@
text
@d1 3
a3 3
#	$MirBSD: src/sys/arch/sparc/conf/Makefile.sparc,v 1.8 2004/04/30 17:29:56 tg Exp $
#	$OpenBSD: Makefile.sparc,v 1.33 2003/11/20 08:38:52 espie Exp $
# 	$NetBSD: Makefile.sparc,v 1.32.4.1 1996/06/12 20:26:32 pk Exp $
d5 1
a5 1
# Makefile for OpenBSD-mirabile aka MirBSD
d56 1
a56 1
COPTS?=		-O2
a57 2
# add `-mno-fpu' to work around gcc (last noticed in v2.7.2) bug
CFLAGS+=	-mno-fpu
d115 3
a117 3
SYSTEM_LD_TAIL=	@@${SIZE} $@@; chmod 755 $@@; \
		( typeset -i10 "relocval=16\#${RELOC2:S/^0x//}"; \
		  set -A kstmp -- $$(ls -l $@@); \
d123 1
a123 1
		      "too big; must shrink below $$relocval"; fi )
d139 1
a139 1
	    ${PARAM} < ${SPARC}/sparc/genassym.cf > assym.h.tmp && \
d172 1
a172 1
	  sed -e 's/:.*//' -e 's/\.c/.o/' | sort -u > dontlink
d175 1
a175 1
	  sed 's,../.*/\(.*.o\),rm -f \1; ln -s ../GENERIC/\1 \1,' > makelinks
d188 2
a189 2
	    ${CPPFLAGS} < ${SPARC}/sparc/genassym.cf
	@@sed -e 's/.*\.o:.* /assym.h: /' < assym.dep >> .depend
d195 3
a197 3
 
# depend on network or filesystem configuration 
uipc_proto.o vfs_conf.o: Makefile 
d202 1
a202 1
# depend on CPU configuration 
@


1.8
log
@add CSYS makeoption to kernel config files so they can specify their
own COPTS which override these from a user
used by ramdisk kernels to add -Os
while here, nuke CKERNFLAGS from sparc
@
text
@d1 1
a1 1
#	$MirBSD: src/sys/arch/sparc/conf/Makefile.sparc,v 1.7 2004/04/23 21:05:35 tg Exp $
d140 1
a140 1
	sh $S/kern/genassym.sh ${CC} ${CFLAGS} ${CPPFLAGS} \
d155 1
a155 1
	sh $S/conf/newvers.sh "${OSrev}" "${OSrpl}" \
d178 1
a178 1
	sh makelinks && rm -f dontlink
d189 1
a189 1
	sh $S/kern/genassym.sh ${MKDEP} -f assym.dep ${CFLAGS} \
@


1.7
log
@Improve RELOC value checking logic:
- RELOC values are factured out to sys/arch/sparc/Makefile.reloc
- ksh is used instead of perl
- compile/*/Makefile now checks size on builds

I've taken the comment from the kernel config to check the size;
it says (16384+sizeof bsd)<"RELOC value from boot/bootxx" is ok;
I think this means \${RELOC2} - please correct me if I'm wrong.
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.sparc,v 1.6 2003/12/28 01:01:22 tg Exp $
d56 2
a57 1
CFLAGS=		${DEBUG} -O2 ${CDIAGFLAGS} ${CMACHFLAGS} ${COPTS} ${PIPE} ${CKERNFLAGS}
@


1.6
log
@employ fix for the uname change problem
which will fix 95% of the 90% broken ports
XXX all ports using COMES_WITH must use mirbsd
XXX	releases (1, 2, 3...) not openbsd ones
XXX	(3.0, 3.1, ...) now!
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.sparc,v 1.5 2003/12/27 19:55:02 tg Exp $
d38 2
d116 9
a124 1
SYSTEM_LD_TAIL=	@@${SIZE} $@@; chmod 755 $@@
@


1.5
log
@save what I've done so far to attempt building it through
perl was broken (i386-tirttt not i386-mirbsd? but not
everywhere???) etc. so I didn't sync the lists.
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.sparc,v 1.4 2003/12/25 20:28:44 tg Exp $
d144 2
a145 1
	sh $S/conf/newvers.sh "${OSrev}" "${OSrpl}" "${OSREV:C/^${OSrev}.//}"
@


1.4
log
@merge another bit of the OpenBSD import from $some days ago
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.sparc,v 1.3 2003/12/17 18:26:30 tg Exp $
d144 1
a144 1
	sh $S/conf/newvers.sh "${OSrel}" "${OSrelm}" "${OSrelx}"
@


1.3
log
@second (piecewise) attempt to merge MirBSD #7ter into HEAD
@
text
@d1 2
a2 2
#	$MirBSD: Makefile.sparc,v 1.2.2.2 2003/10/23 21:59:03 tg Exp $
#	$OpenBSD: Makefile.sparc,v 1.32 2003/07/22 19:39:50 otto Exp $
d42 1
a42 1
		-Wno-uninitialized -Wno-format -Wno-main
d52 1
@


1.2
log
@Remove "some dead architectures".

These are all but i386 and x86-64 (which is not in the tree yet),
because I have no machines to work with.

Re-adding support should be fairly easy, just cvs adding a partial
OpenBSD checkout and pulling in stuff like kernel signal patch, humantime,
etc. which got added to i386 as well.

You will need gcc support as well.
@
text
@d1 2
a2 1
#	$OpenBSD: Makefile.sparc,v 1.28 2002/12/25 21:10:26 miod Exp $
d5 1
a5 1
# Makefile for OpenBSD
d10 1
a10 1
#	/sys/arch/sparc/conf/``machineid''
d49 1
d51 1
d53 1
a53 1
CFLAGS=		${DEBUG} -O2 ${CDIAGFLAGS} ${CMACHFLAGS} ${COPTS} ${PIPE}
d143 1
a143 1
	sh $S/conf/newvers.sh
d153 1
a153 1
	    ${CFILES} ${SPARC}/sparc/swapgeneric.c ioconf.c param.c | \
d176 4
@


1.2.2.1
log
@o move machine-dependent ATM and PLIP options out of mi space
  in i386 GENERIC kernel
o bring back in all of the sparc32 stuff I could find

maintained by: wbx@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sparc,v 1.32 2003/07/22 19:39:50 otto Exp $
a47 1
.if ${IDENT:M-DNO_PROPOLICE}
a48 1
.endif
d150 1
a150 1
	    ${CFILES} ioconf.c param.c | \
a172 4
	sh $S/kern/genassym.sh ${MKDEP} -f assym.dep ${CFLAGS} \
	    ${CPPFLAGS} < ${SPARC}/sparc/genassym.cf
	@@sed -e 's/.*\.o:.* /assym.h: /' < assym.dep >> .depend
	@@rm -f assym.dep
@


1.2.2.2
log
@MirOSify
@
text
@a0 1
#	$MirBSD$
d4 1
a4 1
# Makefile for OpenBSD-mirabile aka MirBSD
d9 1
a9 1
#	/sys/arch/sparc/conf/MACHINEID
d52 1
a52 1
CFLAGS=		${DEBUG} -O2 ${CDIAGFLAGS} ${CMACHFLAGS} ${COPTS} ${PIPE} ${CKERNFLAGS}
d142 1
a142 1
	sh $S/conf/newvers.sh "${OSrel}" "${OSrelm}" "${OSrelx}"
@


1.2.2.2.2.1
log
@MFC: newvers.sh needs mirbsdksh
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.sparc,v 1.2.2.2 2003/10/23 21:59:03 tg Exp $
d143 1
a143 1
	ksh $S/conf/newvers.sh "${OSrel}" "${OSrelm}" "${OSrelx}"
@


1.2.2.2.2.2
log
@MFC: optimized sparc RELOC behaviour
@
text
@d1 1
a1 1
#	$MirBSD: src/sys/arch/sparc/conf/Makefile.sparc,v 1.2.2.2.2.1 2004/04/10 22:42:00 tg Exp $
a37 2
.include "${SPARC}/Makefile.reloc"

d113 1
a113 9
SYSTEM_LD_TAIL=	@@${SIZE} $@@; chmod 755 $@@; \
		( typeset -i10 "relocval=16\#${RELOC2:S/^0x//}"; \
		  set -A kstmp -- $$(ls -l $@@); \
		  typeset -i10 "ksize=16384+$${kstmp[4]}"; \
		  if ((ksize<relocval)); then \
		    print "Kernel size ($${kstmp[4]}) below" \
		      "reloc value ($$relocval), OK"; else \
		    print "ATTENTION: Kernel ($$ksize) is" \
		      "too big; must shrink below $$relocval"; fi )
@


1.2.2.2.2.3
log
@uaah, annoying that root's shell has an impact on Makefiles
call ksh manually, and ls with full pathname (in case it's an alias)
@
text
@d1 1
a1 1
#	$MirBSD: src/sys/arch/sparc/conf/Makefile.sparc,v 1.2.2.2.2.2 2004/04/24 19:25:21 tg Exp $
d115 3
a117 3
SYSTEM_LD_TAIL=	@@${SIZE} $@@; chmod 755 $@@; /bin/ksh -c \
		' typeset -i10 "relocval=16\#${RELOC2:S/^0x//}"; \
		  set -A kstmp -- $$(/bin/ls -l $@@); \
d123 1
a123 1
		      "too big; must shrink below $$relocval"; fi '
@


1.1
log
@Initial revision
@
text
@@


1.1.1.1
log
@Import OpenBSD 3.3 source repository from CTM 3132 the first time
This opens an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright © 1968-2003  The authors of And contributors to UNIX®, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@


1.1.1.2
log
@Sync MirBSD main source tree against OpenBSD-current,
which should be fairly stable after the Hackathon now.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sparc,v 1.30 2003/05/13 22:45:11 miod Exp $
a47 1
.if ${IDENT:M-DNO_PROPOLICE}
a48 1
.endif
@


1.1.1.3
log
@Import latest OpenBSD CVS tree by CTM in order
to sync the base system and ports tree with Them.

This includes the recent licence changes as well - by
importing the changed base and re-applying the diffs
(with cvs up -j -j) they are inherited, and we're not
bound to the removed clauses any longer.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sparc,v 1.31 2003/05/23 22:16:16 tedu Exp $
d152 1
a152 1
	    ${CFILES} ioconf.c param.c | \
@


1.1.1.4
log
@Import latest OpenBSD ports, XFree and source in sync
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sparc,v 1.32 2003/07/22 19:39:50 otto Exp $
a174 4
	sh $S/kern/genassym.sh ${MKDEP} -f assym.dep ${CFLAGS} \
	    ${CPPFLAGS} < ${SPARC}/sparc/genassym.cf
	@@sed -e 's/.*\.o:.* /assym.h: /' < assym.dep >> .depend
	@@rm -f assym.dep
@


1.1.1.5
log
@Time to import OpenBSD once again. Expect breakage.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sparc,v 1.33 2003/11/20 08:38:52 espie Exp $
a50 1
CMACHFLAGS+=	-fno-builtin-printf -fno-builtin-log
@


