head	1.25;
access;
symbols
	tg-mergetmp-mirosx-1:1.25
	tg-mergefixes-1-branch:1.25.0.4
	tg-mergefixes-1-base:1.25
	MIROS_X:1.25.0.2
	MIROS_X_BASE:1.25
	tg-mergetmp-3:1.25
	MIRBSD_XP_MIRPPC:1.22.0.4
	MIRBSD_XP_SPARC_BASE:1.22
	MIRBSD_XP_SPARC:1.22.0.2
	MIRBSD_7quater:1.9.4.1
	cvs-200405160640:1.1.1.7
	cvs-200401271800:1.1.1.6
	cvs-200401261630:1.1.1.6
	cvs-200401021645:1.1.1.6
	MIRBSD_7_ALPHA:1.9.0.6
	MIRBSD_7:1.9.0.4
	cvs-200312222040:1.1.1.6
	MIRBSD_7ter:1.9
	MIRBSD_7_DEV:1.9.0.2
	cvs-200310020700:1.1.1.5
	cvs-200309271030:1.1.1.5
	cvs-200309261655:1.1.1.5
	cvs-200309251530:1.1.1.5
	cvs-200308302005:1.1.1.5
	cvs-200308221505:1.1.1.5
	cvs-200308171200:1.1.1.5
	ctm-3496:1.1.1.5
	ctm-3449:1.1.1.5
	ctm-3437:1.1.1.4
	cvs-200307191805:1.1.1.4
	ctm-3425:1.1.1.4
	cvs-200307091500:1.1.1.4
	cvs-200307072125:1.1.1.4
	ctm-3389:1.1.1.4
	cvs-200307021520:1.1.1.4
	cvs-200306291430:1.1.1.4
	ctm-3341:1.1.1.4
	MIRBSD_5:1.5
	cvs-200306082100:1.1.1.4
	ctm-3316:1.1.1.4
	ctm-3272:1.1.1.3
	ctm-3264:1.1.1.2
	cvs-200305071630:1.1.1.2
	ctm-3255:1.1.1.2
	ctm-3229:1.1.1.2
	MIRBSD_4:1.2
	ctm-3203:1.1.1.1
	cvs-20030410-1130:1.1.1.1
	ctm-3155:1.1.1.1
	ctm-3132:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.25
date	2004.12.11.16.50.06;	author tg;	state Exp;
branches
	1.25.2.1
	1.25.4.1;
next	1.24;

1.24
date	2004.11.23.21.21.00;	author tg;	state Exp;
branches;
next	1.23;

1.23
date	2004.10.28.15.15.35;	author tg;	state Exp;
branches;
next	1.22;

1.22
date	2004.09.16.10.08.01;	author tg;	state Exp;
branches;
next	1.21;

1.21
date	2004.07.14.11.21.22;	author tg;	state Stab;
branches;
next	1.20;

1.20
date	2004.06.23.16.58.42;	author tg;	state Exp;
branches;
next	1.19;

1.19
date	2004.06.17.19.52.43;	author tg;	state Exp;
branches;
next	1.18;

1.18
date	2004.05.27.19.10.36;	author tg;	state Exp;
branches;
next	1.17;

1.17
date	2004.05.23.20.15.34;	author tg;	state Exp;
branches;
next	1.16;

1.16
date	2004.05.07.17.21.14;	author tg;	state Exp;
branches;
next	1.15;

1.15
date	2004.04.30.17.29.56;	author tg;	state Exp;
branches;
next	1.14;

1.14
date	2004.04.10.22.41.00;	author tg;	state Exp;
branches;
next	1.13;

1.13
date	2003.12.28.01.01.22;	author tg;	state Exp;
branches;
next	1.12;

1.12
date	2003.12.27.19.55.00;	author tg;	state Exp;
branches;
next	1.11;

1.11
date	2003.12.25.20.27.45;	author tg;	state Exp;
branches;
next	1.10;

1.10
date	2003.11.30.02.26.25;	author tg;	state Exp;
branches;
next	1.9;

1.9
date	2003.10.01.18.33.27;	author tg;	state Exp;
branches
	1.9.4.1;
next	1.8;

1.8
date	2003.09.19.13.19.22;	author tg;	state Exp;
branches;
next	1.7;

1.7
date	2003.07.26.20.06.27;	author tg;	state Exp;
branches;
next	1.6;

1.6
date	2003.07.26.16.08.08;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2003.06.06.18.28.49;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2003.05.22.14.08.22;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2003.04.24.11.04.59;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2003.03.23.21.52.15;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.22.17.49.34;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.03.22.17.49.34;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.04.24.09.05.25;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2003.05.21.19.05.05;	author tg;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2003.06.05.17.34.13;	author tg;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2003.07.26.13.16.54;	author tg;	state Exp;
branches;
next	1.1.1.6;

1.1.1.6
date	2003.12.22.20.58.54;	author tg;	state Exp;
branches;
next	1.1.1.7;

1.1.1.7
date	2004.05.16.08.42.30;	author tg;	state Exp;
branches;
next	;

1.9.4.1
date	2004.04.10.22.41.58;	author tg;	state Exp;
branches;
next	;

1.25.2.1
date	2005.01.06.13.48.23;	author tg;	state Exp;
branches;
next	;

1.25.4.1
date	2005.01.09.14.27.54;	author tg;	state Exp;
branches;
next	;


desc
@@


1.25
log
@Another round of mega-commit-death:
* compile fixes (pre-removal)
* distrib list sync (pre-removal)
* throw out more orphaned profiling stuff
* sync with reality (post-removal)
  -> e.g. don't call comsatd in inetd.conf
* general clean-up phase for touched files,
  or stuff "while here"
* partial distrib list sync (post-removal)
* replace echo with print in /etc/profile

kernel builds; will do a make b-r in two jiffies
@
text
@# $MirBSD: src/sys/arch/i386/conf/Makefile.i386,v 1.23 2004/10/28 15:15:35 tg Exp $
# $OpenBSD: Makefile.i386,v 1.40 2004/05/11 04:01:00 deraadt Exp $

# Makefile for MirOS BSD and derived operating environments
# based upon Makefile for OpenBSD (NetBSD, 4.4BSD-Lite, etc.)
#
# This makefile is constructed from a machine description:
#	config machineid
# Most changes should be made in the machine description
#	/sys/arch/i386/conf/MACHINEID
# after which you should do
#	config machineid
# Machine generic makefile changes should be made in
#	/sys/arch/i386/conf/Makefile.i386
# after which config should be rerun for all machines of that type.
#
# N.B.: NO DEPENDENCIES ON FOLLOWING FLAGS ARE VISIBLE TO MAKEFILE
#	IF YOU CHANGE THE DEFINITION OF ANY OF THESE RECOMPILE EVERYTHING
#
# -DTRACE	compile in kernel tracing hooks
# -DQUOTA	compile in file system quotas

# DEBUG is set to -g if debugging.

.include <bsd.own.mk>

MKDEP?=	mkdep
SIZE?=	size
STRIP?=	strip

# source tree is located via $S relative to the compilation directory
.ifndef S
S!=	cd ../../../..; pwd
.endif
I386=	$S/arch/i386

INCLUDES=	-nostdinc -I. -I$S/arch -I$S
CPPFLAGS=	${INCLUDES} ${IDENT} -D_KERNEL -Di386
CDIAGFLAGS=	-Werror -Wall -Wstrict-prototypes -Wmissing-prototypes \
		-Wno-uninitialized -Wno-format -Wno-main -ffreestanding

.if !${IDENT:M-DI386_CPU}
CMACHFLAGS=	-march=i486
.else
CMACHFLAGS=
.endif
.if ${IDENT:M-DNO_PROPOLICE}
CMACHFLAGS+=	-fno-stack-protector
.endif
CMACHFLAGS+=	-fno-builtin-printf -fno-builtin-log

COPTS?=		-O2
CFLAGS=		${DEBUG} ${CDIAGFLAGS} ${CMACHFLAGS} \
		${COPTS:S/-g//} ${PIPE} ${CSYS}
AFLAGS=		-x assembler-with-cpp -traditional-cpp -D_LOCORE
LINKFLAGS=	-Ttext 0xD0100120 -e start -N
STRIPFLAGS=	-g -X -x

HOSTCC=		${CC}
HOSTED_CPPFLAGS=${CPPFLAGS:S/^-nostdinc$//}
HOSTED_CFLAGS=	${CFLAGS}

### find out what to use for libkern
.include "$S/lib/libkern/Makefile.inc"
LIBKERN=	${KERNLIB}

### find out what to use for libcompat
.include "$S/compat/common/Makefile.inc"
LIBCOMPAT=	${COMPATLIB}

# compile rules: rules are named ${TYPE}_${SUFFIX}${CONFIG_DEP}
# where TYPE is NORMAL or DRIVER; SUFFIX is the file suffix,
# capitalized (e.g. C for a .c file), and CONFIG_DEP is _C if the file
# is marked as config-dependent.

NORMAL_C=	${CC} ${CFLAGS} ${CPPFLAGS} -c $<
NORMAL_C_C=	${CC} ${CFLAGS} ${CPPFLAGS} ${PARAM} -c $<

DRIVER_C=	${CC} ${CFLAGS} ${CPPFLAGS} -c $<
DRIVER_C_C=	${CC} ${CFLAGS} ${CPPFLAGS} ${PARAM} -c $<

NORMAL_S=	${CC} ${AFLAGS} ${CPPFLAGS} -c $<
NORMAL_S_C=	${CC} ${AFLAGS} ${CPPFLAGS} ${PARAM} -c $<

HOSTED_C=	${HOSTCC} ${HOSTED_CFLAGS} ${HOSTED_CPPFLAGS} -c $<

%OBJS

%CFILES

%SFILES

# load lines for config "xxx" will be emitted as:
# xxx: ${SYSTEM_DEP} swapxxx.o
#	${SYSTEM_LD_HEAD}
#	${SYSTEM_LD} swapxxx.o
#	${SYSTEM_LD_TAIL}
SYSTEM_OBJ=	locore.o tai_leaps.o init_ssp.o \
		param.o ioconf.o ${OBJS} ${LIBKERN} ${LIBCOMPAT}
SYSTEM_DEP=	Makefile ${SYSTEM_OBJ}
SYSTEM_LD_HEAD=	rm -f $@@
SYSTEM_LD=	@@echo ${LD} ${LINKFLAGS} -o $@@ '$${SYSTEM_OBJ}' vers.o; \
		${LD} ${LINKFLAGS} -o $@@ ${SYSTEM_OBJ} vers.o
SYSTEM_LD_TAIL=	@@${SIZE} $@@; chmod 755 $@@

DEBUG?=
.if ${DEBUG} == "-g"
LINKFLAGS+=	-X
SYSTEM_LD_TAIL+=; \
		echo cp $@@ $@@.gdb; rm -f $@@.gdb; cp $@@ $@@.gdb; \
		echo ${STRIP} ${STRIPFLAGS} $@@; ${STRIP} ${STRIPFLAGS} $@@
.else
LINKFLAGS+=	-x
.endif

%LOAD

assym.h: $S/kern/genassym.sh ${I386}/i386/genassym.cf Makefile
	${SHELL} $S/kern/genassym.sh ${CC} ${CFLAGS} ${CPPFLAGS} \
	    ${PARAM} <${I386}/i386/genassym.cf >assym.h.tmp && \
	    mv -f assym.h.tmp assym.h

# Propolice init
init_ssp.o: $S/kern/init_ssp.c
	${NORMAL_C} -fno-stack-protector

param.c: $S/conf/param.c
	rm -f param.c
	cp $S/conf/param.c .

param.o: param.c Makefile
	${NORMAL_C_C}

ioconf.o: ioconf.c
	${NORMAL_C}

tai_leaps.o: tai_leaps.c
	${NORMAL_C}

tai_leaps.c: tai_make
	./tai_make >$@@ || (rm -f $@@; false)

tai_make: tai_make.o
	${HOSTCC} ${HOSTED_CFLAGS} -o $@@ $>

tai_make.o: $S/lib/libkern/tai_make.c
	${HOSTED_C}

newvers: ${SYSTEM_DEP} ${SYSTEM_SWAP_DEP}
	${SHELL} $S/conf/newvers.sh "${OSrev}" "${OSrpl}" \
	    "${OSREV:C/^${OSrev}.//}" "${OScompat}"
	${CC} ${CFLAGS} ${CPPFLAGS} -c vers.c


clean::
	rm -f eddep *bsd bsd.gdb tags *.[io] [a-z]*.s \
	    [Ee]rrs linterrs makelinks assym.h

lint:
	@@lint -hbxncez -Dvolatile= ${CPPFLAGS} ${PARAM} -UKGDB \
	    ${CFILES} ioconf.c param.c | \
	    grep -v 'static function .* unused'

tags:
	@@echo "see $S/kern/Makefile for tags"

links:
	egrep '#if' ${CFILES} | sed -f $S/conf/defines | \
	  sed -e 's/:.*//' -e 's/\.c/.o/' | sort -u >dontlink
	echo ${CFILES} | tr -s ' ' '\12' | sed 's/\.c/.o/' | \
	  sort -u | comm -23 - dontlink | \
	  sed 's,.*/\(.*.o\),rm -f \1; ln -s ../GENERIC/\1 \1,' >makelinks
	${SHELL} makelinks && rm -f dontlink makelinks

SRCS=	${I386}/i386/locore.s \
	param.c ioconf.c ${CFILES} ${SFILES}
depend:: .depend
.depend: ${SRCS} assym.h param.c ${APMINC}
	CC="${CC}" ${MKDEP} ${AFLAGS} ${CPPFLAGS} ${I386}/i386/locore.s
	CC="${CC}" ${MKDEP} -a ${CFLAGS} ${CPPFLAGS} param.c ioconf.c ${CFILES}
	CC="${CC}" ${MKDEP} -a ${AFLAGS} ${CPPFLAGS} ${SFILES}
	CC="${CC}" ${SHELL} $S/kern/genassym.sh ${MKDEP} -f assym.dep ${CFLAGS} \
	    ${CPPFLAGS} <${I386}/i386/genassym.cf
	@@sed -e 's/.*\.o:.* /assym.h: /' <assym.dep >>.depend
	@@rm -f assym.dep


# depend on root or device configuration
autoconf.o conf.o: Makefile

# depend on network or filesystem configuration
uipc_domain.o uipc_proto.o vfs_conf.o: Makefile
if.o if_tun.o if_loop.o if_ethersubr.o: Makefile
if_arp.o if_ether.o: Makefile
ip_input.o ip_output.o in_pcb.o in_proto.o: Makefile
tcp_subr.o tcp_timer.o tcp_output.o: Makefile

# depend on maxusers
machdep.o: Makefile

# depend on CPU configuration
locore.o machdep.o: Makefile


locore.o: ${I386}/i386/locore.s assym.h
	${NORMAL_S}

# The install target can be redefined by putting a
# install-kernel-${MACHINE_NAME} target into /etc/mk.conf
MACHINE_NAME!=  uname -n
install: install-kernel-${MACHINE_NAME}
.if !target(install-kernel-${MACHINE_NAME}})
install-kernel-${MACHINE_NAME}:
	rm -f /obsd
	ln /bsd /obsd
	cp bsd /nbsd
	mv /nbsd /bsd
.endif

%RULES
@


1.25.4.1
log
@fold MIROS_X branch
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/conf/Makefile.i386,v 1.25.2.1 2005/01/06 13:48:23 tg Exp $
d40 1
a40 1
		-Wno-uninitialized -Wno-format -Wno-main
d50 1
a50 1
CMACHFLAGS+=	-fno-builtin-printf -fno-builtin-log -ffreestanding
@


1.25.2.1
log
@I was going to specify -Wno-packed here for gcc 3.4's benefit,
but it doesn't change a thing.

But, while here, move the -ffreestanding to its right place.
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/conf/Makefile.i386,v 1.25 2004/12/11 16:50:06 tg Exp $
d40 1
a40 1
		-Wno-uninitialized -Wno-format -Wno-main
d50 1
a50 1
CMACHFLAGS+=	-fno-builtin-printf -fno-builtin-log -ffreestanding
@


1.24
log
@sync with libc source; shrink and make more failproof
@
text
@a23 1
# PROF is set to -pg if profiling.
a64 1
.ifndef PROF
a65 3
.else
LIBKERN=	${KERNLIB_PROF}
.endif
a68 1
.ifndef PROF
a69 3
.else
LIBCOMPAT=	${COMPATLIB_PROF}
.endif
d72 1
a72 1
# where TYPE is NORMAL, DRIVER, or PROFILE; SUFFIX is the file suffix,
d76 2
a77 2
NORMAL_C=	${CC} ${CFLAGS} ${CPPFLAGS} ${PROF} -c $<
NORMAL_C_C=	${CC} ${CFLAGS} ${CPPFLAGS} ${PROF} ${PARAM} -c $<
d79 2
a80 2
DRIVER_C=	${CC} ${CFLAGS} ${CPPFLAGS} ${PROF} -c $<
DRIVER_C_C=	${CC} ${CFLAGS} ${CPPFLAGS} ${PROF} ${PARAM} -c $<
d152 1
a152 1
	${CC} ${CFLAGS} ${CPPFLAGS} ${PROF} -c vers.c
@


1.23
log
@pass $CC to mkdep(1)
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/conf/Makefile.i386,v 1.22 2004/09/16 10:08:01 tg Exp $
d150 1
a150 1
	./tai_make >$@@
@


1.22
log
@another price.
the __guard[] setup functions (obviously) must not be ssp protected,
since __guard[0] before and after will differ (previously, they used
to work, and I could use -fno-stack-protector-all, but this way it's
a lot safer)

libc tested; kernel crash without this diff confirmed, new kernel not
yet tested
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/conf/Makefile.i386,v 1.21 2004/07/14 11:21:22 tg Stab $
d188 4
a191 4
	${MKDEP} ${AFLAGS} ${CPPFLAGS} ${I386}/i386/locore.s
	${MKDEP} -a ${CFLAGS} ${CPPFLAGS} param.c ioconf.c ${CFILES}
	${MKDEP} -a ${AFLAGS} ${CPPFLAGS} ${SFILES}
	${SHELL} $S/kern/genassym.sh ${MKDEP} -f assym.dep ${CFLAGS} \
@


1.21
log
@put in some effort to
* fix the boot loader output
* fix ramdisk root device selection
* make release with as few sudo as possible
* fix COPTS selection for the anoncvsbin
* fix COPTS (no -g) for the kernel
  (a kernel with DEBUG=-g needs a higher ulimit -d)
* clean up in general
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/conf/Makefile.i386,v 1.20 2004/06/23 16:58:42 tg Exp $
d107 1
a107 1
SYSTEM_OBJ=	locore.o tai_leaps.o \
d131 4
@


1.20
log
@* lalala, ABI change...
  change the calling convention for the mjd2tm and tm2mjd functions,
  to be
  - similar between themselfes
  - equal between kernel and userland
  - not using malloc
* add TAI stuff to the kernel, including leap seconds(!) :)
  -> we can soon(TM) set the RTC to UTC, even when
     having the kernel on dru^H^H^HLS^H^HTAI
* some Makefile adjustments for
  - new library stuff
  - bsd.cfwrap.mk
  - simplifications
* start fixing the build (still static, tho I didn't intend that...)
* add missing shlib version for libsupc++
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/conf/Makefile.i386,v 1.19 2004/06/17 19:52:43 tg Exp $
d54 2
a55 1
CFLAGS=		${DEBUG} ${CDIAGFLAGS} ${CMACHFLAGS} ${COPTS} ${PIPE} ${CSYS}
@


1.19
log
@preliminary build fixes, whitespace fixes, dependency fixes,
manpage installation and naming fixes, programme hard-link
fixes & addition to <bsd.cfwrap.mk>, removal-of-NOPROFILE-option
fixes etc.

you should be able to build kernel & userland with this set
of source and the following line in /etc/mk.conf added:
| CSYS+=		-D"ETHER_ALIGN=2"
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/conf/Makefile.i386,v 1.18 2004/05/27 19:10:36 tg Exp $
d106 1
a106 1
SYSTEM_OBJ=	locore.o \
d140 12
@


1.18
log
@* make kernel (GENERIC i386) build
* nuke more NS parts
* nuke more SVR4 compat
* fix compats
* more MirOS RCS IDs
* better randomness usage/distribution
* better paranoia checks in random stuff
* use \$SHELL instead of sh
etc.pp
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/conf/Makefile.i386,v 1.17 2004/05/23 20:15:34 tg Exp $
d59 1
a59 1
HOSTCC= ${CC}
@


1.17
log
@* first futile attempt to merge OpenBSD 3.5-current
* damn! they got pxeboot! -> disable for now
  (there's still ports/sysutils/pxegrub; we'll have pxeboot later)
* I don't know if that ... bootloader still works
* nuke netbsd emul (was unused anyways)
* nuke a plethora of syscalls not being used, and mark
  the other two (COMPAT_35) for deletion RSN
* merge new MI-GENERIC into i386 GENERIC
* resolve numeric conflicts for
  - syscalls
  - sysctls
  - device majors
  - pcidevs
* (c) cleanup - no need to add a bsd-like licence when
  there's already one; just add my name
* and much more
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/conf/Makefile.i386,v 1.16 2004/05/07 17:21:14 tg Exp $
d128 1
a128 1
	    ${PARAM} < ${I386}/i386/genassym.cf > assym.h.tmp && \
d161 1
a161 1
	  sed -e 's/:.*//' -e 's/\.c/.o/' | sort -u > dontlink
d164 1
a164 1
	  sed 's,.*/\(.*.o\),rm -f \1; ln -s ../GENERIC/\1 \1,' > makelinks
d175 2
a176 2
	    ${CPPFLAGS} < ${I386}/i386/genassym.cf
	@@sed -e 's/.*\.o:.* /assym.h: /' < assym.dep >> .depend
@


1.16
log
@sh -> ${SHELL}
ksh -> ${SHELL}
@
text
@d1 2
a2 3
# $MirBSD: src/sys/arch/i386/conf/Makefile.i386,v 1.15 2004/04/30 17:29:56 tg Exp $
# $OpenBSD: Makefile.i386,v 1.39 2003/11/20 08:38:52 espie Exp $
# $NetBSD: Makefile.i386,v 1.67 1996/05/11 16:12:11 mycroft Exp $
@


1.15
log
@add CSYS makeoption to kernel config files so they can specify their
own COPTS which override these from a user
used by ramdisk kernels to add -Os
while here, nuke CKERNFLAGS from sparc
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/conf/Makefile.i386,v 1.14 2004/04/10 22:41:00 tg Exp $
d128 1
a128 1
	sh $S/kern/genassym.sh ${CC} ${CFLAGS} ${CPPFLAGS} \
d143 1
a143 1
	ksh $S/conf/newvers.sh "${OSrev}" "${OSrpl}" \
d166 1
a166 1
	sh makelinks && rm -f dontlink makelinks
d175 1
a175 1
	sh $S/kern/genassym.sh ${MKDEP} -f assym.dep ${CFLAGS} \
@


1.14
log
@newvers.sh needs mirbsdksh now
@
text
@d1 1
a1 1
# $MirBSD: Makefile.i386,v 1.13 2003/12/28 01:01:22 tg Exp $
d55 1
a55 1
CFLAGS=		${DEBUG} ${CDIAGFLAGS} ${CMACHFLAGS} ${COPTS} ${PIPE}
d183 3
a185 3
 
# depend on network or filesystem configuration 
uipc_domain.o uipc_proto.o vfs_conf.o: Makefile 
d194 1
a194 1
# depend on CPU configuration 
@


1.13
log
@employ fix for the uname change problem
which will fix 95% of the 90% broken ports
XXX all ports using COMES_WITH must use mirbsd
XXX	releases (1, 2, 3...) not openbsd ones
XXX	(3.0, 3.1, ...) now!
@
text
@d1 3
a3 3
#	$MirBSD: Makefile.i386,v 1.12 2003/12/27 19:55:00 tg Exp $
#	$OpenBSD: Makefile.i386,v 1.39 2003/11/20 08:38:52 espie Exp $
#	$NetBSD: Makefile.i386,v 1.67 1996/05/11 16:12:11 mycroft Exp $
d5 2
a6 1
# Makefile for OpenBSD-mirabile aka MirBSD
d143 1
a143 1
	sh $S/conf/newvers.sh "${OSrev}" "${OSrpl}" \
@


1.12
log
@save what I've done so far to attempt building it through
perl was broken (i386-tirttt not i386-mirbsd? but not
everywhere???) etc. so I didn't sync the lists.
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.i386,v 1.11 2003/12/25 20:27:45 tg Exp $
d142 2
a143 1
	sh $S/conf/newvers.sh "${OSrev}" "${OSrpl}" "${OSREV:C/^${OSrev}.//}"
@


1.11
log
@merge another bit of the OpenBSD import from $some days ago
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.i386,v 1.10 2003/11/30 02:26:25 tg Exp $
d142 1
a142 1
	sh $S/conf/newvers.sh "${OSrel}" "${OSrelm}" "${OSrelx}"
@


1.10
log
@remove ${CKERNFLAGS}, because pgcc supports -ffreestanding as well
@
text
@d1 2
a2 2
#	$MirBSD: Makefile.i386,v 1.9 2003/10/01 18:33:27 tg Exp $
#	$OpenBSD: Makefile.i386,v 1.38 2003/07/22 19:39:50 otto Exp $
d51 1
@


1.9
log
@o bump to 0x0781 fully
o add possibility to add a release extension (MirBSD #7semel, bis, ter,
  quater, quinquies, sexties, ...)
o add .c.E .cc.E etc. targets which spit out preprocessed input
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.i386,v 1.8 2003/09/19 13:19:22 tg Exp $
d41 1
a41 1
		-Wno-uninitialized -Wno-format -Wno-main
d53 1
a53 1
CFLAGS=		${DEBUG} ${CDIAGFLAGS} ${CMACHFLAGS} ${COPTS} ${PIPE} ${CKERNFLAGS}
@


1.9.4.1
log
@MFC: newvers.sh needs mirbsdksh
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.i386,v 1.9 2003/10/01 18:33:27 tg Exp $
d141 1
a141 1
	ksh $S/conf/newvers.sh "${OSrel}" "${OSrelm}" "${OSrelx}"
@


1.8
log
@implement machine-parsable input for 'newvers.sh', thus allowing uname(1)
and friends to display the OS patchlevel revision (not patchlevel date)
in a parsable form, derived from the currently installed <sys.mk> revision.

Note: don't try to fake the "latest" patchlevel always. Releases (formal)
are built twice in a row from the same source. To make a formal release,
you cvs up to the tag, make b-r, check the file lists, make b-r in X-Window,
check the file lists, remove /usr/obj stuff, make b-r in both again after
a reboot.
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.i386,v 1.7 2003/07/26 20:06:27 tg Exp $
d141 1
a141 1
	sh $S/conf/newvers.sh "${OSrel}" "${OSrelm}"
@


1.7
log
@fix breakage in the OpenBSD version of /sys/kern/genassym.ch
by circumventing a bug in said script by means of making
our mkdep(1) more intelligent (it looks if ${CC:-cc} exists,
and if not, uses pgcc)
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.i386,v 1.6 2003/07/26 16:08:08 tg Exp $
d141 1
a141 1
	sh $S/conf/newvers.sh
@


1.6
log
@merge CVS; fix here and there a bit
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.i386,v 1.5 2003/06/06 18:28:49 tg Exp $
d28 1
a28 1
MKDEP?=	CC="${CC}" mkdep
@


1.5
log
@Merge OpenBSD-current
@
text
@d1 2
a2 2
#	$MirBSD: Makefile.i386,v 1.4 2003/05/22 14:08:22 tg Exp $
#	$OpenBSD: Makefile.i386,v 1.37 2003/05/23 22:16:16 tedu Exp $
d172 4
@


1.4
log
@merge CVS import stuff
@
text
@d1 2
a2 2
#	$MirBSD: Makefile.i386,v 1.3 2003/04/24 11:04:59 tg Exp $
#	$OpenBSD: Makefile.i386,v 1.36 2003/05/13 22:45:10 miod Exp $
d151 1
a151 1
	    ${CFILES} ${I386}/i386/swapgeneric.c ioconf.c param.c | \
@


1.3
log
@fix cvs import mess, merge OpenBSD-current
@
text
@d1 2
a2 2
#	$MirBSD: Makefile.i386,v 1.2 2003/03/23 21:52:15 tg Exp $
#	$OpenBSD: Makefile.i386,v 1.34 2003/04/17 03:42:09 drahn Exp $
d48 1
d50 1
@


1.2
log
@Merge MirBSD-old entirely
Remove krb, yp, afs, GPL'd stuff in kernel
Adjust some other stuff

Not to be compiled yet...
@
text
@d1 2
a2 2
#	$MirBSD: obsd.kernel,v 1.16 2003/03/22 22:33:25 tg Exp $
#	$OpenBSD: Makefile.i386,v 1.33 2002/12/25 21:10:26 miod Exp $
d54 1
a54 1
STRIPFLAGS=	-d
@


1.1
log
@Initial revision
@
text
@d1 1
d5 1
a5 1
# Makefile for OpenBSD
d10 1
a10 1
#	/sys/arch/i386/conf/``machineid''
d28 1
a28 1
MKDEP?=	mkdep
d51 1
a51 1
CFLAGS=		${DEBUG} ${CDIAGFLAGS} ${CMACHFLAGS} ${COPTS} ${PIPE}
d53 1
a53 1
LINKFLAGS=	-z -Ttext D0100000 -e start
@


1.1.1.1
log
@Import OpenBSD 3.3 source repository from CTM 3132 the first time
This opens an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright © 1968-2003  The authors of And contributors to UNIX®, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@


1.1.1.2
log
@Import some parts of OpenBSD-current (after their ELF switch) to ease future merging and reduce diffs against their codebase
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.i386,v 1.34 2003/04/17 03:42:09 drahn Exp $
d52 2
a53 2
LINKFLAGS=	-Ttext 0xD0100120 -e start -N
STRIPFLAGS=	-g -X -x
@


1.1.1.3
log
@Sync MirBSD main source tree against OpenBSD-current,
which should be fairly stable after the Hackathon now.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.i386,v 1.36 2003/05/13 22:45:10 miod Exp $
a46 1
.if ${IDENT:M-DNO_PROPOLICE}
a47 1
.endif
@


1.1.1.4
log
@Import latest OpenBSD CVS tree by CTM in order
to sync the base system and ports tree with Them.

This includes the recent licence changes as well - by
importing the changed base and re-applying the diffs
(with cvs up -j -j) they are inherited, and we're not
bound to the removed clauses any longer.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.i386,v 1.37 2003/05/23 22:16:16 tedu Exp $
d150 1
a150 1
	    ${CFILES} ioconf.c param.c | \
@


1.1.1.5
log
@Import latest OpenBSD ports, XFree and source in sync
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.i386,v 1.38 2003/07/22 19:39:50 otto Exp $
a170 4
	sh $S/kern/genassym.sh ${MKDEP} -f assym.dep ${CFLAGS} \
	    ${CPPFLAGS} < ${I386}/i386/genassym.cf
	@@sed -e 's/.*\.o:.* /assym.h: /' < assym.dep >> .depend
	@@rm -f assym.dep
@


1.1.1.6
log
@Time to import OpenBSD once again. Expect breakage.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.i386,v 1.39 2003/11/20 08:38:52 espie Exp $
a49 1
CMACHFLAGS+=	-fno-builtin-printf -fno-builtin-log
@


1.1.1.7
log
@large-scale import of OpenBSD 3.5-current source base including many fixes
note: from now, we will not be binary compatible with OpenBSD apps any
longer (due to syscall numbering differences); both an OpenBSD compat and
a conversion tool for old MirOS #7 apps will be delivered later.

The src/ tree is locked from now.
@
text
@d1 2
a2 1
#	$OpenBSD: Makefile.i386,v 1.40 2004/05/11 04:01:00 deraadt Exp $
@


