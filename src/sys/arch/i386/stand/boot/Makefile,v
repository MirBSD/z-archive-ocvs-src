head	1.28;
access;
symbols
	tg-mergetmp-mirosx-1:1.28
	tg-mergefixes-1-branch:1.28.0.8
	tg-mergefixes-1-base:1.28
	MIROS_X:1.28.0.6
	MIROS_X_BASE:1.28
	tg-mergetmp-3:1.28
	MIRBSD_XP_MIRPPC:1.28.0.4
	MIRBSD_XP_SPARC_BASE:1.28
	MIRBSD_XP_SPARC:1.28.0.2
	MIRBSD_7quater:1.3
	cvs-200405160640:1.1.1.2
	cvs-200401271800:1.1.1.2
	cvs-200401261630:1.1.1.2
	cvs-200401021645:1.1.1.2
	MIRBSD_7_ALPHA:1.3.0.6
	MIRBSD_7:1.3.0.4
	cvs-200312222040:1.1.1.2
	cvs-200312171912:1.1.1.2
	MIRBSD_7ter:1.3
	MIRBSD_7_DEV:1.3.0.2
	cvs-200310020700:1.1.1.2
	cvs-200309271030:1.1.1.2
	cvs-200309261655:1.1.1.2
	cvs-200309251530:1.1.1.2
	cvs-200309192030:1.1.1.2
	cvs-200309181930:1.1.1.2
	cvs-200309131952:1.1.1.2
	cvs-200308302005:1.1.1.2
	cvs-200308221505:1.1.1.2
	cvs-200308171200:1.1.1.2
	ctm-3496:1.1.1.2
	ctm-3449:1.1.1.2
	ctm-3437:1.1.1.2
	cvs-200307191805:1.1.1.2
	ctm-3425:1.1.1.2
	cvs-200307091500:1.1.1.2
	cvs-200307072125:1.1.1.2
	ctm-3389:1.1.1.2
	cvs-200307021520:1.1.1.2
	cvs-200306291430:1.1.1.2
	ctm-3341:1.1.1.2
	MIRBSD_5:1.1.1.2
	cvs-200306082100:1.1.1.2
	ctm-3316:1.1.1.2
	ctm-3272:1.1.1.2
	ctm-3264:1.1.1.2
	cvs-200305071630:1.1.1.2
	ctm-3255:1.1.1.2
	ctm-3229:1.1.1.2
	MIRBSD_4:1.2
	ctm-3203:1.1.1.1
	cvs-20030410-1130:1.1.1.1
	ctm-3155:1.1.1.1
	ctm-3132:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.28
date	2004.07.06.21.08.13;	author tg;	state Stab;
branches;
next	1.27;

1.27
date	2004.03.05.22.01.59;	author tg;	state Exp;
branches;
next	1.26;

1.26
date	2003.12.21.22.07.53;	author tg;	state Exp;
branches;
next	1.25;

1.25
date	2003.12.21.19.22.36;	author tg;	state Exp;
branches;
next	1.24;

1.24
date	2003.12.21.17.36.31;	author tg;	state Exp;
branches;
next	1.23;

1.23
date	2003.12.19.20.58.29;	author tg;	state Exp;
branches;
next	1.22;

1.22
date	2003.12.19.19.18.27;	author tg;	state Exp;
branches;
next	1.21;

1.21
date	2003.12.19.18.52.43;	author tg;	state Exp;
branches;
next	1.20;

1.20
date	2003.12.19.18.31.36;	author tg;	state Exp;
branches;
next	1.19;

1.19
date	2003.12.18.22.26.18;	author tg;	state Exp;
branches;
next	1.18;

1.18
date	2003.12.17.20.42.32;	author tg;	state Exp;
branches;
next	1.17;

1.17
date	2003.12.01.18.53.55;	author tg;	state Exp;
branches;
next	1.16;

1.16
date	2003.12.01.18.49.38;	author tg;	state Exp;
branches;
next	1.15;

1.15
date	2003.11.17.13.57.58;	author tg;	state Exp;
branches;
next	1.14;

1.14
date	2003.11.15.00.37.48;	author tg;	state Exp;
branches;
next	1.13;

1.13
date	2003.11.14.23.37.24;	author tg;	state Exp;
branches;
next	1.12;

1.12
date	2003.11.14.21.12.12;	author tg;	state Exp;
branches;
next	1.11;

1.11
date	2003.11.14.20.55.39;	author tg;	state Exp;
branches;
next	1.10;

1.10
date	2003.11.14.20.49.43;	author tg;	state Exp;
branches;
next	1.9;

1.9
date	2003.10.31.23.43.03;	author tg;	state Exp;
branches;
next	1.8;

1.8
date	2003.10.31.21.07.52;	author tg;	state Exp;
branches;
next	1.7;

1.7
date	2003.10.31.15.19.32;	author tg;	state Exp;
branches;
next	1.6;

1.6
date	2003.10.31.15.12.37;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2003.10.30.13.19.28;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2003.10.30.13.18.43;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2003.09.20.04.27.52;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2003.03.23.21.52.17;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.22.17.49.37;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.03.22.17.49.37;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.04.24.09.05.38;	author tg;	state Exp;
branches;
next	;


desc
@@


1.28
log
@* enable pxeboot to build
* fix pxeboot
* add pxeboot to list of being built (ya, why not)
* fix CFLAGS/COPTS/makefile inclusion confusion
  which led gcc3 to ignore the -Os; that change in
  turn throws pxeboot from 59k to 52k which makes
  it actually work
* add -PXE postfix to version number

tested on soekris.66h.42h.de-to-be
@
text
@# $MirBSD: src/sys/arch/i386/stand/boot/Makefile,v 1.27 2004/03/05 22:01:59 tg Exp $

.include "${.CURDIR}/../Makefile.inc"

S=${.CURDIR}/../../../..
SADIR=${.CURDIR}/..
RL_VAL=0x17

CPPFLAGS+=	${DEBUGFLAGS} -DRL_VAL=${RL_VAL}
#CPPFLAGS+=	-DWANT_ELTORITO_CHECK
#CPPFLAGS+=	-DLOUD #-DEXTRALOUD
#CPPFLAGS+=	-DUTEST #-DUHARD #-DUANAL
#CPPFLAGS+=	-DDEBUG_OFS
CPPFLAGS+=	$(SACFLAGS)

#AFLAGS+=	-Wa,-R
#AFLAGS+=	-Wa,-a

MAN=	boot.8
MLINKS=	boot.8 boot.cfg.8

.if ${MACHINE} == "i386"
PROG=		boot
LD?=		ld
SIZE?=		size
LDFLAGS+=	-nostdlib -Bstatic
INSTALL_STRIP=
.PATH:		${S}/stand/boot

.if defined(DEBUGFLAGS) && !empty(DEBUGFLAGS:M-D_TEST)
CLEANFILES+=	srt0.o
SRCS=		crt0.c
.else
LDFLAGS+=	-Ttext $(LINKADDR) -N -x -noinhibit-exec
CLEANFILES+=	crt0.o
SRCS=		srt0.S
.endif

CLEANFILES+=	${.CURDIR}/disasm ${PROG}.nm ld.out
SRCS+=		boot.c bootarg.c cmd.c conf.c vars.c
LDADD=		${LIBSA} ${LIBZ}
DPADD=		${LIBSA} ${LIBZ}

all:		${PROG}

${PROG}:	$(OBJS) $(DPADD)
	$(LD) $(LDFLAGS) -o ${PROG} $(OBJS) $(LDADD) 2>&1 | tee ld.out
	@@if fgrep 'undefined reference' ld.out; then \
		echo "*** Attention: undefined references found!"; \
		exit 1; \
	  else exit 0; fi
	nm ${PROG} >${PROG}.nm
	@@if [ x"$$(fgrep 'T _rval' ${PROG}.nm)" != \
	    x"00040170 T _rval" ]; then \
		echo "ERROR: Value of RL_VAL (${RL_VAL}) must be adjusted!"; \
		echo "  Example: 00040170 T _rval => 0x17 (take the two"; \
		echo "   digits before the last 0 in hexadecimal); place"; \
		echo "   that in Makefile and adjust the \$${PROG} rule!"; \
		echo "  The problematic sym: $$(fgrep 'T _rval' ${PROG}.nm)"; \
		exit 1; \
	fi
	@@$(SIZE) ${PROG}
	strip --strip-all -R .comment ${PROG}
	objcopy -O binary ${PROG}

disasm:	${.CURDIR}/disasm

${.CURDIR}/disasm:	${PROG}
	ndisasm -b16 -o${LINKADDR} ${PROG} >${.CURDIR}/disasm

.else
NOPROG=		Yes
.endif

.include <bsd.prog.mk>
@


1.27
log
@a) I've actually encountered a PC with a BIOS which, when
   probing El Torito, overwrites the boot loader!
b) It didn't work for some time now

-> disable El Torito check, and, with that, CD boot (almost)
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.26 2003/12/21 22:07:53 tg Exp $
d63 1
a63 1
	strip --strip-all -R .note -R .comment ${PROG}
d69 1
a69 1
	ndisasm -b16 -o0x40120 ${PROG} >${.CURDIR}/disasm
@


1.26
log
@ > > >                #######   ###    #####  #     # #######   ###
 > > >                #          #    #     # #     #    #      ###
 > > >                #          #    #       #     #    #      ###
 > > >                #####      #    #  #### #######    #       #
 > > >                #          #    #     # #     #    #
 > > >                #          #    #     # #     #    #      ###
 > > >                #         ###    #####  #     #    #      ###


                        \   /   ,---.
     mirabile            \ /    `--_          broken BIOS
                          V     -__-'  o


               #####   #####  ####### ######  #######    #
              #     # #     # #     # #     # #         ###
              #       #       #     # #     # #          #
               #####  #       #     # ######  #####
                    # #       #     # #   #   #          #
              #     # #     # #     # #    #  #         ###
               #####   #####  ####### #     # #######    #


       *****                                     *****
      *     *                                   *     *
            *                                         *
       *****                                     *****
            *                                   *
      *     *                                   *
       *****                                    *******


    %    %     %    %%%%%     %%    %%%%%      %    %       %%%%%%
    %%  %%     %    %    %   %  %   %    %     %    %       %
    % %% %     %    %    %  %    %  %%%%%      %    %       %%%%%
    %    %     %    %%%%%   %%%%%%  %    %     %    %       %
    %    %     %    %   %   %    %  %    %     %    %       %
    %    %     %    %    %  %    %  %%%%%      %    %%%%%%  %%%%%%


    %   %           %    %     %    %    %   %%%%           %   %
     % %            %    %     %    %%   %  %                % %
   %%%%%%%          %    %     %    % %  %   %%%%          %%%%%%%
     % %            % %% %     %    %  % %       %           % %
    %   %           %%  %%     %    %   %%  %    %          %   %
                    %    %     %    %    %   %%%%



The new bootloader code works on CD-R, hard disc and MS-DOS in real broken
hardware, as well as on CD ISO in bochs.
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.25 2003/12/21 19:22:36 tg Exp $
d10 1
@


1.25
log
@* check for undefined references
* add possibilities for more anal debugging
* fix structure alignment etc. (makes help and machine * work again)
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.24 2003/12/21 17:36:31 tg Exp $
d11 1
a11 1
#CPPFLAGS+=	-DUTEST #-DUHARD
@


1.24
log
@increase stack from 0x120 to 64K
add some more checkpointing

no (real) functional changes yet
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.23 2003/12/19 20:58:29 tg Exp $
d10 1
a10 1
#CPPFLAGS+=	-DLOUD
d13 1
a13 1
CFLAGS+=	$(SACFLAGS)
d38 1
a38 1
CLEANFILES+=	${.CURDIR}/disasm ${PROG}.nm
d46 5
a50 1
	$(LD) $(LDFLAGS) -o ${PROG} $(OBJS) $(LDADD)
@


1.23
log
@kludge around more, making use of an option of mkisofs to
write the information table into the boot image itself;
idea seen at various other ISO boot places.

Now it comes until the switch into protected mode on my
machine. This is where I'll stop for now.
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.22 2003/12/19 19:18:27 tg Exp $
d9 4
a12 1
CPPFLAGS+=	${DEBUGFLAGS} -DRL_VAL=${RL_VAL} #-DLOUD -DUTEST #-DUHARD
d38 1
a38 1
CLEANFILES+=	${.CURDIR}/disasm
d47 2
a48 1
	@@if [ x"$$(nm ${PROG} | fgrep 'T _rval')" != \
d54 1
a54 1
		echo "  The false line: $$(nm ${PROG} | fgrep 'T _rval')"; \
@


1.22
log
@Now that it works[0], remove debugging

[0]: ms-dos on real hardware, floppy and hdd and cd on bochs
     cd on real broken hardware just reboots, that's why
     I'll test with -DUHARD now.
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.21 2003/12/19 18:52:43 tg Exp $
d7 1
a7 1
RL_VAL=0x13
d44 2
a45 2
	@@if [ x"$$(nm ${PROG} | fgrep 'T _start')" != \
	    x"00040120 T _start" ]; then \
d47 4
a50 5
		echo "  Example: 00040120 T _start => 0x13 (take the two"; \
		echo "   digits before the last 0 and add a hexadecimal"; \
		echo "   one to them); place that in Makefile and adjust"; \
		echo "   the \$${PROG} rule accordingly!"; \
		echo "  The false line: $$(nm ${PROG} | fgrep 'T _start')"; \
@


1.21
log
@With a few simple thinko fixes, this does work indeed.
Tested:
 * bochs, floppy
 * bochs, CD-ROM
To be tested:
 * bochs, HDD
 * hardware, CD-ROM
 * bochs, MS-DOS
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.20 2003/12/19 18:31:36 tg Exp $
d9 1
a9 1
CPPFLAGS+=	${DEBUGFLAGS} -DRL_VAL=${RL_VAL} -DLOUD -DUTEST
@


1.20
log
@new, self-relocatable, self-loading init code for /boot
works on floppy in bochs (tested)
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.19 2003/12/18 22:26:18 tg Exp $
d35 1
d57 5
@


1.19
log
@first attempt at breaking the boot loader code :-)
Unluckily I can't fix it right now, so don't update
and wait for a great rewrite of some code :)
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.18 2003/12/17 20:42:32 tg Exp $
d7 1
d9 1
a9 1
CPPFLAGS+=	${DEBUGFLAGS} -DLOUD -DUTEST
d43 10
@


1.18
log
@merge OpenBSD
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.17 2003/12/01 18:53:55 tg Exp $
d22 1
a36 1
CLEANFILES+=	${PROG}.bin
a41 7
	# Convert to bootable El Torito image
	printf '\x44\x29\x0C\x29\x01\xE9\x10\x01' \
	    | dd of="${PROG}" bs=1 count=8 seek=8 conv=notrunc
# the following one breaks two fields in the ELF header.
	printf '\xEB\xC4' \
	    | dd of="${PROG}" bs=1 count=2 seek=71 conv=notrunc
	# Conversion done.
d43 2
a44 13

${PROG}.bin:	${PROG}
	objcopy -v -O binary ${PROG} ${PROG}.bin

afterinstall:
	strip --strip-all -R .note -R .comment ${DESTDIR}${BINDIR}/${PROG}
	# Convert to bootable El Torito image
	printf '\x44\x29\x0C\x29\x01\xE9\x10\x01' | dd conv=notrunc \
	    of="${DESTDIR}${BINDIR}/${PROG}" bs=1 count=8 seek=8
# the following one breaks two fields in the ELF header.
	printf '\xEB\xC4' | dd conv=notrunc \
	    of="${DESTDIR}${BINDIR}/${PROG}" bs=1 count=2 seek=71
	# Conversion done.
@


1.17
log
@do not apparently compile debugging flag
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.16 2003/12/01 18:49:38 tg Exp $
d8 1
a8 1
CPPFLAGS+=	${DEBUGFLAGS} #-DLOUD
d55 1
@


1.16
log
@The boot loader seems to have been broken since the MirOS #7 releases.
Apologies to Jannis Konrad for blaming on his (nevertheless
totally broken) hardware. Thanks to Bill Gates and his company
for writing DEBUG.COM which allowed me to get into my system
again, since it apparently can't boot our /boot from CD-ROM
(this is still not fixed, but it's fine in bochs, and my box
 doesn't even get as far as the Lsrt0 message,
	MirOS boot(8) 2.54 srt0 initializing
 when booting from CD, so it must be broke too).

While here, rewrite several chunks of the code, and extend the
size of the argv[] array for boot commands to make echo work.

Tested:
 bochs CD passed
 mybox CD failed
 mybox HD passed
 mybox MS-DOS passed
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.15 2003/11/17 13:57:58 tg Exp $
d8 1
a8 1
CPPFLAGS+=	${DEBUGFLAGS} -DLOUD
@


1.15
log
@pbr_ffs 2.51 is NOT compatible with boot <2.51 any more
this is by design
the new one checks the ELF and jump 0x120 magic, and
saves a few :) bytes
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.14 2003/11/15 00:37:48 tg Exp $
d8 1
a8 1
CPPFLAGS+=	${DEBUGFLAGS} #-DLOUD
@


1.14
log
@Nuke cdrom34.fs, we don't need it any more.
Move to cd34.iso based upon /boot and bsd.rd (gzipped).
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.13 2003/11/14 23:37:24 tg Exp $
d8 1
a8 7
LINKSEG=	${LINKADDR:S/0$//}
LOADSEG=	${LOADADDR:S/0$//}

CPPFLAGS+=	-DBOOTMAGIC=${BOOTMAGIC} ${DEBUGGLAGS}
CPPFLAGS+=	-DSA_LINKSEG=${LINKSEG} -DSA_LOADSEG=${LOADSEG}
CPPFLAGS+=	-DSA_LINKADDR=${LINKADDR} -DSA_LOADADDR=${LOADADDR}
#CPPFLAGS+=	-DLOUD
@


1.13
log
@yay. I am your god. (Or root. What is difference?)

Tested:
 * boot cd0, kernel cd0:gzip'd
 * boot cd0, kernel cd0:stripped
 * boot cd0, kernel cd0:stripped and gzip'd
 * boot cd0, kernel fd1:floppyM34.fs
 * boot fd0, kernel fd1:floppyM34.fs
 * boot hd0, kernel fd1:floppyM34.fs
 * boot cd0, kernel hd0:floppyM34.fs
 * boot hd0, kernel hd0:floppyM34.fs

All tests have been passed in bochs, except the one below.
No tests at all have been performed on real hardware.

Tested and failed:
 * boot cd0, kernel cd0:plain bsd.rd

NM: fixed some minor bits in files touched, too
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.12 2003/11/14 21:12:12 tg Exp $
d59 9
@


1.12
log
@remove silly debugging everywhere; cdboot even loads a
kernel from CD-ROM fine now (which segfaults later...)
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.11 2003/11/14 20:55:39 tg Exp $
d44 1
a44 1
all:		${PROG} ${PROG}.bin
d48 7
@


1.11
log
@we don't need a dedicated cdboot directory either
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.10 2003/11/14 20:49:43 tg Exp $
d14 1
a14 1
CPPFLAGS+=	-DLOUD
@


1.10
log
@switch to boot-new, which shares a common srt0 between CD and BIOS
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.3 2003/11/09 12:54:24 tg Exp $
d42 1
d44 1
a44 1
all:		${PROG}
@


1.9
log
@.Pa /etc/boot.conf
dies, it is no more.
The file is now called
.Nm boot.cfg .
@
text
@d1 1
a1 2
#	$MirBSD: Makefile,v 1.8 2003/10/31 21:07:52 tg Exp $
#	$OpenBSD: Makefile,v 1.31 2003/04/17 12:06:05 mickey Exp $
d5 15
d21 1
a21 2
MLINKS=	boot.8 boot.cfg.8 \
	boot.8 cdboot.8
d24 5
a28 4
PROG?=	boot
LD?=	ld
SIZE?=	size
LDFLAGS+=-nostdlib -Bstatic
d32 1
a32 1
SRCS=	crt0.c
d34 1
a34 1
LDFLAGS+=-Ttext $(LINKADDR) -N -x -noinhibit-exec
d36 1
a36 1
SRCS=	srt0.S
d39 3
a41 3
SRCS+=	boot.c cmd.c vars.c bootarg.c conf.c
S	=${.CURDIR}/../../../..
SADIR=	${.CURDIR}/..
d43 1
a43 2
LDADD=	${LIBSA} ${LIBZ}
DPADD=	${LIBSA} ${LIBZ}
d45 3
a47 1
.PATH:	${S}/stand/boot
d49 1
a49 1
${PROG}.bin: ${PROG}
a51 4
${PROG}: $(OBJS) $(DPADD)
	$(LD) $(LDFLAGS) -o ${PROG} $(OBJS) $(LDADD)
	@@$(SIZE) ${PROG}

d53 1
a53 1
NOPROG=
a56 6

CPPFLAGS+=-DBOOTMAGIC=$(BOOTMAGIC) ${DEBUGFLAGS}
CPPFLAGS+=-DLINKADDR=${LINKADDR} -DSA_LOADADDR=${LOADADDR}
CFLAGS+=$(SACFLAGS)
#AFLAGS+=-Wa,-R
# AFLAGS+=-Wa,-a
@


1.8
log
@I've come so far that it at least boots /boot (in bochs)
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.7 2003/10/31 15:19:32 tg Exp $
d7 1
a7 1
MLINKS=	boot.8 boot.conf.8 \
@


1.7
log
@* RCS ID
* make compile (a handfull of typos)
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.6 2003/10/31 15:12:37 tg Exp $
d48 1
a48 1
CPPFLAGS+=-DLINKADDR=${LINKADDR}
@


1.6
log
@still not even started to finish, but a shot nearer at reality
* install cdboot.bin (raw) not cdboot (ELF)
* load it to LINKADDR because we don't jump into the ELF header
* start writing an srt0.S, "stealing" the API from Mickey and
  the "enter the protected mode" syntax from Linus Torvalds
  (OF COURSE IT'S .intel_syntax noprefix - WHAT DID YOU EXPECT?)
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.5 2003/10/30 13:19:28 tg Exp $
d34 1
a34 1
${PROF}.bin: ${PROG}
@


1.5
log
@install a cdboot(8) manual page
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.4 2003/10/30 13:18:43 tg Exp $
d34 2
a35 2
boot.bin: boot
	objcopy -v -O binary ${PROG} boot.bin
@


1.4
log
@* add (experimental, untested) cdboot programme
* fix swapped thinko, which led to mbr being installed as
  ELF binary, and pbr installed RAW (must be the reverse)
* move version number declare to stand/Makefile.inc
  and bump to 2.30
* mention CDBOOT in boot(8)
* whitespace, etc. cleanup while here
@
text
@d1 1
a1 1
#	$MirBSD$
d7 2
a8 1
MLINKS=	boot.8 boot.conf.8
@


1.3
log
@now, if _that_ doesn't render a usable boot loader, it's FUBAR
@
text
@d1 1
d10 1
a10 1
PROG=	boot
@


1.2
log
@Merge MirBSD-old entirely
Remove krb, yp, afs, GPL'd stuff in kernel
Adjust some other stuff

Not to be compiled yet...
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.29 2000/10/19 17:14:01 fgsch Exp $
d23 1
a23 1
SRCS+=	boot_loadfile.c cmd.c vars.c bootarg.c conf.c
a49 1

@


1.1
log
@Initial revision
@
text
@d18 1
a18 1
LDFLAGS+=-Ttext $(LINKADDR) -z -x
d23 1
a23 1
SRCS+=	boot.c cmd.c vars.c bootarg.c conf.c
d32 3
d36 2
a37 2
	$(LD) $(LDFLAGS) -o $(PROG) $(OBJS) $(LDADD)
	@@$(SIZE) $(PROG)
d46 1
@


1.1.1.1
log
@Import OpenBSD 3.3 source repository from CTM 3132 the first time
This opens an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright © 1968-2003  The authors of And contributors to UNIX®, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@


1.1.1.2
log
@Import some parts of OpenBSD-current (after their ELF switch) to ease future merging and reduce diffs against their codebase
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.31 2003/04/17 12:06:05 mickey Exp $
d18 1
a18 1
LDFLAGS+=-Ttext $(LINKADDR) -N -x -noinhibit-exec
a31 3
boot.bin: boot
	objcopy -v -O binary ${PROG} boot.bin

d33 2
a34 2
	$(LD) $(LDFLAGS) -o ${PROG} $(OBJS) $(LDADD)
	@@$(SIZE) ${PROG}
a42 1
CPPFLAGS+=-DLINKADDR=${LINKADDR}
@

