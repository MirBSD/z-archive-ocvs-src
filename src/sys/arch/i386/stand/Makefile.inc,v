head	1.34;
access;
symbols
	tg-mergetmp-mirosx-1:1.34
	tg-mergefixes-1-branch:1.34.0.4
	tg-mergefixes-1-base:1.34
	MIROS_X:1.34.0.2
	MIROS_X_BASE:1.34
	tg-mergetmp-3:1.34
	MIRBSD_XP_MIRPPC:1.32.0.4
	MIRBSD_XP_SPARC_BASE:1.32
	MIRBSD_XP_SPARC:1.32.0.2
	MIRBSD_7quater:1.6
	cvs-200405160640:1.1.1.5
	cvs-200401271800:1.1.1.5
	cvs-200401261630:1.1.1.5
	cvs-200401021645:1.1.1.5
	MIRBSD_7_ALPHA:1.6.0.6
	MIRBSD_7:1.6.0.4
	cvs-200312222040:1.1.1.5
	cvs-200312171912:1.1.1.5
	MIRBSD_7ter:1.6
	MIRBSD_7_DEV:1.6.0.2
	cvs-200310020700:1.1.1.5
	cvs-200309271030:1.1.1.5
	cvs-200309261655:1.1.1.5
	cvs-200309251530:1.1.1.5
	cvs-200309192030:1.1.1.5
	cvs-200309181930:1.1.1.5
	cvs-200309131952:1.1.1.5
	cvs-200308302005:1.1.1.5
	cvs-200308221505:1.1.1.5
	cvs-200308171200:1.1.1.5
	ctm-3496:1.1.1.5
	ctm-3449:1.1.1.4
	ctm-3437:1.1.1.4
	cvs-200307191805:1.1.1.4
	ctm-3425:1.1.1.3
	cvs-200307091500:1.1.1.3
	cvs-200307072125:1.1.1.3
	ctm-3389:1.1.1.3
	cvs-200307021520:1.1.1.2
	cvs-200306291430:1.1.1.2
	ctm-3341:1.1.1.2
	MIRBSD_5:1.3
	cvs-200306082100:1.1.1.2
	ctm-3316:1.1.1.2
	ctm-3272:1.1.1.2
	ctm-3264:1.1.1.2
	cvs-200305071630:1.1.1.2
	ctm-3255:1.1.1.2
	ctm-3229:1.1.1.2
	MIRBSD_4:1.2
	ctm-3203:1.1.1.1
	cvs-20030410-1130:1.1.1.1
	ctm-3155:1.1.1.1
	ctm-3132:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.34
date	2004.11.16.16.50.11;	author tg;	state Exp;
branches;
next	1.33;

1.33
date	2004.11.13.23.34.22;	author tg;	state Exp;
branches;
next	1.32;

1.32
date	2004.08.02.17.56.40;	author tg;	state Stab;
branches;
next	1.31;

1.31
date	2004.07.15.14.34.19;	author tg;	state Exp;
branches;
next	1.30;

1.30
date	2004.07.06.21.08.12;	author tg;	state Exp;
branches;
next	1.29;

1.29
date	2004.05.10.17.42.46;	author tg;	state Exp;
branches;
next	1.28;

1.28
date	2004.05.08.07.21.58;	author tg;	state Exp;
branches;
next	1.27;

1.27
date	2004.05.02.13.48.23;	author tg;	state Exp;
branches;
next	1.26;

1.26
date	2004.04.29.19.52.07;	author tg;	state Exp;
branches;
next	1.25;

1.25
date	2004.04.29.18.36.02;	author tg;	state Exp;
branches;
next	1.24;

1.24
date	2004.03.10.17.38.43;	author tg;	state Exp;
branches;
next	1.23;

1.23
date	2004.01.02.23.58.53;	author tg;	state Exp;
branches;
next	1.22;

1.22
date	2003.12.25.20.27.53;	author tg;	state Exp;
branches;
next	1.21;

1.21
date	2003.12.21.22.07.51;	author tg;	state Exp;
branches;
next	1.20;

1.20
date	2003.12.19.20.58.28;	author tg;	state Exp;
branches;
next	1.19;

1.19
date	2003.12.19.18.52.41;	author tg;	state Exp;
branches;
next	1.18;

1.18
date	2003.12.19.18.31.35;	author tg;	state Exp;
branches;
next	1.17;

1.17
date	2003.12.18.22.26.14;	author tg;	state Exp;
branches;
next	1.16;

1.16
date	2003.12.11.22.07.57;	author tg;	state Exp;
branches;
next	1.15;

1.15
date	2003.12.01.18.49.37;	author tg;	state Exp;
branches;
next	1.14;

1.14
date	2003.11.30.02.26.26;	author tg;	state Exp;
branches;
next	1.13;

1.13
date	2003.11.28.22.27.06;	author tg;	state Exp;
branches;
next	1.12;

1.12
date	2003.11.25.17.53.59;	author tg;	state Exp;
branches;
next	1.11;

1.11
date	2003.11.17.13.57.55;	author tg;	state Exp;
branches;
next	1.10;

1.10
date	2003.11.17.12.49.17;	author tg;	state Exp;
branches;
next	1.9;

1.9
date	2003.11.14.23.37.24;	author tg;	state Exp;
branches;
next	1.8;

1.8
date	2003.11.14.22.23.33;	author tg;	state Exp;
branches;
next	1.7;

1.7
date	2003.10.30.13.18.43;	author tg;	state Exp;
branches;
next	1.6;

1.6
date	2003.08.16.15.25.39;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2003.07.19.20.24.01;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2003.07.06.20.22.27;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2003.04.24.11.05.26;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2003.03.23.21.52.17;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.22.17.49.37;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.03.22.17.49.37;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.04.24.09.05.37;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2003.07.06.15.42.32;	author tg;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2003.07.19.18.50.46;	author tg;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2003.08.11.18.34.19;	author tg;	state Exp;
branches;
next	1.1.1.6;

1.1.1.6
date	2004.11.13.23.11.56;	author tg;	state Exp;
branches;
next	;


desc
@@


1.34
log
@entire base (without gnu/) -Werror
XXX macppc not done
@
text
@# $MirBSD: src/sys/arch/i386/stand/Makefile.inc,v 1.33 2004/11/13 23:34:22 tg Exp $
# $OpenBSD: Makefile.inc,v 1.35 2004/07/13 21:03:38 marc Exp $

.ifndef	SYS_ARCH_I386_STAND_MAKEFILE_INC

V!=		print '\#include <sys/param.h>\nMirBSD' | gcc -E - \
		    | tail -1 | sed s,0x,,
_V=		\"${V}\"

.include <bsd.own.mk>

CFLAGS+=	-fno-stack-protector -ffreestanding -femit-memmove \
		-Os -Wall -Werror ${DEBUG}
CPPFLAGS+=	-I${S} -I${SADIR}/libsa -I. \
		-I${.CURDIR} -D__BOOT_VER="${_V}" -Derrno=errno
SACFLAGS=	-D_STANDALONE
DEBUGLIBS=	no
DEBUGFLAGS=
# DEBUGFLAGS+=-DDEBUG
# DEBUGFLAGS+=-DGIDT_DEBUG
# DEBUGFLAGS+=-DBIOS_DEBUG
# DEBUGFLAGS+=-DEXEC_DEBUG
# DEBUGFLAGS+=-DALLOC_TRACE
# DEBUGFLAGS+=-g -D_TEST
# DEBUGFLAGS+=-DUNIX_DEBUG
# DEBUGFLAGS+=-DBOOTP_DEBUG -DNETIF_DEBUG -DETHER_DEBUG
# DEBUGFLAGS+=-DNFS_DEBUG -DRPC_DEBUG -DRARP_DEBUG
LINKADDR=	0x40120
LOADADDR=	0x40000
HEAP_LIMIT=	0x90000
BOOTREL=	0x60000
LINKSEG=	${LINKADDR:S/0$//}
LOADSEG=	${LOADADDR:S/0$//}
CPPFLAGS+=	-DSA_LINKSEG=${LINKSEG} -DSA_LOADSEG=${LOADSEG}
CPPFLAGS+=	-DSA_LINKADDR=${LINKADDR} -DSA_LOADADDR=${LOADADDR}

CLEANFILES+=	machine

.if empty(DEBUGFLAGS:M-D_TEST)
SACFLAGS+=	-nostdinc -fno-builtin -fpack-struct
SACFLAGS+=	-fbuiltin-memcmp -fbuiltin-memset
.endif

.if !make(libdep) && !make(sadep) && !make(salibdir) && !make(kernlibdir) && !make(obj)
.BEGIN:
	@@([ X$(S) == X -o -h machine ] || ln -s $(S)/arch/i386/include machine)
.endif


.if exists(${SADIR}/etc/assym.h)
CPPFLAGS+=	-I${SADIR}/etc
.else
CPPFLAGS+=	-I${SADIR}/etc/${__objdir}
.endif
.if exists(${SADIR}/libsa/libsa.a)
LIBSA=		${SADIR}/libsa/libsa.a
.else
LIBSA=		${SADIR}/libsa/${__objdir}/libsa.a
.endif
.if exists(${SADIR}/libz/libz.a)
LIBZ=		${SADIR}/libz/libz.a
.else
LIBZ=		${SADIR}/libz/${__objdir}/libz.a
.endif

# NO_NET=no_net
BINDIR=		/usr/mdec

SYS_ARCH_I386_STAND_MAKEFILE_INC=done
.endif
@


1.33
log
@merge errno changes
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/stand/Makefile.inc,v 1.32 2004/08/02 17:56:40 tg Stab $
d12 2
a13 2
COPTS+=		-Os -Wall -Werror -fno-stack-protector -femit-memmove
CFLAGS=		${DEBUG} -ffreestanding
d28 4
a31 4
LINKADDR=0x40120
LOADADDR=0x40000
HEAP_LIMIT=0x90000
BOOTREL=0x60000
@


1.32
log
@I'm sick that every piece of code has got to have its own version
number - just use the MirOS patchlevel for the bootloader.

Also, rename /usr/mdec/pbr_ffs to ffspbr for a better tabcomplete,
now that we've got the pxeboot
@
text
@d1 2
a2 2
# $MirBSD: src/sys/arch/i386/stand/Makefile.inc,v 1.31 2004/07/15 14:34:19 tg Exp $
# $OpenBSD: Makefile.inc,v 1.34 2003/08/08 07:37:15 deraadt Exp $
d15 1
a15 1
		-I${.CURDIR} -D__BOOT_VER="${_V}"
@


1.31
log
@kill all remaining uses of MANSUBDIR and simplify <bsd.man.mk> _a lot_
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/stand/Makefile.inc,v 1.30 2004/07/06 21:08:12 tg Exp $
d6 3
a8 1
_V=\"2.70\"
@


1.30
log
@* enable pxeboot to build
* fix pxeboot
* add pxeboot to list of being built (ya, why not)
* fix CFLAGS/COPTS/makefile inclusion confusion
  which led gcc3 to ignore the -Os; that change in
  turn throws pxeboot from 59k to 52k which makes
  it actually work
* add -PXE postfix to version number

tested on soekris.66h.42h.de-to-be
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/stand/Makefile.inc,v 1.29 2004/05/10 17:42:46 tg Exp $
a65 1
MANSUBDIR=	i386
@


1.29
log
@man, what must I have been smoking (well, passively - I've got to ask
what the others in the Netzladen[.org] have been smoking) when I coded
this bootsector... no wonder it had weird issues in bochs.

Fixed in v2.70:
* don't overwrite second sector loaded with magic bytes
* if LBA fails, don't repeat forever until after Armaggedon,
  instead try CHS loads immediately (well, after <n> retries)

Added in v2.70:
* for fdisk(8), there is an additional field in the PBR API,
  which allows to set a different timeout than 10 seconds,
  but only during an (u)pdate, as the machine code is modified
  no code in fdisk for that yet, sorry
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/stand/Makefile.inc,v 1.28 2004/05/08 07:21:58 tg Exp $
d4 2
d8 4
a11 2
CFLAGS=		${DEBUG} ${COPTS} -Os -Wall -Werror
CFLAGS+=	-fno-stack-protector -ffreestanding -femit-memmove
d67 3
@


1.28
log
@of course, the legacy bootloader should have its version number
increased with the MBR, too

now I think all issues found after starting to merge OpenBSD have
been fixed, so we can start the real thing soon.
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/stand/Makefile.inc,v 1.27 2004/05/02 13:48:23 tg Exp $
d4 1
a4 1
_V=\"2.69\"
@


1.27
log
@use -femit-memmove
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/stand/Makefile.inc,v 1.26 2004/04/29 19:52:07 tg Exp $
d4 1
a4 1
_V=\"2.68\"
@


1.26
log
@sync
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/stand/Makefile.inc,v 1.25 2004/04/29 18:36:02 tg Exp $
d7 1
a7 1
CFLAGS+=	-fno-stack-protector -ffreestanding
@


1.25
log
@fixes related to preprocessing and memcpy...
@
text
@d1 1
a1 1
# $MirBSD: src/sys/arch/i386/stand/Makefile.inc,v 1.24 2004/03/10 17:38:43 tg Exp $
d4 1
a4 1
_V=\"2.67\"
@


1.24
log
@* fix the build system
* fix and enable the GNU Pascal RTS and Utils
  -> gpc is now fully supported; Hello World works.
* merge OpenBSD-OpenSSH 3.8, bump patchlevel
* add fchroot(2) diff, From: Pedro Martelletto <pbastos@@rdc.puc-rio.br>
* add fchroot(2) man page from NetBSD and myself
* fix orders of manpage sections
* fix displaying of .Nx mdoc macro
* convert scripts requiring bash to ksh
* nuke a shutload of GNU make idiotisms
* add pregenerated manpages - help2man is just bloat
* increase shlib versions after fchroot addition
* adjust and unbreak mk.conf after recent changes
* fix boot system version number after CD boot changes
* understand why Makefile.bsd-wrapper is needed as filename. Finally.
* regenerate files after syscalls.master change
* fix RCS Id detection and generation while here
* remove unused archs while there
* use __RCSID() macro in ssh ifdef __MirBSD__
* build ssh with -Werror, too

Note: this is a pre-snapshot, pre-build commit. Nothing
of this has actually been tested.

Like I said, please wait for the snapshot. Though, the
snapshot doesn't have any more circumstances preventing
me from working towards a release and upload now.
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.23 2004/01/02 23:58:53 tg Exp $
d34 2
a35 2
SACFLAGS+=-nostdinc -fno-builtin -fpack-struct
SACFLAGS+=-fbuiltin-memcmp -fbuiltin-memset
d45 1
a45 1
CPPFLAGS+=-I${SADIR}/etc
d47 1
a47 1
CPPFLAGS+=-I${SADIR}/etc/${__objdir}
d50 1
a50 1
LIBSA=${SADIR}/libsa/libsa.a
d52 1
a52 1
LIBSA=${SADIR}/libsa/${__objdir}/libsa.a
d55 1
a55 1
LIBZ=${SADIR}/libz/libz.a
d57 1
a57 1
LIBZ=${SADIR}/libz/${__objdir}/libz.a
d61 2
a62 3
BINDIR=	/usr/mdec

MANSUBDIR=i386
@


1.23
log
@describe partition-lookup changes and bump version number
XXX testing must be done; after testing, this version will go in effect
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.22 2003/12/25 20:27:53 tg Exp $
d4 1
a4 1
_V=\"2.66\"
d6 1
a6 1
CFLAGS=${DEBUG} ${COPTS} -Os -Wall -Werror
d8 4
a11 3
CPPFLAGS+=-I${S} -I${SADIR}/libsa -I. -I${.CURDIR} -D__BOOT_VER="${_V}"
SACFLAGS=-D_STANDALONE
DEBUGLIBS=no
@


1.22
log
@merge another bit of the OpenBSD import from $some days ago
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.21 2003/12/21 22:07:51 tg Exp $
d4 1
a4 1
_V=\"2.65\"
@


1.21
log
@ > > >                #######   ###    #####  #     # #######   ###
 > > >                #          #    #     # #     #    #      ###
 > > >                #          #    #       #     #    #      ###
 > > >                #####      #    #  #### #######    #       #
 > > >                #          #    #     # #     #    #
 > > >                #          #    #     # #     #    #      ###
 > > >                #         ###    #####  #     #    #      ###


                        \   /   ,---.
     mirabile            \ /    `--_          broken BIOS
                          V     -__-'  o


               #####   #####  ####### ######  #######    #
              #     # #     # #     # #     # #         ###
              #       #       #     # #     # #          #
               #####  #       #     # ######  #####
                    # #       #     # #   #   #          #
              #     # #     # #     # #    #  #         ###
               #####   #####  ####### #     # #######    #


       *****                                     *****
      *     *                                   *     *
            *                                         *
       *****                                     *****
            *                                   *
      *     *                                   *
       *****                                    *******


    %    %     %    %%%%%     %%    %%%%%      %    %       %%%%%%
    %%  %%     %    %    %   %  %   %    %     %    %       %
    % %% %     %    %    %  %    %  %%%%%      %    %       %%%%%
    %    %     %    %%%%%   %%%%%%  %    %     %    %       %
    %    %     %    %   %   %    %  %    %     %    %       %
    %    %     %    %    %  %    %  %%%%%      %    %%%%%%  %%%%%%


    %   %           %    %     %    %    %   %%%%           %   %
     % %            %    %     %    %%   %  %                % %
   %%%%%%%          %    %     %    % %  %   %%%%          %%%%%%%
     % %            % %% %     %    %  % %       %           % %
    %   %           %%  %%     %    %   %%  %    %          %   %
                    %    %     %    %    %   %%%%



The new bootloader code works on CD-R, hard disc and MS-DOS in real broken
hardware, as well as on CD ISO in bochs.
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.20 2003/12/19 20:58:28 tg Exp $
d4 1
a4 1
_V=\"2.64\"
@


1.20
log
@kludge around more, making use of an option of mkisofs to
write the information table into the boot image itself;
idea seen at various other ISO boot places.

Now it comes until the switch into protected mode on my
machine. This is where I'll stop for now.
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.19 2003/12/19 18:52:41 tg Exp $
d4 1
a4 1
_V=\"2.62\"
@


1.19
log
@With a few simple thinko fixes, this does work indeed.
Tested:
 * bochs, floppy
 * bochs, CD-ROM
To be tested:
 * bochs, HDD
 * hardware, CD-ROM
 * bochs, MS-DOS
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.18 2003/12/19 18:31:35 tg Exp $
d4 1
a4 1
_V=\"2.60\"
@


1.18
log
@new, self-relocatable, self-loading init code for /boot
works on floppy in bochs (tested)
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.17 2003/12/18 22:26:14 tg Exp $
d4 1
a4 1
_V=\"2.59a\"
@


1.17
log
@first attempt at breaking the boot loader code :-)
Unluckily I can't fix it right now, so don't update
and wait for a great rewrite of some code :)
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.16 2003/12/11 22:07:57 tg Exp $
d4 1
a4 1
_V=\"2.59\"
@


1.16
log
@bump version; make tori routines use a 2048 instead of a 4096
byte buffer for their I/O transactions and revamp the load code
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.15 2003/12/01 18:49:37 tg Exp $
d4 1
a4 1
_V=\"2.55\"
@


1.15
log
@The boot loader seems to have been broken since the MirOS #7 releases.
Apologies to Jannis Konrad for blaming on his (nevertheless
totally broken) hardware. Thanks to Bill Gates and his company
for writing DEBUG.COM which allowed me to get into my system
again, since it apparently can't boot our /boot from CD-ROM
(this is still not fixed, but it's fine in bochs, and my box
 doesn't even get as far as the Lsrt0 message,
	MirOS boot(8) 2.54 srt0 initializing
 when booting from CD, so it must be broke too).

While here, rewrite several chunks of the code, and extend the
size of the argv[] array for boot commands to make echo work.

Tested:
 bochs CD passed
 mybox CD failed
 mybox HD passed
 mybox MS-DOS passed
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.14 2003/11/30 02:26:26 tg Exp $
d4 1
a4 1
_V=\"2.54\"
@


1.14
log
@remove ${CKERNFLAGS}, because pgcc supports -ffreestanding as well
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.13 2003/11/28 22:27:06 tg Exp $
d4 1
a4 1
_V=\"2.53\"
@


1.13
log
@build the system through, fix remaining issues
sync distrib set lists
take back inlining memmove() because the boot loader must be <57000 bytes
(the exact number is unknown) for cdboot to function
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.12 2003/11/25 17:53:59 tg Exp $
d7 1
a7 1
CFLAGS+=	-fno-stack-protector ${CKERNFLAGS}
@


1.12
log
@woohoo, mirabile learns gcc inline assembly :-)
well, sort of. it sucks, but there isn't a way around it.
as bonus, /usr/mdec/boot grows a Kibibyte or so larger, but
should be faster (as if that mattered...)

bump version, clean up code (including indenting), sync fdisk
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.11 2003/11/17 13:57:55 tg Exp $
d4 1
a4 1
_V=\"2.52\"
@


1.11
log
@pbr_ffs 2.51 is NOT compatible with boot <2.51 any more
this is by design
the new one checks the ELF and jump 0x120 magic, and
saves a few :) bytes
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.10 2003/11/17 12:49:17 tg Exp $
d4 1
a4 1
_V=\"2.51\"
@


1.10
log
@let's just remove bzero, bcmp, bcopy and look what happens.
	bcmp	-> memcmp
	bcopy	-> memmove
	bzero	-> memset
	memcpy	-> memmove *)

*) it happens that old memcpy was implemented
   as per semantics of memmove, thats why I changed
@
text
@d1 2
a2 2
#	$MirBSD: Makefile.inc,v 1.9 2003/11/14 23:37:24 tg Exp $
#	$OpenBSD: Makefile.inc,v 1.34 2003/08/08 07:37:15 deraadt Exp $
d25 5
a29 2
BOOTMAGIC=0xc001d00d
#ROM_SIZE=32768
@


1.9
log
@yay. I am your god. (Or root. What is difference?)

Tested:
 * boot cd0, kernel cd0:gzip'd
 * boot cd0, kernel cd0:stripped
 * boot cd0, kernel cd0:stripped and gzip'd
 * boot cd0, kernel fd1:floppyM34.fs
 * boot fd0, kernel fd1:floppyM34.fs
 * boot hd0, kernel fd1:floppyM34.fs
 * boot cd0, kernel hd0:floppyM34.fs
 * boot hd0, kernel hd0:floppyM34.fs

All tests have been passed in bochs, except the one below.
No tests at all have been performed on real hardware.

Tested and failed:
 * boot cd0, kernel cd0:plain bsd.rd

NM: fixed some minor bits in files touched, too
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.inc,v 1.8 2003/11/14 22:23:33 tg Exp $
d4 1
a4 1
_V=\"2.50\"
d31 1
@


1.8
log
@bump version number and shrink displaying layout a bit
we're almost there: it can boot a kernel from CD and floppy,
although it only succeeded for bsd.gz (ramdiskM) and bsd.rd.gz (ramdisk_cd)
plus, it only handles 8.3 filenames

while here: don't come back into timeout mode if cmd boot fails

status:
 * boots fd1a:/bsd if loaded from fd0
 * boots fd1a:/bsd if loaded from cd0
 * boots cd0a:/bsd.gz if loaded from cd0
 * boots cd0a:/bsd.str if loaded from cd0 (XXX bsd.strip)
 * boots cd0a:/bsdrd.gz if loaded from cd0
 * loads cd0a:/bsd.rd if loaded from cd0; segfault in rdsize()
   before root is mounted [wtf? XXX]
 * you still need to burn boot.bin
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.inc,v 1.7 2003/10/30 13:18:43 tg Exp $
d4 1
a4 1
_V=\"2.40\"
@


1.7
log
@* add (experimental, untested) cdboot programme
* fix swapped thinko, which led to mbr being installed as
  ELF binary, and pbr installed RAW (must be the reverse)
* move version number declare to stand/Makefile.inc
  and bump to 2.30
* mention CDBOOT in boot(8)
* whitespace, etc. cleanup while here
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.inc,v 1.6 2003/08/16 15:25:39 tg Exp $
d4 1
a4 1
_V=\"2.30\"
@


1.6
log
@Merge OpenBSD
@
text
@d1 1
a1 1
#	$MirBSD$
d4 2
d8 1
a8 1
CPPFLAGS+=-I${S} -I${SADIR}/libsa -I. -I${.CURDIR}
@


1.5
log
@merge OpenBSD tree; bump MirBSD minor
@
text
@d1 2
a2 1
#	$OpenBSD: Makefile.inc,v 1.33 2003/07/19 00:03:52 david Exp $
d4 1
a4 1
CFLAGS=${DEBUG} -Os -Wall -Werror
@


1.4
log
@mop up
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.32 2003/07/05 17:02:55 deraadt Exp $
d55 1
a55 1
MANSUBDIR=/i386
@


1.3
log
@fix cvs import mess, merge OpenBSD-current
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.31 2003/04/17 03:43:13 drahn Exp $
d32 1
a32 1
	@@([ -h machine ] || ln -s $(S)/arch/i386/include machine)
@


1.2
log
@Merge MirBSD-old entirely
Remove krb, yp, afs, GPL'd stuff in kernel
Adjust some other stuff

Not to be compiled yet...
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.30 2002/12/02 09:00:23 miod Exp $
@


1.1
log
@Initial revision
@
text
@d4 1
a4 1
CFLAGS+=	-fno-stack-protector
d18 1
a18 1
LINKADDR=0x40000
@


1.1.1.1
log
@Import OpenBSD 3.3 source repository from CTM 3132 the first time
This opens an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright © 1968-2003  The authors of And contributors to UNIX®, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@


1.1.1.2
log
@Import some parts of OpenBSD-current (after their ELF switch) to ease future merging and reduce diffs against their codebase
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.31 2003/04/17 03:43:13 drahn Exp $
d18 1
a18 1
LINKADDR=0x40120
@


1.1.1.3
log
@Import OpenBSD base system minus kerberos from CTM,
kernel source from CVS right now (no diffs though)
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.32 2003/07/05 17:02:55 deraadt Exp $
d32 1
a32 1
	@@([ X$(S) == X -o -h machine ] || ln -s $(S)/arch/i386/include machine)
@


1.1.1.4
log
@Another sync to OpenBSD
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.33 2003/07/19 00:03:52 david Exp $
d55 1
a55 1
MANSUBDIR=i386
@


1.1.1.5
log
@Import the complete OpenBSD source tree (base system)
as of CTM delta 3496 (roughly 1200 UTC today) into the
vendor branch.
Attention: this is a big update. Don't even try to
build this system, OpenBSD 3.4-beta, yet on your own.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.34 2003/08/08 07:37:15 deraadt Exp $
d3 1
a3 1
CFLAGS=${DEBUG} ${COPTS} -Os -Wall -Werror
@


1.1.1.6
log
@	marc@@cvs.openbsd.org    2004/07/13 15:03:39
errno changes, lib major version bumps, and general flag day
To build you must:
cd /usr/src && make obj && make includes
cd lib/libc && make depend && make && NOMAN=1 sudo make install
cd /usr/src && make build
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.35 2004/07/13 21:03:38 marc Exp $
d5 1
a5 1
CPPFLAGS+=-I${S} -I${SADIR}/libsa -I. -I${.CURDIR} -Derrno=errno
@


