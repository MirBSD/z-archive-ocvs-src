head	1.33;
access;
symbols
	tg-mergetmp-mirosx-1:1.33
	tg-mergefixes-1-branch:1.33.0.4
	tg-mergefixes-1-base:1.33
	MIROS_X:1.33.0.2
	MIROS_X_BASE:1.33
	tg-mergetmp-3:1.33
	MIRBSD_XP_MIRPPC:1.29.0.4
	MIRBSD_XP_SPARC_BASE:1.29
	MIRBSD_XP_SPARC:1.29.0.2
	MIRBSD_7quater:1.14
	cvs-200405160640:1.1.1.5
	cvs-200401271800:1.1.1.4
	cvs-200401261630:1.1.1.3
	cvs-200401021645:1.1.1.3
	MIRBSD_7_ALPHA:1.14.0.6
	MIRBSD_7:1.14.0.4
	cvs-200312222040:1.1.1.3
	MIRBSD_7ter:1.14
	MIRBSD_7_DEV:1.14.0.2
	cvs-200310020700:1.1.1.3
	cvs-200309271030:1.1.1.3
	cvs-200309251530:1.1.1.3
	cvs-200308302005:1.1.1.3
	cvs-200308171200:1.1.1.3
	ctm-3496:1.1.1.3
	ctm-3449:1.1.1.2
	ctm-3437:1.1.1.2
	cvs-200307191805:1.1.1.2
	ctm-3425:1.1.1.2
	cvs-200307091500:1.1.1.2
	cvs-200307072125:1.1.1.2
	ctm-3389:1.1.1.2
	cvs-200307030815:1.1.1.2
	cvs-200307021520:1.1.1.2
	cvs-200306291430:1.1.1.2
	ctm-3341:1.1.1.2
	MIRBSD_5:1.10
	cvs-200306082100:1.1.1.2
	ctm-3316:1.1.1.2
	ctm-3272:1.1.1.2
	ctm-3264:1.1.1.2
	cvs-200305071630:1.1.1.2
	MIRBSD_4:1.6
	ctm-3203:1.1.1.1
	cvs-20030410-1130:1.1.1.1
	ctm-3155:1.1.1.1
	ctm-3132:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.33
date	2004.12.10.21.35.41;	author tg;	state Exp;
branches;
next	1.32;

1.32
date	2004.11.05.23.05.12;	author tg;	state Exp;
branches;
next	1.31;

1.31
date	2004.11.05.23.01.31;	author tg;	state Exp;
branches;
next	1.30;

1.30
date	2004.10.21.16.06.25;	author tg;	state Exp;
branches;
next	1.29;

1.29
date	2004.09.17.20.16.35;	author tg;	state Exp;
branches;
next	1.28;

1.28
date	2004.09.15.19.44.14;	author tg;	state Exp;
branches;
next	1.27;

1.27
date	2004.08.14.05.08.28;	author tg;	state Stab;
branches;
next	1.26;

1.26
date	2004.08.13.16.12.10;	author tg;	state Exp;
branches;
next	1.25;

1.25
date	2004.08.13.04.36.10;	author tg;	state Exp;
branches;
next	1.24;

1.24
date	2004.07.14.11.21.21;	author tg;	state Exp;
branches;
next	1.23;

1.23
date	2004.06.17.22.05.33;	author tg;	state Exp;
branches;
next	1.22;

1.22
date	2004.05.21.21.10.44;	author tg;	state Exp;
branches;
next	1.21;

1.21
date	2004.05.10.15.37.57;	author tg;	state Exp;
branches;
next	1.20;

1.20
date	2004.05.10.15.26.36;	author tg;	state Exp;
branches;
next	1.19;

1.19
date	2004.01.27.21.15.17;	author tg;	state Exp;
branches;
next	1.18;

1.18
date	2004.01.03.15.11.23;	author tg;	state Exp;
branches;
next	1.17;

1.17
date	2003.12.27.19.53.39;	author tg;	state Exp;
branches;
next	1.16;

1.16
date	2003.12.11.21.43.41;	author tg;	state Exp;
branches;
next	1.15;

1.15
date	2003.11.15.00.37.41;	author tg;	state Exp;
branches;
next	1.14;

1.14
date	2003.09.02.09.06.39;	author tg;	state Exp;
branches;
next	1.13;

1.13
date	2003.09.01.21.23.37;	author tg;	state Exp;
branches;
next	1.12;

1.12
date	2003.08.16.15.19.50;	author tg;	state Exp;
branches;
next	1.11;

1.11
date	2003.07.18.19.17.54;	author tg;	state Exp;
branches;
next	1.10;

1.10
date	2003.06.12.15.46.17;	author tg;	state Exp;
branches;
next	1.9;

1.9
date	2003.06.07.10.17.21;	author tg;	state Exp;
branches;
next	1.8;

1.8
date	2003.05.25.09.44.35;	author tg;	state Exp;
branches;
next	1.7;

1.7
date	2003.05.07.20.53.05;	author tg;	state Exp;
branches;
next	1.6;

1.6
date	2003.04.12.23.47.24;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2003.04.12.23.43.40;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2003.04.12.21.43.30;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2003.04.12.20.12.56;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2003.03.23.21.47.54;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.22.17.35.08;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.03.22.17.35.08;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.05.07.17.15.39;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2003.08.11.17.46.36;	author tg;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2004.01.27.18.24.27;	author tg;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2004.05.16.07.26.05;	author tg;	state Exp;
branches;
next	;


desc
@@


1.33
log
@no need to have 10000 lists for one thing
@
text
@# $MirBSD: src/distrib/i386/common/Makefile.inc,v 1.31 2004/11/05 23:01:31 tg Exp $
# $OpenBSD: Makefile.inc,v 1.14 2004/05/05 23:40:13 deraadt Exp $

.include <bsd.own.mk>

TOP=		${.CURDIR}/..
REALOBJDIR!=	readlink ${.OBJDIR} || ( cd ${.OBJDIR} && pwd )
IMAGE=		mr.fs
CBIN?=		instbin
CRUNCHCONF?=	${CBIN}.conf
LISTS?=		${.CURDIR}/../common/list
.if exists(${.CURDIR}/list.local)
LISTS+=		${.CURDIR}/list.local
.endif
UTILS?=		${.CURDIR}/../../miniroot
STRIP?=		strip
STRIP_ADDS?=	-K cngetc

MOUNT_POINT=	${.OBJDIR}/tmpmnt
MTREE?=		${UTILS}/mtree.conf

XNAME?=		floppy
FS?=		${XNAME}${OSrev}.fs
VND?=		svnd0
VND_DEV=	/dev/${VND}a
VND_RDEV=	/dev/r${VND}a
VND_CRDEV=	/dev/r${VND}c
PID!=		echo $$$$
REALIMAGE!=	echo ${.OBJDIR}/tmp.ima
BOOT=		${DESTDIR}/usr/mdec/boot
FLOPPYSIZE?=	144
FLOPPYSECS?=	18
FLOPPYTYPE?=	floppy3
COPTS+=		-Os
CFLAGS+=	${CDIAGFLAGS} ${COPTS}

DO_FLOPPY?=	Yes
DO_BSDRD_NAME?=	bsd.rd

.if ${DO_FLOPPY:L} == "yes"
all:	${FS}
.else
all:	${DO_BSDRD_NAME}
.endif

${FS}:	bsd.gz
	dd if=/dev/zero of=${REALIMAGE} bs=10k count=${FLOPPYSIZE}
	${SUDO} vnconfig -v -c ${VND} ${REALIMAGE}
	${SUDO} disklabel -w -r ${VND} ${FLOPPYTYPE}
	${SUDO} newfs -m 0 -o space -i 1048576 -c 80 -b 4096 ${VND_RDEV}
	mkdir -p ${MOUNT_POINT}
	${SUDO} mount ${VND_DEV} ${MOUNT_POINT}
	${SUDO} cp ${BOOT} ${.OBJDIR}/boot
	${SUDO} dd if=${.OBJDIR}/boot of=${MOUNT_POINT}/boot obs=512 conv=osync
	${SUDO} dd if=bsd.gz of=${MOUNT_POINT}/bsd obs=512 conv=osync
	${SUDO} /usr/mdec/installboot -v -s ${FLOPPYSECS} -h 2 \
	    ${MOUNT_POINT}/boot ${DESTDIR}/usr/mdec/ffspbr ${VND_CRDEV}
	@@echo ""
	@@df -i ${MOUNT_POINT}
	@@echo ""
	${SUDO} umount ${MOUNT_POINT}
	${SUDO} vnconfig -u ${VND}
	cp ${REALIMAGE} ${FS}
	rm ${REALIMAGE}

DISKTYPE?=       ipldisc
NBLKS?=          8192
# minfree, opt, b/i  trks, sects, cpg
NEWFSARGS=	-m 0 -o space -c 16 -i 3072

bsd.gz: ${DO_BSDRD_NAME}
	cp ${DO_BSDRD_NAME} bsd.strip
	${STRIP} --strip-all -R .comment -R .eh_frame ${STRIP_ADDS} bsd.strip
	gzip -nc9 bsd.strip >bsd.gz

${DO_BSDRD_NAME}:	${IMAGE} bsd rdsetroot
	cp bsd ${DO_BSDRD_NAME}
	${.OBJDIR}/rdsetroot ${DO_BSDRD_NAME} <${IMAGE}

.ifndef	KERNEL_LOCAL_BUILD
bsd:
	cd ${.CURDIR}/../../../sys/arch/i386/conf && config ${RAMDISK}
	cd ${.CURDIR}/../../../sys/arch/i386/compile/${RAMDISK} && \
	    make clean && make depend && make COPTS="${COPTS}"
	cp ${.CURDIR}/../../../sys/arch/i386/compile/${RAMDISK}/bsd bsd
.endif

${IMAGE}: ${CBIN} rd_setup do_files rd_teardown

rd_setup: ${CBIN}
	dd if=/dev/zero of=${REALIMAGE} bs=512 count=${NBLKS}
	${SUDO} vnconfig -v -c ${VND} ${REALIMAGE}
	${SUDO} disklabel -w -r ${VND} ${DISKTYPE}
	${SUDO} newfs ${NEWFSARGS} ${VND_RDEV}
	${SUDO} fsck ${VND_RDEV}
	mkdir -p ${MOUNT_POINT}
	${SUDO} mount ${VND_DEV} ${MOUNT_POINT}

rd_teardown:
	@@df -i ${MOUNT_POINT}
	-${SUDO} umount ${MOUNT_POINT}
	-${SUDO} vnconfig -u ${VND}
	cp ${REALIMAGE} ${IMAGE}
	rm ${REALIMAGE}

rdsetroot:	${TOP}/../common/elfrdsetroot.c
	${HOSTCC} -DDEBUG -o rdsetroot ${TOP}/../common/elfrdsetroot.c

unconfig:
	-${SUDO} umount -f ${MOUNT_POINT}
	-${SUDO} vnconfig -u ${VND}

.PRECIOUS:	${IMAGE}

install:
.ifndef NOBSDRD
	cp ${DO_BSDRD_NAME} ${DESTDIR}/snapshot/
.endif
.if ${DO_FLOPPY:L} == "yes"
	cp ${FS} ${DESTDIR}/snapshot/${FS}
.endif

${CBIN}.mk ${CBIN}.cache ${CBIN}.c: ${CRUNCHCONF}
	crunchgen -E -D ${BSDSRCDIR} -L ${DESTDIR}/usr/lib \
	    -c ${CBIN}.c -e ${CBIN} -m ${CBIN}.mk ${CRUNCHCONF}

${CBIN}: ${CBIN}.mk ${CBIN}.cache ${CBIN}.c
	make -f ${CBIN}.mk CFLAGS="${CFLAGS}" all
	${STRIP} --strip-all -R .comment -R .eh_frame ${CBIN}

${CRUNCHCONF}: ${LISTS}
	awk -f ${UTILS}/makeconf.awk CBIN=${CBIN} ${LISTS} >${CRUNCHCONF}

do_files:
	${SUDO} mtree -def ${MTREE} -p ${MOUNT_POINT}/ -u
	TOPDIR=${TOP} CURDIR=${.CURDIR} OBJDIR=${.OBJDIR} \
	    REV=${OSrev} TARGDIR=${MOUNT_POINT} UTILS=${UTILS} \
	    ${SUDO} ${SHELL} ${UTILS}/runlist.sh ${LISTS}
	${SUDO} rm ${MOUNT_POINT}/${CBIN}

clean cleandir:
	/bin/rm -f core ${IMAGE} ${CBIN} ${CBIN}.mk ${CBIN}*.cache boot \
	    *.o *.lo *.c bsd bsd.rd bsd.gz bsd.strip floppy*.fs rdsetroot \
	    cdrom*.fs ${CRUNCHCONF} ${DO_BSDRD_NAME} ${FS} ${REALIMAGE}
	/bin/rm -rf ${MOUNT_POINT}

cleannobsd:
	/bin/rm -f core ${IMAGE} ${CBIN} ${CBIN}.mk ${CBIN}*.cache boot \
	    *.o *.lo *.c bsd.rd bsd.gz bsd.strip floppy*.fs rdsetroot \
	    cdrom*.fs ${CRUNCHCONF} ${DO_BSDRD_NAME} ${FS} ${REALIMAGE}
	/bin/rm -rf ${MOUNT_POINT}

.include <bsd.obj.mk>
.include <bsd.subdir.mk>
@


1.32
log
@only strip once
@
text
@d12 3
@


1.31
log
@miod@@openbsd says no .eh_frame for us
@
text
@d1 1
a1 1
# $MirBSD: src/distrib/i386/common/Makefile.inc,v 1.30 2004/10/21 16:06:25 tg Exp $
d126 1
a126 1
	${STRIP} -R .comment -R .eh_frame ${CBIN}
@


1.30
log
@flesh out some not-needed stuff to shrink the 1440 KiB floppy image
@
text
@d1 1
a1 1
# $MirBSD: src/distrib/i386/common/Makefile.inc,v 1.29 2004/09/17 20:16:35 tg Exp $
d13 1
d70 1
a70 1
	strip --strip-all -R .comment ${STRIP_ADDS} bsd.strip
d126 1
@


1.29
log
@like a week of hard work.
* .cvsignore: add build.log
* X: remove unused code
* distrib: shrink floppy ramdisk until it fits, factor out some
  essentials (ping, netcat, hexdump, df, mknod, update, MBRmgr)
  into just another list
* disktab, conf/FLOPPY: in-kernel floppy image shrinks by 256 KiB
* distrib/lists: sync
* gcc: Ada now always disables -fstack-protector-all (not SSP in
  general); I learned it protects by itself
* ld.so, sed: gcc -fstack-protector-all mis-compiles some files
* bsd.own.mk: libbfd and libopcodes need a minor bump
* sys.mk, param.h, gcc version.c: bump MirOS version/patchlevel

I *hope* a make b-r "could" now succeed. I've done like 50 this week.
@
text
@d1 1
a1 1
# $MirBSD: src/distrib/i386/common/Makefile.inc,v 1.28 2004/09/15 19:44:14 tg Exp $
d16 1
a16 1
MTREE=		${UTILS}/mtree.conf
@


1.28
log
@sync after make release (partial)
@
text
@d1 1
a1 1
# $MirBSD: src/distrib/i386/common/Makefile.inc,v 1.27 2004/08/14 05:08:28 tg Stab $
d46 1
a46 1
	${SUDO} newfs -m 0 -o space -i 737280 -c 80 -e 16384 ${VND_RDEV}
d62 2
a63 2
DISKTYPE?=       rdroot
NBLKS?=          3584
@


1.27
log
@* sync configure scripts
* remove GENERIC kernel
* rename RAMDISK to GENERIC
* if RAMDISK_HOOK but no initrd image has been written into array,
  proceed as if you were generic
* if no initrd image, make the array available to the user
* sync
@
text
@d1 1
a1 1
# $MirBSD: src/distrib/i386/common/Makefile.inc,v 1.26 2004/08/13 16:12:10 tg Exp $
d15 1
a15 1
MOUNT_POINT=	/mnt
d25 1
a25 1
REALIMAGE!=	echo /var/tmp/image.${PID}
d47 1
d65 1
a65 1
NEWFSARGS= -m 0 -o space -c 16 -i 3072
d92 1
d139 2
a140 1
	    cdrom*.fs ${CRUNCHCONF} ${DO_BSDRD_NAME} ${FS}
d145 2
a146 1
	    cdrom*.fs ${CRUNCHCONF} ${DO_BSDRD_NAME} ${FS}
@


1.26
log
@remove another small junk file
@
text
@d1 1
a1 1
# $MirBSD: src/distrib/i386/common/Makefile.inc,v 1.25 2004/08/13 04:36:10 tg Exp $
d7 1
d75 1
d81 1
@


1.25
log
@This is as far as I come now.
* rebuild base
* partial sync lists
* concatenate X11 lists, too
* add provision for building libgcc.so (commented out - it breaks)
@
text
@d1 1
a1 1
# $MirBSD: src/distrib/i386/common/Makefile.inc,v 1.24 2004/07/14 11:21:21 tg Exp $
d4 2
a6 2

.include "${TOP}/Makefile.inc"
d18 1
a18 1
FS?=		${XNAME}${REV}.fs
d127 1
a127 1
	    REV=${REV} TARGDIR=${MOUNT_POINT} UTILS=${UTILS} \
@


1.24
log
@put in some effort to
* fix the boot loader output
* fix ramdisk root device selection
* make release with as few sudo as possible
* fix COPTS selection for the anoncvsbin
* fix COPTS (no -g) for the kernel
  (a kernel with DEBUG=-g needs a higher ulimit -d)
* clean up in general
@
text
@d1 1
a1 1
# $MirBSD: src/distrib/i386/common/Makefile.inc,v 1.23 2004/06/17 22:05:33 tg Exp $
d51 1
a51 1
	    ${MOUNT_POINT}/boot ${DESTDIR}/usr/mdec/pbr_ffs ${VND_CRDEV}
@


1.23
log
@sync after make b-r with no X-Window or floppy built,
only bsd and bsd.rd (and the ISO)
@
text
@d1 1
a1 1
# $MirBSD: src/distrib/i386/common/Makefile.inc,v 1.22 2004/05/21 21:10:44 tg Exp $
d43 9
a51 9
	vnconfig -v -c ${VND} ${REALIMAGE}
	disklabel -w -r ${VND} ${FLOPPYTYPE}
	newfs -m 0 -o space -i 737280 -c 80 -e 16384 ${VND_RDEV}
	mount ${VND_DEV} ${MOUNT_POINT}
	cp ${BOOT} ${.OBJDIR}/boot
	dd if=${.OBJDIR}/boot of=${MOUNT_POINT}/boot obs=512 conv=osync
	dd if=bsd.gz of=${MOUNT_POINT}/bsd obs=512 conv=osync
	/usr/mdec/installboot -v -s ${FLOPPYSECS} -h 2 ${MOUNT_POINT}/boot \
	    ${DESTDIR}/usr/mdec/pbr_ffs ${VND_CRDEV}
d55 2
a56 2
	umount ${MOUNT_POINT}
	vnconfig -u ${VND}
d84 5
a88 5
	vnconfig -v -c ${VND} ${REALIMAGE}
	disklabel -w -r ${VND} ${DISKTYPE}
	newfs ${NEWFSARGS} ${VND_RDEV}
	fsck ${VND_RDEV}
	mount ${VND_DEV} ${MOUNT_POINT}
d92 2
a93 2
	-umount ${MOUNT_POINT}
	-vnconfig -u ${VND}
d101 2
a102 2
	-umount -f ${MOUNT_POINT}
	-vnconfig -u ${VND}
d116 1
a116 1
	-c ${CBIN}.c -e ${CBIN} -m ${CBIN}.mk ${CRUNCHCONF}
a119 1
	strip -R .comment ${CBIN}
d125 1
a125 1
	mtree -def ${MTREE} -p ${MOUNT_POINT}/ -u
d128 2
a129 2
	    ${SHELL} ${UTILS}/runlist.sh ${LISTS}
	rm ${MOUNT_POINT}/${CBIN}
@


1.22
log
@not-so-easy merge
note: the release process is currently marked as broken, because
the install.sub file needs some major fixes.
they are so major I'll eventually rewrite the stuff now. let's see.
@
text
@d1 1
a1 1
# $MirBSD: src/distrib/i386/common/Makefile.inc,v 1.21 2004/05/10 15:37:57 tg Exp $
d129 1
a129 1
	    sh ${UTILS}/runlist.sh ${LISTS}
@


1.21
log
@kernel wants COPTS (our ramdisk kernels want -Os anyways...)
@
text
@d1 2
a2 2
# $MirBSD: src/distrib/i386/common/Makefile.inc,v 1.20 2004/05/10 15:26:36 tg Exp $
# $OpenBSD: Makefile.inc,v 1.12 2004/01/26 23:21:49 tom Exp $
d135 1
a135 1
	    cdrom*.fs ${CRUNCHCONF} ${DO_BSDRD_NAME}
d140 1
a140 1
	    cdrom*.fs ${CRUNCHCONF} ${DO_BSDRD_NAME}
@


1.20
log
@hrmpf; actually pass -Os correctly to generation of
instbin and kernel, and don't override pre-existing
COPTS and CFLAGS... *sigh*
@
text
@d1 1
a1 1
# $MirBSD: src/distrib/i386/common/Makefile.inc,v 1.19 2004/01/27 21:15:17 tg Exp $
d77 1
a77 1
	    make clean && make depend && make
@


1.19
log
@second of many many merge steps
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.18 2004/01/03 15:11:23 tg Exp $
d29 2
d77 1
a77 1
	    make clean && make depend && COPTS=-Os make
d119 1
a119 1
	make -f ${CBIN}.mk all
@


1.18
log
@make build release through (no X yet)
@
text
@d1 2
a2 2
# $MirBSD: Makefile.inc,v 1.17 2003/12/27 19:53:39 tg Exp $
# $OpenBSD: Makefile.inc,v 1.11 2003/08/08 19:39:25 deraadt Exp $
@


1.17
log
@save what I've done so far to attempt building it through
perl was broken (i386-tirttt not i386-mirbsd? but not
everywhere???) etc. so I didn't sync the lists.
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.16 2003/12/11 21:43:41 tg Exp $
d43 1
a43 1
	newfs -m 0 -o space -i 524288 -c 80 -e 16384 ${VND_RDEV}
d59 1
a59 1
NBLKS?=          3072
d61 1
a61 1
NEWFSARGS= -m 0 -o space -c 16 -i 4096
@


1.16
log
@after some make build release, the set lists are corrected,
the kernel sizes are modified etc.
@
text
@d1 1
a1 1
# $MirBSD: Makefile.inc,v 1.15 2003/11/15 00:37:41 tg Exp $
d46 2
a47 3
	strip --strip-all -R .comment ${.OBJDIR}/boot
	dd if=${.OBJDIR}/boot of=${MOUNT_POINT}/boot bs=512
	dd if=bsd.gz of=${MOUNT_POINT}/bsd bs=512
@


1.15
log
@Nuke cdrom34.fs, we don't need it any more.
Move to cd34.iso based upon /boot and bsd.rd (gzipped).
@
text
@d1 2
a2 2
#	$MirBSD: Makefile.inc,v 1.14 2003/09/02 09:06:39 tg Exp $
#	$OpenBSD: Makefile.inc,v 1.11 2003/08/08 19:39:25 deraadt Exp $
d12 1
d43 1
a43 1
	newfs -m 0 -o space -i 524288 -c 80 ${VND_RDEV}
d60 1
a60 1
NBLKS?=          4096
d66 1
a66 1
	strip --strip-all -R .comment -K cngetc bsd.strip
@


1.14
log
@clean cdrom*.fs, too
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.inc,v 1.13 2003/09/01 21:23:37 tg Exp $
d29 4
d34 3
d63 2
a64 2
bsd.gz: bsd.rd
	cp bsd.rd bsd.strip
d68 3
a70 4
bsd.rd:	${IMAGE} bsd rdsetroot
	cp bsd bsd.rd
	${.OBJDIR}/rdsetroot bsd.rd < ${IMAGE}

d106 1
a106 1
	cp bsd.rd ${DESTDIR}/snapshot/bsd.rd
d108 1
d110 1
d121 1
a121 1
	awk -f ${UTILS}/makeconf.awk CBIN=${CBIN} ${LISTS} > ${CRUNCHCONF}
d133 1
a133 1
	    cdrom*.fs ${CRUNCHCONF}
d138 1
a138 1
	    cdrom*.fs ${CRUNCHCONF}
@


1.13
log
@clean 'boot' too
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.inc,v 1.12 2003/08/16 15:19:50 tg Exp $
d125 1
a125 1
	    ${CRUNCHCONF}
d130 1
a130 1
	    ${CRUNCHCONF}
@


1.12
log
@Merge OpenBSD
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.inc,v 1.11 2003/07/18 19:17:54 tg Exp $
d123 1
a123 1
	/bin/rm -f core ${IMAGE} ${CBIN} ${CBIN}.mk ${CBIN}*.cache \
d128 1
a128 1
	/bin/rm -f core ${IMAGE} ${CBIN} ${CBIN}.mk ${CBIN}*.cache \
@


1.11
log
@die, die, die!
@
text
@d1 2
a2 2
#	$MirBSD: Makefile.inc,v 1.10 2003/06/12 15:46:17 tg Exp $
#	$OpenBSD: Makefile.inc,v 1.10 2003/04/26 16:23:44 deraadt Exp $
d59 1
a59 1
	gzip -nc9 bsd.strip > bsd.gz
d110 1
@


1.10
log
@MFC: Backport to MirBSD#5-stable

fix cdrom33.fs and cd33.iso:
 - kernels compiled with DDB support don't boot at all
   if they're stripped.
   kludge that by not stripping one single symbol, thus
   rendering it ~200 bytes larger but bootable.
 - need a real fix: what's the problem?
 - problem: can't break into ddb since it's a problem
   within the ddb setup routine
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.inc,v 1.9 2003/06/07 10:17:21 tg Exp $
d59 1
a59 1
	gzip -c9 bsd.strip > bsd.gz
@


1.9
log
@biosboot -> pbr_ffs
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.inc,v 1.8 2003/05/25 09:44:35 tg Exp $
d38 1
a38 1
	strip -R .comment ${.OBJDIR}/boot
d58 1
a58 1
	strip -R .comment bsd.strip
@


1.8
log
@use the maximum size possible (as per disklabel)
for the real size of the ramdisk.

null bytes don't really hurt, because they're
compressed (except for more RAM, but nobody is
going to use MirBSD on a system with less than
32 Mebibytes of RAM anyways) - but you get the
plus that you can write "stuff" to the ramdisk,
and tar xp doesn't break that fast...

rdroot:  3560 (OpenBSD: 3560) -> 4096
rcdroot: 5120 (OpenBSD: 3560) -> 6144
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.inc,v 1.7 2003/05/07 20:53:05 tg Exp $
d42 1
a42 1
	    ${DESTDIR}/usr/mdec/biosboot ${VND_CRDEV}
@


1.7
log
@merge conflicts; fix what(1) stdin
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.inc,v 1.6 2003/04/12 23:47:24 tg Exp $
d52 1
a52 1
NBLKS?=          3560
@


1.6
log
@put the 'dd' back in fear the ramdiscs could not boot
@
text
@d1 2
a2 2
#	$MirBSD: Makefile.inc,v 1.5 2003/04/12 23:43:40 tg Exp $
#	$OpenBSD: Makefile.inc,v 1.8 2002/09/23 18:31:03 markus Exp $
a9 1
CRUNCHCONFS?=	${.CURDIR}/../common/crunch.conf
d61 1
a61 1
bsd.rd:	${IMAGE} bsd elfrdsetroot
d63 1
a63 1
	${.OBJDIR}/elfrdsetroot bsd.rd < ${IMAGE}
d89 2
a90 5
elfrdsetroot:	${TOP}/../common/elfrdsetroot.c
	${HOSTCC} -DDEBUG -o elfrdsetroot ${TOP}/../common/elfrdsetroot.c

rdsetroot:	${TOP}/../common/rdsetroot.c
	${HOSTCC} -DDEBUG -o rdsetroot ${TOP}/../common/rdsetroot.c
d112 1
a112 1
	awk -f ${UTILS}/makeconf.awk CBIN=${CBIN} ${LISTS} > ${CBIN}.conf
d123 1
a123 1
	    *.o *.lo *.c bsd bsd.rd bsd.gz bsd.strip floppy*.fs elfrdsetroot \
d128 1
a128 1
	    *.o *.lo *.c bsd.rd bsd.gz bsd.strip floppy*.fs elfrdsetroot \
@


1.5
log
@reorganize, so the ramdiscs will all build (verified)
@
text
@d1 1
a1 1
#	$MirBSD: Makefile.inc,v 1.4 2003/04/12 21:43:30 tg Exp $
d41 1
a41 1
	cp bsd.gz ${MOUNT_POINT}/bsd
@


1.4
log
@strip should remove gcc comments as well
@
text
@d1 1
a1 1
#	$MirBSD$
d41 1
a41 1
	dd if=bsd.gz of=${MOUNT_POINT}/bsd bs=512
d128 5
@


1.3
log
@modularize lists a bit

summary of changes:
- all:
	size 3510 -> 3560, match kernel
	rsh is still in
	pppd was added
- ramdisk_cd:
	size 3510 -> 4096, adjust kernel
	rsh is still in
	pppd is NOT in
	wi* is still in, as in ramdiskC
	ppp(8) and isdnd are in
@
text
@d1 1
d39 1
a39 1
	strip ${.OBJDIR}/boot
d59 1
a59 1
	strip bsd.strip
@


1.2
log
@Merge MirBSD-old entirely
Remove krb, yp, afs, GPL'd stuff in kernel
Adjust some other stuff

Not to be compiled yet...
@
text
@d52 1
a52 1
NBLKS?=          3510
@


1.1
log
@Initial revision
@
text
@d61 1
a61 1
bsd.rd:	${IMAGE} bsd rdsetroot
d63 1
a63 1
	${.OBJDIR}/rdsetroot bsd.rd < ${IMAGE}
d89 3
d108 1
a108 1
	crunchgen -D ${BSDSRCDIR} -L ${DESTDIR}/usr/lib \
d126 1
a126 1
	    *.o *.lo *.c bsd bsd.rd bsd.gz bsd.strip floppy*.fs rdsetroot \
@


1.1.1.1
log
@Import OpenBSD 3.3 source repository from CTM 3132 the first time
This opens an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright © 1968-2003  The authors of And contributors to UNIX®, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@


1.1.1.2
log
@Import OpenBSD source tree of short before 17:00 UTC today
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.10 2003/04/26 16:23:44 deraadt Exp $
d9 1
d89 2
a90 2
rdsetroot:	${TOP}/../common/elfrdsetroot.c
	${HOSTCC} -DDEBUG -o rdsetroot ${TOP}/../common/elfrdsetroot.c
d105 1
a105 1
	crunchgen -E -D ${BSDSRCDIR} -L ${DESTDIR}/usr/lib \
d112 1
a112 1
	awk -f ${UTILS}/makeconf.awk CBIN=${CBIN} ${LISTS} > ${CRUNCHCONF}
@


1.1.1.3
log
@Import the complete OpenBSD source tree (base system)
as of CTM delta 3496 (roughly 1200 UTC today) into the
vendor branch.
Attention: this is a big update. Don't even try to
build this system, OpenBSD 3.4-beta, yet on your own.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.11 2003/08/08 19:39:25 deraadt Exp $
a37 1
	strip -R .comment ${.OBJDIR}/boot
a57 1
	strip -R .comment bsd.strip
a108 1
	strip -R .comment ${CBIN}
@


1.1.1.4
log
@using: ========= cvsim-base-obsd _MirBSD: cvsim-src-openbsd,v 1.3 2004/01/27 17:17:54 tg Exp $ =========

In contrast to what people might believe now,
I am not "specially" attracted by CVS Imports
(neither am I a version number hunter).
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.12 2004/01/26 23:21:49 tom Exp $
d41 1
a41 1
	/usr/mdec/installboot -v ${MOUNT_POINT}/boot \
@


1.1.1.5
log
@large-scale import of OpenBSD 3.5-current source base including many fixes
note: from now, we will not be binary compatible with OpenBSD apps any
longer (due to syscall numbering differences); both an OpenBSD compat and
a conversion tool for old MirOS #7 apps will be delivered later.

The src/ tree is locked from now.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.14 2004/05/05 23:40:13 deraadt Exp $
d25 1
d125 2
a126 2
	    *.o *.lo *.c bsd bsd.rd bsd.gz bsd.strip floppy*.fs \
	    rdsetroot boot ${CRUNCHCONF} ${FS}
@


