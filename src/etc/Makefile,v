head	1.71;
access;
symbols
	tg-mergetmp-mirosx-1:1.71
	tg-mergefixes-1-branch:1.71.0.4
	tg-mergefixes-1-base:1.71
	MIROS_X:1.71.0.2
	MIROS_X_BASE:1.71
	tg-mergetmp-3:1.71
	MIRBSD_XP_MIRPPC:1.56.0.4
	MIRBSD_XP_SPARC_BASE:1.56
	MIRBSD_XP_SPARC:1.56.0.2
	MIRBSD_7quater:1.19.2.2.2.1
	cvs-200405160640:1.1.1.10
	cvs-200401271800:1.1.1.9
	cvs-200401261630:1.1.1.9
	cvs-200401021645:1.1.1.8
	MIRBSD_7_ALPHA:1.19.2.2.0.4
	MIRBSD_7:1.19.2.2.0.2
	cvs-200312222040:1.1.1.7
	cvs-200312031730:1.1.1.7
	MIRBSD_7ter:1.19.2.2
	MIRBSD_7_DEV:1.19.0.2
	cvs-200310020700:1.1.1.6
	cvs-200309271030:1.1.1.6
	cvs-200309251530:1.1.1.6
	cvs-200308302005:1.1.1.5
	cvs-200308221505:1.1.1.5
	cvs-200308171200:1.1.1.4
	ctm-3496:1.1.1.4
	ctm-3449:1.1.1.4
	ctm-3437:1.1.1.4
	cvs-200307191805:1.1.1.4
	ctm-3425:1.1.1.4
	cvs-200307091500:1.1.1.4
	cvs-200307072125:1.1.1.4
	ctm-3389:1.1.1.4
	cvs-200307021520:1.1.1.4
	cvs-200306291430:1.1.1.4
	ctm-3341:1.1.1.3
	MIRBSD_5:1.12
	cvs-200306082100:1.1.1.3
	ctm-3316:1.1.1.3
	ctm-3272:1.1.1.3
	ctm-3264:1.1.1.3
	cvs-200305071630:1.1.1.3
	MIRBSD_4:1.9
	ctm-3203:1.1.1.3
	cvs-20030410-1130:1.1.1.3
	ctm-3155:1.1.1.2
	ctm-3132:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.71
date	2004.12.14.19.07.48;	author tg;	state Exp;
branches;
next	1.70;

1.70
date	2004.12.07.21.30.17;	author tg;	state Exp;
branches;
next	1.69;

1.69
date	2004.12.07.14.45.31;	author tg;	state Exp;
branches;
next	1.68;

1.68
date	2004.11.30.17.04.14;	author tg;	state Exp;
branches;
next	1.67;

1.67
date	2004.11.28.19.28.09;	author tg;	state Exp;
branches;
next	1.66;

1.66
date	2004.11.23.14.16.37;	author tg;	state Exp;
branches;
next	1.65;

1.65
date	2004.11.15.00.18.54;	author tg;	state Exp;
branches;
next	1.64;

1.64
date	2004.11.13.21.05.34;	author tg;	state Exp;
branches;
next	1.63;

1.63
date	2004.11.13.18.51.38;	author tg;	state Exp;
branches;
next	1.62;

1.62
date	2004.11.13.02.24.37;	author tg;	state Exp;
branches;
next	1.61;

1.61
date	2004.10.24.17.08.24;	author tg;	state Exp;
branches;
next	1.60;

1.60
date	2004.10.24.15.11.17;	author tg;	state Exp;
branches;
next	1.59;

1.59
date	2004.10.21.14.22.30;	author tg;	state Exp;
branches;
next	1.58;

1.58
date	2004.10.15.16.13.14;	author tg;	state Exp;
branches;
next	1.57;

1.57
date	2004.10.14.19.50.22;	author tg;	state Exp;
branches;
next	1.56;

1.56
date	2004.09.18.13.09.08;	author tg;	state Exp;
branches
	1.56.2.1
	1.56.4.1;
next	1.55;

1.55
date	2004.09.18.13.07.29;	author tg;	state Exp;
branches;
next	1.54;

1.54
date	2004.09.15.19.44.23;	author tg;	state Exp;
branches;
next	1.53;

1.53
date	2004.09.12.15.35.36;	author tg;	state Exp;
branches;
next	1.52;

1.52
date	2004.08.27.19.22.38;	author tg;	state Exp;
branches;
next	1.51;

1.51
date	2004.08.13.21.12.24;	author tg;	state Stab;
branches;
next	1.50;

1.50
date	2004.08.13.16.52.02;	author tg;	state Exp;
branches;
next	1.49;

1.49
date	2004.08.13.15.46.30;	author tg;	state Exp;
branches;
next	1.48;

1.48
date	2004.08.13.15.36.28;	author tg;	state Exp;
branches;
next	1.47;

1.47
date	2004.07.18.13.26.17;	author tg;	state Exp;
branches;
next	1.46;

1.46
date	2004.07.15.19.31.17;	author tg;	state Exp;
branches;
next	1.45;

1.45
date	2004.07.15.06.56.11;	author tg;	state Exp;
branches;
next	1.44;

1.44
date	2004.07.14.11.21.21;	author tg;	state Exp;
branches;
next	1.43;

1.43
date	2004.07.13.20.29.06;	author tg;	state Exp;
branches;
next	1.42;

1.42
date	2004.06.17.22.06.44;	author tg;	state Exp;
branches;
next	1.41;

1.41
date	2004.06.14.00.25.39;	author tg;	state Exp;
branches;
next	1.40;

1.40
date	2004.06.09.15.16.58;	author tg;	state Exp;
branches;
next	1.39;

1.39
date	2004.05.23.20.48.21;	author tg;	state Exp;
branches;
next	1.38;

1.38
date	2004.05.02.16.37.12;	author tg;	state Exp;
branches;
next	1.37;

1.37
date	2004.05.02.15.20.55;	author tg;	state Exp;
branches;
next	1.36;

1.36
date	2004.04.30.18.29.50;	author tg;	state Exp;
branches;
next	1.35;

1.35
date	2004.03.11.20.56.12;	author tg;	state Exp;
branches;
next	1.34;

1.34
date	2004.03.11.18.35.22;	author tg;	state Exp;
branches;
next	1.33;

1.33
date	2004.03.09.21.10.41;	author tg;	state Exp;
branches;
next	1.32;

1.32
date	2004.01.29.21.32.20;	author tg;	state Exp;
branches;
next	1.31;

1.31
date	2004.01.27.17.41.36;	author tg;	state Exp;
branches;
next	1.30;

1.30
date	2004.01.21.12.00.10;	author tg;	state Exp;
branches;
next	1.29;

1.29
date	2004.01.20.20.29.32;	author tg;	state Exp;
branches;
next	1.28;

1.28
date	2004.01.20.19.22.16;	author tg;	state Exp;
branches;
next	1.27;

1.27
date	2004.01.03.01.37.42;	author tg;	state Exp;
branches;
next	1.26;

1.26
date	2004.01.03.01.25.09;	author tg;	state Exp;
branches;
next	1.25;

1.25
date	2003.12.17.18.19.20;	author tg;	state Exp;
branches;
next	1.24;

1.24
date	2003.12.17.18.01.53;	author tg;	state Exp;
branches;
next	1.23;

1.23
date	2003.12.06.00.55.50;	author tg;	state Exp;
branches;
next	1.22;

1.22
date	2003.12.04.17.19.44;	author tg;	state Exp;
branches;
next	1.21;

1.21
date	2003.12.03.21.50.56;	author tg;	state Exp;
branches;
next	1.20;

1.20
date	2003.10.29.13.42.44;	author tg;	state Exp;
branches;
next	1.19;

1.19
date	2003.09.27.14.14.56;	author tg;	state Exp;
branches
	1.19.2.1;
next	1.18;

1.18
date	2003.09.02.00.45.41;	author tg;	state Exp;
branches;
next	1.17;

1.17
date	2003.09.01.17.36.40;	author tg;	state Exp;
branches;
next	1.16;

1.16
date	2003.08.31.20.54.15;	author tg;	state Exp;
branches;
next	1.15;

1.15
date	2003.07.05.15.38.16;	author tg;	state Exp;
branches;
next	1.14;

1.14
date	2003.06.30.17.28.47;	author tg;	state Exp;
branches;
next	1.13;

1.13
date	2003.06.29.19.45.46;	author tg;	state Exp;
branches;
next	1.12;

1.12
date	2003.06.08.21.21.08;	author tg;	state Exp;
branches;
next	1.11;

1.11
date	2003.06.07.19.43.48;	author tg;	state Exp;
branches;
next	1.10;

1.10
date	2003.06.07.14.26.44;	author tg;	state Exp;
branches;
next	1.9;

1.9
date	2003.04.12.20.20.17;	author tg;	state Exp;
branches;
next	1.8;

1.8
date	2003.04.12.18.25.52;	author tg;	state Exp;
branches;
next	1.7;

1.7
date	2003.04.10.20.10.50;	author tg;	state Exp;
branches;
next	1.6;

1.6
date	2003.04.06.14.52.59;	author tg;	state Exp;
branches;
next	1.5;

1.5
date	2003.04.06.14.20.21;	author tg;	state Exp;
branches;
next	1.4;

1.4
date	2003.03.29.21.33.32;	author tg;	state Exp;
branches;
next	1.3;

1.3
date	2003.03.24.21.25.05;	author tg;	state Exp;
branches;
next	1.2;

1.2
date	2003.03.23.21.47.59;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.22.17.35.17;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.03.22.17.35.17;	author tg;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.03.29.19.07.29;	author tg;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2003.04.10.13.56.20;	author tg;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2003.06.29.14.53.37;	author tg;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2003.08.22.15.28.40;	author tg;	state Exp;
branches;
next	1.1.1.6;

1.1.1.6
date	2003.09.25.16.07.57;	author tg;	state Exp;
branches;
next	1.1.1.7;

1.1.1.7
date	2003.12.03.17.58.22;	author tg;	state Exp;
branches;
next	1.1.1.8;

1.1.1.8
date	2004.01.02.17.08.21;	author tg;	state Exp;
branches;
next	1.1.1.9;

1.1.1.9
date	2004.01.26.16.55.26;	author tg;	state Exp;
branches;
next	1.1.1.10;

1.1.1.10
date	2004.05.16.07.18.07;	author tg;	state Exp;
branches;
next	;

1.19.2.1
date	2003.10.23.20.45.13;	author tg;	state Exp;
branches;
next	1.19.2.2;

1.19.2.2
date	2003.10.23.21.46.44;	author tg;	state Exp;
branches
	1.19.2.2.2.1;
next	;

1.19.2.2.2.1
date	2004.02.14.23.19.31;	author tg;	state Exp;
branches;
next	;

1.56.2.1
date	2004.10.11.20.12.26;	author tg;	state Exp;
branches;
next	;

1.56.4.1
date	2004.11.13.19.24.35;	author tg;	state Exp;
branches;
next	;


desc
@@


1.71
log
@release, too (except kernel builds)
@
text
@# $MirBSD: src/etc/Makefile,v 1.69 2004/12/07 14:45:31 tg Exp $
# $OpenBSD: Makefile,v 1.206 2004/05/04 23:37:04 deraadt Exp $

TZDIR=		/usr/share/zoneinfo
LOCALTIME?=	UTC
NOOBJ=		yes

.if exists(etc.${MACHINE}/Makefile.inc)
.  include "etc.${MACHINE}/Makefile.inc"
.endif

.include <bsd.own.mk>

# -rw-r--r--
BINOWN= root
BINGRP= wheel
BIN1=	changelist ccd.conf \
	daily dhcpd.conf dhcpd.interfaces exports ftpusers \
	ftpchroot gettytab group hosts hosts.lpd inetd.conf \
	ksh.kshrc locate.rc man.conf monthly motd mrouted.conf \
	myname netstart networks newsyslog.conf ntpd.conf \
	phones printcap protocols rbootd.conf rc rc.conf rc.local \
	rc.securelevel rc.shutdown remote rpc security services \
	shells spamd.conf weekly etc.${MACHINE}/disktab profile \
	dhclient.conf mailer.conf wsconsctl.conf

# machine dependent parts
BINMD=	mk.conf syslog.conf

# -rw-rw-r--
BIN2=	motd

# Use NOGZIP on architectures where the gzip'ing would take too much time
# (pmax or slower :-)).  This way you get only tar'ed snap files and you can
# gzip them on a faster machine
.ifndef NOGZIP
GZIP?=		gzip
GZIPFLAGS?=	-9
GZIPEXT?=	.gz
.else
GZIP=		cat
GZIPFLAGS=
GZIPEXT=
.endif

all clean cleandir depend etc install lint:

distrib-dirs:
.ifdef	DESTDIR
	if [ ! -d ${DESTDIR}/. ]; then \
		${INSTALL} -d -o root -g wheel -m 755 ${DESTDIR}; \
	fi
.endif
	mtree -qdef mtree/4.4BSD.dist -p ${DESTDIR}/ -U
	for i in ${DESTDIR}/usr/{ports,src}; do \
		[[ -d $$i ]] || ${INSTALL} -d -o root -g wsrc -m 775 $$i; \
	done
	cd ${DESTDIR}/; rm -f sys; ln -s usr/src/sys sys

.ifndef DESTDIR
distribution-etc-root-var distribution release snapshot:
	@@echo setenv DESTDIR before doing that!
	@@false
.else
distribution-etc-root-var: distrib-dirs
# not for a release
#	cd ${DESTDIR}/etc && ln -s AFGHJ malloc.conf
	${INSTALL} -c -o ${BINOWN} -g ${BINGRP} -m 644 ${BIN1} ${DESTDIR}/etc
	chmod 640 ${DESTDIR}/etc/inetd.conf
	cat etc.${MACHINE}/ttys ttys.pty >${DESTDIR}/etc/ttys && \
	    chown ${BINOWN} ${DESTDIR}/etc/ttys && \
	    chgrp ${BINGRP} ${DESTDIR}/etc/ttys && \
	    chmod 644 ${DESTDIR}/etc/ttys
	cat sysctl.conf etc.${MACHINE}/sysctl.conf >${DESTDIR}/etc/sysctl.conf && \
	    chown ${BINOWN} ${DESTDIR}/etc/sysctl.conf && \
	    chgrp ${BINGRP} ${DESTDIR}/etc/sysctl.conf && \
	    chmod 644 ${DESTDIR}/etc/sysctl.conf
	cat fbtab.head etc.${MACHINE}/fbtab fbtab.tail >${DESTDIR}/etc/fbtab && \
	    chown ${BINOWN} ${DESTDIR}/etc/fbtab && \
	    chgrp ${BINGRP} ${DESTDIR}/etc/fbtab && \
	    chmod 644 ${DESTDIR}/etc/fbtab
.  for _i in ${BINMD}
	if [ -e ${.CURDIR}/etc.${MACHINE}/${_i}.md ]; then \
		sed -e '/@@@@MDPART@@@@/r${.CURDIR}/etc.${MACHINE}/${_i}.md' \
		    -e '//d' ${.CURDIR}/${_i}; \
	    else \
		sed -e '/@@@@MDPART@@@@/d' ${.CURDIR}/${_i}; \
	  fi >${DESTDIR}/etc/${_i}; \
	    chown ${BINOWN} ${DESTDIR}/etc/${_i} && \
	    chgrp ${BINGRP} ${DESTDIR}/etc/${_i} && \
	    chmod 644 ${DESTDIR}/etc/${_i}
.  endfor
	${INSTALL} -c -o ${BINOWN} -g ${BINGRP} -m 664 ${BIN2} ${DESTDIR}/etc
	${INSTALL} -c -o root -g wheel -m 600 hosts.equiv ${DESTDIR}/etc
	${INSTALL} -c -o root -g wheel -m 600 crontab ${DESTDIR}/var/cron/tabs/root
	${INSTALL} -c -o root -g wheel -m 644 login.conf ${DESTDIR}/etc
	${INSTALL} -c -o root -g wheel -m 600 master.passwd ${DESTDIR}/etc
	pwd_mkdb -p -d ${DESTDIR}/etc /etc/master.passwd
	${INSTALL} -c -o root -g wheel -m 644 moduli ${DESTDIR}/etc
	${INSTALL} -c -o root -g wheel -m 600 bgpd.conf ${DESTDIR}/etc
	${INSTALL} -c -o root -g wheel -m 600 pf.conf ${DESTDIR}/etc
	${INSTALL} -c -o root -g wheel -m 644 pf.os ${DESTDIR}/etc
	${INSTALL} -c -o root -g wheel -m 644 sensorsd.conf ${DESTDIR}/etc
	${INSTALL} -c -o ${BINOWN} -g ${BINGRP} -m 555 \
	    etc.${MACHINE}/MAKEDEV ${DESTDIR}/dev
	cd root; \
		${INSTALL} -c -o root -g wheel -m 644 dot.profile \
		    ${DESTDIR}/root/.profile; \
		rm -f ${DESTDIR}/.profile; \
		ln ${DESTDIR}/root/.profile ${DESTDIR}/.profile
	cd skel; \
		${INSTALL} -c -o root -g wheel -m 644 ssh.known_hosts \
		    ${DESTDIR}/etc/skel/.etc/ssh/known_hosts; \
		${INSTALL} -c -o root -g wheel -m 644 dot.mailrc \
		    ${DESTDIR}/etc/skel/.mailrc; \
		${INSTALL} -c -o root -g wheel -m 644 dot.profile \
		    ${DESTDIR}/etc/skel/.profile
	cd mtree; \
		${INSTALL} -c -o root -g wheel -m 600 special \
		    ${DESTDIR}/etc/mtree; \
		${INSTALL} -c -o root -g wheel -m 444 4.4BSD.dist \
		    ${DESTDIR}/etc/mtree; \
		${INSTALL} -c -o root -g wheel -m 444 BSD.local.dist \
		    ${DESTDIR}/etc/mtree
	cd ppp; \
		${INSTALL} -c -o root -g wheel -m 600 \
		    chap-secrets options.sample pap-secrets \
		    ppp.conf.sample ppp.secret.sample \
			${DESTDIR}/etc/ppp/; \
		${INSTALL} -c -o root -g wheel -m 600 \
		    isp.sample isp.chat.sample \
			${DESTDIR}/etc/ppp/peers/; \
		${INSTALL} -c -o root -g wheel -m 755 \
		    ip-up ip-down ppp.linkup.sample ppp.linkdown.sample \
			${DESTDIR}/etc/ppp/
	cd systrace; \
		${INSTALL} -c -o root -g wheel -m 600 usr_sbin_lpd \
		    ${DESTDIR}/etc/systrace;
	/bin/rm -f ${DESTDIR}/etc/localtime
	ln -s ${TZDIR}/${LOCALTIME} ${DESTDIR}/etc/localtime
	/bin/rm -f ${DESTDIR}/etc/rmt
	ln -s /usr/sbin/rmt ${DESTDIR}/etc/rmt
	${INSTALL} -c -o root -g wheel -m 644 minfree \
		${DESTDIR}/var/crash
	${INSTALL} -c -o ${BINOWN} -g operator -m 664 /dev/null \
		${DESTDIR}/etc/dumpdates
.  if ${MACHINE} == "i386"
	${INSTALL} -c -o root -g wheel -m 644 isdnd.rc.sample \
		${DESTDIR}/etc/isdn/
	${INSTALL} -c -o root -g wheel -m 644 isdnd.sppp.sample \
		${DESTDIR}/etc/isdn/
.  endif
	${INSTALL} -c -o root -g crontab -m 660 /dev/null \
		${DESTDIR}/var/cron/at.deny
	${INSTALL} -c -o root -g crontab -m 660 /dev/null \
		${DESTDIR}/var/cron/cron.deny
	${INSTALL} -c -o root -g wheel -m 600 /dev/null \
		${DESTDIR}/var/cron/log
	${INSTALL} -c -o root -g wheel -m 444 /dev/null \
		${DESTDIR}/var/db/locate.database
	${INSTALL} -c -o ${BINOWN} -g wheel -m 640 /dev/null \
		${DESTDIR}/var/log/messages
	${INSTALL} -c -o ${BINOWN} -g wheel -m 664 /dev/null \
		${DESTDIR}/var/log/sendmail.st
	${INSTALL} -c -o ${BINOWN} -g wheel -m 644 /dev/null \
		${DESTDIR}/var/log/wtmp
	${INSTALL} -c -o daemon -g staff -m 664 /dev/null \
		${DESTDIR}/var/msgs/bounds
	${INSTALL} -c -o ${BINOWN} -g utmp -m 664 /dev/null \
		${DESTDIR}/var/run/utmp
.  if defined(SKIPDIR) && ${SKIPDIR:Mgnu/usr.sbin/sendmail}
	@@echo "Warning: skipping sendmail"
.  else
	cd ../gnu/usr.sbin/sendmail/cf/cf && exec ${MAKE} distribution
.  endif
	cd ../usr.bin/ssh && exec ${MAKE} distribution
	cd ../lib/libssl && exec ${MAKE} distribution
.  for _i in usr.sbin/httpd gnu/usr.bin/lynx
.    if defined(SKIPDIR) && ${SKIPDIR:M${_i}}
	@@echo "Warning: skipping ${_i}"
.    else
	cd ../${_i} && exec ${MAKE} -f Makefile.bsd-wrapper distribution
.    endif
.  endfor
	cd ../usr.bin/mail && exec ${MAKE} distribution
	cd ../gnu/usr.bin/anoncvs && exec ${MAKE} distribution
	${INSTALL} -c -o root -g wheel -m 600 root/root.mail \
		${DESTDIR}/var/mail/root
	${INSTALL} -c -o root -g wheel -m 440 ../usr.bin/sudo/sudoers \
		${DESTDIR}/etc/sudoers
	cd ${DESTDIR}/etc/ssl/certs && ${SHELL} ${.CURDIR}/ssl.certs.shar && \
		chown ${BINOWN}:${BINGRP} * && chmod 444 *

distribution:
	exec ${SUDO} ${_STCMD_DEST} ${MAKE} distribution-etc-root-var
	cd .. && exec ${SUDO} ${_STCMD_DEST} ${MAKE} install

.  ifndef RELEASEDIR
release:
	@@echo setenv RELEASEDIR before building a release.
	@@false
.  else
release: distribution snap_pre snap_md
	@@echo "============================================================"
	@@echo "Checking files:"
	@@echo ""
	-cd ${.CURDIR}/../distrib/lists/base && DESTDIR="${DESTDIR}" \
	    RELEASEDIR="${RELEASEDIR}" ${SUDO} ${SHELL} \
	    ${BSDSRCDIR}/scripts/checkflist
	@@echo "============================================================"
.    ifdef WAIT_CHECKFLIST
	@@read a?'Press Return to continue...'
.    endif
	cd ${.CURDIR}/../distrib/lists/base && DESTDIR="${DESTDIR}" \
	    RELEASEDIR="${RELEASEDIR}" ${SUDO} ${SHELL} \
	    ${BSDSRCDIR}/scripts/maketars ${OSrev}
	@@cd ${.CURDIR} && ${MAKE} release-finish DESTDIR="${DESTDIR}" \
	    RELEASEDIR="${RELEASEDIR}"

release-finish:
	-cd ${DESTDIR}/snapshot; for f in bsd* *boot* *BOOT* cd*.iso \
	    *.fs *.fs.gz; do test -e $$f && \
		${SUDO} cp $$f ${RELEASEDIR}; done
	-cd ${RELEASEDIR}; \
		md5 bsd!(*.gz) *boot* *BOOT* *.fs *.iso *.gz *.ngz \
		    | ${SUDO} tee MD5
	-cd ${RELEASEDIR}; \
		cksum bsd!(*.gz) *boot* *BOOT* *.fs *.iso *.gz *.ngz \
		    | ${SUDO} tee CKSUM
.    ifdef MACHINE_HAS_TOOLS
	${SUDO} mkdir -p ${RELEASEDIR}/tools
	${SUDO} cp ${DESTDIR}/snapshot/tools/* ${RELEASEDIR}/tools
	cd ${RELEASEDIR} && md5 tools/* | ${SUDO} tee -a MD5
	cd ${RELEASEDIR} && cksum tools/* | ${SUDO} tee -a CKSUM
.    endif
	-cd ${RELEASEDIR} && ${SUDO} sort -o MD5 MD5
	-cd ${RELEASEDIR} && ${SUDO} sort -o CKSUM -k 3 CKSUM
.  endif

htman:
	@@echo "Building HTML format manual pages."
	${SHELL} -c ". ${BSDSRCDIR}/scripts/man2htm; \
	    convert_all ${BASEDESTDIR}/usr/share/man ${DESTDIR}"
	@@echo "Building ASCII to HTML format papers."
	mkdir -p ${DESTDIR}/papers
	-rm -rf ${BSDOBJDIR}/htman
.for _i in papers psd smm usd
	mkdir -p ${BSDOBJDIR}/htman/${_i}
	( cd ${BSDOBJDIR}/htman/${_i} \
	    && lndir ${BASEDESTDIR}/usr/share/doc/${_i} \
	    && ${MAKE} )
	[[ ! -e ${BSDOBJDIR}/htman/${_i}/Title.txt ]] \
	    || ${SHELL} -c ". ${BSDSRCDIR}/scripts/man2htm; \
	    output_header Title ${_i:U}; \
	    do_convert <${BSDOBJDIR}/htman/${_i}/Title.txt; \
	    output_footer" >${DESTDIR}/papers/${_i}-Title.htm
	[[ ! -e ${BSDOBJDIR}/htman/${_i}/contents.txt ]] \
	    || ${SHELL} -c ". ${BSDSRCDIR}/scripts/man2htm; \
	    output_header Contents ${_i:U}; \
	    do_convert <${BSDOBJDIR}/htman/${_i}/contents.txt; \
	    output_footer" >${DESTDIR}/papers/${_i}-contents.htm
	for f in ${BSDOBJDIR}/htman/${_i}/*/paper.txt; do \
		t=$$(print "$$f" | sed \
		    -e 's#${BSDOBJDIR}/htman/${_i}/##' \
		    -e 's#/paper.txt##'); \
		${SHELL} -c ". ${BSDSRCDIR}/scripts/man2htm; \
		    output_header $$t ${_i:U}; \
		    do_convert <$$f; \
		    output_footer" >${DESTDIR}/papers/${_i}.$$t.htm; \
	done
.endfor
	@@echo "============================================================"
	@@echo "Checking files:"
	@@echo ""
	-cd ${.CURDIR}/../distrib/lists/htman && RELEASEDIR="${RELEASEDIR}" \
	    DESTDIR="${DESTDIR}" ${SHELL} ${BSDSRCDIR}/scripts/checkflist
	@@echo "============================================================"
.  ifdef WAIT_CHECKFLIST
	@@read a?'Press Return to continue...'
.  endif
	-cd ${.CURDIR}/../distrib/lists/htman && RELEASEDIR="${RELEASEDIR}" \
	    DESTDIR="${DESTDIR}" ${SUDO} ${SHELL} \
	    ${BSDSRCDIR}/scripts/maketars ${OSrev}
	-cd ${RELEASEDIR}; md5 htman${OSrev}.ngz | ${SUDO} tee -a MD5; \
	    cksum htman${OSrev}.ngz | ${SUDO} tee -a CKSUM

snap_pre:
	${SUDO} /bin/rm -rf ${DESTDIR}/snapshot
	${SUDO} ${INSTALL} -d -o root -g wheel -m 755 ${DESTDIR}/snapshot

snap_md:
# nothing here -- look in the machine-dependent Makefile.inc

.endif	# DESTDIR check

MAKEDEVARCHS+= i386
MAKEDEVARCHS+= macppc
MAKEDEVARCHS+= sparc

clean:
	rm -f etc.${MACHINE}/MAKEDEV

cleandir:
	cd ${.CURDIR}; for m in ${MAKEDEVARCHS}; do \
	    ${MAKE} MACHINE=$$m clean; done

MAKEDEVSRC=	MAKEDEV.mi MAKEDEV.sub MAKEDEV.common
MAKEDEVDOC=	MAKEDEV.man MAKEDEV.mansub MAKEDEV.common
m4: etc.${M}/MAKEDEV
man: ${.CURDIR}/../share/man/man8/man8.${M}/MAKEDEV.8

etc.${M}/MAKEDEV: ${MAKEDEVSRC} etc.${M}/MAKEDEV.md
	@@echo "==> etc.${M}/MAKEDEV"
	m4 -DMACHINE=${M} MAKEDEV.mi >etc.${M}/.MAKEDEV.tmp && \
	    mv etc.${M}/.MAKEDEV.tmp etc.${M}/MAKEDEV || \
	    rm etc.${M}/.MAKEDEV.tmp

${.CURDIR}/../share/man/man8/man8.${M}/MAKEDEV.8: ${MAKEDEVDOC} etc.${M}/MAKEDEV.md
	m4 -DMACHINE=${M} MAKEDEV.man >$@@

allarchs: ${MAKEDEVSRC} ${MAKEDEVDOC}
	cd ${.CURDIR}; for m in ${MAKEDEVARCHS}; do \
	    ${MAKE} M=$$m m4 man; done
	@@echo "================================="
	@@echo " Don't forget to update your own"
	@@echo " '/dev/MAKEDEV' script manually!"
	@@echo "================================="

distrib:
	# XXX no ${_STCMD_OBJ} because /sys/arch/*/compile/* is R/W
	cd ${.CURDIR}/../distrib \
	    && ${MAKE} cleandir \
	    && ${MAKE} \
	    && exec ${SUDO} ${_STCMD_DEST} ${MAKE} install

GENERATED_FILES=

.for _i in ${BINMD}
GENERATED_FILES+= ${_i}.generated

.  for _j in etc.${MACHINE}/${_i}.md etc.${MACHINE_ARCH}/${_i}.md ${_i}
.    if exists(${_j})
${_i}.generated: ${_j}
.    endif
.  endfor

${_i}.generated:
	if [ -e ${.CURDIR}/etc.${MACHINE}/${_i}.md ]; then \
		sed -e '/@@@@MDPART@@@@/r${.CURDIR}/etc.${MACHINE}/${_i}.md' \
		    -e '//d'; \
	elif [ -e ${.CURDIR}/etc.${MACHINE_ARCH}/${_i}.md ]; then \
		sed -e '/@@@@MDPART@@@@/r${.CURDIR}/etc.${MACHINE_ARCH}/${_i}.md' \
		    -e '//d'; \
	else \
		sed -e '/@@@@MDPART@@@@/d'; \
	fi <${.CURDIR}/${_i} >$@@
.endfor

make-generated: ${GENERATED_FILES}

clean-generated:
	-rm -f ${GENERATED_FILES}

.ifdef DESTDIR
install-generated: make-generated
.  for _i in ${BINMD}
	${INSTALL} -c -o ${BINOWN} -g ${BINGRP} -m 644 \
	    ${_i}.generated ${DESTDIR}/etc/${_i}
.  endfor
.else
install-generated:
	@@echo "Set DESTDIR before trying this!"; false
.endif

DHSIZE=	1024 1536 2048 3072 4096
update-moduli:
	( \
		echo '#    $$MirBSD: src/etc/Makefile,v 1.69 2004/12/07 14:45:31 tg Exp $$'; \
		echo '#    $$OpenBSD: Makefile,v 1.206 2004/05/04 23:37:04 deraadt Exp $$'; \
		echo '# Time Type Tests Tries Size Generator Modulus'; \
		( for i in ${DHSIZE}; do \
			ssh-keygen -b $$i -G /dev/stdout; \
		done) | \
		ssh-keygen -T /dev/stdout \
	) >moduli

.PHONY: distribution-etc-root-var distribution distrib-dirs release \
	make-generated clean-generated install-generated update-moduli \
	release-finish snapshot allarchs snap_pre snap_tar snap_md m4

.include <bsd.prog.mk>
@


1.70
log
@build HTML format papers too
(they look weird, especially the eqn docs, but
 to fix this is to fix it for nroff; maybe ditroff's
 nroff mode will help this)

This commit is dedicated to Schaghayegh, with whom I
have been talking in ICQ the first time since...long
during hacking this.
@
text
@d195 2
a196 2
	exec ${SUDO} ${MAKE} distribution-etc-root-var
	cd .. && exec ${SUDO} ${MAKE} install
d330 5
a334 3
	cd ${.CURDIR}/../distrib && ${MAKE} cleandir
	cd ${.CURDIR}/../distrib && ${MAKE} \
	    && exec ${SUDO} ${MAKE} install
@


1.69
log
@let the C shell die
finally agreed by bsiegert@@ sap@@
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.68 2004/11/30 17:04:14 tg Exp $
d244 28
d376 1
a376 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.68 2004/11/30 17:04:14 tg Exp $$'; \
@


1.68
log
@NOOBJ=.*$ -> NOOBJ=yes
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.67 2004/11/28 19:28:09 tg Exp $
d17 1
a17 1
BIN1=	changelist ccd.conf csh.cshrc csh.login csh.logout \
a106 4
		${INSTALL} -c -o root -g wheel -m 644 dot.cshrc \
		    ${DESTDIR}/root/.cshrc; \
		${INSTALL} -c -o root -g wheel -m 644 dot.login \
		    ${DESTDIR}/root/.login; \
d109 1
a109 2
		rm -f ${DESTDIR}/.cshrc ${DESTDIR}/.profile; \
		ln ${DESTDIR}/root/.cshrc ${DESTDIR}/.cshrc; \
a113 4
		${INSTALL} -c -o root -g wheel -m 644 dot.cshrc \
		    ${DESTDIR}/etc/skel/.cshrc; \
		${INSTALL} -c -o root -g wheel -m 644 dot.login \
		    ${DESTDIR}/etc/skel/.login; \
d348 1
a348 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.67 2004/11/28 19:28:09 tg Exp $$'; \
@


1.67
log
@* set /var/log/messages to 640 root:wheel so that only these
  people with sudo on by default can read it unless admin changes.
  first noticed by pieass in IRC, gecko2 made some good points
  in persuading me
* while here, prevent us from wtmp running over some gigs of space
  on otherwise idle systems
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.66 2004/11/23 14:16:37 tg Exp $
d6 1
a6 1
NOOBJ=		noobj
d357 1
a357 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.66 2004/11/23 14:16:37 tg Exp $$'; \
@


1.66
log
@install default /usr/ports,root:wsrc,0775
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.65 2004/11/15 00:18:54 tg Exp $
d170 1
a170 1
	${INSTALL} -c -o ${BINOWN} -g wheel -m 644 /dev/null \
d357 1
a357 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.65 2004/11/15 00:18:54 tg Exp $$'; \
@


1.65
log
@rest of the fallout:
distrib/*:	instbin (sftp) needs editline now (-ledit)
etc/*:		some usability, buildability
		mtree/ fixup
top:		from obsd: rename "errno" struct member to "err" (*sigh*)
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.64 2004/11/13 21:05:34 tg Exp $
d55 3
a57 3
	if [ ! -d ${DESTDIR}/usr/src ]; then \
		${INSTALL} -d -o root -g wsrc -m 775 ${DESTDIR}/usr/src; \
	fi
d357 1
a357 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.64 2004/11/13 21:05:34 tg Exp $$'; \
@


1.64
log
@shave some off my work for the first MirHackathon and let
the zombies walk around for bsiegert@@'s voodoo
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.56.4.1 2004/11/13 19:24:35 tg Exp $
a132 2
		    ${DESTDIR}/etc/mtree; \
		${INSTALL} -c -o root -g wheel -m 444 BSD.x11.dist \
d357 1
a357 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.63 2004/11/13 18:51:38 tg Exp $$'; \
@


1.63
log
@move sendmail certs to /etc/ssl/ and more sensible locations/names
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.62 2004/11/13 02:24:37 tg Exp $
d280 1
d359 1
a359 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.62 2004/11/13 02:24:37 tg Exp $$'; \
@


1.62
log
@welcome back, sparc
(usr.bin/pmdb was never deleted)
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.56.2.1 2004/10/11 20:12:26 tg Exp $
a203 2
	cd ${DESTDIR}/etc/mail/certs && ${SHELL} ${.CURDIR}/ssl.certs.shar && \
		chown ${BINOWN}:${BINGRP} * && chmod 444 *
d358 1
a358 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.61 2004/10/24 17:08:24 tg Exp $$'; \
@


1.61
log
@more .PHONY targets
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.60 2004/10/24 15:11:17 tg Exp $
d282 1
d360 1
a360 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.60 2004/10/24 15:11:17 tg Exp $$'; \
@


1.60
log
@sync, after make b-r w/o X
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.59 2004/10/21 14:22:30 tg Exp $
d359 1
a359 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.59 2004/10/21 14:22:30 tg Exp $$'; \
d369 1
@


1.59
log
@* move distrib/lists/<set> to distrib/lists/base/<set>
  so the new structure is distrib/lists/<list>/<set>/mi
  where <list> is the same as in /usr/obj/D/<list>
  and distrib/lists/<list>/ignfiles exist
* add new set htman8.ngz containing the online manpages
* copy old contrib/samples/man2htm.sh, slightly adapted
  for the release process, here
* generate that set during make b-r
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.58 2004/10/15 16:13:14 tg Exp $
d255 2
a256 2
	( . ${BSDSRCDIR}/scripts/man2htm; \
	    convert_all ${BASEDESTDIR}/usr/share/man ${DESTDIR} )
d359 1
a359 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.58 2004/10/15 16:13:14 tg Exp $$'; \
@


1.58
log
@don't install /etc/malloc.conf right now
it breaks too much broken programmes, preventing them from
working at all (but then, I personally would rather like to
see them prevented from being run if that's the only way to
prevent their bugs from being exploited)
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.57 2004/10/14 19:50:22 tg Exp $
d220 1
a220 1
	-cd ${.CURDIR}/../distrib/lists && DESTDIR="${DESTDIR}" \
d227 1
a227 1
	cd ${.CURDIR}/../distrib/lists && DESTDIR="${DESTDIR}" \
d253 19
d359 1
a359 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.57 2004/10/14 19:50:22 tg Exp $$'; \
@


1.57
log
@add sample ntpd.conf
add ntpd_flags to rc/rc.conf
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.56 2004/09/18 13:09:08 tg Exp $
d66 2
a67 1
	cd ${DESTDIR}/etc && ln -s AFGHJ malloc.conf
d340 1
a340 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.56 2004/09/18 13:09:08 tg Exp $$'; \
@


1.56
log
@for pppd(8), ip-{up,down} must be executables
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.55 2004/09/18 13:07:29 tg Exp $
d21 1
a21 1
	myname netstart networks newsyslog.conf \
d339 1
a339 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.55 2004/09/18 13:07:29 tg Exp $$'; \
@


1.56.4.1
log
@add these zombies back
not I am the person who's going to welcome this piece of code, though.
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.56 2004/09/18 13:09:08 tg Exp $
a261 1
MAKEDEVARCHS+= macppc
d339 1
a339 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.56 2004/09/18 13:09:08 tg Exp $$'; \
@


1.56.2.1
log
@This branch consists of HEAD nxsrc, with the
following directories as of 2004/07/15 19:30
but reverted to 32-bit time_t values.

	distrib/sparc
	etc/etc.sparc
	lib/csu/sparc_elf
	lib/libc/arch/sparc
	lib/libpthread/arch/sparc
	lib/libssl/crypto/arch/sparc
	libexec/ld.so/sparc
	share/man/man4/man4.sparc
	share/man/man8/man8.sparc
	sys/arch/sparc
	sys/lib/libkern/arch/sparc
	usr.sbin/eeprom

link at least these directories back into the tree for now.
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.56 2004/09/18 13:09:08 tg Exp $
a261 1
MAKEDEVARCHS+= sparc
d339 1
a339 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.56 2004/09/18 13:09:08 tg Exp $$'; \
@


1.55
log
@* call ip-up/ip-down from mirbsdksh (in ppp(8))
* $Id keyword
* add sample ip-up and ip-down
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.54 2004/09/15 19:44:23 tg Exp $
d143 1
a143 1
		${INSTALL} -c -o root -g wheel -m 644 \
d339 1
a339 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.54 2004/09/15 19:44:23 tg Exp $$'; \
@


1.54
log
@sync after make release (partial)
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.53 2004/09/12 15:35:36 tg Exp $
d136 10
a145 18
		${INSTALL} -c -o root -g wheel -m 600 chap-secrets \
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 600 options.sample \
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 600 isp.sample \
		    ${DESTDIR}/etc/ppp/peers; \
		${INSTALL} -c -o root -g wheel -m 600 isp.chat.sample \
		    ${DESTDIR}/etc/ppp/peers; \
		${INSTALL} -c -o root -g wheel -m 600 pap-secrets \
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 600 ppp.conf.sample \
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 644 ppp.linkup.sample \
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 644 ppp.linkdown.sample \
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 644 ppp.secret.sample \
		    ${DESTDIR}/etc/ppp
d339 1
a339 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.53 2004/09/12 15:35:36 tg Exp $$'; \
@


1.53
log
@spacing
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.52 2004/08/27 19:22:38 tg Exp $
d242 1
a242 1
	    INSTALL.* *.fs *.fs.gz; do test -e $$f && \
d245 1
a245 1
		md5 bsd!(*.gz) *boot* *BOOT* INSTALL.* *.fs *.iso *.gz *.ngz \
d248 1
a248 1
		cksum bsd!(*.gz) *boot* *BOOT* INSTALL.* *.fs *.iso *.gz *.ngz \
d347 1
a347 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.52 2004/08/27 19:22:38 tg Exp $$'; \
@


1.52
log
@anoncvs moved
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.51 2004/08/13 21:12:24 tg Exp $
d9 1
a9 1
.include "etc.${MACHINE}/Makefile.inc"
d81 1
a81 1
.for _i in ${BINMD}
d91 1
a91 1
.endfor
d165 1
a165 1
.if ${MACHINE} == "i386"
d170 1
a170 1
.endif
d189 1
a189 1
.if defined(SKIPDIR) && ${SKIPDIR:Mgnu/usr.sbin/sendmail}
d191 1
a191 1
.else
d193 1
a193 1
.endif
d196 2
a197 2
.for _i in usr.sbin/httpd gnu/usr.bin/lynx
.  if defined(SKIPDIR) && ${SKIPDIR:M${_i}}
d199 1
a199 1
.  else
d201 2
a202 2
.  endif
.endfor
d218 1
a218 1
.ifndef RELEASEDIR
d222 1
a222 1
.else
d231 1
a231 1
.ifdef WAIT_CHECKFLIST
d233 1
a233 1
.endif
d250 1
a250 1
.ifdef	MACHINE_HAS_TOOLS
d255 1
a255 1
.endif
d258 1
a258 1
.endif
d333 1
a333 1
.ifdef	DESTDIR
d347 1
a347 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.51 2004/08/13 21:12:24 tg Exp $$'; \
d358 1
@


1.51
log
@build process fixes
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.50 2004/08/13 16:52:02 tg Exp $
d204 1
a204 1
	cd ../distrib/anoncvsbin && exec ${MAKE} distribution
d347 1
a347 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.50 2004/08/13 16:52:02 tg Exp $$'; \
@


1.50
log
@install malloc.conf(5) unconditionally
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.49 2004/08/13 15:46:30 tg Exp $
d237 7
a243 2
	cd ${DESTDIR}/snapshot; for f in bsd* *boot* *BOOT* cd*.iso \
	    INSTALL.* *.fs *.fs.gz; do ${SUDO} cp $$f ${RELEASEDIR}; done
d347 1
a347 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.49 2004/08/13 15:46:30 tg Exp $$'; \
d356 2
a357 2
.PHONY: distribution-etc-root-var distribution distrib-dirs \
	release snapshot allarchs snap_pre snap_tar snap_md m4
@


1.49
log
@call checkflist before makeflist, optionally wait
remove a few superfluous targets (leftovers from MirOS #0 or #1 or so)
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.48 2004/08/13 15:36:28 tg Exp $
a65 1
.ifdef REL_DEBUG_SNAP
a66 1
.endif
d342 1
a342 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.48 2004/08/13 15:36:28 tg Exp $$'; \
@


1.48
log
@no need to install distrib/notes twice
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.47 2004/07/18 13:26:17 tg Exp $
d226 10
d239 2
a240 7
	-${SUDO} cp ${DESTDIR}/snapshot/bsd* ${RELEASEDIR}
	-${SUDO} cp ${DESTDIR}/snapshot/*boot* ${RELEASEDIR}
	-${SUDO} cp ${DESTDIR}/snapshot/*BOOT* ${RELEASEDIR}
	-${SUDO} cp ${DESTDIR}/snapshot/cd*.iso ${RELEASEDIR}
	-${SUDO} cp ${DESTDIR}/snapshot/INSTALL.* ${RELEASEDIR}
	-${SUDO} cp ${DESTDIR}/snapshot/*.fs ${DESTDIR}/snapshot/*.fs.gz \
	    ${RELEASEDIR}
d344 1
a344 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.47 2004/07/18 13:26:17 tg Exp $$'; \
@


1.47
log
@nuke egcs (pgcc, gcc2) and simplify the system a bit
also fix placement of GNUSYSTEM_AUX_DIR equation in <bsd.own.mk> while here
remove some sparc and xc-old/xc-mit remnants
for now, all distribution lists are mi, since we only have 1 arch

XXX comp is second-largest now (after xfont), need ideas, come to IRC

agreed: <benz|lernen> joa, warum nicht
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.46 2004/07/15 19:31:17 tg Exp $
a225 2
	cd ${.CURDIR}/../distrib/notes && ${MAKE} && \
	    exec ${SUDO} ${MAKE} install
d339 1
a339 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.46 2004/07/15 19:31:17 tg Exp $$'; \
@


1.46
log
@sparc has to die :(

it was nice while it lasted, but I couldn't even live up to
my promise to provide XFree86 4.4.0 on sparc due to lack of
time (and money and health).

also, compat_freebsd dies, without prejudice.

<mirabile> benz: sparc darf sterben?
<mirabile> compat_freebsd darf sterben?
<benz> na gut

in addition, some set shuffling (it was a good idea originally
to pull out gcc3 specifics to the egcs set, but with gcc3 being
the only compiler that isn't it any more)
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.45 2004/07/15 06:56:11 tg Exp $
d229 1
a229 2
	    RELEASEDIR="${RELEASEDIR}" HAS_GCC2="${HAS_GCC2:L}" \
	    HAS_GCC3="${HAS_GCC3:L}" ${SUDO} ${SHELL} \
d341 1
a341 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.45 2004/07/15 06:56:11 tg Exp $$'; \
@


1.45
log
@more build and set fixes
don't use -g globally - ld(1) is broken and dumps core

this is still a test release :(
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.44 2004/07/14 11:21:21 tg Exp $
a264 1
MAKEDEVARCHS+= sparc
d342 1
a342 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.44 2004/07/14 11:21:21 tg Exp $$'; \
@


1.44
log
@put in some effort to
* fix the boot loader output
* fix ramdisk root device selection
* make release with as few sudo as possible
* fix COPTS selection for the anoncvsbin
* fix COPTS (no -g) for the kernel
  (a kernel with DEBUG=-g needs a higher ulimit -d)
* clean up in general
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.43 2004/07/13 20:29:06 tg Exp $
d232 7
a238 6
	-cp ${DESTDIR}/snapshot/bsd* ${RELEASEDIR}
	-cp ${DESTDIR}/snapshot/*boot* ${RELEASEDIR}
	-cp ${DESTDIR}/snapshot/*BOOT* ${RELEASEDIR}
	-cp ${DESTDIR}/snapshot/cd*.iso ${RELEASEDIR}
	-cp ${DESTDIR}/snapshot/INSTALL.* ${RELEASEDIR}
	-cp ${DESTDIR}/snapshot/*.fs ${DESTDIR}/snapshot/*.fs.gz ${RELEASEDIR}
d241 1
a241 1
		    | tee MD5
d244 1
a244 1
		    >CKSUM
d246 4
a249 4
	mkdir -p ${RELEASEDIR}/tools
	cp ${DESTDIR}/snapshot/tools/* ${RELEASEDIR}/tools
	cd ${RELEASEDIR} && md5 tools/* >>MD5
	cd ${RELEASEDIR} && cksum tools/* >>CKSUM
d251 2
a252 2
	-cd ${RELEASEDIR} && sort -o MD5 MD5
	-cd ${RELEASEDIR} && sort -o CKSUM -k 3 CKSUM
d343 1
a343 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.43 2004/07/13 20:29:06 tg Exp $$'; \
@


1.43
log
@add /etc/malloc.conf to base and -g to cflags - for snapshots ;)
we want our users to _test_ that damn thing, for example the
suddenly crashing xterm on copy'n'paste...
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.42 2004/06/17 22:06:44 tg Exp $
d297 1
a297 1
	cd ${.CURDIR}/../distrib && ${SUDO} ${MAKE} \
d342 1
a342 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.42 2004/06/17 22:06:44 tg Exp $$'; \
@


1.42
log
@sync after make b-r with no X-Window or floppy built,
only bsd and bsd.rd (and the ISO)
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.41 2004/06/14 00:25:39 tg Exp $
d66 3
d342 1
a342 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.41 2004/06/14 00:25:39 tg Exp $$'; \
@


1.41
log
@First (probably not working[1]) attempt at modernizing the framework:
* MANZ, MANPS, NOPROFILE die (always set to false, false, true)
* Fortran generating code for <bsd.prog.mk> dies (pascal to follow)
* GLOBAL_AUTOCONF_CACHE dies (birth of <bsd.gnuwrap.mk> to follow...)
* sanitize my head and rewrite certain pieces of certain Makefiles
* move most mk.conf functionality out of there, so a system
  without mk.conf works really well(TM)
* attempt at synching docs with reality

[1] First update *.mk, then remove old mk.conf and mk.conf.local,
    then install new mk.conf and adapt it to suit your needs.

Why don't the OpenBSD people modernize parts of this? The indenting
is really really bad in places, and MANSUBDIR was... well. I have
done it with 1/3 of the code now, and it works. Even better.

There will definitively follow more ;-)
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.40 2004/06/09 15:16:58 tg Exp $
d226 3
a228 2
	    HAS_GCC2="${HAS_GCC2:L}" HAS_GCC3="${HAS_GCC3:L}" \
	    ${SUDO} ${SHELL} ${BSDSRCDIR}/scripts/maketars ${OSrev}
d339 1
a339 1
		echo '#    $$MirBSD: src/etc/Makefile,v 1.40 2004/06/09 15:16:58 tg Exp $$'; \
@


1.40
log
@adjust with new zoneinfo stuff
simplify
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.39 2004/05/23 20:48:21 tg Exp $
d208 1
a208 1
	cd ${DESTDIR}/etc/ssl/certs && sh ${.CURDIR}/ssl.certs.shar && \
d210 1
a210 1
	cd ${DESTDIR}/etc/mail/certs && sh ${.CURDIR}/ssl.certs.shar && \
d227 1
a227 1
	    ${SUDO} sh ${BSDSRCDIR}/scripts/maketars ${OSrev}
d301 6
d310 7
a316 4
		    -e '//d' ${.CURDIR}/${_i}; \
	    else \
		sed -e '/@@@@MDPART@@@@/d' ${.CURDIR}/${_i}; \
	  fi >"$@@"
d338 1
a338 1
		echo '#    $$MirBSD: Makefile,v 1.206 2004/05/04 23:37:04 deraadt Exp $$'; \
@


1.39
log
@first soft attempt to merge
add learn dirs to mtree
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.38 2004/05/02 16:37:12 tg Exp $
d5 1
a5 1
LOCALTIME=	right/UTC
d272 1
a272 1
man: ${.CURDIR}/../share/man/man8/man.${M}/MAKEDEV.8
d280 2
a281 3
${.CURDIR}/../share/man/man8/man.${M}/MAKEDEV.8: ${MAKEDEVDOC} etc.${M}/MAKEDEV.md
	m4 -DMACHINE=${M} MAKEDEV.man > \
	    ${.CURDIR}/../share/man/man8/man8.${M}/MAKEDEV.8
d326 1
a326 1
DHSIZE=1024 1536 2048 3072 4096
d329 1
d336 1
a336 1
	) > moduli
@


1.38
log
@* make use of capabilities (HAS_GCC2, HAS_GCC3) in
  - descending into gnu/gcc or gnu/egcs/gcc directory
  - distribution set lists
* fix gcc2 -femit-memmove
* document changes in manpages
* install cccp and gcc-local manpages from gnu/doc/
* install gcc3 /usr/libexec/cpp if HAS_GCC2=no
* fold gpcrts into gcc3 again, since utils are now external,
  and don't warn on installation any more
* fix calls to scripts
@
text
@d1 2
a2 2
# $MirBSD: src/etc/Makefile,v 1.37 2004/05/02 15:20:55 tg Exp $
# $OpenBSD: Makefile,v 1.192 2004/01/12 23:58:00 todd Exp $
d17 1
a17 1
BIN1=	bootptab changelist ccd.conf csh.cshrc csh.login csh.logout \
d25 1
a25 1
	dhclient.conf mailer.conf bgpd.conf wsconsctl.conf
d98 1
d124 1
a124 3
		    ${DESTDIR}/etc/skel/.profile; \
		${INSTALL} -c -o root -g wheel -m 600 dot.rhosts \
		    ${DESTDIR}/etc/skel/.rhosts
d269 2
d272 1
d274 1
a274 1
etc.${M}/MAKEDEV: MAKEDEV.sub MAKEDEV.mi etc.${M}/MAKEDEV.md
d280 5
a284 1
allarchs: MAKEDEV.sub MAKEDEV.mi
d286 1
a286 1
	    ${MAKE} M=$$m m4; done
d326 11
@


1.37
log
@add usefil targets for updating generated files
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.36 2004/04/30 18:29:50 tg Exp $
d226 3
a228 2
	cd ${.CURDIR}/../distrib/lists && NO_GCC3="${NO_GCC3}" \
	     ${SUDO} sh ${BSDSRCDIR}/scripts/maketars ${OSrev}
@


1.36
log
@sync after make build release (without X-Window)
get rid of some warnings
don't build pppd support into floppy any more, it just won't fit by chance
fix partial building as user
@
text
@d1 1
a1 1
# $MirBSD: src/etc/Makefile,v 1.35 2004/03/11 20:56:12 tg Exp $
d289 30
@


1.35
log
@- sync distrib lists
- some small build fixes
- some warning fixes

That's pretty much all of it. Now, there'll be testing, and
after that, watch http://symlink.lu/ or http:///..org/  ;-)
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.34 2004/03/11 18:35:22 tg Exp $
a285 1
.ifndef	CONTINUE_RELEASE
d287 2
a288 2
.endif
	cd ${.CURDIR}/../distrib && ${MAKE} && exec ${SUDO} ${MAKE} install
@


1.34
log
@use tee for creating the MD5 file, because sudo doesn't do output redirection
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.33 2004/03/09 21:10:41 tg Exp $
d49 1
a49 1
.if defined(DESTDIR)
d240 1
a240 1
.if defined(MACHINE_HAS_TOOLS)
@


1.33
log
@* nuke obsolete files and parts of files
* enable pascal frontend
* enable CPIO naming convention:
  sv4cpio = .cpio
  sv4crc  = .cpio
  sv4cpio gzipped = .ngz (newc/gz)
  svrcrc  gzipped = .cgz (crc/gz)
* all packages are .cgz, all sets are .ngz
* add hooks for gjc frontend
* add stubbed out gpc and gjc rts hooks in src/gnu/gcc/Makefile
* enable java frontend (with almost no changes; this is what I
  call a _really_ nice langspec-subdir... amazing)
* bump patchlevel for these changes
* better document some changes
* matthieu@@openbsd.org assured me we need no X piclibs any more
* improve comments
* export whole libz to XFree86 .a modules
* correct usage of languages when bootstrapping gcc
* fix MKC_PGCC when USE_GCC3=no (since USE_GCC3 is a post-#7
  thing, and ports/lang/egcs is not available for -current)
* install man- and texinfopages for gpc

most of this stuff is tested. however, I *strongly* recommend
to not update, but rather wait for the next snapshot.

Now missing:
* pascal RTS
* a port for libgjc (I won't like it in base, due to the
  _heavy_ overhead (jar, ffi, boehm-gc*cough*, ...), but
  since the compiler is there, it should be easy)
* test pascal (c, cp, f, objc, and ada are fine already)
* test gcov? (proto is fine, all right)
* documentation improvements
* quality tests and improvements
* more ~/.etc
* get the damn cvs conflict script right ;)

Next projects:
* update binutils
* sync with openbsd
* rewrite large parts of build system
* write boot loader
* rewrite install system
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.32 2004/01/29 21:32:20 tg Exp $
d236 1
a236 1
		    >MD5
@


1.32
log
@the first part of making a release (non-X)
* sync sets (for now)
* mention set sizes in INSTALL.i386
* install all files, but not more than wanted
* fix build time warnings
  (the mktemp in lpd is said to be safe)
* update docs a bit
* the eqn -> neqn move
* improved man page generation
* anoncvsbin removes tmp before making new symlink
* sendmail generated files are now in sendmail, and
  SKIPDIRS is checked before (asked for by Waldemar Brodkorb)
* more SKIPDIR checks, mostly for GNU stuff
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.31 2004/01/27 17:41:36 tg Exp $
d235 1
a235 1
		md5 bsd!(*.gz) *boot* *BOOT* INSTALL.* *.fs *.iso *.gz *.tgz \
d238 1
a238 1
		cksum bsd!(*.gz) *boot* *BOOT* INSTALL.* *.fs *.iso *.gz *.tgz \
a249 4
snapshot: distribution snap_pre snap_tar snap_md
	cd ${DESTDIR}/snapshot && cksum * >CKSUMS
	cd ${DESTDIR}/snapshot && md5 * >MD5

a252 31

snap_tar:
	cd ${DESTDIR} && tar cf - bin \
	    | ${GZIP} ${GZIPFLAGS} >snapshot/bin.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - dev \
	    | ${GZIP} ${GZIPFLAGS} >snapshot/dev.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - .profile .cshrc altroot etc home mnt \
	    root stand sys tmp | ${GZIP} ${GZIPFLAGS} \
	    >snapshot/etc.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - sbin \
	    | ${GZIP} ${GZIPFLAGS} >snapshot/sbin.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - usr/bin \
	    | ${GZIP} ${GZIPFLAGS} >snapshot/usr.bin.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - usr/games \
	    | ${GZIP} ${GZIPFLAGS} >snapshot/usr.games.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - usr/include \
	    | ${GZIP} ${GZIPFLAGS} >snapshot/usr.include.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - usr/lib \
	    | ${GZIP} ${GZIPFLAGS} >snapshot/usr.lib.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - usr/libexec \
	    | ${GZIP} ${GZIPFLAGS} >snapshot/usr.libexec.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - usr/mdec usr/libdata usr/lkm usr/local \
	    usr/src usr/obj | ${GZIP} ${GZIPFLAGS} \
	    >snapshot/usr.misc.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - usr/sbin \
	    | ${GZIP} ${GZIPFLAGS} >snapshot/usr.sbin.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - usr/share \
	    | ${GZIP} ${GZIPFLAGS} >snapshot/usr.share.tar${GZIPEXT}
	cd ${DESTDIR} && tar cf - var \
	    | ${GZIP} ${GZIPFLAGS} >snapshot/var.tar${GZIPEXT}
	cd ../distrib/notes; ${MAKE}; ${MAKE} install
@


1.31
log
@first part of mergeing OpenBSD and fixing whitespace and RCS IDs
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.30 2004/01/21 12:00:10 tg Exp $
d12 2
d189 3
d193 1
a194 1
	cd ../usr.sbin/httpd && exec ${MAKE} -f Makefile.bsd-wrapper distribution
d196 7
a202 1
	cd ../gnu/usr.bin/lynx && exec ${MAKE} -f Makefile.bsd-wrapper distribution
a213 7
distribution-etc-root-var-postinstall:
	/usr/libexec/sendmail/sendmail -C${DESTDIR}/etc/mail/sendmail.cf \
	    -bi -O AliasFile=${DESTDIR}/etc/mail/aliases \
	    -O DontBlameSendmail=mapinunsafedirpath
	cd ${DESTDIR}/etc/mail/ && \
	    ${DESTDIR}/usr/sbin/makemap hash access.db <access

a216 1
	exec ${SUDO} ${MAKE} distribution-etc-root-var-postinstall
d321 4
a324 2
	cd ${.CURDIR}/../distrib && \
	    ${MAKE} cleandir && ${MAKE} && exec ${SUDO} ${MAKE} install
@


1.30
log
@fix building (scripts) a release
@
text
@d1 2
a2 2
# $MirBSD: Makefile,v 1.29 2004/01/20 20:29:32 tg Exp $
# $OpenBSD: Makefile,v 1.188 2003/12/24 20:37:03 henning Exp $
@


1.29
log
@apparently final cleanup
 * forgotten commit in etc/Makefile adjusting for path changes
 * cleanup in Pascal
 * move common parts for all gcc-suite into common file
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.28 2004/01/20 19:22:16 tg Exp $
d223 2
a224 2
	cd ${.CURDIR}/../distrib/lists && \
	    exec ${SUDO} sh ${BSDSRCDIR}/scripts/maketars ${OSrev}
@


1.28
log
@* nuke duplicate code
* automatically md5 the X sets
* move distrib/sets/lists/* and X-Window/distrib/sets/lists/*
  into a common distrib/lists/* (subdir'd, though)
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.27 2004/01/03 01:37:42 tg Exp $
d224 1
a224 1
	    exec ${SUDO} sh ${.CURDIR}/../distrib/sets/maketars ${OSrev}
@


1.27
log
@merge OpenBSD configuration files, and move all fles to one place
@
text
@d1 2
a2 2
#	$MirBSD: Makefile,v 1.26 2004/01/03 01:25:09 tg Exp $
#	$OpenBSD: Makefile,v 1.188 2003/12/24 20:37:03 henning Exp $
d6 1
a6 2

NOOBJ=	oobj
d221 4
a224 2
	cd ${.CURDIR}/../distrib/notes && ${MAKE} && exec ${SUDO} ${MAKE} install
	cd ${.CURDIR}/../distrib/sets && exec ${SUDO} sh maketars ${OSrev}
@


1.26
log
@merge OpenBSD
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.25 2003/12/17 18:19:20 tg Exp $
a194 5
	${INSTALL} -c -o root -g ${BINGRP} -m 644 aliases \
	    ${DESTDIR}/etc/mail/aliases
	/usr/libexec/sendmail/sendmail -C${DESTDIR}/etc/mail/sendmail.cf \
	    -bi -O AliasFile=${DESTDIR}/etc/mail/aliases \
	    -O DontBlameSendmail=mapinunsafedirpath
d205 3
@


1.25
log
@better handling of machdep files
add mk.conf machdep for sparc (ie, no gcc3, no X for now)
@
text
@d1 2
a2 2
# $MirBSD: Makefile,v 1.23 2003/12/06 00:55:50 tg Exp $
# $OpenBSD: Makefile,v 1.187 2003/10/31 04:04:05 drahn Exp $
d23 2
a24 2
	shells spamd.conf weekly etc.${MACHINE}/disktab \
	dhclient.conf mailer.conf profile wsconsctl.conf
@


1.24
log
@second (piecewise) attempt to merge MirBSD #7ter into HEAD
@
text
@d24 4
a27 1
	dhclient.conf mailer.conf mk.conf profile wsconsctl.conf
d79 11
a89 5
	sed -e '/@@@@MDPART@@@@/r${.CURDIR}/etc.${MACHINE}/syslog.conf.md' \
	    -e '//d' ${.CURDIR}/syslog.conf >${DESTDIR}/etc/syslog.conf && \
	    chown ${BINOWN} ${DESTDIR}/etc/syslog.conf && \
	    chgrp ${BINGRP} ${DESTDIR}/etc/syslog.conf && \
	    chmod 644 ${DESTDIR}/etc/syslog.conf
@


1.23
log
@allow "make distrib-dirs" to function without DESTDIR set
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.22 2003/12/04 17:19:44 tg Exp $
d155 1
d160 1
d284 1
@


1.22
log
@by wish of wbx@@, split syslog.conf into mi and md part
wishes? feedback?
@
text
@d1 1
a1 1
# $MirBSD: Makefile,v 1.21 2003/12/03 21:50:56 tg Exp $
d44 12
d57 1
a57 1
distribution-etc-root-var distribution distrib-dirs release snapshot:
a205 10

distrib-dirs:
	if [ ! -d ${DESTDIR}/. ]; then \
		${INSTALL} -d -o root -g wheel -m 755 ${DESTDIR}; \
	fi
	mtree -qdef mtree/4.4BSD.dist -p ${DESTDIR}/ -U
	if [ ! -d ${DESTDIR}/usr/src ]; then \
		${INSTALL} -d -o root -g wsrc -m 775 ${DESTDIR}/usr/src; \
	fi
	cd ${DESTDIR}/; rm -f sys; ln -s usr/src/sys sys
@


1.21
log
@merge cvs import, etc.
@
text
@d1 2
a2 2
#	$MirBSD: Makefile,v 1.20 2003/10/29 13:42:44 tg Exp $
#	$OpenBSD: Makefile,v 1.187 2003/10/31 04:04:05 drahn Exp $
d23 1
a23 1
	shells spamd.conf syslog.conf weekly etc.${MACHINE}/disktab \
d64 5
@


1.20
log
@sync what we get after the first installation with what mtree
(by means of the daily security script run) expects
@
text
@d1 2
a2 2
#	$MirBSD: Makefile,v 1.19 2003/09/27 14:14:56 tg Exp $
#	$OpenBSD: Makefile,v 1.184 2003/08/21 19:10:19 frantzen Exp $
d73 1
@


1.19
log
@Install the following directories *NEW* by default:
o /etc/mail/certs
	content: same as /etc/ssl/certs.
		 (i.e. a hashed store of X509v3 CA Certificates)
o /etc/mail/private
	sendmail.key
	sendmail.cer
		 (i.e. a snake-oil STARTTLS certificate, so sendmail
		  at least encrypts anything that goes over the wire)
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.18 2003/09/02 00:45:41 tg Exp $
d51 2
a52 1
	cat etc.${MACHINE}/ttys ttys.pty > ${DESTDIR}/etc/ttys && \
d56 1
a56 1
	cat sysctl.conf etc.${MACHINE}/sysctl.conf > ${DESTDIR}/etc/sysctl.conf && \
d60 1
a60 1
	cat fbtab.head etc.${MACHINE}/fbtab fbtab.tail > ${DESTDIR}/etc/fbtab && \
d215 1
a215 1
		    > MD5
d218 1
a218 1
		    > CKSUM
d230 2
a231 2
	cd ${DESTDIR}/snapshot && cksum * > CKSUMS
	cd ${DESTDIR}/snapshot && md5 * > MD5
d239 1
a239 1
	    | ${GZIP} ${GZIPFLAGS} > snapshot/bin.tar${GZIPEXT}
d241 1
a241 1
	    | ${GZIP} ${GZIPFLAGS} > snapshot/dev.tar${GZIPEXT}
d244 1
a244 1
	    > snapshot/etc.tar${GZIPEXT}
d246 1
a246 1
	    | ${GZIP} ${GZIPFLAGS} > snapshot/sbin.tar${GZIPEXT}
d248 1
a248 1
	    | ${GZIP} ${GZIPFLAGS} > snapshot/usr.bin.tar${GZIPEXT}
d250 1
a250 1
	    | ${GZIP} ${GZIPFLAGS} > snapshot/usr.games.tar${GZIPEXT}
d252 1
a252 1
	    | ${GZIP} ${GZIPFLAGS} > snapshot/usr.include.tar${GZIPEXT}
d254 1
a254 1
	    | ${GZIP} ${GZIPFLAGS} > snapshot/usr.lib.tar${GZIPEXT}
d256 1
a256 1
	    | ${GZIP} ${GZIPFLAGS} > snapshot/usr.libexec.tar${GZIPEXT}
d259 1
a259 1
	    > snapshot/usr.misc.tar${GZIPEXT}
d261 1
a261 1
	    | ${GZIP} ${GZIPFLAGS} > snapshot/usr.sbin.tar${GZIPEXT}
d263 1
a263 1
	    | ${GZIP} ${GZIPFLAGS} > snapshot/usr.share.tar${GZIPEXT}
d265 1
a265 1
	    | ${GZIP} ${GZIPFLAGS} > snapshot/var.tar${GZIPEXT}
d286 1
a286 1
	m4 -DMACHINE=${M} MAKEDEV.mi > etc.${M}/.MAKEDEV.tmp && \
@


1.19.2.1
log
@this is a glance of an idea for sparc support...
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.19 2003/09/27 14:14:56 tg Exp $
a272 1
MAKEDEVARCHS+= sparc
@


1.19.2.2
log
@ISDN files only for i386
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.19.2.1 2003/10/23 20:45:13 tg Exp $
a135 1
.if ${MACHINE} == "i386"
a139 1
.endif
@


1.19.2.2.2.1
log
@(USABILITY) MFC:
 * fix perms for inetd.conf
 * fix /dev/ttyC4 being referenced on SPARC
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.19.2.2 2003/10/23 21:46:44 tg Exp $
d6 2
a7 1
NOOBJ=		noobj
a12 2
.include <bsd.own.mk>

d23 1
a23 1
	shells spamd.conf weekly etc.${MACHINE}/disktab profile \
a25 3
# machine dependent parts
BINMD=	syslog.conf

d51 1
a51 2
	chmod 640 ${DESTDIR}/etc/inetd.conf
	cat etc.${MACHINE}/ttys ttys.pty >${DESTDIR}/etc/ttys && \
a62 11
.for _i in ${BINMD}
	if [ -e ${.CURDIR}/etc.${MACHINE}/${_i}.md ]; then \
		sed -e '/@@@@MDPART@@@@/r${.CURDIR}/etc.${MACHINE}/${_i}.md' \
		    -e '//d' ${.CURDIR}/${_i}; \
	    else \
		sed -e '/@@@@MDPART@@@@/d' ${.CURDIR}/${_i}; \
	  fi >${DESTDIR}/etc/${_i}; \
	    chown ${BINOWN} ${DESTDIR}/etc/${_i} && \
	    chgrp ${BINGRP} ${DESTDIR}/etc/${_i} && \
	    chmod 644 ${DESTDIR}/etc/${_i}
.endfor
@


1.18
log
@enable the anoncvssh and anoncvsbin tools,
an applied example of why the crunchtools are good
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.17 2003/09/01 17:36:40 tg Exp $
d175 2
@


1.17
log
@o ~/.ssh -> ~/.etc/ssh
o bump MirBSD/SSH patchlevel
o adjust the rest of the tree accordingly
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.16 2003/08/31 20:54:15 tg Exp $
d164 1
@


1.16
log
@Merge import of OpenBSD source, ports and XF4 tree.

While here,
o clean up differences where possible
o whitespace cleanup
o ifdef ./. if defined()
o '...' ./. "..."
o echo foo > bar ./. echo foo >bar
o `...` ./. $(...) ./. $$(...)
o `...' ./. '...'
o modernize "our" tree, e.g. WWW in ports
o fix some typos and brainos introduced when renaming OpenBSD to MirBSD
o use hardware 80387 by default
o migrate Apache 1.3.28 OpenBSD ./. MirBSD ./. KAME
o work around as many CVS bugs as possible (add back/delete files, ...)

Synchronize stuff, ready for ongoing changes.
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.15 2003/07/05 15:38:16 tg Exp $
d86 1
a86 1
		    ${DESTDIR}/etc/skel/.ssh/known_hosts; \
@


1.15
log
@Install the currently known X509 Root CA Certificates into /etc/ssl/certs
by default. Source: Internet Explorer, Netscape, Websites of CAs
This is so a future lynx version can automatically find them.

TRUST INFORMATION: If you don't trust this, feel free to compare
the certificates with the one in your favourite #1 trusted
webbrowser. gl hf
@
text
@d1 2
a2 2
#	$MirBSD: Makefile,v 1.14 2003/06/30 17:28:47 tg Exp $
#	$OpenBSD: Makefile,v 1.183 2003/06/27 21:26:19 david Exp $
d71 1
@


1.14
log
@make the access database for sendmail after
actually installing the makemap tool

makes a new postinstall target in src/etc/Makefile
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.13 2003/06/29 19:45:46 tg Exp $
d172 2
@


1.13
log
@merge the import
amd (automount dmon) bites the dust
rewrite fake-NLS emulation, copyright to me
foobar! fnord!
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.12 2003/06/08 21:21:08 tg Exp $
d173 4
d180 1
@


1.12
log
@echo -> @@echo
@
text
@d1 2
a2 2
#	$MirBSD: Makefile,v 1.11 2003/06/07 19:43:48 tg Exp $
#	$OpenBSD: Makefile,v 1.182 2003/03/30 07:43:02 deraadt Exp $
a95 3
	cd amd; \
		${INSTALL} -c -o root -g wheel -m 644 master.sample \
		    ${DESTDIR}/etc/amd
@


1.11
log
@install the skeleton known_hosts file to ~/.ssh/

idea from gecko2's playing with adduser on my
raid test box
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.10 2003/06/07 14:26:44 tg Exp $
d276 1
a276 1
	echo "==> etc.${M}/MAKEDEV"
@


1.10
log
@prevent cases of PEBKAC at my place
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.9 2003/04/12 20:20:17 tg Exp $
d85 1
a85 1
		    ${DESTDIR}/etc/skel/.ssh.known_hosts; \
@


1.9
log
@clean up and allow PPPoE on RAMDISK_CD as well
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.8 2003/04/12 18:25:52 tg Exp $
d284 4
@


1.8
log
@sample ISDN configuration that ought to work
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.7 2003/04/10 20:10:50 tg Exp $
a111 2
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 600 isdnd.sppp.sample \
@


1.7
log
@clean up the cvs import mess

nb, this doesnt mean the tree builds.
its bed time
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.6 2003/04/06 14:52:59 tg Exp $
d113 2
d141 2
@


1.6
log
@More arch-removal trimming
Integrate MAKEDEV.i4b into the main m4 MAKEDEV scripts
adjust m4 scripts to "our" RCSId
@
text
@d1 2
a2 2
#	$MirBSD: Makefile,v 1.5 2003/04/06 14:20:21 tg Exp $
#	$OpenBSD: Makefile,v 1.181 2003/03/24 18:15:27 drahn Exp $
@


1.5
log
@add sample ISDN rc file from NetBSD
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.4 2003/03/29 21:33:32 tg Exp $
d24 1
a24 7
	dhclient.conf mailer.conf mk.conf profile

.if (${MACHINE} == "alpha" || ${MACHINE} == "hppa" || \
     ${MACHINE} == "i386" || ${MACHINE} == "macppc" || \
     ${MACHINE} == "sparc" || ${MACHINE} == "sparc64")
BIN1+=	wsconsctl.conf
.endif
a72 2
	${INSTALL} -c -o ${BINOWN} -g ${BINGRP} -m 555 \
	    MAKEDEV.i4b ${DESTDIR}/dev
a261 3
MAKEDEVARCHS+= alpha
MAKEDEVARCHS+= hp300
MAKEDEVARCHS+= hppa
a262 8
MAKEDEVARCHS+= mac68k
MAKEDEVARCHS+= macppc
MAKEDEVARCHS+= mvme68k
MAKEDEVARCHS+= mvme88k
#MAKEDEVARCHS+= mvmeppc
MAKEDEVARCHS+= sparc
MAKEDEVARCHS+= sparc64
#MAKEDEVARCHS+= vax
@


1.4
log
@merge OpenBSD cvs import conflicts
enable /etc/isdn directory and MAKEDEV.i4b
@
text
@d1 1
a1 1
#	$MirBSD: Makefile,v 1.3 2003/03/24 21:25:05 tg Exp $
d146 2
@


1.3
log
@Since we are going to support ISDN in the future,
I can add the ISDN ppp.conf example I found as well now,
while synching examples to what can actually be used.

Add ppp and pppd configuration examples and /etc/ppp/peers
directory for pppd(8).
@
text
@d1 2
a2 2
#	$MirBSD: Makefile,v 1.2 2003/03/23 21:47:59 tg Exp $
#	$OpenBSD: Makefile,v 1.180 2003/03/10 21:08:44 millert Exp $
d79 2
d209 2
a210 1
		md5 bsd!(*.gz) *boot* *BOOT* INSTALL.* *.fs *.gz *.tgz > MD5
d212 2
a213 1
		cksum bsd!(*.gz) *boot* *BOOT* INSTALL.* *.fs *.gz *.tgz > CKSUM
@


1.2
log
@Merge MirBSD-old entirely
Remove krb, yp, afs, GPL'd stuff in kernel
Adjust some other stuff

Not to be compiled yet...
@
text
@d1 1
a1 1
#	$MirBSD: obsd.tygs,v 1.44 2003/03/22 22:33:30 tg Exp $
d119 4
a122 2
		${INSTALL} -c -o root -g wheel -m 600 chatscript.sample \
		    ${DESTDIR}/etc/ppp; \
@


1.1
log
@Initial revision
@
text
@d1 1
d5 1
a5 1
LOCALTIME=	US/Pacific
d24 1
a24 1
	dhclient.conf mailer.conf
a34 5
NAMEDB=	localhost.rev localhost.v6.rev localhost.zone root.cache
PCS=	pcs750.bin
WCS1=	wcs fppwcs poc poc1 poc2 fppoc
WCS2=	fpevent fppwcs fppwcs_dual hdcwcs load_diags start_fpp wcs wcs_dual

a81 2
		${INSTALL} -c -o root -g wheel -m 600 dot.klogin \
		    ${DESTDIR}/root/.klogin; \
d90 2
a101 16
	cd kerberosIV; \
		${INSTALL} -c -o root -g wheel -m 644 README \
		    ${DESTDIR}/etc/kerberosIV; \
		${INSTALL} -c -o root -g wheel -m 644 krb.conf \
		    ${DESTDIR}/etc/kerberosIV; \
		${INSTALL} -c -o root -g wheel -m 644 krb.realms \
		    ${DESTDIR}/etc/kerberosIV; \
		${INSTALL} -c -o root -g wheel -m 644 krb.extra \
		    ${DESTDIR}/etc/kerberosIV; \
		${INSTALL} -c -o root -g wheel -m 644 krb.equiv \
		    ${DESTDIR}/etc/kerberosIV
	cd kerberosV; \
		${INSTALL} -c -o root -g wheel -m 644 README \
		    ${DESTDIR}/etc/kerberosV; \
		${INSTALL} -c -o root -g wheel -m 644 krb5.conf.example \
		    ${DESTDIR}/etc/kerberosV
a116 4
		${INSTALL} -c -o root -g wheel -m 600 options \
		    ${DESTDIR}/etc/ppp; \
		${INSTALL} -c -o root -g wheel -m 600 options.leaf \
		    ${DESTDIR}/etc/ppp; \
a130 11
	cd afs; \
		${INSTALL} -c -o root -g wheel -m 644 afsd.conf \
		    ${DESTDIR}/etc/afs; \
		${INSTALL} -c -o root -g wheel -m 644 ThisCell \
		    ${DESTDIR}/etc/afs; \
		${INSTALL} -c -o root -g wheel -m 644 CellServDB \
		    ${DESTDIR}/etc/afs; \
		${INSTALL} -c -o root -g wheel -m 644 SuidCells \
		    ${DESTDIR}/etc/afs; \
		${INSTALL} -c -o root -g wheel -m 644 README \
		    ${DESTDIR}/etc/afs
a132 2
		    ${DESTDIR}/etc/systrace; \
		${INSTALL} -c -o root -g wheel -m 600 usr_sbin_named \
a133 15
	cd bind; \
		${INSTALL} -c -o root -g named -m 640 named-simple.conf \
		    ${DESTDIR}/var/named/etc/named.conf; \
		${INSTALL} -c -o root -g named -m 640 named-*.conf \
		    ${DESTDIR}/var/named/etc; \
		${INSTALL} -c -o root -g wheel -m 644 db.localhost \
		    ${DESTDIR}/var/named/standard/localhost; \
		${INSTALL} -c -o root -g wheel -m 644 db.loopback \
		    ${DESTDIR}/var/named/standard/loopback; \
		${INSTALL} -c -o root -g wheel -m 644 db.loopback6.arpa \
		    ${DESTDIR}/var/named/standard/loopback6.arpa; \
		${INSTALL} -c -o root -g wheel -m 644 db.loopback6.int \
		    ${DESTDIR}/var/named/standard/loopback6.int; \
		${INSTALL} -c -o root -g wheel -m 644 root.hint \
		    ${DESTDIR}/var/named/standard; \
a149 14
	${INSTALL} -c -o ${BINOWN} -g wheel -m 640 /dev/null \
		${DESTDIR}/var/log/authlog
	${INSTALL} -c -o ${BINOWN} -g wheel -m 640 /dev/null \
		${DESTDIR}/var/log/daemon
	${INSTALL} -c -o ${BINOWN} -g wheel -m 600 /dev/null \
		${DESTDIR}/var/log/failedlogin
	${INSTALL} -c -o ${BINOWN} -g wheel -m 640 /dev/null \
		${DESTDIR}/var/log/ftpd
	${INSTALL} -c -o ${BINOWN} -g wheel -m 644 /dev/null \
		${DESTDIR}/var/log/lastlog
	${INSTALL} -c -o ${BINOWN} -g wheel -m 640 /dev/null \
		${DESTDIR}/var/log/lpd-errs
	${INSTALL} -c -o ${BINOWN} -g wheel -m 600 /dev/null \
		${DESTDIR}/var/log/maillog
a151 2
	${INSTALL} -c -o ${BINOWN} -g wheel -m 600 /dev/null \
		${DESTDIR}/var/log/secure
a155 2
	${INSTALL} -c -o ${BINOWN} -g wheel -m 640 /dev/null \
		${DESTDIR}/var/log/xferlog
a159 6
.if ${MACHINE} == "vax"
	uudecode -p etc.vax/${PCS}.uu > ${DESTDIR}/${PCS} && \
	    chown ${BINOWN} ${DESTDIR}/${PCS} && \
	    chgrp ${BINGRP} ${DESTDIR}/${PCS} && \
	    chmod 644 ${DESTDIR}/${PCS}
.endif
a160 1
	cd ../usr.sbin/ypserv/ypinit && exec ${MAKE} distribution
@


1.1.1.1
log
@Import OpenBSD 3.3 source repository from CTM 3132 the first time
This opens an OpenBSD-mirabile (aka MirBSD) repository.

### MirBSD is:
# Copyright (c) 1982-2003 by Thorsten "mirabile" Glaser <x86@@ePost.de>
# Copyright  1968-2003  The authors of And contributors to UNIX, the
#       C Language, BSD/Berkeley Unix; 386BSD, NetBSD 1.1 and OpenBSD.
#
# Anyone who obtained a copy of this work is hereby permitted to freely use,
# distribute, modify, merge, sublicence, give away or sell it as long as the
# authors are given due credit and the following notice is retained:
#
# This work is provided "as is", with no explicit or implicit warranty what-
# soever. Use it only at your own risk. In no event may an author or contri-
# butor be held liable for any damage, directly or indirectly, that origina-
# ted through or is caused by creation or modification of this work.

MirBSD is my private tree. MirBSD does not differ very much from OpenBSD
and intentionally tracks OpenBSD. That's why it _is_ OpenBSD, just not the
official one. It's like with DarrenBSD.

At time of this writing, no advertising for MirBSD must be done,
because the advertising clause has not yet been sorted out.

http://templeofhate.com/tglaser/MirBSD/index.php
@
text
@@


1.1.1.2
log
@Import OpenBSD repository of CTM 3155 (roughly today at noon).
Mostly in order to go 3.3-current and ease further merges of
both OpenBSD and ELFdiffs after the MirBSD has been enabled
to build again.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.181 2003/03/24 18:15:27 drahn Exp $
d282 1
a282 2
		md5 bsd!(*.gz) *boot* *BOOT* INSTALL.* *.fs *.iso *.gz *.tgz \
		    > MD5
d284 1
a284 2
		cksum bsd!(*.gz) *boot* *BOOT* INSTALL.* *.fs *.iso *.gz *.tgz \
		    > CKSUM
@


1.1.1.3
log
@Import OpenBSD cvs as of roughly 11:11 UTC today,
or CTM delta 3188/3189/3190.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.182 2003/03/30 07:43:02 deraadt Exp $
d4 1
a4 1
LOCALTIME=	Canada/Mountain
@


1.1.1.4
log
@Sync OpenBSD source tree from -current CVS.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.183 2003/06/27 21:26:19 david Exp $
d106 11
@


1.1.1.5
log
@Pull in a bit of current OpenBSD, to the least
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.184 2003/08/21 19:10:19 frantzen Exp $
a80 1
	${INSTALL} -c -o root -g wheel -m 644 pf.os ${DESTDIR}/etc
@


1.1.1.6
log
@Release Time. Synchronize with OpenBSD 3.4-current (base system).
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.185 2003/09/23 21:37:11 millert Exp $
d233 5
a237 1
	cd mail && exec ${MAKE} distribution
@


1.1.1.7
log
@Import selected parts of the OpenBSD base system:
 * vnd change - you'll have to re-run MAKEDEV after booting a new kernel
 * misc. changes in /etc, mostly user related
 * Perl 5.8.2 (diff to MirPorts will be committed RSN)
 * some changes to binutils
 * Updates in bc and dc
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.187 2003/10/31 04:04:05 drahn Exp $
d27 1
a27 2
     ${MACHINE} == "pegasos" || ${MACHINE} == "sparc" || \
     ${MACHINE} == "sparc64")
a81 1
	${INSTALL} -c -o root -g wheel -m 644 sensorsd.conf ${DESTDIR}/etc
@


1.1.1.8
log
@Import OpenBSD again, for various reasons.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.188 2003/12/24 20:37:03 henning Exp $
d23 1
a23 1
	dhclient.conf mailer.conf bgpd.conf
@


1.1.1.9
log
@Import OpenBSD as of today again (seems pretty stable, I hope)

Prominent changes: more bgpd, tcpmd5; tcpdump/isakmpd fixes
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.192 2004/01/12 23:58:00 todd Exp $
a337 1
MAKEDEVARCHS+= pegasos
d340 1
a340 1
MAKEDEVARCHS+= vax
@


1.1.1.10
log
@large-scale import of OpenBSD 3.5-current source base including many fixes
note: from now, we will not be binary compatible with OpenBSD apps any
longer (due to syscall numbering differences); both an OpenBSD compat and
a conversion tool for old MirOS #7 apps will be delivered later.

The src/ tree is locked from now.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.206 2004/05/04 23:37:04 deraadt Exp $
d15 14
a28 13
BIN1=	changelist ccd.conf csh.cshrc csh.login csh.logout daily dhcpd.conf \
	dhcpd.interfaces exports ftpusers ftpchroot gettytab group hosts \
	hosts.lpd inetd.conf ksh.kshrc locate.rc man.conf monthly motd \
	mrouted.conf myname netstart networks newsyslog.conf phones printcap \
	protocols rbootd.conf rc rc.conf rc.local rc.securelevel rc.shutdown \
	remote rpc security services shells spamd.conf syslog.conf weekly \
	etc.${MACHINE}/disktab dhclient.conf mailer.conf

.if ${MACHINE} == "alpha" || ${MACHINE} == "amd64" || \
    ${MACHINE} == "cats" || ${MACHINE} == "hppa" || \
    ${MACHINE} == "i386" || ${MACHINE} == "luna88k" || \
    ${MACHINE} == "macppc" || ${MACHINE} == "sparc" || \
    ${MACHINE} == "sparc64"
a80 1
	${INSTALL} -c -o root -g wheel -m 600 bgpd.conf ${DESTDIR}/etc
d106 3
a108 1
		    ${DESTDIR}/etc/skel/.profile
a329 2
MAKEDEVARCHS+= amd64
MAKEDEVARCHS+= cats
a332 1
MAKEDEVARCHS+= luna88k
d338 1
a349 2
MAKEDEVSRC=	MAKEDEV.mi MAKEDEV.sub MAKEDEV.common
MAKEDEVDOC=	MAKEDEV.man MAKEDEV.mansub MAKEDEV.common
a350 1
man: ${.CURDIR}/../share/man/man8/man.${M}/MAKEDEV.8
d352 2
a353 2
etc.${M}/MAKEDEV: ${MAKEDEVSRC} etc.${M}/MAKEDEV.md
	@@echo "==> etc.${M}/MAKEDEV"
d358 1
a358 5
${.CURDIR}/../share/man/man8/man.${M}/MAKEDEV.8: ${MAKEDEVDOC} etc.${M}/MAKEDEV.md
	m4 -DMACHINE=${M} MAKEDEV.man > \
	    ${.CURDIR}/../share/man/man8/man8.${M}/MAKEDEV.8

allarchs: ${MAKEDEVSRC} ${MAKEDEVDOC}
d360 1
a360 1
	    ${MAKE} M=$$m m4 man; done
a364 11

DHSIZE=1024 1536 2048 3072 4096
update-moduli:
	( \
		echo '#    $$OpenBSD: Makefile,v 1.206 2004/05/04 23:37:04 deraadt Exp $$'; \
		echo '# Time Type Tests Tries Size Generator Modulus'; \
		( for i in ${DHSIZE}; do \
			ssh-keygen -b $$i -G /dev/stdout; \
		done) | \
		ssh-keygen -T /dev/stdout \
	) > moduli
@


